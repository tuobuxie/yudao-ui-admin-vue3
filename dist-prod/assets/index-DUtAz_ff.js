import{d as De,a as Ve,e as Ee,u as Ne,h as te,D as I,_ as Se,I as Pe}from"./index-DmQdxAiK.js";import{_ as Oe}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as Ue}from"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import{_ as Re}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{l as qe,r as m,j as Fe,e as Le,ag as ze,m as b,q as s,J as a,B as t,u as i,I as k,$ as T,A as r,Z as ie,C as v,G as p,x as n,D as se,H as w,E as Ae}from"./form-create-_84fGzaM.js";import{d as je}from"./formatTime-BGPGB_ys.js";import{a as G,D as O}from"./index-m3HcIj_K.js";import{_ as Ye}from"./DeviceForm.vue_vue_type_script_setup_true_lang-BwX3nnCu.js";import{P as Ge}from"./index-qUQIUBhD.js";import{D as Ke}from"./index-BYF5XYz2.js";import{d as Ze}from"./download-oWiM5xVU.js";import{_ as Be}from"./DeviceGroupForm.vue_vue_type_script_setup_true_lang-DnwvXZRM.js";import{_ as He}from"./DeviceImportForm.vue_vue_type_script_setup_true_lang-U124fTkN.js";import{h as Je,aj as Qe,x as $e,Q as Me,k as We,aq as Xe,f as el,i as ll,j as al,ad as tl,al as il,a7 as sl,P as ol,V as dl,Z as cl,_ as pl,a6 as nl,ak as rl}from"./form-designer-DHHJWkD5.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./index-C9m7grCy.js";const ul={class:"p-4 relative"},ml={class:"flex items-center mb-3"},fl={class:"mr-2.5 flex items-center"},vl={class:"text-[16px] font-600 flex-1"},xl={class:"inline-flex items-center"},_l={class:"flex items-center text-[14px]"},yl={class:"flex-1"},gl={class:"mb-2.5 last:mb-0"},bl={class:"mb-2.5 last:mb-0"},kl={class:"mb-2.5 last:mb-0"},wl={class:"text-[#0b1d30] inline-block align-middle overflow-hidden text-ellipsis whitespace-nowrap max-w-[130px]"},Cl={class:"w-[100px] h-[100px]"},hl={class:"flex items-center px-0"},Il=qe({name:"IoTDevice",__name:"index",setup(Tl){const D=De(),{t:K}=Ve(),oe=Ee(),U=m(!0),R=m([]),Z=m(0),o=Fe({pageNo:1,pageSize:10,deviceName:void 0,productId:void 0,deviceType:void 0,nickname:void 0,status:void 0,groupId:void 0}),B=m(),q=m(!1),E=m([]),F=m([]),C=m([]),V=m("card"),de=m("/src/assets/imgs/iot/device.png"),ce=m("/src/assets/svgs/iot/card-fill.svg"),y=async()=>{U.value=!0;try{const d=await O.getDevicePage(o);R.value=d.list,Z.value=d.total}finally{U.value=!1}},N=()=>{o.pageNo=1,y()},pe=()=>{B.value.resetFields(),C.value=[],N()},H=m(),L=(d,l)=>{H.value.open(d,l)},{push:z}=Ne(),A=d=>{z({name:"IoTDeviceDetail",params:{id:d}})},J=d=>{z({name:"IoTProductDetail",params:{id:d}})},Q=async d=>{try{await D.delConfirm(),await O.deleteDevice(d),D.success(K("common.delSuccess")),await y()}catch{}},ne=async()=>{try{await D.exportConfirm(),q.value=!0;const d=await O.exportDeviceExcel(o);Ze.excel(d,"\u7269\u8054\u7F51\u8BBE\u5907.xls")}catch{}finally{q.value=!1}},re=d=>{C.value=d.map(l=>l.id)},ue=async()=>{try{await D.delConfirm(),await O.deleteDeviceList(C.value),D.success(K("common.delSuccess")),await y()}catch{}},$=m(),me=()=>{$.value.open(C.value)},M=d=>{z({name:"IoTDeviceDetail",params:{id:d},query:{tab:"model"}})},W=m(),fe=()=>{W.value.open()};return Le(async()=>{const{productId:d}=oe.query;d&&(o.productId=Number(d)),await y(),E.value=await Ge.getSimpleProductList(),F.value=await Ke.getSimpleDeviceGroupList()}),(d,l)=>{const S=Me,P=$e,g=Qe,X=We,f=Se,u=el,ve=Xe,xe=Je,ee=Re,le=il,_e=sl,j=ol,Y=Ue,ye=dl,ge=tl,be=al,ke=ll,_=pl,we=nl,Ce=cl,he=Oe,x=ze("hasPermi"),Ie=rl;return s(),b(k,null,[a(ee,null,{default:t(()=>[a(xe,{class:"-mb-15px",model:i(o),ref_key:"queryFormRef",ref:B,inline:!0,"label-width":"68px"},{default:t(()=>[a(g,{label:"\u4EA7\u54C1",prop:"productId"},{default:t(()=>[a(P,{modelValue:i(o).productId,"onUpdate:modelValue":l[0]||(l[0]=e=>i(o).productId=e),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",class:"!w-240px"},{default:t(()=>[(s(!0),b(k,null,T(i(E),e=>(s(),r(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"DeviceName",prop:"deviceName"},{default:t(()=>[a(X,{modelValue:i(o).deviceName,"onUpdate:modelValue":l[1]||(l[1]=e=>i(o).deviceName=e),placeholder:"\u8BF7\u8F93\u5165 DeviceName",clearable:"",onKeyup:ie(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:t(()=>[a(X,{modelValue:i(o).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>i(o).nickname=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0",clearable:"",onKeyup:ie(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u8BBE\u5907\u7C7B\u578B",prop:"deviceType"},{default:t(()=>[a(P,{modelValue:i(o).deviceType,"onUpdate:modelValue":l[3]||(l[3]=e=>i(o).deviceType=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u7C7B\u578B",clearable:"",class:"!w-240px"},{default:t(()=>[(s(!0),b(k,null,T(i(te)(i(I).IOT_PRODUCT_DEVICE_TYPE),e=>(s(),r(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u8BBE\u5907\u72B6\u6001",prop:"status"},{default:t(()=>[a(P,{modelValue:i(o).status,"onUpdate:modelValue":l[4]||(l[4]=e=>i(o).status=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u72B6\u6001",clearable:"",class:"!w-240px"},{default:t(()=>[(s(!0),b(k,null,T(i(te)(i(I).IOT_DEVICE_STATE),e=>(s(),r(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupId"},{default:t(()=>[a(P,{modelValue:i(o).groupId,"onUpdate:modelValue":l[5]||(l[5]=e=>i(o).groupId=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",clearable:"",class:"!w-240px"},{default:t(()=>[(s(!0),b(k,null,T(i(F),e=>(s(),r(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{class:"float-right !mr-0 !mb-0"},{default:t(()=>[a(ve,null,{default:t(()=>[a(u,{type:i(V)==="card"?"primary":"default",onClick:l[6]||(l[6]=e=>V.value="card")},{default:t(()=>[a(f,{icon:"ep:grid"})]),_:1},8,["type"]),a(u,{type:i(V)==="list"?"primary":"default",onClick:l[7]||(l[7]=e=>V.value="list")},{default:t(()=>[a(f,{icon:"ep:list"})]),_:1},8,["type"])]),_:1})]),_:1}),a(g,null,{default:t(()=>[a(u,{onClick:N},{default:t(()=>[a(f,{icon:"ep:search",class:"mr-5px"}),l[11]||(l[11]=p(" \u641C\u7D22 "))]),_:1}),a(u,{onClick:pe},{default:t(()=>[a(f,{icon:"ep:refresh",class:"mr-5px"}),l[12]||(l[12]=p(" \u91CD\u7F6E "))]),_:1}),v((s(),r(u,{type:"primary",plain:"",onClick:l[8]||(l[8]=e=>L("create"))},{default:t(()=>[a(f,{icon:"ep:plus",class:"mr-5px"}),l[13]||(l[13]=p(" \u65B0\u589E "))]),_:1})),[[x,["iot:device:create"]]]),v((s(),r(u,{type:"success",plain:"",onClick:ne,loading:i(q)},{default:t(()=>[a(f,{icon:"ep:download",class:"mr-5px"}),l[14]||(l[14]=p(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[x,["iot:device:export"]]]),v((s(),r(u,{type:"warning",plain:"",onClick:fe},{default:t(()=>[a(f,{icon:"ep:upload"}),l[15]||(l[15]=p(" \u5BFC\u5165 "))]),_:1})),[[x,["iot:device:import"]]]),v((s(),r(u,{type:"primary",plain:"",onClick:me,disabled:i(C).length===0},{default:t(()=>[a(f,{icon:"ep:folder-add",class:"mr-5px"}),l[16]||(l[16]=p(" \u6DFB\u52A0\u5230\u5206\u7EC4 "))]),_:1},8,["disabled"])),[[x,["iot:device:update"]]]),v((s(),r(u,{type:"danger",plain:"",onClick:ue,disabled:i(C).length===0},{default:t(()=>[a(f,{icon:"ep:delete",class:"mr-5px"}),l[17]||(l[17]=p(" \u6279\u91CF\u5220\u9664 "))]),_:1},8,["disabled"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(ee,null,{default:t(()=>[i(V)==="card"?(s(),r(ke,{key:0,gutter:16},{default:t(()=>[(s(!0),b(k,null,T(i(R),e=>(s(),r(be,{key:e.id,xs:24,sm:12,md:12,lg:6,class:"mb-4"},{default:t(()=>[a(ge,{class:"h-full transition-colors relative overflow-hidden","body-style":{padding:"0"}},{default:t(()=>[n("div",{class:se(["absolute top-0 left-0 right-0 h-[50px] pointer-events-none",[e.state===i(G).ONLINE?"bg-gradient-to-b from-[#eefaff] to-transparent":"bg-gradient-to-b from-[#fff1f1] to-transparent"]])},null,2),n("div",ul,[n("div",ml,[n("div",fl,[a(le,{src:i(ce),class:"w-[18px] h-[18px]"},null,8,["src"])]),n("div",vl,w(e.deviceName),1),n("div",xl,[n("div",{class:se(["w-1 h-1 rounded-full mr-1.5",e.state===i(G).ONLINE?"bg-[var(--el-color-success)]":"bg-[var(--el-color-danger)]"])},null,2),a(_e,{class:"!text-xs font-bold",type:e.state===i(G).ONLINE?"success":"danger"},{default:t(()=>[p(w(i(Pe)(i(I).IOT_DEVICE_STATE,e.state)),1)]),_:2},1032,["type"])])]),n("div",_l,[n("div",yl,[n("div",gl,[l[18]||(l[18]=n("span",{class:"text-[#717c8e] mr-2.5"},"\u6240\u5C5E\u4EA7\u54C1",-1)),a(j,{class:"text-[#0070ff]",onClick:c=>J(e.productId)},{default:t(()=>{var c;return[p(w((c=i(E).find(h=>h.id===e.productId))==null?void 0:c.name),1)]}),_:2},1032,["onClick"])]),n("div",bl,[l[19]||(l[19]=n("span",{class:"text-[#717c8e] mr-2.5"},"\u8BBE\u5907\u7C7B\u578B",-1)),a(Y,{type:i(I).IOT_PRODUCT_DEVICE_TYPE,value:e.deviceType},null,8,["type","value"])]),n("div",kl,[l[20]||(l[20]=n("span",{class:"text-[#717c8e] mr-2.5"},"\u5907\u6CE8\u540D\u79F0",-1)),n("span",wl,w(e.nickname||e.deviceName),1)])]),n("div",Cl,[a(le,{src:i(de),class:"w-full h-full"},null,8,["src"])])]),a(ye,{class:"!my-3"}),n("div",hl,[v((s(),r(u,{class:"flex-1 !px-2 !h-[32px] text-[13px]",type:"primary",plain:"",onClick:c=>L("update",e.id)},{default:t(()=>[a(f,{icon:"ep:edit-pen",class:"mr-1"}),l[21]||(l[21]=p(" \u7F16\u8F91 "))]),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),a(u,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"warning",plain:"",onClick:c=>A(e.id)},{default:t(()=>[a(f,{icon:"ep:view",class:"mr-1"}),l[22]||(l[22]=p(" \u8BE6\u60C5 "))]),_:2},1032,["onClick"]),a(u,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"info",plain:"",onClick:c=>M(e.id)},{default:t(()=>[a(f,{icon:"ep:tickets",class:"mr-1"}),l[23]||(l[23]=p(" \u6570\u636E "))]),_:2},1032,["onClick"]),l[24]||(l[24]=n("div",{class:"mx-[10px] h-[20px] w-[1px] bg-[#dcdfe6]"},null,-1)),v((s(),r(u,{class:"!px-2 !h-[32px] text-[13px]",type:"danger",plain:"",onClick:c=>Q(e.id)},{default:t(()=>[a(f,{icon:"ep:delete"})]),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):v((s(),r(Ce,{key:1,data:i(R),stripe:!0,"show-overflow-tooltip":!0,onSelectionChange:re},{default:t(()=>[a(_,{type:"selection",width:"55"}),a(_,{label:"DeviceName",align:"center",prop:"deviceName"},{default:t(e=>[a(j,{onClick:c=>A(e.row.id)},{default:t(()=>[p(w(e.row.deviceName),1)]),_:2},1032,["onClick"])]),_:1}),a(_,{label:"\u5907\u6CE8\u540D\u79F0",align:"center",prop:"nickname"}),a(_,{label:"\u6240\u5C5E\u4EA7\u54C1",align:"center",prop:"productId"},{default:t(e=>[a(j,{onClick:c=>J(e.row.productId)},{default:t(()=>{var c;return[p(w(((c=i(E).find(h=>h.id===e.row.productId))==null?void 0:c.name)||"-"),1)]}),_:2},1032,["onClick"])]),_:1}),a(_,{label:"\u8BBE\u5907\u7C7B\u578B",align:"center",prop:"deviceType"},{default:t(e=>[a(Y,{type:i(I).IOT_PRODUCT_DEVICE_TYPE,value:e.row.deviceType},null,8,["type","value"])]),_:1}),a(_,{label:"\u6240\u5C5E\u5206\u7EC4",align:"center",prop:"groupId"},{default:t(e=>{var c;return[(c=e.row.groupIds)!=null&&c.length?(s(!0),b(k,{key:0},T(e.row.groupIds,h=>(s(),r(we,{key:h,class:"ml-5px",size:"small"},{default:t(()=>{var ae;return[p(w((ae=i(F).find(Te=>Te.id===h))==null?void 0:ae.name),1)]}),_:2},1024))),128)):Ae("",!0)]}),_:1}),a(_,{label:"\u8BBE\u5907\u72B6\u6001",align:"center",prop:"status"},{default:t(e=>[a(Y,{type:i(I).IOT_DEVICE_STATE,value:e.row.status},null,8,["type","value"])]),_:1}),a(_,{label:"\u6700\u540E\u4E0A\u7EBF\u65F6\u95F4",align:"center",prop:"onlineTime",formatter:i(je),width:"180px"},null,8,["formatter"]),a(_,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:t(e=>[v((s(),r(u,{link:"",type:"primary",onClick:c=>A(e.row.id)},{default:t(()=>l[25]||(l[25]=[p(" \u67E5\u770B ")])),_:2},1032,["onClick"])),[[x,["iot:product:query"]]]),a(u,{link:"",type:"primary",onClick:c=>M(e.row.id)},{default:t(()=>l[26]||(l[26]=[p(" \u65E5\u5FD7 ")])),_:2},1032,["onClick"]),v((s(),r(u,{link:"",type:"primary",onClick:c=>L("update",e.row.id)},{default:t(()=>l[27]||(l[27]=[p(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),v((s(),r(u,{link:"",type:"danger",onClick:c=>Q(e.row.id)},{default:t(()=>l[28]||(l[28]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["data"])),[[Ie,i(U)]]),a(he,{total:i(Z),page:i(o).pageNo,"onUpdate:page":l[9]||(l[9]=e=>i(o).pageNo=e),limit:i(o).pageSize,"onUpdate:limit":l[10]||(l[10]=e=>i(o).pageSize=e),onPagination:y},null,8,["total","page","limit"])]),_:1}),a(Ye,{ref_key:"formRef",ref:H,onSuccess:y},null,512),a(Be,{ref_key:"groupFormRef",ref:$,onSuccess:y},null,512),a(He,{ref_key:"importFormRef",ref:W,onSuccess:y},null,512)],64)}}});export{Il as default};
