import{u as Ze,d as el,C as ll,_ as al,N as fe,c as sl}from"./index-B2urM1q-.js";import{b as rl}from"./formCreate-BIGK0pmc.js";import{a as tl,b as il,r as nl,c as ol,t as dl,d as ul,s as cl,e as pl,f as fl,T as ml}from"./index-C6FuNdKy.js";import{d as gl,e as vl}from"./index-Cwb307Pz.js";import{O as g,C as Te,b as bl,a as yl}from"./consts-CvaDWb4S.js";import{B as xl,e as me}from"./constants-C3gLHYOK.js";import{_ as kl}from"./SignDialog.vue_vue_type_script_setup_true_lang-kTF0XJVo.js";import{_ as _l}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-DajtiogQ.js";import{ak as hl,h as Ul,ad as wl,aj as Il,k as Rl,f as Vl,al as Cl,n as Sl,x as El,Q as Tl}from"./form-designer-DHHJWkD5.js";import{l as Al,r as v,j as x,c as Ae,b as Fl,aa as Pl,m as y,q as n,I as H,x as R,J as a,A as b,E as h,u as l,B as s,C as A,h as Dl,H as k,G as c,$ as X,n as Nl}from"./form-create-_84fGzaM.js";import"./download-oWiM5xVU.js";import"./index-hV7105lN.js";import"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import"./tree-COGD3qag.js";import"./index-CRqoysqb.js";import"./index-Bix5n4IG.js";import"./formatTime-BGPGB_ys.js";const Ol={class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},ql={class:"flex flex-col flex-1 pt-20px px-20px"},jl={class:"el-icon-picture-outline"},Gl={class:"ml-10px -mt-15px -mb-35px"},Kl={class:"flex flex-col flex-1 pt-20px px-20px"},zl={class:"flex flex-col flex-1 pt-20px px-20px"},Ll={class:"flex flex-col flex-1 pt-20px px-20px"},Bl={class:"flex flex-col flex-1 pt-20px px-20px"},Jl={class:"flex flex-col flex-1 pt-20px px-20px"},$l={class:"flex flex-col flex-1 pt-20px px-20px"},Yl={class:"flex flex-col flex-1 pt-20px px-20px"},Hl={class:"flex flex-col flex-1 pt-20px px-20px"},Ml=sl(Al({name:"ProcessInstanceBtnContainer",__name:"ProcessInstanceOperationButton",props:{processInstance:{},processDefinition:{},userOptions:{},normalForm:{},normalFormApi:{},writableFields:{}},emits:["success"],setup(Fe,{expose:Pe,emit:De}){const Ne=Ze(),U=el(),ge=ll().getUser.id,Oe=De,D=Fe,o=v(!1),f=v({approve:!1,reject:!1,transfer:!1,delegate:!1,addSign:!1,return:!1,copy:!1,cancel:!1,deleteSign:!1}),de=v([]),u=v(),F=v({}),M=v({}),ie=v("\u5BA1\u6279"),ue=v(),ce=v(),ve=v(),be=v(),N=v([]),O=v(),w=x({reason:"",signPicUrl:"",nextAssignees:{}}),qe=Ae(()=>({reason:[{required:ue.value,message:ie+"\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],signPicUrl:[{required:!0,message:"\u7B7E\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],nextAssignees:[{required:!0,message:"\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]})),pe=v(),ne=x({reason:""}),je=Ae(()=>({reason:[{required:ue.value,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]})),Z=v(),q=x({copyUserIds:[],copyReason:""}),Ge=x({copyUserIds:[{required:!0,message:"\u6284\u9001\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),ee=v(),j=x({assigneeUserId:void 0,reason:""}),Ke=x({assigneeUserId:[{required:!0,message:"\u65B0\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),le=v(),G=x({delegateUserId:void 0,reason:""}),ze=x({delegateUserId:[{required:!0,message:"\u63A5\u6536\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),ae=v(),K=x({addSignUserIds:void 0,reason:""}),Le=x({addSignUserIds:[{required:!0,message:"\u52A0\u7B7E\u5904\u7406\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),se=v(),z=x({deleteSignTaskId:void 0,reason:""}),Be=x({deleteSignTaskId:[{required:!0,message:"\u51CF\u7B7E\u4EBA\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),re=v(),L=x({targetTaskDefinitionKey:void 0,returnReason:""}),Je=x({targetTaskDefinitionKey:[{required:!0,message:"\u9000\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],returnReason:[{required:!0,message:"\u9000\u56DE\u7406\u7531\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),te=v(),oe=x({cancelReason:""}),$e=x({cancelReason:[{required:!0,message:"\u53D6\u6D88\u7406\u7531\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]});Fl(()=>M.value,r=>{var e,d;(e=r==null?void 0:r.btn)==null||e.show(!1),(d=r==null?void 0:r.resetBtn)==null||d.show(!1)},{deep:!0});const V=async r=>{if(f.value[r]!==!0){if(r==="approve"){if(!await _e())return void U.warning("\u8868\u5355\u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u8BF7\u5148\u5B8C\u5584\u8868\u5355!!");Ye()}r!=="return"||(de.value=await tl(u.value.id),de.value.length!==0)?Object.keys(f.value).forEach(e=>{f.value[e]=e===r}):U.warning("\u5F53\u524D\u6CA1\u6709\u53EF\u9000\u56DE\u7684\u8282\u70B9")}},C=(r,e)=>{e&&e.resetFields(),f.value[r]=!1,N.value=[],O.value&&O.value.batchSetCustomApproveUsers({})},Ye=async()=>{const r=he(),e=await gl({processInstanceId:D.processInstance.id,taskId:u.value.id,processVariablesStr:JSON.stringify(r)});if(e&&e.length>0){const d={};e.forEach(i=>{(fe(i.tasks)&&fe(i.candidateUsers)&&Te.START_USER_SELECT===i.candidateStrategy||Te.APPROVE_USER_SELECT===i.candidateStrategy)&&N.value.push(i),i.candidateUsers&&i.candidateUsers.length>0&&(d[i.id]=i.candidateUsers)}),await Nl(),O.value&&Object.keys(d).length>0&&O.value.batchSetCustomApproveUsers(d)}},He=(r,e)=>{w.nextAssignees[r]=e==null?void 0:e.map(d=>d.id)},ye=async(r,e)=>{var d;o.value=!0;try{if(!e)return;if(await e.validate(),!await _e())return void U.warning("\u8868\u5355\u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u8BF7\u5148\u5B8C\u5584\u8868\u5355!!");if(r){if(!(()=>{if(Object.keys(N.value).length===0)return!0;for(const I of N.value)if(fe(w.nextAssignees[I.id]))return U.warning("\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A!"),!1;return!0})())return;const i=he(),P={id:u.value.id,reason:w.reason,variables:i,nextAssignees:w.nextAssignees};u.value.signEnable&&(P.signPicUrl=w.signPicUrl);const Y=M.value;((d=Object.keys(Y))==null?void 0:d.length)>0&&(await Y.validate(),P.variables=F.value.value),await il(P),f.value.approve=!1,N.value=[],O.value&&O.value.batchSetCustomApproveUsers({}),U.success("\u5BA1\u6279\u901A\u8FC7\u6210\u529F")}else{const i={id:u.value.id,reason:ne.reason};await nl(i),f.value.reject=!1,U.success("\u5BA1\u6279\u4E0D\u901A\u8FC7\u6210\u529F")}e.resetFields(),B()}finally{o.value=!1}},Me=async()=>{o.value=!0;try{if(!Z.value)return;await Z.value.validate();const r={id:u.value.id,reason:q.copyReason,copyUserIds:q.copyUserIds};await ol(r),Z.value.resetFields(),f.value.copy=!1,U.success("\u64CD\u4F5C\u6210\u529F")}finally{o.value=!1}},xe=async r=>{o.value=!0;try{if(!ae.value)return;await ae.value.validate();const e={id:u.value.id,type:r,reason:K.reason,userIds:K.addSignUserIds};await cl(e),U.success("\u64CD\u4F5C\u6210\u529F"),ae.value.resetFields(),f.value.addSign=!1,B()}finally{o.value=!1}},Qe=r=>{var d,i,P,Y;const e=((d=r==null?void 0:r.assigneeUser)==null?void 0:d.deptName)||((i=r==null?void 0:r.ownerUser)==null?void 0:i.deptName);return`${((P=r==null?void 0:r.assigneeUser)==null?void 0:P.nickname)||((Y=r==null?void 0:r.ownerUser)==null?void 0:Y.nickname)} ( \u6240\u5C5E\u90E8\u95E8\uFF1A${e} )`},B=()=>{Oe("success")},J=()=>{var e;let r=!1;return ml.RUNNING===((e=u.value)==null?void 0:e.status)&&(r=!0),r},ke=r=>{let e=!1;return me.APPROVE!==r&&me.REJECT!==r&&me.CANCEL!==r||(e=!0),e},$=r=>{var d,i;let e=!0;return(d=u.value)!=null&&d.buttonsSetting&&((i=u.value)!=null&&i.buttonsSetting[r])&&(e=u.value.buttonsSetting[r].enable),e},_=r=>{var d,i;let e=bl.get(r);return(d=u.value)!=null&&d.buttonsSetting&&((i=u.value)!=null&&i.buttonsSetting[r])&&(e=u.value.buttonsSetting[r].displayName),e},_e=async()=>{var r,e;if(((r=D.processDefinition)==null?void 0:r.formType)===xl.NORMAL){let d=!0;try{await((e=D.normalFormApi)==null?void 0:e.validate())}catch{d=!1}return d}return!0},he=()=>{const r={};return D.writableFields.forEach(e=>{r[e]=D.normalFormApi.getValue(e)}),r},We=r=>{w.signPicUrl=r,be.value.validate("change")};return Pe({loadTodoTask:r=>{if(F.value={},u.value=r,M.value={},ue.value=(r==null?void 0:r.reasonRequire)??!1,ie.value=(r==null?void 0:r.nodeType)===yl.TRANSACTOR_NODE?"\u529E\u7406":"\u5BA1\u6279",r&&r.formId&&r.formConf){const e={};rl(e,r.formConf,r.formFields,r.formVariables),F.value=e}else F.value={}}}),(r,e)=>{var Ue,we,Ie,Re,Ve,Ce,Se,Ee;const d=al,i=Vl,P=Pl("form-create"),Y=wl,I=Rl,p=Il,Xe=Cl,S=Ul,E=Sl,Q=Tl,W=El,T=hl;return n(),y(H,null,[R("div",Ol,[l(u)&&J()&&$(l(g).APPROVE)?(n(),b(E,{key:0,visible:l(f).approve,placement:"top-end",width:420,trigger:"click"},{reference:s(()=>[a(i,{plain:"",type:"success",onClick:e[0]||(e[0]=t=>V("approve"))},{default:s(()=>[a(d,{icon:"ep:select"}),c("\xA0 "+k(_(l(g).APPROVE)),1)]),_:1})]),default:s(()=>[A((n(),y("div",ql,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"approveFormRef",ref:ce,model:l(w),rules:l(qe),"label-width":"100px"},{default:s(()=>{var t;return[((t=l(u))==null?void 0:t.formId)>0?(n(),b(Y,{key:0,class:"mb-15px !-mt-10px"},{header:s(()=>{var m;return[R("span",jl," \u586B\u5199\u8868\u5355\u3010"+k((m=l(u))==null?void 0:m.formName)+"\u3011 ",1)]}),default:s(()=>[a(P,{modelValue:l(F).value,"onUpdate:modelValue":e[1]||(e[1]=m=>l(F).value=m),api:l(M),"onUpdate:api":e[2]||(e[2]=m=>Dl(M)?M.value=m:null),option:l(F).option,rule:l(F).rule},null,8,["modelValue","api","option","rule"])]),_:1})):h("",!0),a(p,{label:`${l(ie)}\u610F\u89C1`,prop:"reason"},{default:s(()=>[a(I,{modelValue:l(w).reason,"onUpdate:modelValue":e[3]||(e[3]=m=>l(w).reason=m),placeholder:`\u8BF7\u8F93\u5165${l(ie)}\u610F\u89C1`,type:"textarea",rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(N).length>0?(n(),b(p,{key:1,label:"\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684\u5BA1\u6279\u4EBA",prop:"nextAssignees"},{default:s(()=>[R("div",Gl,[a(_l,{ref_key:"nextAssigneesTimelineRef",ref:O,"activity-nodes":l(N),"show-status-icon":!1,"enable-approve-user-select":!0,onSelectUserConfirm:He},null,8,["activity-nodes"])])]),_:1})):h("",!0),l(u).signEnable?(n(),b(p,{key:2,label:"\u7B7E\u540D",prop:"signPicUrl",ref_key:"approveSignFormRef",ref:be},{default:s(()=>[a(i,{onClick:e[4]||(e[4]=m=>l(ve).open())},{default:s(()=>e[46]||(e[46]=[c("\u70B9\u51FB\u7B7E\u540D")])),_:1}),l(w).signPicUrl?(n(),b(Xe,{key:0,class:"w-90px h-40px ml-5px",src:l(w).signPicUrl,"preview-src-list":[l(w).signPicUrl]},null,8,["src","preview-src-list"])):h("",!0)]),_:1},512)):h("",!0),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"success",onClick:e[5]||(e[5]=m=>ye(!0,l(ce)))},{default:s(()=>[c(k(_(l(g).APPROVE)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[6]||(e[6]=m=>C("approve",l(ce)))},{default:s(()=>e[47]||(e[47]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]}),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).REJECT)?(n(),b(E,{key:1,visible:l(f).reject,placement:"top-end",width:420,trigger:"click"},{reference:s(()=>[a(i,{class:"mr-20px",plain:"",type:"danger",onClick:e[7]||(e[7]=t=>V("reject"))},{default:s(()=>[a(d,{icon:"ep:close"}),c("\xA0 "+k(_(l(g).REJECT)),1)]),_:1})]),default:s(()=>[A((n(),y("div",Kl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"rejectFormRef",ref:pe,model:l(ne),rules:l(je),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:s(()=>[a(I,{modelValue:l(ne).reason,"onUpdate:modelValue":e[8]||(e[8]=t=>l(ne).reason=t),placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"danger",onClick:e[9]||(e[9]=t=>ye(!1,l(pe)))},{default:s(()=>[c(k(_(l(g).REJECT)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[10]||(e[10]=t=>C("reject",l(pe)))},{default:s(()=>e[48]||(e[48]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).COPY)?(n(),b(E,{key:2,visible:l(f).copy,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[11]||(e[11]=t=>V("copy")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"svg-icon:send"}),c("\xA0 "+k(_(l(g).COPY)),1)])]),default:s(()=>[A((n(),y("div",zl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"copyFormRef",ref:Z,model:l(q),rules:l(Ge),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u6284\u9001\u4EBA",prop:"copyUserIds"},{default:s(()=>[a(W,{modelValue:l(q).copyUserIds,"onUpdate:modelValue":e[12]||(e[12]=t=>l(q).copyUserIds=t),clearable:"",style:{width:"100%"},multiple:"",placeholder:"\u8BF7\u9009\u62E9\u6284\u9001\u4EBA"},{default:s(()=>[(n(!0),y(H,null,X(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u6284\u9001\u610F\u89C1",prop:"copyReason"},{default:s(()=>[a(I,{modelValue:l(q).copyReason,"onUpdate:modelValue":e[13]||(e[13]=t=>l(q).copyReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6284\u9001\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:Me},{default:s(()=>[c(k(_(l(g).COPY)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[14]||(e[14]=t=>C("copy",l(Z)))},{default:s(()=>e[49]||(e[49]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).TRANSFER)?(n(),b(E,{key:3,visible:l(f).transfer,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[15]||(e[15]=t=>V("transfer")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"fa:share-square-o"}),c("\xA0 "+k(_(l(g).TRANSFER)),1)])]),default:s(()=>[A((n(),y("div",Ll,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"transferFormRef",ref:ee,model:l(j),rules:l(Ke),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u65B0\u5BA1\u6279\u4EBA",prop:"assigneeUserId"},{default:s(()=>[a(W,{modelValue:l(j).assigneeUserId,"onUpdate:modelValue":e[16]||(e[16]=t=>l(j).assigneeUserId=t),clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),y(H,null,X(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:s(()=>[a(I,{modelValue:l(j).reason,"onUpdate:modelValue":e[17]||(e[17]=t=>l(j).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[18]||(e[18]=t=>(async()=>{o.value=!0;try{if(!ee.value)return;await ee.value.validate();const m={id:u.value.id,reason:j.reason,assigneeUserId:j.assigneeUserId};await dl(m),ee.value.resetFields(),f.value.transfer=!1,U.success("\u64CD\u4F5C\u6210\u529F"),B()}finally{o.value=!1}})())},{default:s(()=>[c(k(_(l(g).TRANSFER)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[19]||(e[19]=t=>C("transfer",l(ee)))},{default:s(()=>e[50]||(e[50]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).DELEGATE)?(n(),b(E,{key:4,visible:l(f).delegate,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[20]||(e[20]=t=>V("delegate")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"ep:position"}),c("\xA0 "+k(_(l(g).DELEGATE)),1)])]),default:s(()=>[A((n(),y("div",Bl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"delegateFormRef",ref:le,model:l(G),rules:l(ze),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u63A5\u6536\u4EBA",prop:"delegateUserId"},{default:s(()=>[a(W,{modelValue:l(G).delegateUserId,"onUpdate:modelValue":e[21]||(e[21]=t=>l(G).delegateUserId=t),clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),y(H,null,X(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:s(()=>[a(I,{modelValue:l(G).reason,"onUpdate:modelValue":e[22]||(e[22]=t=>l(G).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[23]||(e[23]=t=>(async()=>{o.value=!0;try{if(!le.value)return;await le.value.validate();const m={id:u.value.id,reason:G.reason,delegateUserId:G.delegateUserId};await ul(m),f.value.delegate=!1,le.value.resetFields(),U.success("\u64CD\u4F5C\u6210\u529F"),B()}finally{o.value=!1}})())},{default:s(()=>[c(k(_(l(g).DELEGATE)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[24]||(e[24]=t=>C("delegate",l(le)))},{default:s(()=>e[51]||(e[51]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).ADD_SIGN)?(n(),b(E,{key:5,visible:l(f).addSign,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[25]||(e[25]=t=>V("addSign")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"ep:plus"}),c("\xA0 "+k(_(l(g).ADD_SIGN)),1)])]),default:s(()=>[A((n(),y("div",Jl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"addSignFormRef",ref:ae,model:l(K),rules:l(Le),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u52A0\u7B7E\u5904\u7406\u4EBA",prop:"addSignUserIds"},{default:s(()=>[a(W,{modelValue:l(K).addSignUserIds,"onUpdate:modelValue":e[26]||(e[26]=t=>l(K).addSignUserIds=t),multiple:"",clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),y(H,null,X(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:s(()=>[a(I,{modelValue:l(K).reason,"onUpdate:modelValue":e[27]||(e[27]=t=>l(K).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[28]||(e[28]=t=>xe("before"))},{default:s(()=>[c(" \u5411\u524D"+k(_(l(g).ADD_SIGN)),1)]),_:1},8,["disabled"]),a(i,{disabled:l(o),type:"primary",onClick:e[29]||(e[29]=t=>xe("after"))},{default:s(()=>[c(" \u5411\u540E"+k(_(l(g).ADD_SIGN)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[30]||(e[30]=t=>C("addSign",l(ae)))},{default:s(()=>e[52]||(e[52]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),((Ue=l(u))==null?void 0:Ue.children.length)>0?(n(),b(E,{key:6,visible:l(f).deleteSign,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[31]||(e[31]=t=>V("deleteSign")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"ep:semi-select"}),e[53]||(e[53]=c("\xA0 \u51CF\u7B7E "))])]),default:s(()=>[A((n(),y("div",$l,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"deleteSignFormRef",ref:se,model:l(z),rules:l(Be),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u51CF\u7B7E\u4EBA\u5458",prop:"deleteSignTaskId"},{default:s(()=>[a(W,{modelValue:l(z).deleteSignTaskId,"onUpdate:modelValue":e[32]||(e[32]=t=>l(z).deleteSignTaskId=t),clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),y(H,null,X(l(u).children,t=>(n(),b(Q,{key:t.id,label:Qe(t),value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:s(()=>[a(I,{modelValue:l(z).reason,"onUpdate:modelValue":e[33]||(e[33]=t=>l(z).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[34]||(e[34]=t=>(async()=>{o.value=!0;try{if(!se.value)return;await se.value.validate();const m={id:z.deleteSignTaskId,reason:z.reason};await fl(m),U.success("\u51CF\u7B7E\u6210\u529F"),se.value.resetFields(),f.value.deleteSign=!1,B()}finally{o.value=!1}})())},{default:s(()=>e[54]||(e[54]=[c(" \u51CF\u7B7E ")])),_:1},8,["disabled"]),a(i,{onClick:e[35]||(e[35]=t=>C("deleteSign",l(se)))},{default:s(()=>e[55]||(e[55]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&J()&&$(l(g).RETURN)?(n(),b(E,{key:7,visible:l(f).return,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[36]||(e[36]=t=>V("return")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"ep:back"}),c("\xA0 "+k(_(l(g).RETURN)),1)])]),default:s(()=>[A((n(),y("div",Yl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"returnFormRef",ref:re,model:l(L),rules:l(Je),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u9000\u56DE\u8282\u70B9",prop:"targetTaskDefinitionKey"},{default:s(()=>[a(W,{modelValue:l(L).targetTaskDefinitionKey,"onUpdate:modelValue":e[37]||(e[37]=t=>l(L).targetTaskDefinitionKey=t),clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),y(H,null,X(l(de),t=>(n(),b(Q,{key:t.taskDefinitionKey,label:t.name,value:t.taskDefinitionKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"\u9000\u56DE\u7406\u7531",prop:"returnReason"},{default:s(()=>[a(I,{modelValue:l(L).returnReason,"onUpdate:modelValue":e[38]||(e[38]=t=>l(L).returnReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9000\u56DE\u7406\u7531",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[39]||(e[39]=t=>(async()=>{o.value=!0;try{if(!re.value)return;await re.value.validate();const m={id:u.value.id,reason:L.returnReason,targetTaskDefinitionKey:L.targetTaskDefinitionKey};await pl(m),f.value.return=!1,re.value.resetFields(),U.success("\u64CD\u4F5C\u6210\u529F"),B()}finally{o.value=!1}})())},{default:s(()=>[c(k(_(l(g).RETURN)),1)]),_:1},8,["disabled"]),a(i,{onClick:e[40]||(e[40]=t=>C("return",l(re)))},{default:s(()=>e[56]||(e[56]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(ge)!==((Ie=(we=r.processInstance)==null?void 0:we.startUser)==null?void 0:Ie.id)||ke((Re=r.processInstance)==null?void 0:Re.status)?h("",!0):(n(),b(E,{key:8,visible:l(f).cancel,placement:"top-start",width:420,trigger:"click"},{reference:s(()=>[R("div",{onClick:e[41]||(e[41]=t=>V("cancel")),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"fa:mail-reply"}),e[57]||(e[57]=c("\xA0 \u53D6\u6D88 "))])]),default:s(()=>[A((n(),y("div",Hl,[a(S,{"label-position":"top",class:"mb-auto",ref_key:"cancelFormRef",ref:te,model:l(oe),rules:l($e),"label-width":"100px"},{default:s(()=>[a(p,{label:"\u53D6\u6D88\u7406\u7531",prop:"cancelReason"},{default:s(()=>[e[58]||(e[58]=R("span",{class:"text-#878c93 text-12px"},"\xA0 \u53D6\u6D88\u540E\uFF0C\u8BE5\u5BA1\u6279\u6D41\u7A0B\u5C06\u81EA\u52A8\u7ED3\u675F",-1)),a(I,{modelValue:l(oe).cancelReason,"onUpdate:modelValue":e[42]||(e[42]=t=>l(oe).cancelReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u53D6\u6D88\u7406\u7531",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(i,{disabled:l(o),type:"primary",onClick:e[43]||(e[43]=t=>(async()=>{o.value=!0;try{if(!te.value)return;await te.value.validate(),await vl(D.processInstance.id,oe.cancelReason),f.value.return=!1,U.success("\u64CD\u4F5C\u6210\u529F"),te.value.resetFields(),B()}finally{o.value=!1}})())},{default:s(()=>e[59]||(e[59]=[c(" \u786E\u8BA4 ")])),_:1},8,["disabled"]),a(i,{onClick:e[44]||(e[44]=t=>C("cancel",l(te)))},{default:s(()=>e[60]||(e[60]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])),l(ge)===((Ce=(Ve=r.processInstance)==null?void 0:Ve.startUser)==null?void 0:Ce.id)&&ke((Se=r.processInstance)==null?void 0:Se.status)&&((Ee=r.processDefinition)==null?void 0:Ee.formType)===10?(n(),y("div",{key:9,onClick:e[45]||(e[45]=t=>(async()=>{var m;await Ne.push({name:"BpmProcessInstanceCreate",query:{processInstanceId:(m=D.processInstance)==null?void 0:m.id}})})()),class:"hover-bg-gray-100 rounded-xl p-6px"},[a(d,{size:14,icon:"ep:refresh"}),e[61]||(e[61]=c("\xA0 \u518D\u6B21\u63D0\u4EA4 "))])):h("",!0)]),a(kl,{ref_key:"signRef",ref:ve,onSuccess:We},null,512)],64)}}}),[["__scopeId","data-v-793cc4c7"]]);export{Ml as default};
