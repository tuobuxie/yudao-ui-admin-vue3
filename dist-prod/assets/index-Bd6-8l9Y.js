import{a as X,d as Y,_ as ee}from"./index-DzK2S43K.js";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import{_ as le}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BYZVL11n.js";import{_ as te}from"./index-RnHrue4c.js";import{l as oe,r as i,j as ne,e as re,ag as se,m as x,q as u,J as e,B as t,u as n,Z as M,C,G as p,A as c,E as ue,I as R,$ as ie,H as pe}from"./form-create-_84fGzaM.js";import{d as ce}from"./formatTime-BGPGB_ys.js";import{a as de,s as me}from"./index-Kq3kgCoJ.js";import{b as fe}from"./index-DZsv1_6z.js";import{_ as ge}from"./main.vue_vue_type_script_setup_true_lang-CmH5bfTi.js";import{_ as _e}from"./UserForm.vue_vue_type_script_setup_true_lang-ClQlNa68.js";import{h as be,aj as ye,k as he,f as ve,Z as ke,_ as we,ah as Ie,a6 as xe,ak as Ce}from"./form-designer-DHHJWkD5.js";import"./index-CscvvQ0V.js";import"./tagsView-CKM4YfGJ.js";import"./Dialog.vue_vue_type_style_index_0_lang-D3YOFsHs.js";const Ve=oe({name:"MpUser",__name:"index",emits:["change"],setup(Se,{expose:T,emit:Z}){const{t:Ue}=X(),V=Y(),f=i(!1),h=i(!0),v=i(0),S=i([]),k=i([]),l=ne({pageNo:1,pageSize:10,accountId:-1,openid:"",nickname:""}),U=i(null),N=i([]),q=r=>{l.accountId=r,l.pageNo=1,d()},d=async()=>{try{k.value=[],h.value=!0;const r=await de(l);S.value=r.list,v.value=r.total}finally{h.value=!1}},g=()=>{l.pageNo=1,d(),f.value&&P()},A=()=>{var a;const r=l.accountId;(a=U.value)==null||a.resetFields(),l.accountId=r,g()},z=i(null),D=async()=>{try{await V.confirm("\u662F\u5426\u786E\u8BA4\u540C\u6B65\u7C89\u4E1D\uFF1F"),await me(l.accountId),V.success("\u5F00\u59CB\u4ECE\u5FAE\u4FE1\u516C\u4F17\u53F7\u540C\u6B65\u7C89\u4E1D\u4FE1\u606F\uFF0C\u540C\u6B65\u9700\u8981\u4E00\u6BB5\u65F6\u95F4\uFF0C\u5EFA\u8BAE\u7A0D\u540E\u518D\u67E5\u8BE2"),await d()}catch{}};T({open:r=>{q(r),f.value=!0}});const E=Z,P=()=>{E("change",{multipleSelection:k.value,total:v.value,queryParams:l})},G=r=>{k.value=r,f.value&&P()};return re(async()=>{N.value=await fe()}),(r,a)=>{const H=te,_=ye,j=he,w=ee,b=ve,J=be,B=le,s=we,$=Ie,I=xe,L=ke,O=ae,F=se("hasPermi"),Q=Ce;return u(),x(R,null,[e(H,{title:"\u516C\u4F17\u53F7\u7C89\u4E1D",url:"https://doc.iocoder.cn/mp/user/"}),e(B,null,{default:t(()=>[e(J,{class:"-mb-15px",model:n(l),ref_key:"queryFormRef",ref:U,inline:!0,"label-width":"68px"},{default:t(()=>[e(_,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:t(()=>[e(n(ge),{onChange:q,modelValue:n(l).accountId},null,8,["modelValue"])]),_:1}),e(_,{label:"\u7528\u6237\u6807\u8BC6",prop:"openid"},{default:t(()=>[e(j,{modelValue:n(l).openid,"onUpdate:modelValue":a[0]||(a[0]=o=>n(l).openid=o),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6807\u8BC6",clearable:"",onKeyup:M(g,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(_,{label:"\u6635\u79F0",prop:"nickname"},{default:t(()=>[e(j,{modelValue:n(l).nickname,"onUpdate:modelValue":a[1]||(a[1]=o=>n(l).nickname=o),placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",clearable:"",onKeyup:M(g,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e(b,{onClick:g},{default:t(()=>[e(w,{icon:"ep:search"}),a[4]||(a[4]=p("\u641C\u7D22 "))]),_:1}),e(b,{onClick:A},{default:t(()=>[e(w,{icon:"ep:refresh"}),a[5]||(a[5]=p("\u91CD\u7F6E "))]),_:1}),C((u(),c(b,{type:"success",plain:"",onClick:D,disabled:n(l).accountId===0},{default:t(()=>[e(w,{icon:"ep:refresh",class:"mr-5px"}),a[6]||(a[6]=p(" \u540C\u6B65 "))]),_:1},8,["disabled"])),[[F,["mp:user:sync"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(B,null,{default:t(()=>[C((u(),c(L,{data:S.value,onSelectionChange:G},{default:t(()=>[f.value?(u(),c(s,{key:0,type:"selection",width:"55"})):ue("",!0),e(s,{label:"\u7F16\u53F7",align:"center",prop:"id"}),e(s,{label:"\u7528\u6237\u6807\u8BC6",align:"center",prop:"openid",width:"260"}),e(s,{label:"\u7528\u6237\u5934\u50CF","min-width":"80px",prop:"headImageUrl"},{default:t(o=>[e($,{src:o.row.headImageUrl},null,8,["src"])]),_:1}),e(s,{label:"\u6635\u79F0",align:"center",prop:"nickname"}),e(s,{label:"\u5907\u6CE8",align:"center",prop:"remark"}),e(s,{label:"\u6807\u7B7E",align:"center",prop:"tagIds",width:"200"},{default:t(o=>[(u(!0),x(R,null,ie(o.row.tagIds,(K,y)=>(u(),x("span",{key:y},[e(I,null,{default:t(()=>{var m;return[p(pe((m=N.value.find(W=>W.tagId===K))==null?void 0:m.name),1)]}),_:2},1024),a[7]||(a[7]=p("\xA0 "))]))),128))]),_:1}),e(s,{label:"\u8BA2\u9605\u72B6\u6001",align:"center",prop:"subscribeStatus"},{default:t(o=>[o.row.subscribeStatus===0?(u(),c(I,{key:0,type:"success"},{default:t(()=>a[8]||(a[8]=[p("\u5DF2\u8BA2\u9605")])),_:1})):(u(),c(I,{key:1,type:"danger"},{default:t(()=>a[9]||(a[9]=[p("\u672A\u8BA2\u9605")])),_:1}))]),_:1}),e(s,{label:"\u8BA2\u9605\u65F6\u95F4",align:"center",prop:"subscribeTime",width:"180",formatter:n(ce)},null,8,["formatter"]),e(s,{label:"\u64CD\u4F5C",align:"center"},{default:t(o=>[C((u(),c(b,{type:"primary",link:"",onClick:K=>{var m;return y=o.row.id,void((m=z.value)==null?void 0:m.open(y));var y}},{default:t(()=>a[10]||(a[10]=[p(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[F,["mp:user:update"]]])]),_:1})]),_:1},8,["data"])),[[Q,h.value]]),e(O,{total:v.value,page:n(l).pageNo,"onUpdate:page":a[2]||(a[2]=o=>n(l).pageNo=o),limit:n(l).pageSize,"onUpdate:limit":a[3]||(a[3]=o=>n(l).pageSize=o),onPagination:d},null,8,["total","page","limit"])]),_:1}),e(_e,{ref_key:"formRef",ref:z,onSuccess:d},null,512)],64)}}});export{Ve as default};
