import{d as G,u as q,_ as H,D as J}from"./index-DmQdxAiK.js";import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as Q}from"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import{d as W,g as X,e as Y,f as V}from"./index-DS09qtFr.js";import{_ as $}from"./ContactForm.vue_vue_type_script_setup_true_lang-DW27CpP7.js";import{B as N}from"./index-uUWMlvvc.js";import{_ as ee}from"./ContactListModal.vue_vue_type_script_setup_true_lang-a60_PEj9.js";import{i as ae,f as se,ak as te,_ as oe,P as ie,Z as re}from"./form-designer-DHHJWkD5.js";import{l as ne,r as c,j as le,b as ce,ag as ue,m as de,q as u,I as pe,J as a,A as p,E as m,B as r,C as k,G as f,u as o,H as me}from"./form-create-_84fGzaM.js";const fe=ne({name:"CrmContactList",__name:"ContactList",props:{bizType:{},bizId:{},customerId:{},businessId:{}},setup(x){const i=x,I=c(!0),w=c(0),C=c([]),s=le({pageNo:1,pageSize:10,customerId:void 0,businessId:void 0}),b=G(),_=async()=>{I.value=!0;try{s.customerId=void 0;let t={list:[],total:0};switch(i.bizType){case N.CRM_CUSTOMER:s.customerId=i.bizId,t=await X(s);break;case N.CRM_BUSINESS:s.businessId=i.bizId,t=await W(s);break;default:return}C.value=t.list,w.value=t.total}finally{I.value=!1}},y=()=>{s.pageNo=1,_()},z=c(),E=()=>{z.value.open("create",void 0,i.customerId,i.businessId)},{push:P}=q(),S=c(),T=()=>{S.value.open()},B=async t=>{const e={businessId:i.bizId,contactIds:t};g.value.getSelectionRows().forEach(d=>{e.contactIds.push(d.id)}),await V(e),b.success("\u5173\u8054\u8054\u7CFB\u4EBA\u6210\u529F"),y()},g=c(),M=async()=>{const t={businessId:i.bizId,contactIds:g.value.getSelectionRows().map(e=>e.id)};if(t.contactIds.length===0)return b.error("\u672A\u9009\u62E9\u8054\u7CFB\u4EBA");await Y(t),b.success("\u53D6\u5173\u8054\u7CFB\u4EBA\u6210\u529F"),y()};return ce(()=>[i.bizId,i.bizType],()=>{y()},{immediate:!0,deep:!0}),(t,e)=>{const d=H,v=se,U=ae,l=oe,A=ie,L=Q,O=re,j=K,D=Z,R=ue("hasPermi"),F=te;return u(),de(pe,null,[a(U,{justify:"end"},{default:r(()=>[a(v,{onClick:E},{default:r(()=>[a(d,{class:"mr-5px",icon:"system-uicons:contacts"}),e[2]||(e[2]=f(" \u521B\u5EFA\u8054\u7CFB\u4EBA "))]),_:1}),o(s).businessId?k((u(),p(v,{key:0,onClick:T},{default:r(()=>[a(d,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=f(" \u5173\u8054 "))]),_:1})),[[R,["crm:contact:create-business"]]]):m("",!0),o(s).businessId?k((u(),p(v,{key:1,onClick:M},{default:r(()=>[a(d,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=f(" \u89E3\u9664\u5173\u8054 "))]),_:1})),[[R,["crm:contact:delete-business"]]]):m("",!0)]),_:1}),a(D,{class:"mt-10px"},{default:r(()=>[k((u(),p(O,{ref_key:"contactRef",ref:g,data:o(C),"show-overflow-tooltip":!0,stripe:!0},{default:r(()=>[o(s).businessId?(u(),p(l,{key:0,type:"selection",width:"55"})):m("",!0),a(l,{align:"center",fixed:"left",label:"\u59D3\u540D",prop:"name"},{default:r(n=>[a(A,{underline:!1,type:"primary",onClick:Ie=>{return h=n.row.id,void P({name:"CrmContactDetail",params:{id:h}});var h}},{default:r(()=>[f(me(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(l,{align:"center",label:"\u624B\u673A\u53F7",prop:"mobile"}),a(l,{align:"center",label:"\u804C\u4F4D",prop:"post"}),a(l,{align:"center",label:"\u76F4\u5C5E\u4E0A\u7EA7",prop:"parentName"}),a(l,{align:"center",label:"\u662F\u5426\u5173\u952E\u51B3\u7B56\u4EBA","min-width":"100",prop:"master"},{default:r(n=>[a(L,{type:o(J).INFRA_BOOLEAN_STRING,value:n.row.master},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[F,o(I)]]),a(j,{limit:o(s).pageSize,"onUpdate:limit":e[0]||(e[0]=n=>o(s).pageSize=n),page:o(s).pageNo,"onUpdate:page":e[1]||(e[1]=n=>o(s).pageNo=n),total:o(w),onPagination:_},null,8,["limit","page","total"])]),_:1}),a($,{ref_key:"formRef",ref:z,onSuccess:_},null,512),t.customerId?(u(),p(ee,{key:0,ref_key:"contactModalRef",ref:S,"customer-id":t.customerId,onSuccess:B},null,8,["customer-id"])):m("",!0)],64)}}});export{fe as _};
