import{a as O,d as T,q as D,u as G,ak as Q,z as W,A as X,al as Y,t as Z,c as $}from"./index-DzK2S43K.js";import{_ as ee}from"./XButton-c3Z73tBC.js";import{l as le,r as g,c as ae,u as e,j as N,b as oe,C as se,K as ne,A as w,q as f,B as a,J as l,E as _,m as C,H as S}from"./form-create-_84fGzaM.js";import{u as x}from"./useIcon-DdzKJstU.js";import{u as te,L as ie,_ as re,a as me}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-TLnzM6Xx.js";import{r as h}from"./formRules-CLH8W1j7.js";import{i as ce,j as ue,aj as de,k as pe,h as ge,d as V}from"./form-designer-DHHJWkD5.js";const fe={key:1,class:"getMobileCode",style:{cursor:"pointer"}},be=$(le({name:"MobileForm",__name:"MobileForm",setup(_e){const{t}=O(),I=T(),L=D(),{currentRoute:M,push:E}=G(),y=g(),d=g(!1),j=x({icon:"ep:house"}),q=x({icon:"ep:cellphone"}),z=x({icon:"ep:circle-check"}),{validForm:B}=me(y),{handleBackLogin:P,getLoginState:U}=te(),A=ae(()=>e(U)===ie.MOBILE),R={tenantName:[h],mobileNumber:[h],code:[h]},o=N({codeImg:"",tenantEnable:"true",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"\u828B\u9053\u6E90\u7801",mobileNumber:"",code:""}}),u=N({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),i=g(0),p=g(""),H=async()=>{await v(),u.smsCode.mobile=o.loginForm.mobileNumber,await Q(u.smsCode).then(async()=>{I.success(t("login.SmsSendMsg")),i.value=60;let n=setInterval(()=>{i.value=i.value-1,i.value<=0&&clearInterval(n)},1e3)})};oe(()=>M.value,n=>{var s;p.value=(s=n==null?void 0:n.query)==null?void 0:s.redirect},{immediate:!0});const v=async()=>{if(o.tenantEnable==="true"){const n=await W(o.loginForm.tenantName);X(n)}};return(n,s)=>{const c=de,r=ue,b=pe,k=ce,F=ee,J=ge;return se((f(),w(J,{ref_key:"formSmsLogin",ref:y,model:e(o).loginForm,rules:R,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:a(()=>[l(k,{class:"mx-[-10px]"},{default:a(()=>[l(r,{span:24,class:"px-10px"},{default:a(()=>[l(c,null,{default:a(()=>[l(re,{class:"w-full"})]),_:1})]),_:1}),l(r,{span:24,class:"px-10px"},{default:a(()=>[e(o).tenantEnable==="true"?(f(),w(c,{key:0,prop:"tenantName"},{default:a(()=>[l(b,{modelValue:e(o).loginForm.tenantName,"onUpdate:modelValue":s[0]||(s[0]=m=>e(o).loginForm.tenantName=m),placeholder:e(t)("login.tenantNamePlaceholder"),"prefix-icon":e(j),type:"primary",link:""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):_("",!0)]),_:1}),l(r,{span:24,class:"px-10px"},{default:a(()=>[l(c,{prop:"mobileNumber"},{default:a(()=>[l(b,{modelValue:e(o).loginForm.mobileNumber,"onUpdate:modelValue":s[1]||(s[1]=m=>e(o).loginForm.mobileNumber=m),placeholder:e(t)("login.mobileNumberPlaceholder"),"prefix-icon":e(q)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),l(r,{span:24,class:"px-10px"},{default:a(()=>[l(c,{prop:"code"},{default:a(()=>[l(k,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:a(()=>[l(r,{span:24},{default:a(()=>[l(b,{modelValue:e(o).loginForm.code,"onUpdate:modelValue":s[2]||(s[2]=m=>e(o).loginForm.code=m),placeholder:e(t)("login.codePlaceholder"),"prefix-icon":e(z)},{append:a(()=>[e(i)<=0?(f(),C("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:H},S(e(t)("login.getSmsCode")),1)):_("",!0),e(i)>0?(f(),C("span",fe,S(e(i))+"\u79D2\u540E\u53EF\u91CD\u65B0\u83B7\u53D6 ",1)):_("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(r,{span:24,class:"px-10px"},{default:a(()=>[l(c,null,{default:a(()=>[l(F,{loading:e(d),title:e(t)("login.login"),class:"w-full",type:"primary",onClick:s[3]||(s[3]=m=>(async()=>{await v(),await B()&&(V.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),d.value=!0,u.loginSms.mobile=o.loginForm.mobileNumber,u.loginSms.code=o.loginForm.code,await Y(u.loginSms).then(async K=>{Z(K),p.value||(p.value="/"),E({path:p.value||L.addRouters[0].path})}).catch(()=>{}).finally(()=>{d.value=!1,setTimeout(()=>{V.service().close()},400)}))})())},null,8,["loading","title"])]),_:1})]),_:1}),l(r,{span:24,class:"px-10px"},{default:a(()=>[l(c,null,{default:a(()=>[l(F,{loading:e(d),title:e(t)("login.backLogin"),class:"w-full",onClick:s[4]||(s[4]=m=>e(P)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[ne,e(A)]])}}}),[["__scopeId","data-v-b1107884"]]);export{be as default};
