import{d as pe,a as me,h as ce,D as fe,_ as ye}from"./index-DmQdxAiK.js";import{_ as we}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as _e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as he}from"./index-C2x7yuaO.js";import{l as ge,r as c,j as ve,e as be,ag as ke,m as z,q as i,J as e,B as l,u as t,Z as q,I as H,$ as xe,A as u,C as _,G as p,x as Ce,E as T}from"./form-create-_84fGzaM.js";import{c as C}from"./permission-Dj0aJnJY.js";import{d as Ve}from"./formatTime-BGPGB_ys.js";import{d as Se}from"./download-oWiM5xVU.js";import{C as V}from"./constants-C3gLHYOK.js";import{a as Ne,d as Ue,e as Ee,f as Re,h as De,r as Te}from"./index-oJNTIjFE.js";import{_ as Ae}from"./UserForm.vue_vue_type_script_setup_true_lang-D5f7I2m-.js";import{_ as Fe}from"./UserImportForm.vue_vue_type_script_setup_true_lang-5BD_29CH.js";import{_ as Be}from"./UserAssignRoleForm.vue_vue_type_script_setup_true_lang-XqNsq3t1.js";import{_ as je}from"./DeptTree.vue_vue_type_script_setup_true_lang-CCymDMZD.js";import{j as Ie,h as Le,aj as Me,k as Pe,x as Ye,Q as ze,F as qe,f as He,Z as Ke,_ as Oe,D as Ze,a2 as Ge,a3 as Je,a4 as Qe,ak as $e,i as We}from"./form-designer-DHHJWkD5.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./tree-COGD3qag.js";import"./index-hYLD56hJ.js";import"./index-CuiPf8R-.js";import"./index-CujqeT-i.js";import"./index-EzkaYqZE.js";const Xe={class:"flex items-center justify-center"},ea=ge({name:"SystemUser",__name:"index",setup(aa){const f=pe(),{t:S}=me(),N=c(!0),A=c(0),F=c([]),r=ve({pageNo:1,pageSize:10,username:void 0,mobile:void 0,status:void 0,deptId:void 0,createTime:[]}),B=c(),n=async()=>{N.value=!0;try{const o=await Ne(r);F.value=o.list,A.value=o.total}finally{N.value=!1}},k=()=>{r.pageNo=1,n()},K=()=>{var o;(o=B.value)==null||o.resetFields(),k()},O=async o=>{o===void 0?(r.deptId=void 0,await n()):(r.deptId=o.id,await n())},j=c(),I=(o,a)=>{j.value.open(o,a)},L=c(),Z=()=>{L.value.open()},U=c(!1),G=async()=>{try{await f.exportConfirm(),U.value=!0;const o=await Ee(r);Se.excel(o,"\u7528\u6237\u6570\u636E.xls")}catch{}finally{U.value=!1}},J=async o=>{try{await f.delConfirm(),await Re(o),f.success(S("common.delSuccess")),await n()}catch{}},x=c([]),Q=o=>{x.value=o.map(a=>a.id)},$=async()=>{try{await f.delConfirm(),await De(x.value),x.value=[],f.success(S("common.delSuccess")),await n()}catch{}},W=async o=>{try{const a=(await f.prompt('\u8BF7\u8F93\u5165"'+o.username+'"\u7684\u65B0\u5BC6\u7801',S("common.reminder"))).value;await Te(o.id,a),f.success("\u4FEE\u6539\u6210\u529F\uFF0C\u65B0\u5BC6\u7801\u662F\uFF1A"+a)}catch{}},M=c(),X=o=>{M.value.open(o)};return be(()=>{n()}),(o,a)=>{const E=he,R=_e,P=Ie,Y=Pe,g=Me,ee=ze,ae=Ye,le=qe,d=ye,y=He,te=Le,m=Oe,se=Ze,D=Qe,oe=Je,re=Ge,ie=Ke,ne=we,de=We,h=ke("hasPermi"),ue=$e;return i(),z(H,null,[e(E,{title:"\u7528\u6237\u4F53\u7CFB",url:"https://doc.iocoder.cn/user-center/"}),e(E,{title:"\u4E09\u65B9\u767B\u9646",url:"https://doc.iocoder.cn/social-user/"}),e(E,{title:"Excel \u5BFC\u5165\u5BFC\u51FA",url:"https://doc.iocoder.cn/excel-import-and-export/"}),e(de,{gutter:20},{default:l(()=>[e(P,{span:4,xs:24},{default:l(()=>[e(R,{class:"h-1/1"},{default:l(()=>[e(je,{onNodeClick:O})]),_:1})]),_:1}),e(P,{span:20,xs:24},{default:l(()=>[e(R,null,{default:l(()=>[e(te,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:B,inline:!0,"label-width":"68px"},{default:l(()=>[e(g,{label:"\u7528\u6237\u540D\u79F0",prop:"username"},{default:l(()=>[e(Y,{modelValue:t(r).username,"onUpdate:modelValue":a[0]||(a[0]=s=>t(r).username=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",clearable:"",onKeyup:q(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(g,{label:"\u624B\u673A\u53F7\u7801",prop:"mobile"},{default:l(()=>[e(Y,{modelValue:t(r).mobile,"onUpdate:modelValue":a[1]||(a[1]=s=>t(r).mobile=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",clearable:"",onKeyup:q(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(g,{label:"\u72B6\u6001",prop:"status"},{default:l(()=>[e(ae,{modelValue:t(r).status,"onUpdate:modelValue":a[2]||(a[2]=s=>t(r).status=s),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(i(!0),z(H,null,xe(t(ce)(t(fe).COMMON_STATUS),s=>(i(),u(ee,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:l(()=>[e(le,{modelValue:t(r).createTime,"onUpdate:modelValue":a[3]||(a[3]=s=>t(r).createTime=s),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(y,{onClick:k},{default:l(()=>[e(d,{icon:"ep:search"}),a[7]||(a[7]=p("\u641C\u7D22"))]),_:1}),e(y,{onClick:K},{default:l(()=>[e(d,{icon:"ep:refresh"}),a[8]||(a[8]=p("\u91CD\u7F6E"))]),_:1}),_((i(),u(y,{type:"primary",plain:"",onClick:a[4]||(a[4]=s=>I("create"))},{default:l(()=>[e(d,{icon:"ep:plus"}),a[9]||(a[9]=p(" \u65B0\u589E "))]),_:1})),[[h,["system:user:create"]]]),_((i(),u(y,{type:"warning",plain:"",onClick:Z},{default:l(()=>[e(d,{icon:"ep:upload"}),a[10]||(a[10]=p(" \u5BFC\u5165 "))]),_:1})),[[h,["system:user:import"]]]),_((i(),u(y,{type:"success",plain:"",onClick:G,loading:t(U)},{default:l(()=>[e(d,{icon:"ep:download"}),a[11]||(a[11]=p("\u5BFC\u51FA "))]),_:1},8,["loading"])),[[h,["system:user:export"]]]),_((i(),u(y,{type:"danger",plain:"",disabled:t(x).length===0,onClick:$},{default:l(()=>[e(d,{icon:"ep:delete"}),a[12]||(a[12]=p("\u6279\u91CF\u5220\u9664 "))]),_:1},8,["disabled"])),[[h,["system:user:delete"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(R,null,{default:l(()=>[_((i(),u(ie,{data:t(F),onSelectionChange:Q},{default:l(()=>[e(m,{type:"selection",width:"55"}),e(m,{label:"\u7528\u6237\u7F16\u53F7",align:"center",key:"id",prop:"id"}),e(m,{label:"\u7528\u6237\u540D\u79F0",align:"center",prop:"username","show-overflow-tooltip":!0}),e(m,{label:"\u7528\u6237\u6635\u79F0",align:"center",prop:"nickname","show-overflow-tooltip":!0}),e(m,{label:"\u90E8\u95E8",align:"center",key:"deptName",prop:"deptName","show-overflow-tooltip":!0}),e(m,{label:"\u624B\u673A\u53F7\u7801",align:"center",prop:"mobile",width:"120"}),e(m,{label:"\u72B6\u6001",key:"status"},{default:l(s=>[e(se,{modelValue:s.row.status,"onUpdate:modelValue":v=>s.row.status=v,"active-value":0,"inactive-value":1,onChange:v=>(async w=>{try{const b=w.status===V.ENABLE?"\u542F\u7528":"\u505C\u7528";await f.confirm('\u786E\u8BA4\u8981"'+b+'""'+w.username+'"\u7528\u6237\u5417?'),await Ue(w.id,w.status),await n()}catch{w.status=w.status===V.ENABLE?V.DISABLE:V.ENABLE}})(s.row),disabled:!t(C)(["system:user:update"])},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),e(m,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(Ve),width:"180"},null,8,["formatter"]),e(m,{label:"\u64CD\u4F5C",align:"center",width:"160"},{default:l(s=>[Ce("div",Xe,[_((i(),u(y,{type:"primary",link:"",onClick:v=>I("update",s.row.id)},{default:l(()=>[e(d,{icon:"ep:edit"}),a[13]||(a[13]=p("\u4FEE\u6539 "))]),_:2},1032,["onClick"])),[[h,["system:user:update"]]]),_((i(),u(re,{onCommand:v=>((w,b)=>{switch(w){case"handleDelete":J(b.id);break;case"handleResetPwd":W(b);break;case"handleRole":X(b)}})(v,s.row)},{dropdown:l(()=>[e(oe,null,{default:l(()=>[t(C)(["system:user:delete"])?(i(),u(D,{key:0,command:"handleDelete"},{default:l(()=>[e(d,{icon:"ep:delete"}),a[15]||(a[15]=p("\u5220\u9664 "))]),_:1})):T("",!0),t(C)(["system:user:update-password"])?(i(),u(D,{key:1,command:"handleResetPwd"},{default:l(()=>[e(d,{icon:"ep:key"}),a[16]||(a[16]=p("\u91CD\u7F6E\u5BC6\u7801 "))]),_:1})):T("",!0),t(C)(["system:permission:assign-user-role"])?(i(),u(D,{key:2,command:"handleRole"},{default:l(()=>[e(d,{icon:"ep:circle-check"}),a[17]||(a[17]=p("\u5206\u914D\u89D2\u8272 "))]),_:1})):T("",!0)]),_:1})]),default:l(()=>[e(y,{type:"primary",link:""},{default:l(()=>[e(d,{icon:"ep:d-arrow-right"}),a[14]||(a[14]=p(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[h,["system:user:delete","system:user:update-password","system:permission:assign-user-role"]]])])]),_:1})]),_:1},8,["data"])),[[ue,t(N)]]),e(ne,{total:t(A),page:t(r).pageNo,"onUpdate:page":a[5]||(a[5]=s=>t(r).pageNo=s),limit:t(r).pageSize,"onUpdate:limit":a[6]||(a[6]=s=>t(r).pageSize=s),onPagination:n},null,8,["total","page","limit"])]),_:1})]),_:1})]),_:1}),e(Ae,{ref_key:"formRef",ref:j,onSuccess:n},null,512),e(Fe,{ref_key:"importFormRef",ref:L,onSuccess:n},null,512),e(Be,{ref_key:"assignRoleFormRef",ref:M,onSuccess:n},null,512)],64)}}});export{ea as default};
