import{d as j,a as A,_ as B,D as q,ay as D}from"./index-B2urM1q-.js";import{_ as G}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{_ as J}from"./index.vue_vue_type_script_setup_true_lang-Cj0jlW8o.js";import{_ as M}from"./DictTag.vue_vue_type_script_lang-wg8pUI-B.js";import{g as F,d as Q}from"./index-DIFIEhZY.js";import{_ as V}from"./ReceivableForm.vue_vue_type_script_setup_true_lang-DMcEEfsx.js";import{b as Y}from"./formatTime-BGPGB_ys.js";import{i as Z,f as H,ak as K,_ as O,Z as W}from"./form-designer-DHHJWkD5.js";import{l as X,r as p,j as $,b as ee,ag as ae,m as te,q as m,I as re,J as a,B as n,G as I,C as g,u as o,A as _}from"./form-create-_84fGzaM.js";const oe=X({name:"CrmReceivableList",__name:"ReceivableList",props:{customerId:{},contractId:{}},setup(C,{expose:x}){const t=C,v=j(),{t:R}=A(),d=p(!0),b=p(0),y=p([]),r=$({pageNo:1,pageSize:10,customerId:void 0,contractId:void 0}),s=async()=>{d.value=!0;try{t.customerId&&!t.contractId?r.customerId=t.customerId:t.customerId&&t.contractId&&(r.customerId=t.customerId,r.contractId=t.contractId);const l=await F(r);y.value=l.list,b.value=l.total}finally{d.value=!1}},u=p(),w=(l,e)=>{u.value.open(l,e,{customerId:t.customerId,contractId:t.contractId})};return x({createReceivable:l=>{const e=l;u.value.open("create",void 0,e)}}),ee(()=>[t.customerId,t.contractId],l=>{l[0]&&(r.pageNo=1,r.customerId=void 0,r.contractId=void 0,s())},{immediate:!0,deep:!0}),(l,e)=>{const h=B,f=H,N=Z,c=O,S=M,E=W,T=J,P=G,k=ae("hasPermi"),U=K;return m(),te(re,null,[a(N,{justify:"end"},{default:n(()=>[a(f,{onClick:e[0]||(e[0]=i=>w("create"))},{default:n(()=>[a(h,{class:"mr-5px",icon:"icon-park:income-one"}),e[3]||(e[3]=I(" \u521B\u5EFA\u56DE\u6B3E "))]),_:1})]),_:1}),a(P,{class:"mt-10px"},{default:n(()=>[g((m(),_(E,{data:o(y),"show-overflow-tooltip":!0,stripe:!0},{default:n(()=>[a(c,{align:"center",label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"}),a(c,{align:"center",label:"\u5BA2\u6237",prop:"customerName"}),a(c,{align:"center",label:"\u5408\u540C",prop:"contract.no"}),a(c,{formatter:o(Y),align:"center",label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime",width:"150px"},null,8,["formatter"]),a(c,{align:"center",label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType",width:"130px"},{default:n(i=>[a(S,{type:o(q).CRM_RECEIVABLE_RETURN_TYPE,value:i.row.returnType},null,8,["type","value"])]),_:1}),a(c,{align:"center",label:"\u56DE\u6B3E\u91D1\u989D(\u5143)",prop:"price",formatter:o(D)},null,8,["formatter"]),a(c,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName"}),a(c,{align:"center",label:"\u5907\u6CE8",prop:"remark"}),a(c,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"130px"},{default:n(i=>[g((m(),_(f,{link:"",type:"primary",onClick:z=>w("update",i.row.id)},{default:n(()=>e[4]||(e[4]=[I(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:update"]]]),g((m(),_(f,{link:"",type:"danger",onClick:z=>(async L=>{try{await v.delConfirm(),await Q(L),v.success(R("common.delSuccess")),await s()}catch{}})(i.row.id)},{default:n(()=>e[5]||(e[5]=[I(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:delete"]]])]),_:1})]),_:1},8,["data"])),[[U,o(d)]]),a(T,{limit:o(r).pageSize,"onUpdate:limit":e[1]||(e[1]=i=>o(r).pageSize=i),page:o(r).pageNo,"onUpdate:page":e[2]||(e[2]=i=>o(r).pageNo=i),total:o(b),onPagination:s},null,8,["limit","page","total"])]),_:1}),a(V,{ref_key:"formRef",ref:u,onSuccess:s},null,512)],64)}}});export{oe as _};
