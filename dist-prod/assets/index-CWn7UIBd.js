import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{u as ee,e as ae,d as te,C as le,_ as se,c as re}from"./index-DmQdxAiK.js";import{l as ie,r as m,b as oe,e as me,P as pe,A as M,q as d,B as D,x as r,J as y,u as t,H as P,m as w,I as ue,$ as ne,D as z,E as k,G as de,C as ce,h as _,K as ve,n as fe,p as G}from"./form-create-_84fGzaM.js";import{u as ye}from"./tagsView-CQDzb46U.js";import{g as we,u as B,c as R,d as xe}from"./index-0Ok0c-x7.js";import{a as he}from"./index-D29lUHab.js";import{C as ge}from"./index-UrKDy54_.js";import{g as be}from"./index-oJNTIjFE.js";import{g as ke}from"./index-CuiPf8R-.js";import{a as _e}from"./index-6gTZpT9M.js";import{B as Ie,a as S,b as Ue}from"./constants-C3gLHYOK.js";import Ve from"./BasicInfo-XsrlUzZK.js";import{_ as Ce}from"./FormDesign.vue_vue_type_script_setup_true_lang-BpU4aTEQ.js";import{_ as Te}from"./ProcessDesign.vue_vue_type_script_setup_true_lang-Bci1wicF.js";import{_ as Le}from"./ExtraSettings.vue_vue_type_script_setup_true_lang-zovm9t6j.js";import{u as Me}from"./useTagsView-CaW5k37Z.js";import{f as De}from"./form-designer-DHHJWkD5.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./tree-COGD3qag.js";import"./index-BhHRYVfS.js";import"./formCreate-BIGK0pmc.js";import"./index.vue_vue_type_style_index_0_lang-DJOHVcmd.js";import"./bpmn-embedded-B03mYb7T.js";import"./XTextButton-CXU1Athx.js";import"./XButton-BH0HlMtk.js";import"./index-DWAKVBMX.js";import"./consts-CvaDWb4S.js";import"./node-D3mIdOYQ.js";import"./index-DX-DzHIf.js";import"./index-BCN8BzfC.js";import"./utils-DciZ0SJK.js";import"./index-EzkaYqZE.js";import"./index-hYLD56hJ.js";import"./index-C8HfUSOZ.js";import"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import"./index-DOsjFOOh.js";import"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import"./index-B6R_oMDY.js";import"./formatTime-BGPGB_ys.js";import"./SimpleModelDesign.vue_vue_type_script_setup_true_lang-dV0tnYrg.js";import"./simple-process-designer-D6s0X7s1.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-CKlTSlHM.js";import"./download-oWiM5xVU.js";import"./Index.vue_vue_type_script_setup_true_lang-CDBT2Z5d.js";import"./MentionModal.vue_vue_type_style_index_0_lang-BQssHd5O.js";const Pe={class:"mx-auto"},Be={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},Re={class:"w-200px flex items-center overflow-hidden"},Se=["title"],Ee={class:"flex-1 flex items-center justify-center h-full"},Ne={class:"w-400px flex items-center justify-between h-full"},Xe=["onClick"],je={class:"text-16px font-bold whitespace-nowrap"},Ae={class:"w-200px flex items-center justify-end gap-2"},Oe={key:0},Je={key:1},qe={class:"mt-50px"},ze={key:0,class:"mx-auto w-560px"},Ge={key:1,class:"mx-auto w-560px"},He={class:"mx-auto w-700px"},Ke=ie({__name:"index",setup($e){const x=ee(),{delView:H}=ye(),K=Me(),h=ae(),p=te(),W=le(),I=m(),U=m(),c=m(),E=m(),V=async()=>{var a;await((a=I.value)==null?void 0:a.validate())},C=async()=>{var a;await((a=U.value)==null?void 0:a.validate())},T=async()=>{var a;await((a=c.value)==null?void 0:a.validate())},i=m(-1),$=[{title:"\u57FA\u672C\u4FE1\u606F",validator:V},{title:"\u8868\u5355\u8BBE\u8BA1",validator:C},{title:"\u6D41\u7A0B\u8BBE\u8BA1",validator:T},{title:"\u66F4\u591A\u8BBE\u7F6E",validator:null}],e=m({id:void 0,name:"",key:"",category:void 0,icon:void 0,description:"",type:S.BPMN,formType:Ie.NORMAL,formId:"",formCustomCreatePath:"",formCustomViewPath:"",visible:!0,startUserType:void 0,startUserIds:[],startDeptIds:[],managerUserIds:[],allowCancelRunningProcess:!0,processIdRule:{enable:!1,prefix:"",infix:"",postfix:"",length:5},autoApprovalType:Ue.NONE,titleSetting:{enable:!1,title:""},summarySetting:{enable:!1,summary:[]},allowWithdrawTask:!1,printTemplateSetting:{enable:!1}}),L=m();G("processData",L),G("modelData",e);const N=m([]),X=m([]),j=m([]),A=m([]),n=h.params.type;oe(async()=>e.value.type,()=>{e.value.type===S.BPMN?L.value=e.value.bpmnXml:e.value.type===S.SIMPLE&&(L.value=e.value.simpleModel)},{immediate:!0});const O=async()=>{try{try{await V()}catch{throw i.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await C()}catch{throw i.value=1,new Error("\u8BF7\u5B8C\u5584\u81EA\u5B9A\u4E49\u8868\u5355\u4FE1\u606F")}try{await T()}catch{throw i.value=2,new Error("\u8BF7\u8BBE\u8BA1\u6D41\u7A0B")}return!0}catch(a){throw a}},F=async()=>{try{await O();const a={...e.value};n==="definition"?(await B(a),p.success("\u6062\u590D\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="update"?(await B(a),p.success("\u4FEE\u6539\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="copy"?(e.value.id=await R(a),p.success("\u590D\u5236\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):(e.value.id=await R(a),p.success("\u65B0\u5EFA\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")),n!=="update"&&await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},Q=async()=>{try{e.value.id||await p.confirm("\u662F\u5426\u786E\u8BA4\u53D1\u5E03\u8BE5\u6D41\u7A0B\uFF1F"),await O();const a={...e.value};if(e.value.id)await B(a);else{const l=await R(a);e.value.id=l.id}await xe(e.value.id),p.success("\u53D1\u5E03\u6210\u529F"),await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u53D1\u5E03\u5931\u8D25")}},Y=()=>{H(t(x.currentRoute)),x.push({name:"BpmModel"})};return me(async()=>{await(async()=>{var a,l,g,v,b,s;if(n==="definition"){const u=h.params.id,o=await _e(u);o.type=o.modelType,delete o.modelType,o.id=o.modelId,delete o.modelId,o.simpleModel&&(o.simpleModel=JSON.parse(o.simpleModel)),e.value=o,e.value.startUserType=((a=e.value.startUserIds)==null?void 0:a.length)>0?1:((g=(l=e.value)==null?void 0:l.startDeptIds)==null?void 0:g.length)>0?2:0}else if(["update","copy"].includes(n)){const u=h.params.id;e.value=await we(u),e.value.startUserType=((v=e.value.startUserIds)==null?void 0:v.length)>0?1:((s=(b=e.value)==null?void 0:b.startDeptIds)==null?void 0:s.length)>0?2:0,h.params.type==="copy"&&(delete e.value.id,e.value.bpmnXml&&(e.value.bpmnXml=e.value.bpmnXml.replaceAll(e.value.name,e.value.name+"\u526F\u672C"),e.value.bpmnXml=e.value.bpmnXml.replaceAll(e.value.key,e.value.key+"_copy")),e.value.name+="\u526F\u672C",e.value.key+="_copy",K.setTitle("\u590D\u5236\u6D41\u7A0B"))}else e.value.startUserType=0,e.value.managerUserIds.push(W.getUser.id);N.value=await he(),X.value=await ge.getCategorySimpleList(),j.value=await be(),A.value=await ke(),i.value=0,E.value.initData()})()}),pe(()=>{I.value=null,U.value=null,c.value=null}),(a,l)=>{const g=se,v=De,b=Z;return d(),M(b,null,{default:D(()=>[r("div",Pe,[r("div",Be,[r("div",Re,[y(g,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:Y}),r("span",{class:"ml-10px text-16px truncate",title:t(e).name||"\u521B\u5EFA\u6D41\u7A0B"},P(t(e).name||"\u521B\u5EFA\u6D41\u7A0B"),9,Se)]),r("div",Ee,[r("div",Ne,[(d(),w(ue,null,ne($,(s,u)=>r("div",{key:u,class:z(["flex items-center cursor-pointer mx-15px relative h-full",[t(i)===u?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:o=>(async f=>{var J;try{f!==0&&await V(),f!==1&&await C(),f!==2&&await T(),i.value=f,f===2&&(await fe(),await new Promise(q=>setTimeout(q,200)),(J=c.value)!=null&&J.refresh&&await c.value.refresh())}catch{p.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(u)},[r("div",{class:z(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[t(i)===u?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},P(u+1),3),r("span",je,P(s.title),1)],10,Xe)),64))])]),r("div",Ae,[t(n)==="update"?(d(),M(v,{key:0,type:"success",onClick:Q},{default:D(()=>l[4]||(l[4]=[de(" \u53D1 \u5E03 ")])),_:1})):k("",!0),y(v,{type:"primary",onClick:F},{default:D(()=>[t(n)==="definition"?(d(),w("span",Oe,"\u6062 \u590D")):(d(),w("span",Je,"\u4FDD \u5B58"))]),_:1})])]),r("div",qe,[t(i)===0?(d(),w("div",ze,[y(Ve,{modelValue:t(e),"onUpdate:modelValue":l[0]||(l[0]=s=>_(e)?e.value=s:null),categoryList:t(X),userList:t(j),deptList:t(A),ref_key:"basicInfoRef",ref:I},null,8,["modelValue","categoryList","userList","deptList"])])):k("",!0),t(i)===1?(d(),w("div",Ge,[y(Ce,{modelValue:t(e),"onUpdate:modelValue":l[1]||(l[1]=s=>_(e)?e.value=s:null),formList:t(N),ref_key:"formDesignRef",ref:U},null,8,["modelValue","formList"])])):k("",!0),t(i)===2?(d(),M(Te,{key:2,modelValue:t(e),"onUpdate:modelValue":l[2]||(l[2]=s=>_(e)?e.value=s:null),ref_key:"processDesignRef",ref:c},null,8,["modelValue"])):k("",!0),ce(r("div",He,[y(Le,{ref_key:"extraSettingsRef",ref:E,modelValue:t(e),"onUpdate:modelValue":l[3]||(l[3]=s=>_(e)?e.value=s:null)},null,8,["modelValue"])],512),[[ve,t(i)===3]])])])]),_:1})}}}),We=re(Ke,[["__scopeId","data-v-05960bcf"]]);export{We as default};
