import{_ as G}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{d as J,_ as L,b as O}from"./index-D_TWD7wt.js";import{k as P,m as Q}from"./index-Cftm-TQu.js";import{d as R}from"./download-oWiM5xVU.js";import{g as $}from"./index-tmtszvF2.js";import{x as E,Q as K,z as W,w as H,P as M,f as T}from"./form-designer-DHHJWkD5.js";import{l as X,r,A as V,q as y,B as s,x as u,J as n,h as _,u as i,m as Y,I as Z,$ as ee,G as x,n as ae}from"./form-create-_84fGzaM.js";const le={class:"flex items-center my-10px"},te={class:"el-upload__tip text-center"},oe={class:"el-upload__tip"},se=X({name:"CrmCustomerImportForm",__name:"CustomerImportForm",emits:["success"],setup(re,{expose:h,emit:k}){const f=J(),m=r(!1),d=r(!1),C=r(),p=r([]),v=r(!1),c=r(),g=r([]);h({open:async()=>{m.value=!0,await w(),g.value=await $(),c.value=O().getUser.id}});const N=async()=>{if(p.value.length!=0){d.value=!0;try{const a=new FormData;a.append("updateSupport",String(v.value)),a.append("file",p.value[0].raw),a.append("ownerUserId",String(c.value));const e=await P(a);F(e)}catch{I()}finally{d.value=!1}}else f.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},U=k,F=a=>{if(a.code!==0)return f.error(a.msg),void(d.value=!1);const e=a.data;let t="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createCustomerNames.length+";";for(let o of e.createCustomerNames)t+="< "+o+" >";t+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateCustomerNames.length+";";for(const o of e.updateCustomerNames)t+="< "+o+" >";t+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureCustomerNames).length+";";for(const o in e.failureCustomerNames)t+="< "+o+": "+e.failureCustomerNames[o]+" >";f.alert(t),d.value=!1,m.value=!1,U("success")},I=()=>{f.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),w()},w=async()=>{var a;p.value=[],v.value=!1,c.value=void 0,await ae(),(a=C.value)==null||a.clearFiles()},S=()=>{f.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},j=async()=>{const a=await Q();R.excel(a,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const t=K,o=E,q=L,z=H,A=M,B=W,b=T,D=G;return y(),V(D,{modelValue:i(m),"onUpdate:modelValue":e[4]||(e[4]=l=>_(m)?m.value=l:null),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:s(()=>[n(b,{disabled:i(d),type:"primary",onClick:N},{default:s(()=>e[10]||(e[10]=[x("\u786E \u5B9A")])),_:1},8,["disabled"]),n(b,{onClick:e[3]||(e[3]=l=>m.value=!1)},{default:s(()=>e[11]||(e[11]=[x("\u53D6 \u6D88")])),_:1})]),default:s(()=>[u("div",le,[e[5]||(e[5]=u("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1)),n(o,{modelValue:i(c),"onUpdate:modelValue":e[0]||(e[0]=l=>_(c)?c.value=l:null),class:"!w-240px",clearable:""},{default:s(()=>[(y(!0),Y(Z,null,ee(i(g),l=>(y(),V(t,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n(B,{ref_key:"uploadRef",ref:C,"file-list":i(p),"onUpdate:fileList":e[2]||(e[2]=l=>_(p)?p.value=l:null),"auto-upload":!1,disabled:i(d),limit:1,"on-exceed":S,accept:".xlsx, .xls",action:"none",drag:""},{tip:s(()=>[u("div",te,[u("div",oe,[n(z,{modelValue:i(v),"onUpdate:modelValue":e[1]||(e[1]=l=>_(v)?v.value=l:null)},null,8,["modelValue"]),e[6]||(e[6]=x(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 "))]),e[8]||(e[8]=u("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),n(A,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:j},{default:s(()=>e[7]||(e[7]=[x(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:s(()=>[n(q,{icon:"ep:upload"}),e[9]||(e[9]=u("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),u("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}}});export{se as _};
