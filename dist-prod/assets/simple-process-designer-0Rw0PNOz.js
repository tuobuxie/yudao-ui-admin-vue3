import{_ as ve,ar as Ne,D as Ll,c as _l,d as Rl,R as Tt}from"./index-D_TWD7wt.js";import{_ as Hl}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{_ as ql}from"./DictTag.vue_vue_type_script_lang-BD_Qe0UA.js";import{l as ce,r as M,i as me,m as i,q as l,x as o,A as c,E as T,u as e,h as de,B as a,J as t,ag as Te,G as A,H as B,I as G,$,C as he,a8 as Ee,D as ke,c as Se,j as ol,b as pl,g as Dl,e as Ml,aa as kt,p as Ie,O as St}from"./form-create-_84fGzaM.js";import{a as V,A as Ut,c as Gl,R as zl,d as nl,e as ml,f as _e,D as Me,F as se,S as wt,g as Ge,C as ie,P as Vt,h as bl,T as Re,i as Zl,j as Ct,k as et,M as lt,l as Rt,m as Dt,n as xt,o as xl,p as It,q as Ot,b as tt,r as At,s as Pt,t as at,u as ot,v as we,w as nt,x as ge,y as Ft,z as El,B as it,E as dt,G as Lt,H as Ht,I as qt,N as st}from"./consts-CvaDWb4S.js";import{n as Mt,K as Ce,aH as Ye,a0 as Il,$ as Ol,a7 as Nl,o as rt,s as il,u as vl,V as je,f as Oe,v as Bl,i as Tl,Z as $l,_ as jl,h as Ke,aj as Xe,D as kl,R as Gt,k as fl,j as zt,x as We,Q as Qe,a1 as ut,l as Kl,t as Yl,at as ct,ad as Al,F as pt,aI as Bt,e as $t,a6 as jt,aq as Kt,aJ as Yt,aK as Xt,aL as Wt,ak as Qt}from"./form-designer-DHHJWkD5.js";import{a as dl,u as Ve,b as sl,c as Xl,d as rl,e as Ae,f as mt,g as Pl,h as vt,i as Jt}from"./node-DGa8QpOR.js";import{d as yl,a as Wl}from"./formatTime-BGPGB_ys.js";import{d as ft,h as Zt}from"./tree-COGD3qag.js";import{g as ea,c as Ql,a as yt,b as la}from"./utils-DciZ0SJK.js";import{_ as ta,a as aa}from"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-BaqkTJqn.js";import{B as Jl}from"./constants-C3gLHYOK.js";import{a as oa}from"./index-BLgxU3BI.js";import{g as gt}from"./index-DtDcjRGr.js";import{p as na}from"./index-BCN8BzfC.js";import{d as ia}from"./download-oWiM5xVU.js";import{g as da}from"./index-D0Shdg27.js";import{g as sa}from"./index-2u6l8ymH.js";import{g as ra}from"./index-bRiUJ-Wq.js";import{g as ua}from"./index-tmtszvF2.js";import{g as ca}from"./index-Dr_KpYqc.js";const pa={class:"node-handler-wrapper"},ma={class:"node-handler"},va={class:"handler-item-wrapper"},fa={class:"add-icon"},qe=ce({name:"NodeHandler",__name:"NodeHandler",props:{childNode:{type:Object,default:null},currentNode:{type:Object,required:!0}},emits:["update:childNode"],setup(J,{emit:Z}){const Y=M(!1),S=J,m=Z,n=me("readonly"),d=x=>{if(Y.value=!1,x===V.USER_TASK_NODE||x===V.TRANSACTOR_NODE){const g={id:"Activity_"+Ne(),name:ml.get(x),showText:"",type:x,approveMethod:nl.SEQUENTIAL_APPROVE,rejectHandler:{type:zl.FINISH_PROCESS},timeoutHandler:{enable:!1},assignEmptyHandler:{type:Gl.APPROVE},assignStartUserHandlerType:Ut.START_USER_AUDIT,childNode:S.childNode,taskCreateListener:{enable:!1},taskAssignListener:{enable:!1},taskCompleteListener:{enable:!1}};m("update:childNode",g)}if(x===V.COPY_TASK_NODE){const g={id:"Activity_"+Ne(),name:ml.get(V.COPY_TASK_NODE),showText:"",type:V.COPY_TASK_NODE,childNode:S.childNode};m("update:childNode",g)}if(x===V.CONDITION_BRANCH_NODE){const g={name:"\u6761\u4EF6\u5206\u652F",type:V.CONDITION_BRANCH_NODE,id:"GateWay_"+Ne(),childNode:S.childNode,conditionNodes:[{id:"Flow_"+Ne(),name:"\u6761\u4EF61",showText:"",type:V.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!1,conditionType:_e.RULE,conditionGroups:Ce(Me)}},{id:"Flow_"+Ne(),name:"\u5176\u5B83\u60C5\u51B5",showText:"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F",type:V.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!0}}]};m("update:childNode",g)}if(x===V.PARALLEL_BRANCH_NODE){const g={name:"\u5E76\u884C\u5206\u652F",type:V.PARALLEL_BRANCH_NODE,id:"GateWay_"+Ne(),childNode:S.childNode,conditionNodes:[{id:"Flow_"+Ne(),name:"\u5E76\u884C1",showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:V.CONDITION_NODE,childNode:void 0},{id:"Flow_"+Ne(),name:"\u5E76\u884C2",showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:V.CONDITION_NODE,childNode:void 0}]};m("update:childNode",g)}if(x===V.INCLUSIVE_BRANCH_NODE){const g={name:"\u5305\u5BB9\u5206\u652F",type:V.INCLUSIVE_BRANCH_NODE,id:"GateWay_"+Ne(),childNode:S.childNode,conditionNodes:[{id:"Flow_"+Ne(),name:"\u5305\u5BB9\u6761\u4EF61",showText:"",type:V.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!1,conditionType:_e.RULE,conditionGroups:Ce(Me)}},{id:"Flow_"+Ne(),name:"\u5176\u5B83\u60C5\u51B5",showText:"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F",type:V.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!0}}]};m("update:childNode",g)}if(x===V.DELAY_TIMER_NODE){const g={id:"Activity_"+Ne(),name:ml.get(V.DELAY_TIMER_NODE),showText:"",type:V.DELAY_TIMER_NODE,childNode:S.childNode};m("update:childNode",g)}if(x===V.ROUTER_BRANCH_NODE){const g={id:"GateWay_"+Ne(),name:ml.get(V.ROUTER_BRANCH_NODE),showText:"",type:V.ROUTER_BRANCH_NODE,childNode:S.childNode};m("update:childNode",g)}if(x===V.TRIGGER_NODE){const g={id:"Activity_"+Ne(),name:ml.get(V.TRIGGER_NODE),showText:"",type:V.TRIGGER_NODE,childNode:S.childNode};m("update:childNode",g)}if(x===V.CHILD_PROCESS_NODE){const g={id:"Activity_"+Ne(),name:ml.get(V.CHILD_PROCESS_NODE),showText:"",type:V.CHILD_PROCESS_NODE,childNode:S.childNode,childProcessSetting:{calledProcessDefinitionKey:"",calledProcessDefinitionName:"",async:!1,skipStartUserNode:!1,startUserSetting:{type:1},timeoutSetting:{enable:!1},multiInstanceSetting:{enable:!1}}};m("update:childNode",g)}};return(x,g)=>{const I=ve,H=Mt;return l(),i("div",pa,[o("div",ma,[e(n)?T("",!0):(l(),c(H,{key:0,trigger:"hover",visible:e(Y),"onUpdate:visible":g[10]||(g[10]=N=>de(Y)?Y.value=N:null),placement:"right-start",width:"auto"},{reference:a(()=>[o("div",fa,[t(I,{icon:"ep:plus"})])]),default:a(()=>[o("div",va,[o("div",{class:"handler-item",onClick:g[0]||(g[0]=N=>d(e(V).USER_TASK_NODE))},g[11]||(g[11]=[o("div",{class:"approve handler-item-icon"},[o("span",{class:"iconfont icon-approve icon-size"})],-1),o("div",{class:"handler-item-text"},"\u5BA1\u6279\u4EBA",-1)])),o("div",{class:"handler-item",onClick:g[1]||(g[1]=N=>d(e(V).TRANSACTOR_NODE))},g[12]||(g[12]=[o("div",{class:"transactor handler-item-icon"},[o("span",{class:"iconfont icon-transactor icon-size"})],-1),o("div",{class:"handler-item-text"},"\u529E\u7406\u4EBA",-1)])),o("div",{class:"handler-item",onClick:g[2]||(g[2]=N=>d(e(V).COPY_TASK_NODE))},g[13]||(g[13]=[o("div",{class:"handler-item-icon copy"},[o("span",{class:"iconfont icon-size icon-copy"})],-1),o("div",{class:"handler-item-text"},"\u6284\u9001",-1)])),o("div",{class:"handler-item",onClick:g[3]||(g[3]=N=>d(e(V).CONDITION_BRANCH_NODE))},g[14]||(g[14]=[o("div",{class:"handler-item-icon condition"},[o("span",{class:"iconfont icon-size icon-exclusive"})],-1),o("div",{class:"handler-item-text"},"\u6761\u4EF6\u5206\u652F",-1)])),o("div",{class:"handler-item",onClick:g[4]||(g[4]=N=>d(e(V).PARALLEL_BRANCH_NODE))},g[15]||(g[15]=[o("div",{class:"handler-item-icon parallel"},[o("span",{class:"iconfont icon-size icon-parallel"})],-1),o("div",{class:"handler-item-text"},"\u5E76\u884C\u5206\u652F",-1)])),o("div",{class:"handler-item",onClick:g[5]||(g[5]=N=>d(e(V).INCLUSIVE_BRANCH_NODE))},g[16]||(g[16]=[o("div",{class:"handler-item-icon inclusive"},[o("span",{class:"iconfont icon-size icon-inclusive"})],-1),o("div",{class:"handler-item-text"},"\u5305\u5BB9\u5206\u652F",-1)])),o("div",{class:"handler-item",onClick:g[6]||(g[6]=N=>d(e(V).DELAY_TIMER_NODE))},g[17]||(g[17]=[o("div",{class:"handler-item-icon delay"},[o("span",{class:"iconfont icon-size icon-delay"})],-1),o("div",{class:"handler-item-text"},"\u5EF6\u8FDF\u5668",-1)])),o("div",{class:"handler-item",onClick:g[7]||(g[7]=N=>d(e(V).ROUTER_BRANCH_NODE))},g[18]||(g[18]=[o("div",{class:"handler-item-icon router"},[o("span",{class:"iconfont icon-size icon-router"})],-1),o("div",{class:"handler-item-text"},"\u8DEF\u7531\u5206\u652F",-1)])),o("div",{class:"handler-item",onClick:g[8]||(g[8]=N=>d(e(V).TRIGGER_NODE))},g[19]||(g[19]=[o("div",{class:"handler-item-icon trigger"},[o("span",{class:"iconfont icon-size icon-trigger"})],-1),o("div",{class:"handler-item-text"},"\u89E6\u53D1\u5668",-1)])),o("div",{class:"handler-item",onClick:g[9]||(g[9]=N=>d(e(V).CHILD_PROCESS_NODE))},g[20]||(g[20]=[o("div",{class:"handler-item-icon child-process"},[o("span",{class:"iconfont icon-size icon-child-process"})],-1),o("div",{class:"handler-item-text"},"\u5B50\u6D41\u7A0B",-1)]))])]),_:1},8,["visible"]))])])}}}),ya={class:"config-header"},ga=["placeholder"],ha={key:1,class:"node-name"},_a={key:1},ba={key:2},Ea={class:"field-setting-pane"},Na={class:"field-permit-title"},Ta={class:"other-titles"},ka={class:"field-setting-item-label"},Sa={class:"item-radio-wrap"},Ua={class:"item-radio-wrap"},wa={class:"item-radio-wrap"},Va=ce({name:"StartUserNodeConfig",__name:"StartUserNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const Y=J,S=me("startUserIds"),m=me("startDeptIds"),n=me("userList"),d=me("deptList"),{settingVisible:x,closeDrawer:g,openDrawer:I}=dl(),H=Ve(Y),{nodeName:N,showInput:U,clickIcon:r,blurEvent:s}=sl(V.COPY_TASK_NODE),v=M("user"),{formType:O,fieldsPermissionConfig:p,getNodeConfigFormFields:_}=Xl(se.WRITE),z=K=>{if(!K||K.length===0)return"";const D=[];return K.forEach(W=>{const F=n==null?void 0:n.value.find(k=>k.id===W);F&&F.nickname&&D.push(F.nickname)}),D.join(",")},R=K=>{if(!K||K.length===0)return"";const D=[];return K.forEach(W=>{const F=d==null?void 0:d.value.find(k=>k.id===W);F&&F.name&&D.push(F.name)}),D.join(",")},P=async()=>(v.value="user",H.value.name=N.value,H.value.showText="\u5DF2\u8BBE\u7F6E",H.value.fieldsPermission=p.value,H.value.buttonsSetting=wt,x.value=!1,!0),j=K=>{p.value.forEach(D=>{D.permission=K==="READ"?se.READ:K==="WRITE"?se.WRITE:se.NONE})};return Z({openDrawer:I,showStartUserNodeConfig:K=>{N.value=K.name,_(K.fieldsPermission)}}),(K,D)=>{const W=ve,F=Nl,k=rt,E=Ol,Q=vl,f=il,w=Il,X=je,q=Oe,ee=Ye,le=Te("mountedFocus");return l(),c(ee,{"append-to-body":!0,modelValue:e(x),"onUpdate:modelValue":D[7]||(D[7]=L=>de(x)?x.value=L:null),"show-close":!1,size:550,"before-close":P},{header:a(()=>[o("div",ya,[e(U)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:D[0]||(D[0]=L=>e(s)()),"onUpdate:modelValue":D[1]||(D[1]=L=>de(N)?N.value=L:null),placeholder:e(N)},null,40,ga)),[[le],[Ee,e(N)]]):(l(),i("div",ha,[A(B(e(N))+" ",1),t(W,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:D[2]||(D[2]=L=>e(r)())})])),D[8]||(D[8]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(X),o("div",null,[t(q,{type:"primary",onClick:P},{default:a(()=>D[15]||(D[15]=[A("\u786E \u5B9A")])),_:1}),t(q,{onClick:e(g)},{default:a(()=>D[16]||(D[16]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[t(w,{type:"border-card",modelValue:e(v),"onUpdate:modelValue":D[6]||(D[6]=L=>de(v)?v.value=L:null)},{default:a(()=>[t(E,{label:"\u6743\u9650",name:"user"},{default:a(()=>[e(S)&&e(S).length!==0||e(m)&&e(m).length!==0?e(S)&&e(S).length>0?(l(),i("div",_a,[e(S).length==1?(l(),c(F,{key:0},{default:a(()=>[A(B(z(e(S)))+" \u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1})):(l(),c(F,{key:1},{default:a(()=>[t(k,{class:"box-item",effect:"dark",placement:"top",content:z(e(S))},{default:a(()=>[A(B(z(e(S).slice(0,2)))+" \u7B49 "+B(e(S).length)+" \u4EBA\u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1},8,["content"])]),_:1}))])):e(m)&&e(m).length>0?(l(),i("div",ba,[e(m).length==1?(l(),c(F,{key:0},{default:a(()=>[A(B(R(e(m)))+" \u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1})):(l(),c(F,{key:1},{default:a(()=>[t(k,{class:"box-item",effect:"dark",placement:"top",content:R(e(m))},{default:a(()=>[A(B(R(e(m).slice(0,2)))+" \u7B49 "+B(e(m).length)+" \u4E2A\u90E8\u95E8\u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1},8,["content"])]),_:1}))])):T("",!0):(l(),c(F,{key:0},{default:a(()=>D[9]||(D[9]=[A(" \u5168\u90E8\u6210\u5458\u53EF\u4EE5\u53D1\u8D77\u6D41\u7A0B ")])),_:1}))]),_:1}),e(O)===10?(l(),c(E,{key:0,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:a(()=>[o("div",Ea,[D[14]||(D[14]=o("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),o("div",Na,[D[10]||(D[10]=o("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 ",-1)),o("div",Ta,[o("span",{class:"setting-title-label cursor-pointer",onClick:D[3]||(D[3]=L=>j("READ"))}," \u53EA\u8BFB "),o("span",{class:"setting-title-label cursor-pointer",onClick:D[4]||(D[4]=L=>j("WRITE"))}," \u53EF\u7F16\u8F91 "),o("span",{class:"setting-title-label cursor-pointer",onClick:D[5]||(D[5]=L=>j("NONE"))}," \u9690\u85CF ")])]),(l(!0),i(G,null,$(e(p),(L,u)=>(l(),i("div",{class:"field-setting-item",key:u},[o("div",ka,B(L.title),1),t(f,{class:"field-setting-item-group",modelValue:L.permission,"onUpdate:modelValue":De=>L.permission=De},{default:a(()=>[o("div",Sa,[t(Q,{value:e(se).READ,size:"large",label:e(se).READ},{default:a(()=>D[11]||(D[11]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",Ua,[t(Q,{value:e(se).WRITE,size:"large",label:e(se).WRITE},{default:a(()=>D[12]||(D[12]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",wa,[t(Q,{value:e(se).NONE,size:"large",label:e(se).NONE},{default:a(()=>D[13]||(D[13]=[o("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):T("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ca={class:"node-wrapper"},Ra={class:"node-container"},Da={class:"node-title-container"},xa=["placeholder"],Ia=["title"],Oa={key:1,class:"node-text"},Aa=ce({name:"StartEventNode",__name:"StartUserNode",props:{flowNode:{type:Object,default:()=>null}},emits:["update:modelValue"],setup(J,{emit:Z}){const Y=J,S=me("readonly"),m=me("tasks",M([])),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.START_USER_NODE),I=M(),H=()=>{S?m&&m.value&&(U.value=n.value.name,r.value=m.value.filter(s=>(s==null?void 0:s.taskDefinitionKey)===n.value.id),N.value=!0):(I.value.showStartUserNodeConfig(n.value),I.value.openDrawer())},N=M(!1),U=M(void 0),r=M([]);return(s,v)=>{var K;const O=ve,p=jl,_=ql,z=$l,R=Tl,P=Bl,j=Te("mountedFocus");return l(),i(G,null,[o("div",Ca,[o("div",Ra,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((K=e(n))==null?void 0:K.activityStatus)}`]])},[o("div",Da,[v[5]||(v[5]=o("div",{class:"node-title-icon start-user"},[o("span",{class:"iconfont icon-start-user"})],-1)),!e(S)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:v[0]||(v[0]=D=>e(x)()),"onUpdate:modelValue":v[1]||(v[1]=D=>e(n).name=D),placeholder:e(n).name},null,40,xa)),[[j],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:v[2]||(v[2]=(...D)=>e(g)&&e(g)(...D))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,Ia)):(l(),i("div",Oa,B(e(Ge).get(e(V).START_USER_NODE)),1)),e(S)?T("",!0):(l(),c(O,{key:2,icon:"ep:arrow-right-bold"}))])],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":v[3]||(v[3]=D=>e(n).childNode=D),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)])]),!e(S)&&e(n)?(l(),c(Va,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0),t(P,{title:e(U)||"\u5BA1\u6279\u8BB0\u5F55",modelValue:e(N),"onUpdate:modelValue":v[4]||(v[4]=D=>de(N)?N.value=D:null),width:"1000px","append-to-body":""},{default:a(()=>[t(R,null,{default:a(()=>[t(z,{data:e(r),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:a(()=>[t(p,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),t(p,{label:"\u5BA1\u6279\u4EBA","min-width":"100",align:"center"},{default:a(D=>{var W,F;return[A(B(((W=D.row.assigneeUser)==null?void 0:W.nickname)||((F=D.row.ownerUser)==null?void 0:F.nickname)),1)]}),_:1}),t(p,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:a(D=>{var W,F;return[A(B(((W=D.row.assigneeUser)==null?void 0:W.deptName)||((F=D.row.ownerUser)==null?void 0:F.deptName)),1)]}),_:1}),t(p,{formatter:e(yl),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),t(p,{formatter:e(yl),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),t(p,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:a(D=>[t(_,{type:e(Ll).BPM_TASK_STATUS,value:D.row.status},null,8,["type","value"])]),_:1}),t(p,{align:"center",label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason","min-width":"120"}),t(p,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:a(D=>[A(B(e(Wl)(D.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["title","modelValue"])],64)}}}),Pa={class:"end-node-wrapper"},Fa=ce({name:"EndEventNode",__name:"EndEventNode",props:{flowNode:{type:Object,default:()=>null}},setup(J){const Z=Ve(J),Y=me("readonly"),S=me("processInstance",M({})),m=M(!1),n=M([]),d=()=>{Y&&S&&S.value&&(n.value=[{assigneeUser:S.value.startUser,createTime:S.value.startTime,endTime:S.value.endTime,status:S.value.status,durationInMillis:S.value.durationInMillis}],m.value=!0)};return(x,g)=>{var s;const I=jl,H=ql,N=$l,U=Tl,r=Bl;return l(),i(G,null,[o("div",Pa,[o("div",{class:ke(["end-node-box cursor-pointer",`${e(Ae)((s=e(Z))==null?void 0:s.activityStatus)}`]),onClick:d},g[1]||(g[1]=[o("span",{class:"node-fixed-name",title:"\u7ED3\u675F"},"\u7ED3\u675F",-1)]),2)]),t(r,{title:"\u5BA1\u6279\u4FE1\u606F",modelValue:e(m),"onUpdate:modelValue":g[0]||(g[0]=v=>de(m)?m.value=v:null),width:"1000px","append-to-body":""},{default:a(()=>[t(U,null,{default:a(()=>[t(N,{data:e(n),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:a(()=>[t(I,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),t(I,{label:"\u53D1\u8D77\u4EBA",prop:"assigneeUser.nickname","min-width":"100",align:"center"}),t(I,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:a(v=>{var O,p;return[A(B(((O=v.row.assigneeUser)==null?void 0:O.deptName)||((p=v.row.ownerUser)==null?void 0:p.deptName)),1)]}),_:1}),t(I,{formatter:e(yl),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),t(I,{formatter:e(yl),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),t(I,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:a(v=>[t(H,{type:e(Ll).BPM_PROCESS_INSTANCE_STATUS,value:v.row.status},null,8,["type","value"])]),_:1}),t(I,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:a(v=>[A(B(e(Wl)(v.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])],64)}}}),La={key:0},Ha=ce({__name:"UserTaskListener",props:{modelValue:{type:Object,required:!0},formFieldOptions:{type:Object,required:!0}},emits:["update:modelValue"],setup(J,{expose:Z,emit:Y}){const S=J,m=Y,n=M(),d=Se({get:()=>S.modelValue,set(g){m("update:modelValue",g)}}),x=M([{name:"\u521B\u5EFA\u4EFB\u52A1",type:"Create"},{name:"\u6307\u6D3E\u4EFB\u52A1\u6267\u884C\u4EBA\u5458",type:"Assign"},{name:"\u5B8C\u6210\u4EFB\u52A1",type:"Complete"}]);return Z({validate:async()=>!!n&&await n.value.validate()}),(g,I)=>{const H=Nl,N=je,U=kl,r=Xe,s=Gt,v=fl,O=Ke;return l(),c(O,{ref_key:"listenerFormRef",ref:n,model:e(d),"label-position":"top"},{default:a(()=>[(l(!0),i(G,null,$(e(x),(p,_)=>(l(),i("div",{key:_},[t(N,{"content-position":"left"},{default:a(()=>[t(H,{tag:"b",size:"large"},{default:a(()=>[A(B(p.name),1)]),_:2},1024)]),_:2},1024),t(r,null,{default:a(()=>[t(U,{modelValue:e(d)[`task${p.type}ListenerEnable`],"onUpdate:modelValue":z=>e(d)[`task${p.type}ListenerEnable`]=z,"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(d)[`task${p.type}ListenerEnable`]?(l(),i("div",La,[t(r,null,{default:a(()=>[t(s,{title:"\u4EC5\u652F\u6301 POST \u8BF7\u6C42\uFF0C\u4EE5\u8BF7\u6C42\u4F53\u65B9\u5F0F\u63A5\u6536\u53C2\u6570",type:"warning","show-icon":"",closable:!1})]),_:1}),t(r,{label:"\u8BF7\u6C42\u5730\u5740",prop:`task${p.type}ListenerPath`,rules:{required:!0,message:"\u8BF7\u6C42\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(v,{modelValue:e(d)[`task${p.type}ListenerPath`],"onUpdate:modelValue":z=>e(d)[`task${p.type}ListenerPath`]=z},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),t(ta,{header:e(d)[`task${p.type}Listener`].header,body:e(d)[`task${p.type}Listener`].body,bind:`task${p.type}Listener`},null,8,["header","body","bind"])])):T("",!0)]))),128))]),_:1},8,["model"])}}}),qa={class:"config-header"},Ma=["placeholder"],Ga={key:1,class:"node-name"},za={key:0,class:"flex flex-items-center mb-3"},Ba={class:"flex-col"},$a={key:9},ja={class:"flex-col"},Ka={key:10},Ya={class:"flex-col"},Xa={key:12},Wa={class:"flex-col"},Qa={key:13},Ja={key:14},Za={class:"button-setting-pane"},eo={class:"button-setting-item-label"},lo={class:"button-setting-item-label"},to=["onBlur","onUpdate:modelValue","placeholder"],ao={class:"button-setting-item-label"},oo={class:"field-setting-pane"},no={class:"field-permit-title"},io={class:"other-titles"},so={class:"field-setting-item-label"},ro={class:"item-radio-wrap"},uo={class:"item-radio-wrap"},co={class:"item-radio-wrap"},po=_l(ce({name:"UserTaskNodeConfig",__name:"UserTaskNodeConfig",props:{flowNode:{type:Object,required:!0}},emits:["find:returnTaskNodes"],setup(J,{expose:Z,emit:Y}){const S=J,m=Y,n=Se(()=>{let h="\u90E8\u95E8\u8D1F\u8D23\u4EBA\u6765\u6E90";return u.value.candidateStrategy==ie.MULTI_LEVEL_DEPT_LEADER?h+="(\u6307\u5B9A\u90E8\u95E8\u5411\u4E0A)":u.value.candidateStrategy==ie.FORM_DEPT_LEADER?h+="(\u8868\u5355\u5185\u90E8\u95E8\u5411\u4E0A)":h+="(\u53D1\u8D77\u4EBA\u90E8\u95E8\u5411\u4E0A)",h}),d=Ve(S),{settingVisible:x,closeDrawer:g,openDrawer:I}=dl(),{nodeName:H,showInput:N,clickIcon:U,blurEvent:r}=sl(V.USER_TASK_NODE),s=M("user"),{formType:v,fieldsPermissionConfig:O,formFieldOptions:p,getNodeConfigFormFields:_}=Xl(se.READ),z=Se(()=>(p.unshift({field:Vt.START_USER_ID,title:"\u53D1\u8D77\u4EBA",type:"UserSelect",required:!0}),p.filter(h=>h.type==="UserSelect"))),R=Se(()=>p.filter(h=>h.type==="DeptSelect")),{buttonsSetting:P,btnDisplayNameEdit:j,changeBtnDisplayName:K,btnDisplayNameBlurEvent:D}=function(){const h=M(),b=M([]);return{buttonsSetting:h,btnDisplayNameEdit:b,changeBtnDisplayName:Ue=>{b.value[Ue]=!0},btnDisplayNameBlurEvent:Ue=>{b.value[Ue]=!1;const ye=h.value[Ue];ye.displayName=ye.displayName||tt.get(ye.id)}}}(),W=M(bl.USER),F=M(),k=ol({candidateStrategy:[{required:!0,message:"\u5BA1\u6279\u4EBA\u8BBE\u7F6E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],roleIds:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],deptIds:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userGroups:[{required:!0,message:"\u7528\u6237\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formUser:[{required:!0,message:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formDept:[{required:!0,message:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],postIds:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],expression:[{required:!0,message:"\u6D41\u7A0B\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],approveMethod:[{required:!0,message:"\u591A\u4EBA\u5BA1\u6279\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],approveRatio:[{required:!0,message:"\u901A\u8FC7\u6BD4\u4F8B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnNodeId:[{required:!0,message:"\u9A73\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeoutHandlerEnable:[{required:!0}],timeoutHandlerType:[{required:!0}],timeDuration:[{required:!0,message:"\u8D85\u65F6\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],maxRemindCount:[{required:!0,message:"\u63D0\u9192\u6B21\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],assignEmptyHandlerType:[{required:!0}],assignEmptyHandlerUserIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],assignStartUserHandlerType:[{required:!0}]}),{configForm:E,roleOptions:Q,postOptions:f,userOptions:w,userGroupOptions:X,deptTreeOptions:q,handleCandidateParam:ee,parseCandidateParam:le,getShowText:L}=mt(d.value.type),u=E,De=()=>{u.value.userIds=[],u.value.deptIds=[],u.value.roleIds=[],u.value.postIds=[],u.value.userGroups=[],u.value.deptLevel=1,u.value.formUser="",u.value.formDept="",u.value.approveMethod=nl.SEQUENTIAL_APPROVE},$e=()=>{u.value.rejectHandlerType=zl.FINISH_PROCESS,u.value.approveMethod===nl.APPROVE_BY_RATIO&&(u.value.approveRatio=100),F.value.clearValidate("approveRatio")},fe=M([]),{timeoutHandlerChange:Pe,cTimeoutType:Fe,timeoutHandlerTypeChanged:Je,timeUnit:te,timeUnitChange:pe,isoTimeDuration:oe,cTimeoutMaxRemindCount:C}=function(){const h=M(Re.HOUR),b=Se(()=>{if(u.value.timeoutHandlerEnable)return u.value.timeoutHandlerType}),Ue=Se(()=>{if(!u.value.timeoutHandlerEnable)return;let be="PT";return h.value===Re.MINUTE&&(be+=u.value.timeDuration+"M"),h.value===Re.HOUR&&(be+=u.value.timeDuration+"H"),h.value===Re.DAY&&(be+=u.value.timeDuration+"D"),be}),ye=Se(()=>{if(u.value.timeoutHandlerEnable&&u.value.timeoutHandlerType===Zl.REMINDER)return u.value.maxRemindCount});return{timeoutHandlerChange:()=>{u.value.timeoutHandlerEnable&&(h.value=2,u.value.timeDuration=6,u.value.timeoutHandlerType=1,u.value.maxRemindCount=1)},cTimeoutType:b,timeoutHandlerTypeChanged:()=>{u.value.timeoutHandlerType===Zl.REMINDER&&(u.value.maxRemindCount=1)},timeUnit:h,timeUnitChange:()=>{h.value===Re.MINUTE&&(u.value.timeDuration=60),h.value===Re.HOUR&&(u.value.timeDuration=6),h.value===Re.DAY&&(u.value.timeDuration=1)},isoTimeDuration:Ue,cTimeoutMaxRemindCount:ye}}(),ae=M(),ne=Se(()=>d.value.type===V.TRANSACTOR_NODE?"\u529E\u7406":"\u5BA1\u6279"),xe=async()=>{var b,Ue,ye,be,el,ll;if(d.value.name=H.value,d.value.approveType=W.value,W.value!==bl.USER)return d.value.showText=ea(W.value),x.value=!1,!0;if(!F||!ae||!(await F.value.validate()&&await ae.value.validate()))return!1;const h=L();return!!h&&(d.value.candidateStrategy=u.value.candidateStrategy,d.value.candidateParam=ee(),d.value.approveMethod=u.value.approveMethod,u.value.approveMethod===nl.APPROVE_BY_RATIO&&(d.value.approveRatio=u.value.approveRatio),d.value.rejectHandler={type:u.value.rejectHandlerType,returnNodeId:u.value.returnNodeId},d.value.timeoutHandler={enable:u.value.timeoutHandlerEnable,type:Fe.value,timeDuration:oe.value,maxRemindCount:C.value},d.value.assignEmptyHandler={type:u.value.assignEmptyHandlerType,userIds:u.value.assignEmptyHandlerType===Gl.ASSIGN_USER?u.value.assignEmptyHandlerUserIds:void 0},d.value.assignStartUserHandlerType=u.value.assignStartUserHandlerType,d.value.fieldsPermission=O.value,d.value.buttonsSetting=P.value,d.value.taskCreateListener={enable:u.value.taskCreateListenerEnable??!1,path:u.value.taskCreateListenerPath,header:(b=u.value.taskCreateListener)==null?void 0:b.header,body:(Ue=u.value.taskCreateListener)==null?void 0:Ue.body},d.value.taskAssignListener={enable:u.value.taskAssignListenerEnable??!1,path:u.value.taskAssignListenerPath,header:(ye=u.value.taskAssignListener)==null?void 0:ye.header,body:(be=u.value.taskAssignListener)==null?void 0:be.body},d.value.taskCompleteListener={enable:u.value.taskCompleteListenerEnable??!1,path:u.value.taskCompleteListenerPath,header:(el=u.value.taskCompleteListener)==null?void 0:el.header,body:(ll=u.value.taskCompleteListener)==null?void 0:ll.body},d.value.signEnable=u.value.signEnable,d.value.reasonRequire=u.value.reasonRequire,d.value.skipExpression=u.value.skipExpression,d.value.showText=h,x.value=!1,!0)};Z({openDrawer:I,showUserTaskNodeConfig:h=>{var Ue,ye,be,el,ll,ue,Le,He,Sl,gl,ul,ze,tl,Ul,wl,al,cl,Vl,Cl,hl,y;if(H.value=h.name,W.value=h.approveType?h.approveType:bl.USER,W.value!==bl.USER)return;u.value.candidateStrategy=h.candidateStrategy,le(h.candidateStrategy,h==null?void 0:h.candidateParam),u.value.approveMethod=h.approveMethod,h.approveMethod==nl.APPROVE_BY_RATIO&&(u.value.approveRatio=h.approveRatio),u.value.rejectHandlerType=(Ue=h.rejectHandler)==null?void 0:Ue.type,u.value.returnNodeId=(ye=h.rejectHandler)==null?void 0:ye.returnNodeId;const b=[];if(m("find:returnTaskNodes",b),fe.value=b,u.value.timeoutHandlerEnable=(be=h.timeoutHandler)==null?void 0:be.enable,((el=h.timeoutHandler)==null?void 0:el.enable)&&((ll=h.timeoutHandler)==null?void 0:ll.timeDuration)){const re=h.timeoutHandler.timeDuration;let Be=re.slice(2,re.length-1),Nt=re.slice(re.length-1);u.value.timeDuration=parseInt(Be),te.value=Ql(Nt)}u.value.timeoutHandlerType=(ue=h.timeoutHandler)==null?void 0:ue.type,u.value.maxRemindCount=(Le=h.timeoutHandler)==null?void 0:Le.maxRemindCount,u.value.assignEmptyHandlerType=(He=h.assignEmptyHandler)==null?void 0:He.type,u.value.assignEmptyHandlerUserIds=(Sl=h.assignEmptyHandler)==null?void 0:Sl.userIds,u.value.assignStartUserHandlerType=h.assignStartUserHandlerType,P.value=Ce(h.buttonsSetting)||(h.type===V.TRANSACTOR_NODE?At:Pt),_(h.fieldsPermission),u.value.taskCreateListenerEnable=(gl=h.taskCreateListener)==null?void 0:gl.enable,u.value.taskCreateListenerPath=(ul=h.taskCreateListener)==null?void 0:ul.path,u.value.taskCreateListener={header:((ze=h.taskCreateListener)==null?void 0:ze.header)??[],body:((tl=h.taskCreateListener)==null?void 0:tl.body)??[]},u.value.taskAssignListenerEnable=(Ul=h.taskAssignListener)==null?void 0:Ul.enable,u.value.taskAssignListenerPath=(wl=h.taskAssignListener)==null?void 0:wl.path,u.value.taskAssignListener={header:((al=h.taskAssignListener)==null?void 0:al.header)??[],body:((cl=h.taskAssignListener)==null?void 0:cl.body)??[]},u.value.taskCompleteListenerEnable=(Vl=h.taskCompleteListener)==null?void 0:Vl.enable,u.value.taskCompleteListenerPath=(Cl=h.taskCompleteListener)==null?void 0:Cl.path,u.value.taskCompleteListener={header:((hl=h.taskCompleteListener)==null?void 0:hl.header)??[],body:((y=h.taskCompleteListener)==null?void 0:y.body)??[]},u.value.signEnable=(h==null?void 0:h.signEnable)??!1,u.value.reasonRequire=(h==null?void 0:h.reasonRequire)??!1,u.value.skipExpression=(h==null?void 0:h.skipExpression)??""}});const Ze=h=>{O.value.forEach(b=>{b.permission=h==="READ"?se.READ:h==="WRITE"?se.WRITE:se.NONE})};return(h,b)=>{const Ue=ve,ye=vl,be=il,el=zt,ll=Tl,ue=Xe,Le=Qe,He=We,Sl=ut,gl=fl,ul=Kl,ze=je,tl=kl,Ul=Yl,wl=Ke,al=Ol,cl=Oe,Vl=Il,Cl=Ye,hl=Te("mountedFocus");return l(),c(Cl,{"append-to-body":!0,modelValue:e(x),"onUpdate:modelValue":b[34]||(b[34]=y=>de(x)?x.value=y:null),"show-close":!1,size:580,"before-close":xe,class:"justify-start"},{header:a(()=>[o("div",qa,[e(N)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:b[0]||(b[0]=y=>e(r)()),"onUpdate:modelValue":b[1]||(b[1]=y=>de(H)?H.value=y:null),placeholder:e(H)},null,40,Ma)),[[hl],[Ee,e(H)]]):(l(),i("div",Ga,[A(B(e(H))+" ",1),t(Ue,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:b[2]||(b[2]=y=>e(U)())})])),b[35]||(b[35]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(ze),o("div",null,[t(cl,{type:"primary",onClick:xe},{default:a(()=>b[52]||(b[52]=[A("\u786E \u5B9A")])),_:1}),t(cl,{onClick:e(g)},{default:a(()=>b[53]||(b[53]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[e(d).type===e(V).USER_TASK_NODE?(l(),i("div",za,[b[36]||(b[36]=o("span",{class:"font-size-16px mr-3"},"\u5BA1\u6279\u7C7B\u578B :",-1)),t(be,{modelValue:e(W),"onUpdate:modelValue":b[3]||(b[3]=y=>de(W)?W.value=y:null)},{default:a(()=>[(l(!0),i(G,null,$(e(Ct),(y,re)=>(l(),c(ye,{key:re,value:y.value,label:y.value},{default:a(()=>[A(B(y.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])):T("",!0),e(W)===e(bl).USER?(l(),c(Vl,{key:1,type:"border-card",modelValue:e(s),"onUpdate:modelValue":b[33]||(b[33]=y=>de(s)?s.value=y:null)},{default:a(()=>[t(al,{label:`${e(ne)}\u4EBA`,name:"user"},{default:a(()=>[o("div",null,[t(wl,{ref_key:"formRef",ref:F,model:e(u),"label-position":"top",rules:e(k)},{default:a(()=>[t(ue,{label:`${e(ne)}\u4EBA\u8BBE\u7F6E`,prop:"candidateStrategy"},{default:a(()=>[t(be,{modelValue:e(u).candidateStrategy,"onUpdate:modelValue":b[4]||(b[4]=y=>e(u).candidateStrategy=y),onChange:De},{default:a(()=>[t(ll,null,{default:a(()=>[(l(!0),i(G,null,$(e(et),(y,re)=>(l(),c(el,{key:re,span:8},{default:a(()=>[t(ye,{value:y.value,label:y.value},{default:a(()=>[A(B(y.label),1)]),_:2},1032,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(u).candidateStrategy==e(ie).ROLE?(l(),c(ue,{key:0,label:"\u6307\u5B9A\u89D2\u8272",prop:"roleIds"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).roleIds,"onUpdate:modelValue":b[5]||(b[5]=y=>e(u).roleIds=y),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(Q),y=>(l(),c(Le,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy==e(ie).DEPT_MEMBER||e(u).candidateStrategy==e(ie).DEPT_LEADER||e(u).candidateStrategy==e(ie).MULTI_LEVEL_DEPT_LEADER?(l(),c(ue,{key:1,label:"\u6307\u5B9A\u90E8\u95E8",prop:"deptIds",span:"24"},{default:a(()=>[t(Sl,{ref:"treeRef",modelValue:e(u).deptIds,"onUpdate:modelValue":b[6]||(b[6]=y=>e(u).deptIds=y),data:e(q),props:e(ft),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",multiple:"","node-key":"id","check-strictly":!0,style:{width:"100%"},"show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):T("",!0),e(u).candidateStrategy==e(ie).POST?(l(),c(ue,{key:2,label:"\u6307\u5B9A\u5C97\u4F4D",prop:"postIds",span:"24"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).postIds,"onUpdate:modelValue":b[7]||(b[7]=y=>e(u).postIds=y),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(f),y=>(l(),c(Le,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy==e(ie).USER?(l(),c(ue,{key:3,label:"\u6307\u5B9A\u7528\u6237",prop:"userIds",span:"24"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).userIds,"onUpdate:modelValue":b[8]||(b[8]=y=>e(u).userIds=y),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(w),y=>(l(),c(Le,{key:y.id,label:y.nickname,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy===e(ie).USER_GROUP?(l(),c(ue,{key:4,label:"\u6307\u5B9A\u7528\u6237\u7EC4",prop:"userGroups"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).userGroups,"onUpdate:modelValue":b[9]||(b[9]=y=>e(u).userGroups=y),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(X),y=>(l(),c(Le,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy===e(ie).FORM_USER?(l(),c(ue,{key:5,label:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5",prop:"formUser"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).formUser,"onUpdate:modelValue":b[10]||(b[10]=y=>e(u).formUser=y),clearable:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(z),(y,re)=>(l(),c(Le,{key:re,label:y.title,value:y.field,disabled:!y.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy===e(ie).FORM_DEPT_LEADER?(l(),c(ue,{key:6,label:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5",prop:"formDept"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).formDept,"onUpdate:modelValue":b[11]||(b[11]=y=>e(u).formDept=y),clearable:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(R),(y,re)=>(l(),c(Le,{key:re,label:y.title,value:y.field,disabled:!y.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u).candidateStrategy==e(ie).MULTI_LEVEL_DEPT_LEADER||e(u).candidateStrategy==e(ie).START_USER_DEPT_LEADER||e(u).candidateStrategy==e(ie).START_USER_MULTI_LEVEL_DEPT_LEADER||e(u).candidateStrategy==e(ie).FORM_DEPT_LEADER?(l(),c(ue,{key:7,label:e(n),prop:"deptLevel",span:"24"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).deptLevel,"onUpdate:modelValue":b[12]||(b[12]=y=>e(u).deptLevel=y),clearable:""},{default:a(()=>[(l(!0),i(G,null,$(e(lt),(y,re)=>(l(),c(Le,{key:re,label:y.label,value:y.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):T("",!0),e(u).candidateStrategy===e(ie).EXPRESSION?(l(),c(ue,{key:8,label:"\u6D41\u7A0B\u8868\u8FBE\u5F0F",prop:"expression"},{default:a(()=>[t(gl,{type:"textarea",modelValue:e(u).expression,"onUpdate:modelValue":b[13]||(b[13]=y=>e(u).expression=y),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):T("",!0),t(ue,{label:`\u591A\u4EBA${e(ne)}\u65B9\u5F0F`,prop:"approveMethod"},{default:a(()=>[t(be,{modelValue:e(u).approveMethod,"onUpdate:modelValue":b[15]||(b[15]=y=>e(u).approveMethod=y),onChange:$e},{default:a(()=>[o("div",Ba,[(l(!0),i(G,null,$(e(Rt),(y,re)=>(l(),i("div",{key:re,class:"flex items-center"},[t(ye,{value:y.value,label:y.value},{default:a(()=>[A(B(y.label),1)]),_:2},1032,["value","label"]),t(ue,{prop:"approveRatio"},{default:a(()=>[y.value===e(nl).APPROVE_BY_RATIO&&e(u).approveMethod===e(nl).APPROVE_BY_RATIO?(l(),c(ul,{key:0,modelValue:e(u).approveRatio,"onUpdate:modelValue":b[14]||(b[14]=Be=>e(u).approveRatio=Be),min:10,max:100,step:10,size:"small"},null,8,["modelValue"])):T("",!0)]),_:2},1024)]))),128))])]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(d).type===e(V).USER_TASK_NODE?(l(),i("div",$a,[t(ze,{"content-position":"left"},{default:a(()=>b[37]||(b[37]=[A("\u5BA1\u6279\u4EBA\u62D2\u7EDD\u65F6")])),_:1}),t(ue,{prop:"rejectHandlerType"},{default:a(()=>[t(be,{modelValue:e(u).rejectHandlerType,"onUpdate:modelValue":b[16]||(b[16]=y=>e(u).rejectHandlerType=y)},{default:a(()=>[o("div",ja,[(l(!0),i(G,null,$(e(Dt),(y,re)=>(l(),i("div",{key:re},[(l(),c(ye,{key:y.value,value:y.value,label:y.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1}),e(u).rejectHandlerType==e(zl).RETURN_USER_TASK?(l(),c(ue,{key:0,label:"\u9A73\u56DE\u8282\u70B9",prop:"returnNodeId"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).returnNodeId,"onUpdate:modelValue":b[17]||(b[17]=y=>e(u).returnNodeId=y),clearable:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(fe),y=>(l(),c(Le,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0)])):T("",!0),e(d).type===e(V).USER_TASK_NODE?(l(),i("div",Ka,[t(ze,{"content-position":"left"},{default:a(()=>b[38]||(b[38]=[A("\u5BA1\u6279\u4EBA\u8D85\u65F6\u672A\u5904\u7406\u65F6")])),_:1}),t(ue,{label:"\u542F\u7528\u5F00\u5173",prop:"timeoutHandlerEnable"},{default:a(()=>[t(tl,{modelValue:e(u).timeoutHandlerEnable,"onUpdate:modelValue":b[18]||(b[18]=y=>e(u).timeoutHandlerEnable=y),"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED",onChange:e(Pe)},null,8,["modelValue","onChange"])]),_:1}),e(u).timeoutHandlerEnable?(l(),c(ue,{key:0,label:"\u6267\u884C\u52A8\u4F5C",prop:"timeoutHandlerType"},{default:a(()=>[t(be,{modelValue:e(u).timeoutHandlerType,"onUpdate:modelValue":b[19]||(b[19]=y=>e(u).timeoutHandlerType=y),onChange:e(Je)},{default:a(()=>[(l(!0),i(G,null,$(e(xt),y=>(l(),c(Ul,{key:y.value,value:y.value,label:y.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})):T("",!0),e(u).timeoutHandlerEnable?(l(),c(ue,{key:1,label:"\u8D85\u65F6\u65F6\u95F4\u8BBE\u7F6E"},{default:a(()=>[b[39]||(b[39]=o("span",{class:"mr-2"},"\u5F53\u8D85\u8FC7",-1)),t(ue,{prop:"timeDuration"},{default:a(()=>[t(ul,{class:"mr-2",style:{width:"100px"},modelValue:e(u).timeDuration,"onUpdate:modelValue":b[20]||(b[20]=y=>e(u).timeDuration=y),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(He,{filterable:"",modelValue:e(te),"onUpdate:modelValue":b[21]||(b[21]=y=>de(te)?te.value=y:null),class:"mr-2",style:{width:"100px"},onChange:e(pe)},{default:a(()=>[(l(!0),i(G,null,$(e(xl),y=>(l(),c(Le,{key:y.value,label:y.label,value:y.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),b[40]||(b[40]=A(" \u672A\u5904\u7406 "))]),_:1})):T("",!0),e(u).timeoutHandlerEnable&&e(u).timeoutHandlerType===1?(l(),c(ue,{key:2,label:"\u6700\u5927\u63D0\u9192\u6B21\u6570",prop:"maxRemindCount"},{default:a(()=>[t(ul,{modelValue:e(u).maxRemindCount,"onUpdate:modelValue":b[22]||(b[22]=y=>e(u).maxRemindCount=y),min:1,max:10},null,8,["modelValue"])]),_:1})):T("",!0)])):T("",!0),t(ze,{"content-position":"left"},{default:a(()=>[A(B(e(ne))+"\u4EBA\u4E3A\u7A7A\u65F6",1)]),_:1}),t(ue,{prop:"assignEmptyHandlerType"},{default:a(()=>[t(be,{modelValue:e(u).assignEmptyHandlerType,"onUpdate:modelValue":b[23]||(b[23]=y=>e(u).assignEmptyHandlerType=y)},{default:a(()=>[o("div",Ya,[(l(!0),i(G,null,$(e(It),(y,re)=>(l(),i("div",{key:re},[(l(),c(ye,{key:y.value,value:y.value,label:y.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1}),e(u).assignEmptyHandlerType==e(Gl).ASSIGN_USER?(l(),c(ue,{key:11,label:"\u6307\u5B9A\u7528\u6237",prop:"assignEmptyHandlerUserIds",span:"24"},{default:a(()=>[t(He,{filterable:"",modelValue:e(u).assignEmptyHandlerUserIds,"onUpdate:modelValue":b[24]||(b[24]=y=>e(u).assignEmptyHandlerUserIds=y),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(w),y=>(l(),c(Le,{key:y.id,label:y.nickname,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(d).type===e(V).USER_TASK_NODE?(l(),i("div",Xa,[t(ze,{"content-position":"left"},{default:a(()=>b[41]||(b[41]=[A("\u5BA1\u6279\u4EBA\u4E0E\u63D0\u4EA4\u4EBA\u4E3A\u540C\u4E00\u4EBA\u65F6")])),_:1}),t(ue,{prop:"assignStartUserHandlerType"},{default:a(()=>[t(be,{modelValue:e(u).assignStartUserHandlerType,"onUpdate:modelValue":b[25]||(b[25]=y=>e(u).assignStartUserHandlerType=y)},{default:a(()=>[o("div",Wa,[(l(!0),i(G,null,$(e(Ot),(y,re)=>(l(),i("div",{key:re},[(l(),c(ye,{key:y.value,value:y.value,label:y.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1})])):T("",!0),e(d).type===e(V).USER_TASK_NODE?(l(),i("div",Qa,[t(ze,{"content-position":"left"},{default:a(()=>b[42]||(b[42]=[A("\u662F\u5426\u9700\u8981\u7B7E\u540D")])),_:1}),t(ue,{prop:"signEnable"},{default:a(()=>[t(tl,{modelValue:e(u).signEnable,"onUpdate:modelValue":b[26]||(b[26]=y=>e(u).signEnable=y),"active-text":"\u662F","inactive-text":"\u5426"},null,8,["modelValue"])]),_:1})])):T("",!0),e(d).type===e(V).USER_TASK_NODE?(l(),i("div",Ja,[t(ze,{"content-position":"left"},{default:a(()=>b[43]||(b[43]=[A("\u5BA1\u6279\u610F\u89C1")])),_:1}),t(ue,{prop:"reasonRequire"},{default:a(()=>[t(tl,{modelValue:e(u).reasonRequire,"onUpdate:modelValue":b[27]||(b[27]=y=>e(u).reasonRequire=y),"active-text":"\u5FC5\u586B","inactive-text":"\u975E\u5FC5\u586B"},null,8,["modelValue"])]),_:1})])):T("",!0),o("div",null,[t(ze,{"content-position":"left"},{default:a(()=>b[44]||(b[44]=[A("\u8DF3\u8FC7\u8868\u8FBE\u5F0F")])),_:1}),t(ue,{prop:"skipExpression"},{default:a(()=>[t(gl,{modelValue:e(u).skipExpression,"onUpdate:modelValue":b[28]||(b[28]=y=>e(u).skipExpression=y),type:"textarea"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["label"]),e(d).type===e(V).USER_TASK_NODE?(l(),c(al,{key:0,label:"\u64CD\u4F5C\u6309\u94AE\u8BBE\u7F6E",name:"buttons"},{default:a(()=>[o("div",Za,[b[45]||(b[45]=o("div",{class:"button-setting-desc"},"\u64CD\u4F5C\u6309\u94AE",-1)),b[46]||(b[46]=o("div",{class:"button-setting-title"},[o("div",{class:"button-title-label"},"\u64CD\u4F5C\u6309\u94AE"),o("div",{class:"pl-4 button-title-label"},"\u663E\u793A\u540D\u79F0"),o("div",{class:"button-title-label"},"\u542F\u7528")],-1)),(l(!0),i(G,null,$(e(P),(y,re)=>(l(),i("div",{class:"button-setting-item",key:re},[o("div",eo,B(e(tt).get(y.id)),1),o("div",lo,[e(j)[re]?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:Be=>e(D)(re),"onUpdate:modelValue":Be=>y.displayName=Be,placeholder:y.displayName},null,40,to)),[[hl],[Ee,y.displayName]]):(l(),c(cl,{key:1,text:"",onClick:Be=>e(K)(re)},{default:a(()=>[A(B(y.displayName)+" \xA0",1),t(Ue,{icon:"ep:edit"})]),_:2},1032,["onClick"]))]),o("div",ao,[t(tl,{modelValue:y.enable,"onUpdate:modelValue":Be=>y.enable=Be},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})):T("",!0),e(v)===10?(l(),c(al,{key:1,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:a(()=>[o("div",oo,[b[51]||(b[51]=o("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),o("div",no,[b[47]||(b[47]=o("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 ",-1)),o("div",io,[o("span",{class:"setting-title-label cursor-pointer",onClick:b[29]||(b[29]=y=>Ze("READ"))}," \u53EA\u8BFB "),o("span",{class:"setting-title-label cursor-pointer",onClick:b[30]||(b[30]=y=>Ze("WRITE"))}," \u53EF\u7F16\u8F91 "),o("span",{class:"setting-title-label cursor-pointer",onClick:b[31]||(b[31]=y=>Ze("NONE"))}," \u9690\u85CF ")])]),(l(!0),i(G,null,$(e(O),(y,re)=>(l(),i("div",{class:"field-setting-item",key:re},[o("div",so,B(y.title),1),t(be,{class:"field-setting-item-group",modelValue:y.permission,"onUpdate:modelValue":Be=>y.permission=Be},{default:a(()=>[o("div",ro,[t(ye,{value:e(se).READ,size:"large",label:e(se).READ},{default:a(()=>b[48]||(b[48]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",uo,[t(ye,{value:e(se).WRITE,size:"large",label:e(se).WRITE},{default:a(()=>b[49]||(b[49]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",co,[t(ye,{value:e(se).NONE,size:"large",label:e(se).NONE},{default:a(()=>b[50]||(b[50]=[o("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):T("",!0),t(al,{label:"\u76D1\u542C\u5668",name:"listener"},{default:a(()=>[t(Ha,{ref_key:"userTaskListenerRef",ref:ae,modelValue:e(u),"onUpdate:modelValue":b[32]||(b[32]=y=>de(u)?u.value=y:null),"form-field-options":e(p)},null,8,["modelValue","form-field-options"])]),_:1})]),_:1},8,["modelValue"])):T("",!0)]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-16c454fc"]]),mo={class:"node-wrapper"},vo={class:"node-container"},fo={class:"node-title-container"},yo=["placeholder"],go=["title"],ho={key:1,class:"node-text"},_o={key:0,class:"node-toolbar"},bo={class:"toolbar-icon"},Eo=ce({name:"UserTaskNode",__name:"UserTaskNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode","find:parentNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=me("tasks",M([])),d=Ve(Y),{showInput:x,blurEvent:g,clickTitle:I}=rl(d,V.START_USER_NODE),H=M(),N=()=>{m?n&&n.value&&(v.value=d.value.name,O.value=n.value.filter(p=>(p==null?void 0:p.taskDefinitionKey)===d.value.id),s.value=!0):(H.value.showUserTaskNodeConfig(d.value),H.value.openDrawer())},U=()=>{S("update:flowNode",d.value.childNode)},r=p=>{S("find:parentNode",p,V.USER_TASK_NODE)},s=M(!1),v=M(void 0),O=M([]);return(p,_)=>{var F;const z=ve,R=jl,P=ql,j=$l,K=Tl,D=Bl,W=Te("mountedFocus");return l(),i(G,null,[o("div",mo,[o("div",vo,[o("div",{class:ke(["node-box",[{"node-config-error":!e(d).showText},`${e(Ae)((F=e(d))==null?void 0:F.activityStatus)}`]])},[o("div",fo,[o("div",{class:ke("node-title-icon "+(e(d).type===e(V).TRANSACTOR_NODE?"transactor-task":"user-task"))},[o("span",{class:ke("iconfont "+(e(d).type===e(V).TRANSACTOR_NODE?"icon-transactor":"icon-approve"))},null,2)],2),!e(m)&&e(x)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:_[0]||(_[0]=k=>e(g)()),"onUpdate:modelValue":_[1]||(_[1]=k=>e(d).name=k),placeholder:e(d).name},null,40,yo)),[[W],[Ee,e(d).name]]):(l(),i("div",{key:1,class:"node-title",onClick:_[2]||(_[2]=(...k)=>e(I)&&e(I)(...k))},B(e(d).name),1))]),o("div",{class:"node-content",onClick:N},[e(d).showText?(l(),i("div",{key:0,class:"node-text",title:e(d).showText},B(e(d).showText),9,go)):(l(),i("div",ho,B(e(Ge).get(e(d).type)),1)),e(m)?T("",!0):(l(),c(z,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",_o,[o("div",bo,[t(z,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:U})])]))],2),e(d)?(l(),c(qe,{key:0,"child-node":e(d).childNode,"onUpdate:childNode":_[3]||(_[3]=k=>e(d).childNode=k),"current-node":e(d)},null,8,["child-node","current-node"])):T("",!0)])]),e(d)?(l(),c(po,{key:0,ref_key:"nodeSetting",ref:H,"flow-node":e(d),"onFind:returnTaskNodes":r},null,8,["flow-node"])):T("",!0),t(D,{title:e(v)||"\u5BA1\u6279\u8BB0\u5F55",modelValue:e(s),"onUpdate:modelValue":_[4]||(_[4]=k=>de(s)?s.value=k:null),width:"1000px","append-to-body":""},{default:a(()=>[t(K,null,{default:a(()=>[t(j,{data:e(O),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:a(()=>[t(R,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),t(R,{label:"\u5BA1\u6279\u4EBA","min-width":"100",align:"center"},{default:a(k=>{var E,Q;return[A(B(((E=k.row.assigneeUser)==null?void 0:E.nickname)||((Q=k.row.ownerUser)==null?void 0:Q.nickname)),1)]}),_:1}),t(R,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:a(k=>{var E,Q;return[A(B(((E=k.row.assigneeUser)==null?void 0:E.deptName)||((Q=k.row.ownerUser)==null?void 0:Q.deptName)),1)]}),_:1}),t(R,{formatter:e(yl),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),t(R,{formatter:e(yl),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),t(R,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:a(k=>[t(P,{type:e(Ll).BPM_TASK_STATUS,value:k.row.status},null,8,["type","value"])]),_:1}),t(R,{align:"center",label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason","min-width":"120"}),t(R,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:a(k=>[A(B(e(Wl)(k.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["title","modelValue"])],64)}}}),No={class:"config-header"},To=["placeholder"],ko={key:1,class:"node-name"},So={class:"field-setting-pane"},Uo={class:"field-permit-title"},wo={class:"other-titles"},Vo={class:"field-setting-item-label"},Co={class:"item-radio-wrap"},Ro={class:"item-radio-wrap"},Do={class:"item-radio-wrap"},xo=ce({name:"CopyTaskNodeConfig",__name:"CopyTaskNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const Y=J,S=Se(()=>{let le="\u90E8\u95E8\u8D1F\u8D23\u4EBA\u6765\u6E90";return f.value.candidateStrategy==ie.MULTI_LEVEL_DEPT_LEADER?le+="(\u6307\u5B9A\u90E8\u95E8\u5411\u4E0A)":le+="(\u53D1\u8D77\u4EBA\u90E8\u95E8\u5411\u4E0A)",le}),{settingVisible:m,closeDrawer:n,openDrawer:d}=dl(),x=Ve(Y),{nodeName:g,showInput:I,clickIcon:H,blurEvent:N}=sl(V.COPY_TASK_NODE),U=M("user"),{formType:r,fieldsPermissionConfig:s,formFieldOptions:v,getNodeConfigFormFields:O}=Xl(se.READ),p=Se(()=>v.filter(le=>le.type==="UserSelect")),_=Se(()=>v.filter(le=>le.type==="DeptSelect")),z=M(),R=ol({candidateStrategy:[{required:!0,message:"\u6284\u9001\u4EBA\u8BBE\u7F6E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],roleIds:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],deptIds:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userGroups:[{required:!0,message:"\u7528\u6237\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],postIds:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formUser:[{required:!0,message:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formDept:[{required:!0,message:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],expression:[{required:!0,message:"\u6D41\u7A0B\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),{configForm:P,roleOptions:j,postOptions:K,userOptions:D,userGroupOptions:W,deptTreeOptions:F,getShowText:k,handleCandidateParam:E,parseCandidateParam:Q}=mt(V.COPY_TASK_NODE),f=P,w=Se(()=>et.filter(le=>le.value!==ie.START_USER)),X=()=>{f.value.userIds=[],f.value.deptIds=[],f.value.roleIds=[],f.value.postIds=[],f.value.userGroups=[],f.value.deptLevel=1,f.value.formUser=""},q=async()=>{if(U.value="user",!z||!await z.value.validate())return!1;const le=k();return!!le&&(x.value.name=g.value,x.value.candidateParam=E(),x.value.candidateStrategy=f.value.candidateStrategy,x.value.showText=le,x.value.fieldsPermission=s.value,m.value=!1,!0)},ee=le=>{s.value.forEach(L=>{L.permission=le==="READ"?se.READ:le==="WRITE"?se.WRITE:se.NONE})};return Z({openDrawer:d,showCopyTaskNodeConfig:le=>{g.value=le.name,f.value.candidateStrategy=le.candidateStrategy,Q(le.candidateStrategy,le==null?void 0:le.candidateParam),O(le.fieldsPermission)}}),(le,L)=>{const u=ve,De=vl,$e=il,fe=Xe,Pe=Qe,Fe=We,Je=ut,te=fl,pe=Ke,oe=Ol,C=Il,ae=je,ne=Oe,xe=Ye,Ze=Te("mountedFocus");return l(),c(xe,{"append-to-body":!0,modelValue:e(m),"onUpdate:modelValue":L[17]||(L[17]=h=>de(m)?m.value=h:null),"show-close":!1,size:550,"before-close":q},{header:a(()=>[o("div",No,[e(I)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:L[0]||(L[0]=h=>e(N)()),"onUpdate:modelValue":L[1]||(L[1]=h=>de(g)?g.value=h:null),placeholder:e(g)},null,40,To)),[[Ze],[Ee,e(g)]]):(l(),i("div",ko,[A(B(e(g))+" ",1),t(u,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:L[2]||(L[2]=h=>e(H)())})])),L[18]||(L[18]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(ae),o("div",null,[t(ne,{type:"primary",onClick:q},{default:a(()=>L[24]||(L[24]=[A("\u786E \u5B9A")])),_:1}),t(ne,{onClick:e(n)},{default:a(()=>L[25]||(L[25]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[t(C,{type:"border-card",modelValue:e(U),"onUpdate:modelValue":L[16]||(L[16]=h=>de(U)?U.value=h:null)},{default:a(()=>[t(oe,{label:"\u6284\u9001\u4EBA",name:"user"},{default:a(()=>[o("div",null,[t(pe,{ref_key:"formRef",ref:z,model:e(f),"label-position":"top",rules:e(R)},{default:a(()=>[t(fe,{label:"\u6284\u9001\u4EBA\u8BBE\u7F6E",prop:"candidateStrategy"},{default:a(()=>[t($e,{modelValue:e(f).candidateStrategy,"onUpdate:modelValue":L[3]||(L[3]=h=>e(f).candidateStrategy=h),onChange:X},{default:a(()=>[(l(!0),i(G,null,$(e(w),(h,b)=>(l(),c(De,{key:b,value:h.value,label:h.value},{default:a(()=>[A(B(h.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f).candidateStrategy==e(ie).ROLE?(l(),c(fe,{key:0,label:"\u6307\u5B9A\u89D2\u8272",prop:"roleIds"},{default:a(()=>[t(Fe,{modelValue:e(f).roleIds,"onUpdate:modelValue":L[4]||(L[4]=h=>e(f).roleIds=h),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(j),h=>(l(),c(Pe,{key:h.id,label:h.name,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy==e(ie).DEPT_MEMBER||e(f).candidateStrategy==e(ie).DEPT_LEADER||e(f).candidateStrategy==e(ie).MULTI_LEVEL_DEPT_LEADER?(l(),c(fe,{key:1,label:"\u6307\u5B9A\u90E8\u95E8",prop:"deptIds",span:"24"},{default:a(()=>[t(Je,{ref:"treeRef",modelValue:e(f).deptIds,"onUpdate:modelValue":L[5]||(L[5]=h=>e(f).deptIds=h),data:e(F),props:e(ft),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",multiple:"","node-key":"id",style:{width:"100%"},"show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):T("",!0),e(f).candidateStrategy==e(ie).POST?(l(),c(fe,{key:2,label:"\u6307\u5B9A\u5C97\u4F4D",prop:"postIds",span:"24"},{default:a(()=>[t(Fe,{modelValue:e(f).postIds,"onUpdate:modelValue":L[6]||(L[6]=h=>e(f).postIds=h),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(K),h=>(l(),c(Pe,{key:h.id,label:h.name,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy==e(ie).USER?(l(),c(fe,{key:3,label:"\u6307\u5B9A\u7528\u6237",prop:"userIds",span:"24"},{default:a(()=>[t(Fe,{modelValue:e(f).userIds,"onUpdate:modelValue":L[7]||(L[7]=h=>e(f).userIds=h),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(D),h=>(l(),c(Pe,{key:h.id,label:h.nickname,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy===e(ie).USER_GROUP?(l(),c(fe,{key:4,label:"\u6307\u5B9A\u7528\u6237\u7EC4",prop:"userGroups"},{default:a(()=>[t(Fe,{modelValue:e(f).userGroups,"onUpdate:modelValue":L[8]||(L[8]=h=>e(f).userGroups=h),clearable:"",multiple:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(W),h=>(l(),c(Pe,{key:h.id,label:h.name,value:h.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy===e(ie).FORM_USER?(l(),c(fe,{key:5,label:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5",prop:"formUser"},{default:a(()=>[t(Fe,{modelValue:e(f).formUser,"onUpdate:modelValue":L[9]||(L[9]=h=>e(f).formUser=h),clearable:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(p),(h,b)=>(l(),c(Pe,{key:b,label:h.title,value:h.field,disabled:!h.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy===e(ie).FORM_DEPT_LEADER?(l(),c(fe,{key:6,label:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5",prop:"formDept"},{default:a(()=>[t(Fe,{modelValue:e(f).formDept,"onUpdate:modelValue":L[10]||(L[10]=h=>e(f).formDept=h),clearable:"",style:{width:"100%"}},{default:a(()=>[(l(!0),i(G,null,$(e(_),(h,b)=>(l(),c(Pe,{key:b,label:h.title,value:h.field,disabled:!h.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(f).candidateStrategy==e(ie).MULTI_LEVEL_DEPT_LEADER||e(f).candidateStrategy==e(ie).START_USER_DEPT_LEADER||e(f).candidateStrategy==e(ie).START_USER_MULTI_LEVEL_DEPT_LEADER||e(f).candidateStrategy==e(ie).FORM_DEPT_LEADER?(l(),c(fe,{key:7,label:e(S),prop:"deptLevel",span:"24"},{default:a(()=>[t(Fe,{modelValue:e(f).deptLevel,"onUpdate:modelValue":L[11]||(L[11]=h=>e(f).deptLevel=h),clearable:""},{default:a(()=>[(l(!0),i(G,null,$(e(lt),(h,b)=>(l(),c(Pe,{key:b,label:h.label,value:h.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):T("",!0),e(f).candidateStrategy===e(ie).EXPRESSION?(l(),c(fe,{key:8,label:"\u6D41\u7A0B\u8868\u8FBE\u5F0F",prop:"expression"},{default:a(()=>[t(te,{type:"textarea",modelValue:e(f).expression,"onUpdate:modelValue":L[12]||(L[12]=h=>e(f).expression=h),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):T("",!0)]),_:1},8,["model","rules"])])]),_:1}),e(r)===10?(l(),c(oe,{key:0,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:a(()=>[o("div",So,[L[23]||(L[23]=o("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),o("div",Uo,[L[19]||(L[19]=o("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 ",-1)),o("div",wo,[o("span",{class:"setting-title-label cursor-pointer",onClick:L[13]||(L[13]=h=>ee("READ"))}," \u53EA\u8BFB "),o("span",{class:"setting-title-label cursor-pointer",onClick:L[14]||(L[14]=h=>ee("WRITE"))}," \u53EF\u7F16\u8F91 "),o("span",{class:"setting-title-label cursor-pointer",onClick:L[15]||(L[15]=h=>ee("NONE"))}," \u9690\u85CF ")])]),(l(!0),i(G,null,$(e(s),(h,b)=>(l(),i("div",{class:"field-setting-item",key:b},[o("div",Vo,B(h.title),1),t($e,{class:"field-setting-item-group",modelValue:h.permission,"onUpdate:modelValue":Ue=>h.permission=Ue},{default:a(()=>[o("div",Co,[t(De,{value:e(se).READ,size:"large",label:e(se).WRITE},{default:a(()=>L[20]||(L[20]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",Ro,[t(De,{value:e(se).WRITE,size:"large",label:e(se).WRITE,disabled:""},{default:a(()=>L[21]||(L[21]=[o("span",null,null,-1)])),_:1},8,["value","label"])]),o("div",Do,[t(De,{value:e(se).NONE,size:"large",label:e(se).NONE},{default:a(()=>L[22]||(L[22]=[o("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):T("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Io={class:"node-wrapper"},Oo={class:"node-container"},Ao={class:"node-title-container"},Po=["placeholder"],Fo=["title"],Lo={key:1,class:"node-text"},Ho={key:0,class:"node-toolbar"},qo={class:"toolbar-icon"},Mo=ce({name:"CopyTaskNode",__name:"CopyTaskNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.COPY_TASK_NODE),I=M(),H=()=>{m||(I.value.showCopyTaskNodeConfig(n.value),I.value.openDrawer())},N=()=>{S("update:flowNode",n.value.childNode)};return(U,r)=>{var O;const s=ve,v=Te("mountedFocus");return l(),i("div",Io,[o("div",Oo,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((O=e(n))==null?void 0:O.activityStatus)}`]])},[o("div",Ao,[r[4]||(r[4]=o("div",{class:"node-title-icon copy-task"},[o("span",{class:"iconfont icon-copy"})],-1)),!e(m)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:r[0]||(r[0]=p=>e(x)()),"onUpdate:modelValue":r[1]||(r[1]=p=>e(n).name=p),placeholder:e(n).name},null,40,Po)),[[v],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:r[2]||(r[2]=(...p)=>e(g)&&e(g)(...p))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,Fo)):(l(),i("div",Lo,B(e(Ge).get(e(V).COPY_TASK_NODE)),1)),e(m)?T("",!0):(l(),c(s,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",Ho,[o("div",qo,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":r[3]||(r[3]=p=>e(n).childNode=p),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)]),!e(m)&&e(n)?(l(),c(xo,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0)])}}}),Go={class:"condition-group-tool"},zo={class:"flex items-center"},Bo={key:0,class:"condition-group-delete"},$o={class:"flex items-center justify-between"},jo={class:"flex"},Ko={class:"mr-2"},Yo={class:"mr-2"},Xo={class:"mr-2"},Wo={key:0,class:"mr-1 flex items-center"},Qo={class:"flex items-center"},Jo={title:"\u6DFB\u52A0\u6761\u4EF6\u7EC4",class:"mt-4 cursor-pointer"},ht=_l(ce({__name:"Condition",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(J,{expose:Z,emit:Y}){const S=J,m=Y,n=Se({get:()=>S.modelValue,set(U){m("update:modelValue",U)}}),d=me("formType"),x=Se(()=>at.filter(U=>(d==null?void 0:d.value)!==Jl.CUSTOM||U.value!==_e.RULE)),g=Pl(),I=ol({conditionType:[{required:!0,message:"\u914D\u7F6E\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionExpression:[{required:!0,message:"\u6761\u4EF6\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),H=M(),N=()=>{n.value.conditionType===_e.RULE&&(n.value.conditionGroups||(n.value.conditionGroups=Ce(Me)))};return Z({validate:async()=>!!H&&await H.value.validate()}),(U,r)=>{const s=vl,v=il,O=Xe,p=kl,_=ve,z=rt,R=Qe,P=We,j=fl,K=Al,D=ct,W=Ke;return l(),c(W,{ref_key:"formRef",ref:H,model:e(n),rules:e(I),"label-position":"top"},{default:a(()=>[t(O,{label:"\u914D\u7F6E\u65B9\u5F0F",prop:"conditionType"},{default:a(()=>[t(v,{modelValue:e(n).conditionType,"onUpdate:modelValue":r[0]||(r[0]=F=>e(n).conditionType=F),onChange:N},{default:a(()=>[(l(!0),i(G,null,$(e(x),(F,k)=>(l(),c(s,{key:k,value:F.value,label:F.value},{default:a(()=>[A(B(F.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n).conditionType===e(_e).RULE&&e(n).conditionGroups?(l(),c(O,{key:0,label:"\u6761\u4EF6\u89C4\u5219"},{default:a(()=>[o("div",Go,[o("div",zo,[r[4]||(r[4]=o("div",{class:"mr-4"},"\u6761\u4EF6\u7EC4\u5173\u7CFB",-1)),t(p,{modelValue:e(n).conditionGroups.and,"onUpdate:modelValue":r[1]||(r[1]=F=>e(n).conditionGroups.and=F),"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue"])])]),t(D,{direction:"vertical",spacer:e(n).conditionGroups.and?"\u4E14":"\u6216"},{default:a(()=>[(l(!0),i(G,null,$(e(n).conditionGroups.conditions,(F,k)=>(l(),c(K,{class:"condition-group",style:{width:"530px"},key:k},{header:a(()=>[o("div",$o,[r[6]||(r[6]=o("div",null,"\u6761\u4EF6\u7EC4",-1)),o("div",jo,[r[5]||(r[5]=o("div",{class:"mr-4"},"\u89C4\u5219\u5173\u7CFB",-1)),t(p,{modelValue:F.and,"onUpdate:modelValue":E=>F.and=E,"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue","onUpdate:modelValue"])])])]),default:a(()=>[e(n).conditionGroups.conditions.length>1?(l(),i("div",Bo,[t(_,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:E=>{return Q=e(n).conditionGroups.conditions,f=k,void Q.splice(f,1);var Q,f}},null,8,["onClick"])])):T("",!0),(l(!0),i(G,null,$(F.rules,(E,Q)=>(l(),i("div",{class:"flex pt-2",key:Q},[o("div",Ko,[t(O,{prop:`conditionGroups.conditions.${k}.rules.${Q}.leftSide`,rules:{required:!0,message:"\u5DE6\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}},{default:a(()=>[t(P,{style:{width:"160px"},modelValue:E.leftSide,"onUpdate:modelValue":f=>E.leftSide=f,clearable:""},{default:a(()=>[(l(!0),i(G,null,$(e(g),(f,w)=>(l(),c(R,{key:w,label:f.title,value:f.field,disabled:!f.required},{default:a(()=>[f.required?T("",!0):(l(),c(z,{key:0,content:"\u8868\u5355\u5B57\u6BB5\u975E\u5FC5\u586B\u65F6\u4E0D\u80FD\u4F5C\u4E3A\u6D41\u7A0B\u5206\u652F\u6761\u4EF6",effect:"dark",placement:"right-start"},{default:a(()=>[o("span",null,B(f.title),1)]),_:2},1024))]),_:2},1032,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",Yo,[t(P,{modelValue:E.opCode,"onUpdate:modelValue":f=>E.opCode=f,style:{width:"100px"}},{default:a(()=>[(l(!0),i(G,null,$(e(ot),f=>(l(),c(R,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),o("div",Xo,[t(O,{prop:`conditionGroups.conditions.${k}.rules.${Q}.rightSide`,rules:{required:!0,message:"\u53F3\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(j,{modelValue:E.rightSide,"onUpdate:modelValue":f=>E.rightSide=f,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),F.rules.length>1?(l(),i("div",Wo,[t(_,{icon:"ep:delete",size:18,onClick:f=>{return w=Q,void F.rules.splice(w,1);var w}},null,8,["onClick"])])):T("",!0),o("div",Qo,[t(_,{icon:"ep:plus",size:18,onClick:f=>{return w=Q,void F.rules.splice(w+1,0,{opCode:"==",leftSide:"",rightSide:""});var w}},null,8,["onClick"])])]))),128))]),_:2},1024))),128))]),_:1},8,["spacer"]),o("div",Jo,[t(_,{color:"#0089ff",icon:"ep:plus",size:24,onClick:r[2]||(r[2]=F=>{var E;return k=(E=e(n).conditionGroups)==null?void 0:E.conditions,void k.push({and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]});var k})})])]),_:1})):T("",!0),e(n).conditionType===e(_e).EXPRESSION?(l(),c(O,{key:1,label:"\u6761\u4EF6\u8868\u8FBE\u5F0F",prop:"conditionExpression"},{default:a(()=>[t(j,{type:"textarea",modelValue:e(n).conditionExpression,"onUpdate:modelValue":r[3]||(r[3]=F=>e(n).conditionExpression=F),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):T("",!0)]),_:1},8,["model","rules"])}}}),[["__scopeId","data-v-c3cf85f4"]]),Zo={class:"config-header"},en=["placeholder"],ln={key:1,class:"node-name"},tn={key:0,class:"mb-3 font-size-16px"},an={key:1},_t=_l(ce({name:"ConditionNodeConfig",__name:"ConditionNodeConfig",props:{conditionNode:{type:Object,required:!0},nodeIndex:{type:Number,required:!0}},setup(J,{expose:Z}){const Y=J,S=M(!1),m=M(Y.conditionNode),n=M({conditionType:_e.RULE,conditionExpression:"",conditionGroups:{and:!0,conditions:[{and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]}]}});pl(()=>Y.conditionNode,U=>{m.value=U});const d=M(!1);Z({open:()=>{m.value.conditionSetting?n.value=Ce(m.value.conditionSetting):n.value={conditionType:_e.RULE,conditionExpression:"",conditionGroups:{and:!0,conditions:[{and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]}]}},S.value=!0}});const x=()=>{S.value=!1},g=async U=>{await N()?U():U(!0)},I=Pl(),H=M(),N=async()=>{var U,r,s,v,O,p,_,z;if(!((U=m.value.conditionSetting)!=null&&U.defaultFlow)){if(!await H.value.validate())return!1;const R=vt((r=n.value)==null?void 0:r.conditionType,(s=n.value)==null?void 0:s.conditionExpression,n.value.conditionGroups,I);if(!R)return!1;m.value.showText=R,m.value.conditionSetting=Ce({...m.value.conditionSetting,conditionType:(v=n.value)==null?void 0:v.conditionType,conditionExpression:((O=n.value)==null?void 0:O.conditionType)===_e.EXPRESSION?(p=n.value)==null?void 0:p.conditionExpression:void 0,conditionGroups:((_=n.value)==null?void 0:_.conditionType)===_e.RULE?(z=n.value)==null?void 0:z.conditionGroups:void 0})}return S.value=!1,!0};return(U,r)=>{const s=ve,v=je,O=Oe,p=Ye,_=Te("mountedFocus");return l(),c(p,{"append-to-body":!0,modelValue:e(S),"onUpdate:modelValue":r[4]||(r[4]=z=>de(S)?S.value=z:null),"show-close":!1,size:588,"before-close":g},{header:a(()=>[o("div",Zo,[e(d)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:r[0]||(r[0]=z=>{var R,P;return d.value=!1,void(m.value.name=m.value.name||yt(Y.nodeIndex,(P=(R=m.value)==null?void 0:R.conditionSetting)==null?void 0:P.defaultFlow))}),"onUpdate:modelValue":r[1]||(r[1]=z=>e(m).name=z),placeholder:e(m).name},null,40,en)),[[_],[Ee,e(m).name]]):(l(),i("div",ln,[A(B(e(m).name)+" ",1),t(s,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:r[2]||(r[2]=z=>{d.value=!0})})])),r[5]||(r[5]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(v),o("div",null,[t(O,{type:"primary",onClick:N},{default:a(()=>r[6]||(r[6]=[A("\u786E \u5B9A")])),_:1}),t(O,{onClick:x},{default:a(()=>r[7]||(r[7]=[A("\u53D6 \u6D88")])),_:1})])]),default:a(()=>{var z;return[o("div",null,[(z=e(m).conditionSetting)!=null&&z.defaultFlow?(l(),i("div",tn,"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F\uFF08\u8BE5\u5206\u652F\u4E0D\u53EF\u7F16\u8F91\u548C\u5220\u9664\uFF09")):(l(),i("div",an,[t(ht,{ref_key:"conditionRef",ref:H,modelValue:e(n),"onUpdate:modelValue":r[3]||(r[3]=R=>de(n)?n.value=R:null)},null,8,["modelValue"])]))])]}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-e2c69d3e"]]),on={class:"branch-node-wrapper"},nn={class:"branch-node-container"},dn={class:"node-wrapper"},sn={class:"node-container"},rn={class:"branch-node-title-container"},un={key:0},cn=["onBlur","onUpdate:modelValue"],pn=["onClick"],mn={class:"branch-priority"},vn=["onClick"],fn=["title"],yn={key:1,class:"branch-node-text"},gn={key:0,class:"node-toolbar"},hn={class:"toolbar-icon"},_n=["onClick"],bn=["onClick"],En=ce({name:"ExclusiveNode",__name:"ExclusiveNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(J,{emit:Z}){const{proxy:Y}=Dl(),S=J,m=Z,n=me("readonly"),d=M(S.flowNode);pl(()=>S.flowNode,N=>{d.value=N});const x=M([]),g=()=>{const N=d.value.conditionNodes;if(N){const U=N.length;let r=U-1;const s={id:"Flow_"+Ne(),name:"\u6761\u4EF6"+U,showText:"",type:V.CONDITION_NODE,childNode:void 0,conditionNodes:[],conditionSetting:{defaultFlow:!1,conditionType:_e.RULE,conditionGroups:Ce(Me)}};N.splice(r,0,s)}},I=(N,U)=>{d.value.conditionNodes&&(d.value.conditionNodes[N]=d.value.conditionNodes.splice(N+U,1,d.value.conditionNodes[N])[0])},H=(N,U,r)=>{U&&U.type!==V.START_USER_NODE&&(U.type===r&&N.push(U),m("find:parentNode",N,r))};return(N,U)=>{var O;const r=Oe,s=ve,v=Te("mountedFocus");return l(),i("div",on,[o("div",nn,[e(n)?(l(),i("div",{key:0,class:ke(["branch-node-readonly",`${e(Ae)((O=e(d))==null?void 0:O.activityStatus)}`])},U[1]||(U[1]=[o("span",{class:"iconfont icon-exclusive icon-size condition"},null,-1)]),2)):(l(),c(r,{key:1,class:"branch-node-add",color:"#67c23a",onClick:g,plain:""},{default:a(()=>U[2]||(U[2]=[A("\u6DFB\u52A0\u6761\u4EF6")])),_:1})),(l(!0),i(G,null,$(e(d).conditionNodes,(p,_)=>{var z,R,P;return l(),i("div",{class:"branch-node-item",key:_},[_==0?(l(),i(G,{key:0},[U[3]||(U[3]=o("div",{class:"branch-line-first-top"},null,-1)),U[4]||(U[4]=o("div",{class:"branch-line-first-bottom"},null,-1))],64)):T("",!0),_+1==((z=e(d).conditionNodes)==null?void 0:z.length)?(l(),i(G,{key:1},[U[5]||(U[5]=o("div",{class:"branch-line-last-top"},null,-1)),U[6]||(U[6]=o("div",{class:"branch-line-last-bottom"},null,-1))],64)):T("",!0),o("div",dn,[o("div",sn,[o("div",{class:ke(["node-box",[{"node-config-error":!p.showText},`${e(Ae)(p.activityStatus)}`]])},[o("div",rn,[!e(n)&&e(x)[_]?(l(),i("div",un,[he(o("input",{type:"text",class:"input-max-width editable-title-input",onBlur:j=>(K=>{var W,F;x.value[K]=!1;const D=(W=d.value.conditionNodes)==null?void 0:W.at(K);D.name=D.name||yt(K,(F=D.conditionSetting)==null?void 0:F.defaultFlow)})(_),"onUpdate:modelValue":j=>p.name=j},null,40,cn),[[v],[Ee,p.name]])])):(l(),i("div",{key:1,class:"branch-title",onClick:j=>(K=>{x.value[K]=!0})(_)},B(p.name),9,pn)),o("div",mn," \u4F18\u5148\u7EA7"+B(_+1),1)]),o("div",{class:"branch-node-content",onClick:j=>(K=>{n||Y.$refs[K][0].open()})(p.id)},[p.showText?(l(),i("div",{key:0,class:"branch-node-text",title:p.showText},B(p.showText),9,fn)):(l(),i("div",yn,B(e(Ge).get(e(V).CONDITION_NODE)),1))],8,vn),e(n)||_+1===((R=e(d).conditionNodes)==null?void 0:R.length)?T("",!0):(l(),i("div",gn,[o("div",hn,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:j=>(K=>{const D=d.value.conditionNodes;if(D&&(D.splice(K,1),D.length==1)){const W=d.value.childNode;m("update:modelValue",W)}})(_)},null,8,["onClick"])])])),_!=0&&_+1!==((P=e(d).conditionNodes)==null?void 0:P.length)?(l(),i("div",{key:1,class:"branch-node-move move-node-left",onClick:j=>I(_,-1)},[t(s,{icon:"ep:arrow-left"})],8,_n)):T("",!0),e(d).conditionNodes&&_<e(d).conditionNodes.length-2?(l(),i("div",{key:2,class:"branch-node-move move-node-right",onClick:j=>I(_,1)},[t(s,{icon:"ep:arrow-right"})],8,bn)):T("",!0)],2),t(qe,{"child-node":p.childNode,"onUpdate:childNode":j=>p.childNode=j,"current-node":p},null,8,["child-node","onUpdate:childNode","current-node"])])]),t(_t,{"node-index":_,"condition-node":p,ref_for:!0,ref:p.id},null,8,["node-index","condition-node"]),p&&p.childNode?(l(),c(Fl,{key:2,"parent-node":p,"flow-node":p.childNode,"onUpdate:flowNode":j=>p.childNode=j,"onFind:recursiveFindParentNode":H},null,8,["parent-node","flow-node","onUpdate:flowNode"])):T("",!0)])}),128))]),e(d)?(l(),c(qe,{key:0,"child-node":e(d).childNode,"onUpdate:childNode":U[0]||(U[0]=p=>e(d).childNode=p),"current-node":e(d)},null,8,["child-node","current-node"])):T("",!0)])}}}),Nn={class:"branch-node-wrapper"},Tn={class:"branch-node-container"},kn={class:"node-wrapper"},Sn={class:"node-container"},Un={class:"branch-node-title-container"},wn={key:0},Vn=["onBlur","onUpdate:modelValue"],Cn=["onClick"],Rn=["onClick"],Dn=["title"],xn={key:1,class:"branch-node-text"},In={key:0,class:"node-toolbar"},On={class:"toolbar-icon"},An=ce({name:"ParallelNode",__name:"ParallelNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(J,{emit:Z}){const{proxy:Y}=Dl(),S=J,m=Z,n=M(S.flowNode),d=me("readonly");pl(()=>S.flowNode,H=>{n.value=H});const x=M([]),g=()=>{const H=n.value.conditionNodes;if(H){const N=H.length;let U=N-1;const r={id:"Flow_"+Ne(),name:"\u5E76\u884C"+N,showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:V.CONDITION_NODE,childNode:void 0,conditionNodes:[]};H.splice(U,0,r)}},I=(H,N,U)=>{N&&N.type!==V.START_USER_NODE&&(N.type===U&&H.push(N),m("find:parentNode",H,U))};return(H,N)=>{var v;const U=Oe,r=ve,s=Te("mountedFocus");return l(),i("div",Nn,[o("div",Tn,[e(d)?(l(),i("div",{key:0,class:ke(["branch-node-readonly",`${e(Ae)((v=e(n))==null?void 0:v.activityStatus)}`])},N[1]||(N[1]=[o("span",{class:"iconfont icon-parallel icon-size parallel"},null,-1)]),2)):(l(),c(U,{key:1,class:"branch-node-add",color:"#626aef",onClick:g,plain:""},{default:a(()=>N[2]||(N[2]=[A("\u6DFB\u52A0\u5206\u652F")])),_:1})),(l(!0),i(G,null,$(e(n).conditionNodes,(O,p)=>{var _;return l(),i("div",{class:"branch-node-item",key:p},[p==0?(l(),i(G,{key:0},[N[3]||(N[3]=o("div",{class:"branch-line-first-top"},null,-1)),N[4]||(N[4]=o("div",{class:"branch-line-first-bottom"},null,-1))],64)):T("",!0),p+1==((_=e(n).conditionNodes)==null?void 0:_.length)?(l(),i(G,{key:1},[N[5]||(N[5]=o("div",{class:"branch-line-last-top"},null,-1)),N[6]||(N[6]=o("div",{class:"branch-line-last-bottom"},null,-1))],64)):T("",!0),o("div",kn,[o("div",Sn,[o("div",{class:ke(["node-box",`${e(Ae)(O.activityStatus)}`])},[o("div",Un,[e(x)[p]?(l(),i("div",wn,[he(o("input",{type:"text",class:"input-max-width editable-title-input",onBlur:z=>(R=>{var j;x.value[R]=!1;const P=(j=n.value.conditionNodes)==null?void 0:j.at(R);P.name=P.name||`\u5E76\u884C${R+1}`})(p),"onUpdate:modelValue":z=>O.name=z},null,40,Vn),[[s],[Ee,O.name]])])):(l(),i("div",{key:1,class:"branch-title",onClick:z=>(R=>{x.value[R]=!0})(p)},B(O.name),9,Cn)),N[7]||(N[7]=o("div",{class:"branch-priority"},"\u65E0\u4F18\u5148\u7EA7",-1))]),o("div",{class:"branch-node-content",onClick:z=>{return R=O.id,void Y.$refs[R][0].open();var R}},[O.showText?(l(),i("div",{key:0,class:"branch-node-text",title:O.showText},B(O.showText),9,Dn)):(l(),i("div",xn,B(e(Ge).get(e(V).CONDITION_NODE)),1))],8,Rn),e(d)?T("",!0):(l(),i("div",In,[o("div",On,[t(r,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:z=>(R=>{const P=n.value.conditionNodes;if(P&&(P.splice(R,1),P.length==1)){const j=n.value.childNode;m("update:modelValue",j)}})(p)},null,8,["onClick"])])]))],2),t(qe,{"child-node":O.childNode,"onUpdate:childNode":z=>O.childNode=z,"current-node":O},null,8,["child-node","onUpdate:childNode","current-node"])])]),O&&O.childNode?(l(),c(Fl,{key:2,"parent-node":O,"flow-node":O.childNode,"onUpdate:flowNode":z=>O.childNode=z,"onFind:recursiveFindParentNode":I},null,8,["parent-node","flow-node","onUpdate:flowNode"])):T("",!0)])}),128))]),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":N[0]||(N[0]=O=>e(n).childNode=O),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)])}}}),Pn={class:"branch-node-wrapper"},Fn={class:"branch-node-container"},Ln={class:"node-wrapper"},Hn={class:"node-container"},qn={class:"branch-node-title-container"},Mn={key:0},Gn=["onBlur","onUpdate:modelValue"],zn=["onClick"],Bn=["onClick"],$n=["title"],jn={key:1,class:"branch-node-text"},Kn={key:0,class:"node-toolbar"},Yn={class:"toolbar-icon"},Xn=["onClick"],Wn=["onClick"],Qn=ce({name:"InclusiveNode",__name:"InclusiveNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(J,{emit:Z}){const{proxy:Y}=Dl(),S=J,m=Z,n=me("readonly"),d=M(S.flowNode);pl(()=>S.flowNode,N=>{d.value=N});const x=M([]),g=()=>{const N=d.value.conditionNodes;if(N){const U=N.length;let r=U-1;const s={id:"Flow_"+Ne(),name:"\u5305\u5BB9\u6761\u4EF6"+U,showText:"",type:V.CONDITION_NODE,childNode:void 0,conditionNodes:[],conditionSetting:{defaultFlow:!1,conditionType:_e.RULE,conditionGroups:Ce(Me)}};N.splice(r,0,s)}},I=(N,U)=>{d.value.conditionNodes&&(d.value.conditionNodes[N]=d.value.conditionNodes.splice(N+U,1,d.value.conditionNodes[N])[0])},H=(N,U,r)=>{U&&U.type!==V.START_USER_NODE&&(U.type===r&&N.push(U),m("find:parentNode",N,r))};return(N,U)=>{var O;const r=Oe,s=ve,v=Te("mountedFocus");return l(),i("div",Pn,[o("div",Fn,[e(n)?(l(),i("div",{key:0,class:ke(["branch-node-readonly",`${e(Ae)((O=e(d))==null?void 0:O.activityStatus)}`])},U[1]||(U[1]=[o("span",{class:"iconfont icon-inclusive icon-size inclusive"},null,-1)]),2)):(l(),c(r,{key:1,class:"branch-node-add",color:"#345da2",onClick:g,plain:""},{default:a(()=>U[2]||(U[2]=[A("\u6DFB\u52A0\u6761\u4EF6")])),_:1})),(l(!0),i(G,null,$(e(d).conditionNodes,(p,_)=>{var z,R,P;return l(),i("div",{class:"branch-node-item",key:_},[_==0?(l(),i(G,{key:0},[U[3]||(U[3]=o("div",{class:"branch-line-first-top"},null,-1)),U[4]||(U[4]=o("div",{class:"branch-line-first-bottom"},null,-1))],64)):T("",!0),_+1==((z=e(d).conditionNodes)==null?void 0:z.length)?(l(),i(G,{key:1},[U[5]||(U[5]=o("div",{class:"branch-line-last-top"},null,-1)),U[6]||(U[6]=o("div",{class:"branch-line-last-bottom"},null,-1))],64)):T("",!0),o("div",Ln,[o("div",Hn,[o("div",{class:ke(["node-box",[{"node-config-error":!p.showText},`${e(Ae)(p.activityStatus)}`]])},[o("div",qn,[!e(n)&&e(x)[_]?(l(),i("div",Mn,[he(o("input",{type:"text",class:"editable-title-input",onBlur:j=>(K=>{var W,F;x.value[K]=!1;const D=(W=d.value.conditionNodes)==null?void 0:W.at(K);D.name=D.name||la(K,(F=D.conditionSetting)==null?void 0:F.defaultFlow)})(_),"onUpdate:modelValue":j=>p.name=j},null,40,Gn),[[v],[Ee,p.name]])])):(l(),i("div",{key:1,class:"branch-title",onClick:j=>(K=>{x.value[K]=!0})(_)},B(p.name),9,zn))]),o("div",{class:"branch-node-content",onClick:j=>(K=>{n||Y.$refs[K][0].open()})(p.id)},[p.showText?(l(),i("div",{key:0,class:"branch-node-text",title:p.showText},B(p.showText),9,$n)):(l(),i("div",jn,B(e(Ge).get(e(V).CONDITION_NODE)),1))],8,Bn),e(n)||_+1===((R=e(d).conditionNodes)==null?void 0:R.length)?T("",!0):(l(),i("div",Kn,[o("div",Yn,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:j=>(K=>{const D=d.value.conditionNodes;if(D&&(D.splice(K,1),D.length==1)){const W=d.value.childNode;m("update:modelValue",W)}})(_)},null,8,["onClick"])])])),e(n)||_==0||_+1===((P=e(d).conditionNodes)==null?void 0:P.length)?T("",!0):(l(),i("div",{key:1,class:"branch-node-move move-node-left",onClick:j=>I(_,-1)},[t(s,{icon:"ep:arrow-left"})],8,Xn)),!e(n)&&e(d).conditionNodes&&_<e(d).conditionNodes.length-2?(l(),i("div",{key:2,class:"branch-node-move move-node-right",onClick:j=>I(_,1)},[t(s,{icon:"ep:arrow-right"})],8,Wn)):T("",!0)],2),t(qe,{"child-node":p.childNode,"onUpdate:childNode":j=>p.childNode=j,"current-node":p},null,8,["child-node","onUpdate:childNode","current-node"])])]),t(_t,{"node-index":_,"condition-node":p,ref_for:!0,ref:p.id},null,8,["node-index","condition-node"]),p&&p.childNode?(l(),c(Fl,{key:2,"parent-node":p,"flow-node":p.childNode,"onUpdate:flowNode":j=>p.childNode=j,"onFind:recursiveFindParentNode":H},null,8,["parent-node","flow-node","onUpdate:flowNode"])):T("",!0)])}),128))]),e(d)?(l(),c(qe,{key:0,"child-node":e(d).childNode,"onUpdate:childNode":U[0]||(U[0]=p=>e(d).childNode=p),"current-node":e(d)},null,8,["child-node","current-node"])):T("",!0)])}}}),Jn={class:"config-header"},Zn=["placeholder"],ei={key:1,class:"node-name"},li=ce({name:"DelayTimerNodeConfig",__name:"DelayTimerNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const Y=J,{settingVisible:S,closeDrawer:m,openDrawer:n}=dl(),d=Ve(Y),{nodeName:x,showInput:g,clickIcon:I,blurEvent:H}=sl(V.DELAY_TIMER_NODE),N=M(),U=ol({delayType:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeDuration:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],dateTime:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),r=M({delayType:we.FIXED_TIME_DURATION,timeDuration:1,timeUnit:Re.HOUR,dateTime:""}),s=async()=>{if(!N||!await N.value.validate())return!1;const p=v();return!!p&&(d.value.name=x.value,d.value.showText=p,r.value.delayType===we.FIXED_TIME_DURATION&&(d.value.delaySetting={delayType:r.value.delayType,delayTime:O()}),r.value.delayType===we.FIXED_DATE_TIME&&(d.value.delaySetting={delayType:r.value.delayType,delayTime:r.value.dateTime}),S.value=!1,!0)},v=()=>{let p="";return r.value.delayType===we.FIXED_TIME_DURATION&&(p=`\u5EF6\u8FDF${r.value.timeDuration}${xl.find(_=>_.value===r.value.timeUnit).label}`),r.value.delayType===we.FIXED_DATE_TIME&&(p=`\u5EF6\u8FDF\u81F3${r.value.dateTime.replace("T"," ")}`),p},O=()=>{let p="PT";return r.value.timeUnit===Re.MINUTE&&(p+=r.value.timeDuration+"M"),r.value.timeUnit===Re.HOUR&&(p+=r.value.timeDuration+"H"),r.value.timeUnit===Re.DAY&&(p+=r.value.timeDuration+"D"),p};return Z({openDrawer:n,showDelayTimerNodeConfig:p=>{if(x.value=p.name,p.delaySetting){if(r.value.delayType=p.delaySetting.delayType,r.value.delayType===we.FIXED_TIME_DURATION){const _=p.delaySetting.delayTime;let z=_.slice(2,_.length-1),R=_.slice(_.length-1);r.value.timeDuration=parseInt(z),r.value.timeUnit=Ql(R)}r.value.delayType===we.FIXED_DATE_TIME&&(r.value.dateTime=p.delaySetting.delayTime)}}}),(p,_)=>{const z=ve,R=Yl,P=il,j=Xe,K=Kl,D=Qe,W=We,F=Nl,k=pt,E=Ke,Q=je,f=Oe,w=Ye,X=Te("mountedFocus");return l(),c(w,{"append-to-body":!0,modelValue:e(S),"onUpdate:modelValue":_[7]||(_[7]=q=>de(S)?S.value=q:null),"show-close":!1,size:550,"before-close":s},{header:a(()=>[o("div",Jn,[e(g)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:_[0]||(_[0]=q=>e(H)()),"onUpdate:modelValue":_[1]||(_[1]=q=>de(x)?x.value=q:null),placeholder:e(x)},null,40,Zn)),[[X],[Ee,e(x)]]):(l(),i("div",ei,[A(B(e(x))+" ",1),t(z,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:_[2]||(_[2]=q=>e(I)())})])),_[8]||(_[8]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(Q),o("div",null,[t(f,{type:"primary",onClick:s},{default:a(()=>_[11]||(_[11]=[A("\u786E \u5B9A")])),_:1}),t(f,{onClick:e(m)},{default:a(()=>_[12]||(_[12]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[o("div",null,[t(E,{ref_key:"formRef",ref:N,model:e(r),"label-position":"top",rules:e(U)},{default:a(()=>[t(j,{label:"\u5EF6\u8FDF\u65F6\u95F4",prop:"delayType"},{default:a(()=>[t(P,{modelValue:e(r).delayType,"onUpdate:modelValue":_[3]||(_[3]=q=>e(r).delayType=q)},{default:a(()=>[(l(!0),i(G,null,$(e(nt),q=>(l(),c(R,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r).delayType===e(we).FIXED_TIME_DURATION?(l(),c(j,{key:0},{default:a(()=>[t(j,{prop:"timeDuration"},{default:a(()=>[t(K,{class:"mr-2",style:{width:"100px"},modelValue:e(r).timeDuration,"onUpdate:modelValue":_[4]||(_[4]=q=>e(r).timeDuration=q),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(W,{modelValue:e(r).timeUnit,"onUpdate:modelValue":_[5]||(_[5]=q=>e(r).timeUnit=q),class:"mr-2",style:{width:"100px"}},{default:a(()=>[(l(!0),i(G,null,$(e(xl),q=>(l(),c(D,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(F,null,{default:a(()=>_[9]||(_[9]=[A("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):T("",!0),e(r).delayType===e(we).FIXED_DATE_TIME?(l(),c(j,{key:1,prop:"dateTime"},{default:a(()=>[t(k,{class:"mr-2",modelValue:e(r).dateTime,"onUpdate:modelValue":_[6]||(_[6]=q=>e(r).dateTime=q),type:"datetime",placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F\u548C\u65F6\u95F4","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"]),t(F,null,{default:a(()=>_[10]||(_[10]=[A("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):T("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}}),ti={class:"node-wrapper"},ai={class:"node-container"},oi={class:"node-title-container"},ni=["placeholder"],ii=["title"],di={key:1,class:"node-text"},si={key:0,class:"node-toolbar"},ri={class:"toolbar-icon"},ui=ce({name:"DelayTimerNode",__name:"DelayTimerNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.DELAY_TIMER_NODE),I=M(),H=()=>{m||(I.value.showDelayTimerNodeConfig(n.value),I.value.openDrawer())},N=()=>{S("update:flowNode",n.value.childNode)};return(U,r)=>{var O;const s=ve,v=Te("mountedFocus");return l(),i("div",ti,[o("div",ai,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((O=e(n))==null?void 0:O.activityStatus)}`]])},[o("div",oi,[r[4]||(r[4]=o("div",{class:"node-title-icon delay-node"},[o("span",{class:"iconfont icon-delay"})],-1)),!e(m)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:r[0]||(r[0]=p=>e(x)()),"onUpdate:modelValue":r[1]||(r[1]=p=>e(n).name=p),placeholder:e(n).name},null,40,ni)),[[v],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:r[2]||(r[2]=(...p)=>e(g)&&e(g)(...p))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,ii)):(l(),i("div",di,B(e(Ge).get(e(V).DELAY_TIMER_NODE)),1)),e(m)?T("",!0):(l(),c(s,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",si,[o("div",ri,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":r[3]||(r[3]=p=>e(n).childNode=p),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)]),!e(m)&&e(n)?(l(),c(li,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0)])}}}),ci={class:"config-header"},pi=["placeholder"],mi={key:1,class:"node-name"},vi={class:"flex flex-items-center"},fi=ce({name:"RouterNodeConfig",__name:"RouterNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const Y=Rl(),S=J,m=me("processNodeTree"),{settingVisible:n,closeDrawer:d,openDrawer:x}=dl(),g=Ve(S),{nodeName:I,showInput:H,clickIcon:N,blurEvent:U}=sl(V.ROUTER_BRANCH_NODE),r=M([]),s=M([]),v=M([]),O=async()=>{let R=!0;for(const j of v.value)j&&!await j.validate()&&(R=!1);if(!R)return!1;const P=p();return!!P&&(g.value.name=I.value,g.value.showText=P,g.value.routerGroups=r.value,n.value=!1,!0)},p=()=>{if(!r.value||!Array.isArray(r.value)||r.value.length<=0)return Y.warning("\u8BF7\u914D\u7F6E\u8DEF\u7531\uFF01"),"";for(const R of r.value){if(!R.nodeId||!R.conditionType||R.conditionType===_e.EXPRESSION&&!R.conditionExpression)return Y.warning("\u8BF7\u5B8C\u5584\u8DEF\u7531\u914D\u7F6E\u9879\uFF01"),"";if(R.conditionType===_e.RULE){for(const P of R.conditionGroups.conditions)for(const j of P.rules)if(!j.leftSide||!j.rightSide)return Y.warning("\u8BF7\u5B8C\u5584\u8DEF\u7531\u914D\u7F6E\u9879\uFF01"),""}}return`${r.value.length}\u6761\u8DEF\u7531\u5206\u652F`},_=()=>{r.value.push({nodeId:"",conditionType:_e.RULE,conditionExpression:"",conditionGroups:{and:!0,conditions:[{and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]}]}})},z=R=>{for(;R&&(R.type!==V.ROUTER_BRANCH_NODE&&R.type!==V.CONDITION_NODE&&s.value.push({label:R.name,value:R.id}),R.childNode&&R.type!==V.END_EVENT_NODE);)R.conditionNodes&&R.conditionNodes.length&&R.conditionNodes.forEach(P=>{z(P)}),R=R.childNode};return Z({openDrawer:x,showRouteNodeConfig:R=>{z(m==null?void 0:m.value),r.value=[],I.value=R.name,R.routerGroups&&(r.value=R.routerGroups)}}),(R,P)=>{const j=ve,K=Nl,D=Qe,W=We,F=Oe,k=Al,E=Ke,Q=je,f=Ye,w=Te("mountedFocus");return l(),c(f,{"append-to-body":!0,modelValue:e(n),"onUpdate:modelValue":P[3]||(P[3]=X=>de(n)?n.value=X:null),"show-close":!1,size:630,"before-close":O},{header:a(()=>[o("div",ci,[e(H)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:P[0]||(P[0]=X=>e(U)()),"onUpdate:modelValue":P[1]||(P[1]=X=>de(I)?I.value=X:null),placeholder:e(I)},null,40,pi)),[[w],[Ee,e(I)]]):(l(),i("div",mi,[A(B(e(I))+" ",1),t(j,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:P[2]||(P[2]=X=>e(N)())})])),P[4]||(P[4]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(Q),o("div",null,[t(F,{type:"primary",onClick:O},{default:a(()=>P[7]||(P[7]=[A("\u786E \u5B9A")])),_:1}),t(F,{onClick:e(d)},{default:a(()=>P[8]||(P[8]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[o("div",null,[t(E,{"label-position":"top"},{default:a(()=>[(l(!0),i(G,null,$(e(r),(X,q)=>(l(),c(k,{class:"mb-15px",key:q},{header:a(()=>[o("div",vi,[t(K,{size:"large"},{default:a(()=>[A("\u8DEF\u7531"+B(q+1),1)]),_:2},1024),t(W,{class:"ml-15px",modelValue:X.nodeId,"onUpdate:modelValue":ee=>X.nodeId=ee,style:{width:"180px"}},{default:a(()=>[(l(!0),i(G,null,$(e(s),ee=>(l(),c(D,{key:ee.value,label:ee.label,value:ee.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(F,{class:"mla",type:"danger",link:"",onClick:ee=>(le=>{r.value.splice(le,1)})(q)},{default:a(()=>P[5]||(P[5]=[A(" \u5220\u9664 ")])),_:2},1032,["onClick"])])]),default:a(()=>[t(ht,{ref_for:!0,ref:ee=>e(v)[q]=ee,modelValue:e(r)[q],"onUpdate:modelValue":ee=>e(r)[q]=ee},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1}),t(F,{class:"w-1/1",type:"primary",icon:e(Bt),onClick:_},{default:a(()=>P[6]||(P[6]=[A(" \u65B0\u589E\u8DEF\u7531\u5206\u652F ")])),_:1},8,["icon"])])]),_:1},8,["modelValue"])}}}),yi={class:"node-wrapper"},gi={class:"node-container"},hi={class:"node-title-container"},_i=["placeholder"],bi=["title"],Ei={key:1,class:"node-text"},Ni={key:0,class:"node-toolbar"},Ti={class:"toolbar-icon"},ki=ce({name:"RouterNode",__name:"RouterNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.ROUTER_BRANCH_NODE),I=M(),H=()=>{m||(I.value.showRouteNodeConfig(n.value),I.value.openDrawer())},N=()=>{S("update:flowNode",n.value.childNode)};return(U,r)=>{var O;const s=ve,v=Te("mountedFocus");return l(),i("div",yi,[o("div",gi,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((O=e(n))==null?void 0:O.activityStatus)}`]])},[o("div",hi,[r[4]||(r[4]=o("div",{class:"node-title-icon router-node"},[o("span",{class:"iconfont icon-router"})],-1)),!e(m)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:r[0]||(r[0]=p=>e(x)()),"onUpdate:modelValue":r[1]||(r[1]=p=>e(n).name=p),placeholder:e(n).name},null,40,_i)),[[v],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:r[2]||(r[2]=(...p)=>e(g)&&e(g)(...p))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,bi)):(l(),i("div",Ei,B(e(Ge).get(e(V).ROUTER_BRANCH_NODE)),1)),e(m)?T("",!0):(l(),c(s,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",Ni,[o("div",Ti,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":r[3]||(r[3]=p=>e(n).childNode=p),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)]),!e(m)&&e(n)?(l(),c(fi,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0)])}}}),Si={class:"h-410px"},Ui={class:"condition-group-tool"},wi={class:"flex items-center"},Vi={key:0,class:"condition-group-delete"},Ci={class:"flex items-center justify-between"},Ri={class:"flex"},Di={class:"mr-2"},xi={class:"mr-2"},Ii={class:"mr-2"},Oi={key:0,class:"cursor-pointer mr-1 flex items-center"},Ai={class:"cursor-pointer flex items-center"},Pi={title:"\u6DFB\u52A0\u6761\u4EF6\u7EC4",class:"mt-4 cursor-pointer"},bt=_l(ce({name:"ConditionDialog",__name:"ConditionDialog",emits:["updateCondition"],setup(J,{expose:Z,emit:Y}){const S=M({conditionType:_e.RULE,conditionGroups:Ce(Me)}),m=Y,n=Rl(),d=M(!1),x=me("formType"),g=Se(()=>at.filter(s=>(x==null?void 0:x.value)!==Jl.CUSTOM||s.value!==_e.RULE)),I=Pl(),H=ol({conditionType:[{required:!0,message:"\u914D\u7F6E\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionExpression:[{required:!0,message:"\u6761\u4EF6\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),N=M(),U=()=>{S.value.conditionType===_e.RULE&&(S.value.conditionGroups||(S.value.conditionGroups=Ce(Me)))},r=async()=>{N&&(await N.value.validate()?(d.value=!1,m("updateCondition",S.value)):n.warning("\u8BF7\u5B8C\u5584\u6761\u4EF6\u89C4\u5219"))};return Z({open:s=>{s&&(S.value.conditionType=s.conditionType,S.value.conditionExpression=s.conditionExpression,S.value.conditionGroups=s.conditionGroups),d.value=!0}}),(s,v)=>{const O=vl,p=il,_=Xe,z=kl,R=ve,P=Qe,j=We,K=fl,D=Al,W=ct,F=Ke,k=$t,E=Oe,Q=Hl;return l(),c(Q,{modelValue:e(d),"onUpdate:modelValue":v[5]||(v[5]=f=>de(d)?d.value=f:null),title:"\u6761\u4EF6\u914D\u7F6E",width:"600px",fullscreen:!1},{footer:a(()=>[t(E,{type:"primary",onClick:r},{default:a(()=>v[9]||(v[9]=[A("\u786E \u5B9A")])),_:1}),t(E,{onClick:v[4]||(v[4]=f=>d.value=!1)},{default:a(()=>v[10]||(v[10]=[A("\u53D6 \u6D88")])),_:1})]),default:a(()=>[o("div",Si,[t(k,{"wrap-class":"h-full"},{default:a(()=>[t(F,{ref_key:"formRef",ref:N,model:e(S),rules:e(H),"label-position":"top"},{default:a(()=>[t(_,{label:"\u914D\u7F6E\u65B9\u5F0F",prop:"conditionType"},{default:a(()=>[t(p,{modelValue:e(S).conditionType,"onUpdate:modelValue":v[0]||(v[0]=f=>e(S).conditionType=f),onChange:U},{default:a(()=>[(l(!0),i(G,null,$(e(g),(f,w)=>(l(),c(O,{key:w,value:f.value,label:f.value},{default:a(()=>[A(B(f.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S).conditionType===e(_e).RULE&&e(S).conditionGroups?(l(),c(_,{key:0,label:"\u6761\u4EF6\u89C4\u5219"},{default:a(()=>[o("div",Ui,[o("div",wi,[v[6]||(v[6]=o("div",{class:"mr-4"},"\u6761\u4EF6\u7EC4\u5173\u7CFB",-1)),t(z,{modelValue:e(S).conditionGroups.and,"onUpdate:modelValue":v[1]||(v[1]=f=>e(S).conditionGroups.and=f),"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue"])])]),t(W,{direction:"vertical",spacer:e(S).conditionGroups.and?"\u4E14":"\u6216"},{default:a(()=>[(l(!0),i(G,null,$(e(S).conditionGroups.conditions,(f,w)=>(l(),c(D,{class:"condition-group",style:{width:"530px"},key:w},{header:a(()=>[o("div",Ci,[v[8]||(v[8]=o("div",null,"\u6761\u4EF6\u7EC4",-1)),o("div",Ri,[v[7]||(v[7]=o("div",{class:"mr-4"},"\u89C4\u5219\u5173\u7CFB",-1)),t(z,{modelValue:f.and,"onUpdate:modelValue":X=>f.and=X,"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue","onUpdate:modelValue"])])])]),default:a(()=>[e(S).conditionGroups.conditions.length>1?(l(),i("div",Vi,[t(R,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:X=>{return q=e(S).conditionGroups.conditions,ee=w,void q.splice(ee,1);var q,ee}},null,8,["onClick"])])):T("",!0),(l(!0),i(G,null,$(f.rules,(X,q)=>(l(),i("div",{class:"flex pt-2",key:q},[o("div",Di,[t(_,{prop:`conditionGroups.conditions.${w}.rules.${q}.leftSide`,rules:{required:!0,message:"\u5DE6\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}},{default:a(()=>[t(j,{style:{width:"160px"},modelValue:X.leftSide,"onUpdate:modelValue":ee=>X.leftSide=ee},{default:a(()=>[(l(!0),i(G,null,$(e(I),(ee,le)=>(l(),c(P,{key:le,label:ee.title,value:ee.field,disabled:!ee.required},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",xi,[t(j,{modelValue:X.opCode,"onUpdate:modelValue":ee=>X.opCode=ee,style:{width:"100px"}},{default:a(()=>[(l(!0),i(G,null,$(e(ot),ee=>(l(),c(P,{key:ee.value,label:ee.label,value:ee.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),o("div",Ii,[t(_,{prop:`conditionGroups.conditions.${w}.rules.${q}.rightSide`,rules:{required:!0,message:"\u53F3\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(K,{modelValue:X.rightSide,"onUpdate:modelValue":ee=>X.rightSide=ee,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),f.rules.length>1?(l(),i("div",Oi,[t(R,{icon:"ep:delete",size:18,onClick:ee=>{return le=q,void f.rules.splice(le,1);var le}},null,8,["onClick"])])):T("",!0),o("div",Ai,[t(R,{icon:"ep:plus",size:18,onClick:ee=>{return le=q,void f.rules.splice(le+1,0,{opCode:"==",leftSide:"",rightSide:""});var le}},null,8,["onClick"])])]))),128))]),_:2},1024))),128))]),_:1},8,["spacer"]),o("div",Pi,[t(R,{color:"#0089ff",icon:"ep:plus",size:24,onClick:v[2]||(v[2]=f=>{var X;return w=(X=e(S).conditionGroups)==null?void 0:X.conditions,void w.push({and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]});var w})})])]),_:1})):T("",!0),e(S).conditionType===e(_e).EXPRESSION?(l(),c(_,{key:1,label:"\u6761\u4EF6\u8868\u8FBE\u5F0F",prop:"conditionExpression"},{default:a(()=>[t(K,{type:"textarea",modelValue:e(S).conditionExpression,"onUpdate:modelValue":v[3]||(v[3]=f=>e(S).conditionExpression=f),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):T("",!0)]),_:1},8,["model","rules"])]),_:1})])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-710e9ef7"]]),Fi={class:"config-header"},Li=["placeholder"],Hi={key:1,class:"node-name"},qi={key:0},Mi={key:1},Gi={class:"flex items-center justify-between"},zi={key:0,class:"cursor-pointer"},Bi={class:"mr-2 flex items-center"},$i={class:"mx-2"},ji={class:"mr-2"},Ki={class:"mr-1 pt-1 cursor-pointer"},Yi={key:2},Xi={class:"flex items-center justify-between"},Wi={key:0,class:"cursor-pointer"},Qi={class:"flex flex-wrap gap-2"},Ji=ce({name:"TriggerNodeConfig",__name:"TriggerNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const{proxy:Y}=Dl(),S=J,m=Rl(),{settingVisible:n,closeDrawer:d,openDrawer:x}=dl(),g=Ve(S),{nodeName:I,showInput:H,clickIcon:N,blurEvent:U}=sl(V.TRIGGER_NODE),r=M(),s=ol({type:[{required:!0,message:"\u89E6\u53D1\u5668\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],"httpRequestSetting.url":[{required:!0,message:"\u8BF7\u6C42\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),v=M({type:ge.HTTP_REQUEST,httpRequestSetting:{url:"",header:[],body:[],response:[]},formSettings:[{conditionGroups:Ce(Me),updateFormFields:{},deleteFields:[]}]}),O=Jt(),p=Se(()=>O.map(f=>({title:f.title,field:f.field,disabled:!1})));let _;const z=()=>v.value.type===ge.HTTP_REQUEST?(v.value.httpRequestSetting=(_==null?void 0:_.type)===ge.HTTP_REQUEST&&_.httpRequestSetting?_.httpRequestSetting:{url:"",header:[],body:[],response:[]},void(v.value.formSettings=void 0)):v.value.type===ge.HTTP_CALLBACK?(v.value.httpRequestSetting=(_==null?void 0:_.type)===ge.HTTP_CALLBACK&&_.httpRequestSetting?_.httpRequestSetting:{url:"",header:[],body:[],response:[]},void(v.value.formSettings=void 0)):v.value.type===ge.FORM_UPDATE?(v.value.formSettings=(_==null?void 0:_.type)===ge.FORM_UPDATE&&_.formSettings?_.formSettings:[{conditionGroups:Ce(Me),updateFormFields:{},deleteFields:[]}],void(v.value.httpRequestSetting=void 0)):v.value.type===ge.FORM_DELETE?(v.value.formSettings=(_==null?void 0:_.type)===ge.FORM_DELETE&&_.formSettings?_.formSettings:[{conditionGroups:Ce(Me),updateFormFields:void 0,deleteFields:[]}],void(v.value.httpRequestSetting=void 0)):void 0,R=()=>{v.value.formSettings.push({conditionGroups:Ce(Me),updateFormFields:{},deleteFields:[]})},P=f=>{v.value.formSettings.splice(f,1)},j=(f,w)=>{Y.$refs[`condition-${f}`][0].open(w)},K=f=>{f.conditionType=void 0},D=(f,w)=>{Y.$refs[`condition-${f}`][0].open(w)},W=(f,w)=>{v.value.formSettings[f].conditionType=w.conditionType,v.value.formSettings[f].conditionExpression=w.conditionExpression,v.value.formSettings[f].conditionGroups=w.conditionGroups},F=f=>vt(f.conditionType,f.conditionExpression,f.conditionGroups,O),k=async()=>{var w,X;if(!r||!await r.value.validate())return!1;const f=Q();return!!f&&(g.value.name=I.value,g.value.showText=f,v.value.type===ge.HTTP_REQUEST?v.value.formSettings=void 0:v.value.type===ge.FORM_UPDATE?(v.value.httpRequestSetting=void 0,(w=v.value.formSettings)==null||w.forEach(q=>{q.deleteFields=void 0})):v.value.type===ge.FORM_DELETE&&(v.value.httpRequestSetting=void 0,(X=v.value.formSettings)==null||X.forEach(q=>{q.updateFormFields=void 0})),g.value.triggerSetting=v.value,n.value=!1,!0)},E=()=>{g.value.triggerSetting=_,d()},Q=()=>{var w;let f="";if(v.value.type===ge.HTTP_REQUEST||v.value.type===ge.HTTP_CALLBACK)f=`${(w=v.value.httpRequestSetting)==null?void 0:w.url}`;else if(v.value.type===ge.FORM_UPDATE){for(const[X,q]of v.value.formSettings.entries())if(!q.updateFormFields||Object.keys(q.updateFormFields).length===0)return m.warning(`\u8BF7\u6DFB\u52A0\u8868\u5355\u8BBE\u7F6E${X+1}\u7684\u4FEE\u6539\u5B57\u6BB5`),"";f="\u4FEE\u6539\u8868\u5355\u6570\u636E"}else if(v.value.type===ge.FORM_DELETE){for(const[X,q]of v.value.formSettings.entries())if(!q.deleteFields||q.deleteFields.length===0)return m.warning(`\u8BF7\u9009\u62E9\u8868\u5355\u8BBE\u7F6E${X+1}\u8981\u5220\u9664\u7684\u5B57\u6BB5`),"";f="\u5220\u9664\u8868\u5355\u6570\u636E"}return f};return Z({openDrawer:x,showTriggerNodeConfig:f=>{I.value=f.name,_=Ce(f.triggerSetting),f.triggerSetting&&(v.value={type:f.triggerSetting.type,httpRequestSetting:f.triggerSetting.httpRequestSetting||{url:"",header:[],body:[],response:[]},formSettings:f.triggerSetting.formSettings||[{conditionGroups:Ce(Me),updateFormFields:{},deleteFields:[]}]})}}),(f,w)=>{const X=ve,q=Qe,ee=We,le=Xe,L=Oe,u=jt,De=je,$e=fl,fe=Al,Pe=Ke,Fe=Ye,Je=Te("mountedFocus");return l(),c(Fe,{"append-to-body":!0,modelValue:e(n),"onUpdate:modelValue":w[5]||(w[5]=te=>de(n)?n.value=te:null),"show-close":!1,size:630,"before-close":k},{header:a(()=>[o("div",Fi,[e(H)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:w[0]||(w[0]=te=>e(U)()),"onUpdate:modelValue":w[1]||(w[1]=te=>de(I)?I.value=te:null),placeholder:e(I)},null,40,Li)),[[Je],[Ee,e(I)]]):(l(),i("div",Hi,[A(B(e(I))+" ",1),t(X,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:w[2]||(w[2]=te=>e(N)())})])),w[6]||(w[6]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(De),o("div",null,[t(L,{type:"primary",onClick:k},{default:a(()=>w[15]||(w[15]=[A("\u786E \u5B9A")])),_:1}),t(L,{onClick:E},{default:a(()=>w[16]||(w[16]=[A("\u53D6 \u6D88")])),_:1})])]),default:a(()=>[o("div",null,[t(Pe,{ref_key:"formRef",ref:r,model:e(v),"label-position":"top",rules:e(s)},{default:a(()=>[t(le,{label:"\u89E6\u53D1\u5668\u7C7B\u578B",prop:"type"},{default:a(()=>[t(ee,{modelValue:e(v).type,"onUpdate:modelValue":w[3]||(w[3]=te=>e(v).type=te),onChange:z},{default:a(()=>[(l(!0),i(G,null,$(e(Ft),(te,pe)=>(l(),c(q,{key:pe,value:te.value,label:te.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),[e(ge).HTTP_REQUEST,e(ge).HTTP_CALLBACK].includes(e(v).type)&&e(v).httpRequestSetting?(l(),i("div",qi,[t(aa,{setting:e(v).httpRequestSetting,"onUpdate:setting":w[4]||(w[4]=te=>e(v).httpRequestSetting=te),responseEnable:e(v).type===e(ge).HTTP_REQUEST,formItemPrefix:"httpRequestSetting"},null,8,["setting","responseEnable"])])):T("",!0),e(v).type===e(ge).FORM_UPDATE?(l(),i("div",Mi,[(l(!0),i(G,null,$(e(v).formSettings,(te,pe)=>(l(),i("div",{key:pe},[t(fe,{class:"w-580px mt-4"},{header:a(()=>[o("div",Gi,[o("div",null,"\u4FEE\u6539\u8868\u5355\u8BBE\u7F6E "+B(pe+1),1),e(v).formSettings.length>1?(l(),c(L,{key:0,type:"primary",plain:"",circle:"",onClick:oe=>P(pe)},{default:a(()=>[t(X,{icon:"ep:close"})]),_:2},1032,["onClick"])):T("",!0)])]),default:a(()=>[t(bt,{ref_for:!0,ref:`condition-${pe}`,onUpdateCondition:oe=>W(pe,oe)},null,8,["onUpdateCondition"]),te.conditionType?(l(),i("div",zi,[t(u,{type:"success",effect:"light",closable:"",onClose:oe=>K(te),onClick:oe=>D(pe,te)},{default:a(()=>[A(B(F(te)),1)]),_:2},1032,["onClose","onClick"])])):(l(),c(L,{key:1,type:"primary",text:"",onClick:oe=>j(pe,te)},{default:a(()=>[t(X,{icon:"ep:link",class:"mr-5px"}),w[7]||(w[7]=A("\u6DFB\u52A0\u6761\u4EF6 "))]),_:2},1032,["onClick"])),t(De,{"content-position":"left"},{default:a(()=>w[8]||(w[8]=[A("\u4FEE\u6539\u8868\u5355\u5B57\u6BB5\u8BBE\u7F6E")])),_:1}),(l(!0),i(G,null,$(Object.keys(te.updateFormFields||{}),oe=>(l(),i("div",{class:"flex items-center",key:oe},[o("div",Bi,[t(le,null,{default:a(()=>[t(ee,{class:"w-160px!","model-value":oe,"onUpdate:modelValue":C=>((ae,ne,xe)=>{if(!(ae!=null&&ae.updateFormFields))return;const Ze=ae.updateFormFields[ne];delete ae.updateFormFields[ne],ae.updateFormFields[xe]=Ze})(te,oe,C),placeholder:"\u8BF7\u9009\u62E9\u8868\u5355\u5B57\u6BB5",disabled:oe!==""},{default:a(()=>[(l(!0),i(G,null,$(e(p),(C,ae)=>(l(),c(q,{key:ae,label:C.title,value:C.field,disabled:C.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","disabled"])]),_:2},1024)]),o("div",$i,[t(le,null,{default:a(()=>w[9]||(w[9]=[A("\u7684\u503C\u8BBE\u7F6E\u4E3A")])),_:1})]),o("div",ji,[t(le,{prop:`formSettings.${pe}.updateFormFields.${oe}`,rules:{required:!0,message:"\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t($e,{class:"w-160px",modelValue:te.updateFormFields[oe],"onUpdate:modelValue":C=>te.updateFormFields[oe]=C,placeholder:"\u8BF7\u8F93\u5165",disabled:!oe},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),o("div",Ki,[t(le,null,{default:a(()=>[t(X,{icon:"ep:delete",size:18,onClick:C=>((ae,ne)=>{ae!=null&&ae.updateFormFields&&delete ae.updateFormFields[ne]})(te,oe)},null,8,["onClick"])]),_:2},1024)])]))),128)),t(L,{type:"primary",text:"",onClick:oe=>(C=>{C&&(C.updateFormFields||(C.updateFormFields={}),C.updateFormFields[""]=void 0)})(te)},{default:a(()=>[t(X,{icon:"ep:memo",class:"mr-5px"}),w[10]||(w[10]=A("\u6DFB\u52A0\u4FEE\u6539\u5B57\u6BB5 "))]),_:2},1032,["onClick"])]),_:2},1024)]))),128)),t(L,{class:"mt-6",type:"primary",text:"",onClick:R},{default:a(()=>[t(X,{icon:"ep:setting",class:"mr-5px"}),w[11]||(w[11]=A("\u6DFB\u52A0\u8BBE\u7F6E "))]),_:1})])):T("",!0),e(v).type===e(ge).FORM_DELETE?(l(),i("div",Yi,[(l(!0),i(G,null,$(e(v).formSettings,(te,pe)=>(l(),i("div",{key:pe},[t(fe,{class:"w-580px mt-4"},{header:a(()=>[o("div",Xi,[o("div",null,"\u5220\u9664\u8868\u5355\u8BBE\u7F6E "+B(pe+1),1),e(v).formSettings.length>1?(l(),c(L,{key:0,type:"primary",plain:"",circle:"",onClick:oe=>P(pe)},{default:a(()=>[t(X,{icon:"ep:close"})]),_:2},1032,["onClick"])):T("",!0)])]),default:a(()=>[t(bt,{ref_for:!0,ref:`condition-${pe}`,onUpdateCondition:oe=>W(pe,oe)},null,8,["onUpdateCondition"]),te.conditionType?(l(),i("div",Wi,[t(u,{type:"warning",effect:"light",closable:"",onClose:oe=>K(te),onClick:oe=>D(pe,te)},{default:a(()=>[A(B(F(te)),1)]),_:2},1032,["onClose","onClick"])])):(l(),c(L,{key:1,type:"primary",text:"",onClick:oe=>j(pe,te)},{default:a(()=>[t(X,{icon:"ep:link",class:"mr-5px"}),w[12]||(w[12]=A("\u6DFB\u52A0\u6761\u4EF6 "))]),_:2},1032,["onClick"])),t(De,{"content-position":"left"},{default:a(()=>w[13]||(w[13]=[A("\u5220\u9664\u8868\u5355\u5B57\u6BB5\u8BBE\u7F6E")])),_:1}),o("div",Qi,[t(ee,{modelValue:te.deleteFields,"onUpdate:modelValue":oe=>te.deleteFields=oe,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u5B57\u6BB5",class:"w-full"},{default:a(()=>[(l(!0),i(G,null,$(e(O),oe=>(l(),c(q,{key:oe.field,label:oe.title,value:oe.field},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]))),128)),t(L,{class:"mt-6",type:"primary",text:"",onClick:R},{default:a(()=>[t(X,{icon:"ep:setting",class:"mr-5px"}),w[14]||(w[14]=A("\u6DFB\u52A0\u8BBE\u7F6E "))]),_:1})])):T("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}}),Zi={class:"node-wrapper"},ed={class:"node-container"},ld={class:"node-title-container"},td=["placeholder"],ad=["title"],od={key:1,class:"node-text"},nd={key:0,class:"node-toolbar"},id={class:"toolbar-icon"},dd=ce({name:"TriggerNode",__name:"TriggerNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.TRIGGER_NODE),I=M(),H=()=>{m||(I.value.showTriggerNodeConfig(n.value),I.value.openDrawer())},N=()=>{S("update:flowNode",n.value.childNode)};return(U,r)=>{var O;const s=ve,v=Te("mountedFocus");return l(),i("div",Zi,[o("div",ed,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((O=e(n))==null?void 0:O.activityStatus)}`]])},[o("div",ld,[r[4]||(r[4]=o("div",{class:"node-title-icon trigger-node"},[o("span",{class:"iconfont icon-trigger"})],-1)),!e(m)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:r[0]||(r[0]=p=>e(x)()),"onUpdate:modelValue":r[1]||(r[1]=p=>e(n).name=p),placeholder:e(n).name},null,40,td)),[[v],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:r[2]||(r[2]=(...p)=>e(g)&&e(g)(...p))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,ad)):(l(),i("div",od,B(e(Ge).get(e(V).TRIGGER_NODE)),1)),e(m)?T("",!0):(l(),c(s,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",nd,[o("div",id,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":r[3]||(r[3]=p=>e(n).childNode=p),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)]),!e(m)&&e(n)?(l(),c(Ji,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0)])}}}),sd={class:"config-header"},rd=["placeholder"],ud={key:1,class:"node-name"},cd={class:"mr-2"},pd={class:"mr-2"},md={class:"mr-1 flex items-center"},vd={class:"mr-2"},fd={class:"mr-2"},yd={class:"mr-1 flex items-center"},gd={key:3},hd={key:4},_d=ce({name:"ChildProcessNodeConfig",__name:"ChildProcessNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(J,{expose:Z}){const Y=J,{settingVisible:S,closeDrawer:m,openDrawer:n}=dl(),d=Ve(Y),{nodeName:x,showInput:g,clickIcon:I,blurEvent:H}=sl(V.CHILD_PROCESS_NODE),N=M("child"),U=M(),r=ol({async:[{required:!0,message:"\u662F\u5426\u5F02\u6B65\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],calledProcessDefinitionKey:[{required:!0,message:"\u5B50\u6D41\u7A0B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],skipStartUserNode:[{required:!0,message:"\u662F\u5426\u81EA\u52A8\u8DF3\u8FC7\u5B50\u6D41\u7A0B\u53D1\u8D77\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],startUserType:[{required:!0,message:"\u5B50\u6D41\u7A0B\u53D1\u8D77\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],startUserEmptyType:[{required:!0,message:"\u5F53\u5B50\u6D41\u7A0B\u53D1\u8D77\u4EBA\u4E3A\u7A7A\u65F6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],startUserFormField:[{required:!0,message:"\u53D1\u8D77\u4EBA\u8868\u5355\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeoutEnable:[{required:!0,message:"\u8D85\u65F6\u8BBE\u7F6E\u662F\u5426\u5F00\u542F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeoutType:[{required:!0,message:"\u8D85\u65F6\u8BBE\u7F6E\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeDuration:[{required:!0,message:"\u8D85\u65F6\u8BBE\u7F6E\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],dateTime:[{required:!0,message:"\u8D85\u65F6\u8BBE\u7F6E\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],multiInstanceEnable:[{required:!0,message:"\u591A\u5B9E\u4F8B\u8BBE\u7F6E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),s=M({async:!1,calledProcessDefinitionKey:"",skipStartUserNode:!1,inVariables:[],outVariables:[],startUserType:dt.MAIN_PROCESS_START_USER,startUserEmptyType:it.MAIN_PROCESS_START_USER,startUserFormField:"",timeoutEnable:!1,timeoutType:we.FIXED_TIME_DURATION,timeDuration:1,timeUnit:Re.HOUR,dateTime:"",multiInstanceEnable:!1,sequential:!1,approveRatio:100,multiInstanceSourceType:El.FIXED_QUANTITY,multiInstanceSource:""}),v=M(),O=Pl(),p=Se(()=>O.filter(k=>k.type==="inputNumber")),_=Se(()=>O.filter(k=>k.type==="select"||k.type==="checkbox")),z=M(),R=async()=>{if(N.value="child",!U||!await U.value.validate())return!1;const k=v.value.find(E=>E.key===s.value.calledProcessDefinitionKey);return d.value.name=x.value,d.value.childProcessSetting&&(d.value.childProcessSetting.async=s.value.async,d.value.childProcessSetting.calledProcessDefinitionKey=k.key,d.value.childProcessSetting.calledProcessDefinitionName=k.name,d.value.childProcessSetting.skipStartUserNode=s.value.skipStartUserNode,d.value.childProcessSetting.inVariables=s.value.inVariables,d.value.childProcessSetting.outVariables=s.value.outVariables,d.value.childProcessSetting.startUserSetting.type=s.value.startUserType,d.value.childProcessSetting.startUserSetting.emptyType=s.value.startUserEmptyType,d.value.childProcessSetting.startUserSetting.formField=s.value.startUserFormField,d.value.childProcessSetting.timeoutSetting={enable:s.value.timeoutEnable},s.value.timeoutEnable&&(d.value.childProcessSetting.timeoutSetting.type=s.value.timeoutType,s.value.timeoutType===we.FIXED_TIME_DURATION&&(d.value.childProcessSetting.timeoutSetting.timeExpression=W()),s.value.timeoutType===we.FIXED_DATE_TIME&&(d.value.childProcessSetting.timeoutSetting.timeExpression=s.value.dateTime)),d.value.childProcessSetting.multiInstanceSetting={enable:s.value.multiInstanceEnable},s.value.multiInstanceEnable&&(d.value.childProcessSetting.multiInstanceSetting.sequential=s.value.sequential,d.value.childProcessSetting.multiInstanceSetting.approveRatio=s.value.approveRatio,d.value.childProcessSetting.multiInstanceSetting.sourceType=s.value.multiInstanceSourceType,d.value.childProcessSetting.multiInstanceSetting.source=s.value.multiInstanceSource)),d.value.showText=`\u8C03\u7528\u5B50\u6D41\u7A0B\uFF1A${k.name}`,S.value=!1,!0};Z({openDrawer:n,showChildProcessNodeConfig:k=>{var E;if(x.value=k.name,k.childProcessSetting){if(s.value.async=k.childProcessSetting.async,s.value.calledProcessDefinitionKey=(E=k.childProcessSetting)==null?void 0:E.calledProcessDefinitionKey,s.value.skipStartUserNode=k.childProcessSetting.skipStartUserNode,s.value.inVariables=k.childProcessSetting.inVariables,s.value.outVariables=k.childProcessSetting.outVariables,s.value.startUserType=k.childProcessSetting.startUserSetting.type,s.value.startUserEmptyType=k.childProcessSetting.startUserSetting.emptyType??it.MAIN_PROCESS_START_USER,s.value.startUserFormField=k.childProcessSetting.startUserSetting.formField??"",s.value.timeoutEnable=k.childProcessSetting.timeoutSetting.enable??!1,s.value.timeoutEnable){if(s.value.timeoutType=k.childProcessSetting.timeoutSetting.type??we.FIXED_TIME_DURATION,s.value.timeoutType===we.FIXED_TIME_DURATION){const Q=k.childProcessSetting.timeoutSetting.timeExpression??"";let f=Q.slice(2,Q.length-1),w=Q.slice(Q.length-1);s.value.timeDuration=parseInt(f),s.value.timeUnit=Ql(w)}s.value.timeoutType===we.FIXED_DATE_TIME&&(s.value.dateTime=k.childProcessSetting.timeoutSetting.timeExpression??"")}s.value.multiInstanceEnable=k.childProcessSetting.multiInstanceSetting.enable??!1,s.value.multiInstanceEnable&&(s.value.sequential=k.childProcessSetting.multiInstanceSetting.sequential??!1,s.value.approveRatio=k.childProcessSetting.multiInstanceSetting.approveRatio??100,s.value.multiInstanceSourceType=k.childProcessSetting.multiInstanceSetting.sourceType??El.FIXED_QUANTITY,s.value.multiInstanceSource=k.childProcessSetting.multiInstanceSetting.source??"")}D()}});const P=k=>{k==null||k.push({source:"",target:""})},j=(k,E)=>{E==null||E.splice(k,1)},K=()=>{s.value.inVariables=[],s.value.outVariables=[],D()},D=async()=>{const k=v.value.find(Q=>Q.key===s.value.calledProcessDefinitionKey),E=await gt(k.formId);z.value=[],E.fields&&E.fields.forEach(Q=>{na(JSON.parse(Q),z.value)})},W=()=>{let k="PT";return s.value.timeUnit===Re.MINUTE&&(k+=s.value.timeDuration+"M"),s.value.timeUnit===Re.HOUR&&(k+=s.value.timeDuration+"H"),s.value.timeUnit===Re.DAY&&(k+=s.value.timeDuration+"D"),k},F=()=>{s.value.multiInstanceSource=""};return Ml(async()=>{v.value=await oa(void 0)}),(k,E)=>{const Q=ve,f=kl,w=Xe,X=Qe,q=We,ee=Oe,le=vl,L=il,u=je,De=Yl,$e=Kl,fe=Nl,Pe=pt,Fe=Ke,Je=Ol,te=Il,pe=Ye,oe=Te("mountedFocus");return l(),c(pe,{"append-to-body":!0,modelValue:e(S),"onUpdate:modelValue":E[24]||(E[24]=C=>de(S)?S.value=C:null),"show-close":!1,size:550,"before-close":R},{header:a(()=>[o("div",sd,[e(g)?he((l(),i("input",{key:0,type:"text",class:"config-editable-input",onBlur:E[0]||(E[0]=C=>e(H)()),"onUpdate:modelValue":E[1]||(E[1]=C=>de(x)?x.value=C:null),placeholder:e(x)},null,40,rd)),[[oe],[Ee,e(x)]]):(l(),i("div",ud,[A(B(e(x))+" ",1),t(Q,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:E[2]||(E[2]=C=>e(I)())})])),E[25]||(E[25]=o("div",{class:"divide-line"},null,-1))])]),footer:a(()=>[t(u),o("div",null,[t(ee,{type:"primary",onClick:R},{default:a(()=>E[34]||(E[34]=[A("\u786E \u5B9A")])),_:1}),t(ee,{onClick:e(m)},{default:a(()=>E[35]||(E[35]=[A("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:a(()=>[t(te,{type:"border-card",modelValue:e(N),"onUpdate:modelValue":E[23]||(E[23]=C=>de(N)?N.value=C:null)},{default:a(()=>[t(Je,{label:"\u5B50\u6D41\u7A0B",name:"child"},{default:a(()=>[o("div",null,[t(Fe,{ref_key:"formRef",ref:U,model:e(s),"label-position":"top",rules:e(r)},{default:a(()=>[t(w,{label:"\u662F\u5426\u5F02\u6B65",prop:"async"},{default:a(()=>[t(f,{modelValue:e(s).async,"onUpdate:modelValue":E[3]||(E[3]=C=>e(s).async=C),"active-text":"\u5F02\u6B65","inactive-text":"\u4E0D\u5F02\u6B65"},null,8,["modelValue"])]),_:1}),t(w,{label:"\u9009\u62E9\u5B50\u6D41\u7A0B",prop:"calledProcessDefinitionKey"},{default:a(()=>[t(q,{modelValue:e(s).calledProcessDefinitionKey,"onUpdate:modelValue":E[4]||(E[4]=C=>e(s).calledProcessDefinitionKey=C),clearable:"",onChange:K},{default:a(()=>[(l(!0),i(G,null,$(e(v),(C,ae)=>(l(),c(X,{key:ae,label:C.name,value:C.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"\u662F\u5426\u81EA\u52A8\u8DF3\u8FC7\u5B50\u6D41\u7A0B\u53D1\u8D77\u8282\u70B9",prop:"skipStartUserNode"},{default:a(()=>[t(f,{modelValue:e(s).skipStartUserNode,"onUpdate:modelValue":E[5]||(E[5]=C=>e(s).skipStartUserNode=C),"active-text":"\u8DF3\u8FC7","inactive-text":"\u4E0D\u8DF3\u8FC7"},null,8,["modelValue"])]),_:1}),t(w,{label:"\u4E3B\u2192\u5B50\u53D8\u91CF\u4F20\u9012",prop:"inVariables"},{default:a(()=>[(l(!0),i(G,null,$(e(s).inVariables,(C,ae)=>(l(),i("div",{class:"flex pt-2",key:ae},[o("div",cd,[t(w,{prop:`inVariables.${ae}.source`,rules:{required:!0,message:"\u53D8\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(q,{class:"w-200px!",modelValue:C.source,"onUpdate:modelValue":ne=>C.source=ne},{default:a(()=>[(l(!0),i(G,null,$(e(O),(ne,xe)=>(l(),c(X,{key:xe,label:ne.title,value:ne.field},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",pd,[t(w,{prop:`inVariables.${ae}.target`,rules:{required:!0,message:"\u53D8\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(q,{class:"w-200px!",modelValue:C.target,"onUpdate:modelValue":ne=>C.target=ne},{default:a(()=>[(l(!0),i(G,null,$(e(z),(ne,xe)=>(l(),c(X,{key:xe,label:ne.title,value:ne.field},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",md,[t(Q,{icon:"ep:delete",size:18,onClick:ne=>j(ae,e(s).inVariables)},null,8,["onClick"])])]))),128)),t(ee,{type:"primary",text:"",onClick:E[6]||(E[6]=C=>P(e(s).inVariables))},{default:a(()=>[t(Q,{icon:"ep:plus",class:"mr-5px"}),E[26]||(E[26]=A("\u6DFB\u52A0\u4E00\u884C "))]),_:1})]),_:1}),e(s).async===!1?(l(),c(w,{key:0,label:"\u5B50\u2192\u4E3B\u53D8\u91CF\u4F20\u9012",prop:"outVariables"},{default:a(()=>[(l(!0),i(G,null,$(e(s).outVariables,(C,ae)=>(l(),i("div",{class:"flex pt-2",key:ae},[o("div",vd,[t(w,{prop:`outVariables.${ae}.source`,rules:{required:!0,message:"\u53D8\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(q,{class:"w-200px!",modelValue:C.source,"onUpdate:modelValue":ne=>C.source=ne},{default:a(()=>[(l(!0),i(G,null,$(e(z),(ne,xe)=>(l(),c(X,{key:xe,label:ne.title,value:ne.field},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",fd,[t(w,{prop:`outVariables.${ae}.target`,rules:{required:!0,message:"\u53D8\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:a(()=>[t(q,{class:"w-200px!",modelValue:C.target,"onUpdate:modelValue":ne=>C.target=ne},{default:a(()=>[(l(!0),i(G,null,$(e(O),(ne,xe)=>(l(),c(X,{key:xe,label:ne.title,value:ne.field},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),o("div",yd,[t(Q,{icon:"ep:delete",size:18,onClick:ne=>j(ae,e(s).outVariables)},null,8,["onClick"])])]))),128)),t(ee,{type:"primary",text:"",onClick:E[7]||(E[7]=C=>P(e(s).outVariables))},{default:a(()=>[t(Q,{icon:"ep:plus",class:"mr-5px"}),E[27]||(E[27]=A("\u6DFB\u52A0\u4E00\u884C "))]),_:1})]),_:1})):T("",!0),t(w,{label:"\u5B50\u6D41\u7A0B\u53D1\u8D77\u4EBA",prop:"startUserType"},{default:a(()=>[t(L,{modelValue:e(s).startUserType,"onUpdate:modelValue":E[8]||(E[8]=C=>e(s).startUserType=C)},{default:a(()=>[(l(!0),i(G,null,$(e(Lt),C=>(l(),c(le,{key:C.value,value:C.value},{default:a(()=>[A(B(C.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s).startUserType===e(dt).FROM_FORM?(l(),c(w,{key:1,label:"\u5F53\u5B50\u6D41\u7A0B\u53D1\u8D77\u4EBA\u4E3A\u7A7A\u65F6",prop:"startUserType"},{default:a(()=>[t(L,{modelValue:e(s).startUserEmptyType,"onUpdate:modelValue":E[9]||(E[9]=C=>e(s).startUserEmptyType=C)},{default:a(()=>[(l(!0),i(G,null,$(e(Ht),C=>(l(),c(le,{key:C.value,value:C.value},{default:a(()=>[A(B(C.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(s).startUserType===2?(l(),c(w,{key:2,label:"\u53D1\u8D77\u4EBA\u8868\u5355",prop:"startUserFormField"},{default:a(()=>[t(q,{class:"w-200px!",modelValue:e(s).startUserFormField,"onUpdate:modelValue":E[10]||(E[10]=C=>e(s).startUserFormField=C)},{default:a(()=>[(l(!0),i(G,null,$(e(O),(C,ae)=>(l(),c(X,{key:ae,label:C.title,value:C.field},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),t(u,{"content-position":"left"},{default:a(()=>E[28]||(E[28]=[A("\u8D85\u65F6\u8BBE\u7F6E")])),_:1}),t(w,{label:"\u542F\u7528\u5F00\u5173",prop:"timeoutEnable"},{default:a(()=>[t(f,{modelValue:e(s).timeoutEnable,"onUpdate:modelValue":E[11]||(E[11]=C=>e(s).timeoutEnable=C),"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED"},null,8,["modelValue"])]),_:1}),e(s).timeoutEnable?(l(),i("div",gd,[t(w,{prop:"timeoutType"},{default:a(()=>[t(L,{modelValue:e(s).timeoutType,"onUpdate:modelValue":E[12]||(E[12]=C=>e(s).timeoutType=C)},{default:a(()=>[(l(!0),i(G,null,$(e(nt),C=>(l(),c(De,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s).timeoutType===e(we).FIXED_TIME_DURATION?(l(),c(w,{key:0},{default:a(()=>[t(w,{prop:"timeDuration"},{default:a(()=>[t($e,{class:"mr-2",style:{width:"100px"},modelValue:e(s).timeDuration,"onUpdate:modelValue":E[13]||(E[13]=C=>e(s).timeDuration=C),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(q,{modelValue:e(s).timeUnit,"onUpdate:modelValue":E[14]||(E[14]=C=>e(s).timeUnit=C),class:"mr-2",style:{width:"100px"}},{default:a(()=>[(l(!0),i(G,null,$(e(xl),C=>(l(),c(X,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(fe,null,{default:a(()=>E[29]||(E[29]=[A("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):T("",!0),e(s).timeoutType===e(we).FIXED_DATE_TIME?(l(),c(w,{key:1,prop:"dateTime"},{default:a(()=>[t(Pe,{class:"mr-2",modelValue:e(s).dateTime,"onUpdate:modelValue":E[15]||(E[15]=C=>e(s).dateTime=C),type:"datetime",placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F\u548C\u65F6\u95F4","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"]),t(fe,null,{default:a(()=>E[30]||(E[30]=[A("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):T("",!0)])):T("",!0),t(u,{"content-position":"left"},{default:a(()=>E[31]||(E[31]=[A("\u591A\u5B9E\u4F8B\u8BBE\u7F6E")])),_:1}),t(w,{label:"\u542F\u7528\u5F00\u5173",prop:"multiInstanceEnable"},{default:a(()=>[t(f,{modelValue:e(s).multiInstanceEnable,"onUpdate:modelValue":E[16]||(E[16]=C=>e(s).multiInstanceEnable=C),"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED"},null,8,["modelValue"])]),_:1}),e(s).multiInstanceEnable?(l(),i("div",hd,[t(w,{prop:"sequential"},{default:a(()=>[t(f,{modelValue:e(s).sequential,"onUpdate:modelValue":E[17]||(E[17]=C=>e(s).sequential=C),"active-text":"\u4E32\u884C","inactive-text":"\u5E76\u884C"},null,8,["modelValue"])]),_:1}),t(w,{prop:"approveRatio"},{default:a(()=>[t(fe,null,{default:a(()=>E[32]||(E[32]=[A("\u5B8C\u6210\u6BD4\u4F8B(%)")])),_:1}),t($e,{class:"ml-10px",modelValue:e(s).approveRatio,"onUpdate:modelValue":E[18]||(E[18]=C=>e(s).approveRatio=C),min:10,max:100,step:10},null,8,["modelValue"])]),_:1}),t(w,{prop:"multiInstanceSourceType"},{default:a(()=>[t(fe,null,{default:a(()=>E[33]||(E[33]=[A("\u591A\u5B9E\u4F8B\u6765\u6E90")])),_:1}),t(q,{class:"ml-10px w-200px!",modelValue:e(s).multiInstanceSourceType,"onUpdate:modelValue":E[19]||(E[19]=C=>e(s).multiInstanceSourceType=C),onChange:F},{default:a(()=>[(l(!0),i(G,null,$(e(qt),C=>(l(),c(X,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s).multiInstanceSourceType===e(El).FIXED_QUANTITY?(l(),c(w,{key:0},{default:a(()=>[t($e,{modelValue:e(s).multiInstanceSource,"onUpdate:modelValue":E[20]||(E[20]=C=>e(s).multiInstanceSource=C),min:1},null,8,["modelValue"])]),_:1})):T("",!0),e(s).multiInstanceSourceType===e(El).NUMBER_FORM?(l(),c(w,{key:1},{default:a(()=>[t(q,{class:"w-200px!",modelValue:e(s).multiInstanceSource,"onUpdate:modelValue":E[21]||(E[21]=C=>e(s).multiInstanceSource=C)},{default:a(()=>[(l(!0),i(G,null,$(e(p),(C,ae)=>(l(),c(X,{key:ae,label:C.title,value:C.field},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(s).multiInstanceSourceType===e(El).MULTIPLE_FORM?(l(),c(w,{key:2},{default:a(()=>[t(q,{class:"w-200px!",modelValue:e(s).multiInstanceSource,"onUpdate:modelValue":E[22]||(E[22]=C=>e(s).multiInstanceSource=C)},{default:a(()=>[(l(!0),i(G,null,$(e(_),(C,ae)=>(l(),c(X,{key:ae,label:C.title,value:C.field},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0)])):T("",!0)]),_:1},8,["model","rules"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),bd={class:"node-wrapper"},Ed={class:"node-container"},Nd={class:"node-title-container"},Td=["placeholder"],kd=["title"],Sd={key:1,class:"node-text"},Ud={key:0,class:"node-toolbar"},wd={class:"toolbar-icon"},Vd=ce({name:"ChildProcessNode",__name:"ChildProcessNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=me("readonly"),n=Ve(Y),{showInput:d,blurEvent:x,clickTitle:g}=rl(n,V.CHILD_PROCESS_NODE),I=M(),H=()=>{m||(I.value.showChildProcessNodeConfig(n.value),I.value.openDrawer())},N=()=>{S("update:flowNode",n.value.childNode)};return(U,r)=>{var O,p,_;const s=ve,v=Te("mountedFocus");return l(),i("div",bd,[o("div",Ed,[o("div",{class:ke(["node-box",[{"node-config-error":!e(n).showText},`${e(Ae)((O=e(n))==null?void 0:O.activityStatus)}`]])},[o("div",Nd,[o("div",{class:ke("node-title-icon "+(((p=e(n).childProcessSetting)==null?void 0:p.async)===!0?"async-child-process":"child-process"))},[o("span",{class:ke("iconfont "+(((_=e(n).childProcessSetting)==null?void 0:_.async)===!0?"icon-async-child-process":"icon-child-process"))},null,2)],2),!e(m)&&e(d)?he((l(),i("input",{key:0,type:"text",class:"editable-title-input",onBlur:r[0]||(r[0]=z=>e(x)()),"onUpdate:modelValue":r[1]||(r[1]=z=>e(n).name=z),placeholder:e(n).name},null,40,Td)),[[v],[Ee,e(n).name]]):(l(),i("div",{key:1,class:"node-title",onClick:r[2]||(r[2]=(...z)=>e(g)&&e(g)(...z))},B(e(n).name),1))]),o("div",{class:"node-content",onClick:H},[e(n).showText?(l(),i("div",{key:0,class:"node-text",title:e(n).showText},B(e(n).showText),9,kd)):(l(),i("div",Sd,B(e(Ge).get(e(V).CHILD_PROCESS_NODE)),1)),e(m)?T("",!0):(l(),c(s,{key:2,icon:"ep:arrow-right-bold"}))]),e(m)?T("",!0):(l(),i("div",Ud,[o("div",wd,[t(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),c(qe,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":r[3]||(r[3]=z=>e(n).childNode=z),"current-node":e(n)},null,8,["child-node","current-node"])):T("",!0)]),!e(m)&&e(n)?(l(),c(_d,{key:0,ref_key:"nodeSetting",ref:I,"flow-node":e(n)},null,8,["flow-node"])):T("",!0)])}}}),Fl=ce({name:"ProcessNodeTree",__name:"ProcessNodeTree",props:{parentNode:{type:Object,default:()=>null},flowNode:{type:Object,default:()=>null}},emits:["update:flowNode","find:recursiveFindParentNode"],setup(J,{emit:Z}){const Y=J,S=Z,m=Ve(Y),n=g=>{S("update:flowNode",g)},d=(g,I)=>{S("find:recursiveFindParentNode",g,Y.parentNode,I)},x=(g,I,H)=>{I&&(I.type!==V.START_USER_NODE?(I.type===H&&g.push(I),S("find:recursiveFindParentNode",g,Y.parentNode,H)):g.push(I))};return(g,I)=>{const H=kt("ProcessNodeTree",!0);return l(),i(G,null,[e(m)&&e(m).type===e(V).START_USER_NODE?(l(),c(Aa,{key:0,"flow-node":e(m)},null,8,["flow-node"])):T("",!0),!e(m)||e(m).type!==e(V).USER_TASK_NODE&&e(m).type!==e(V).TRANSACTOR_NODE?T("",!0):(l(),c(Eo,{key:1,"flow-node":e(m),"onUpdate:flowNode":n,"onFind:parentNode":d},null,8,["flow-node"])),e(m)&&e(m).type===e(V).COPY_TASK_NODE?(l(),c(Mo,{key:2,"flow-node":e(m),"onUpdate:flowNode":n},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).CONDITION_BRANCH_NODE?(l(),c(En,{key:3,"flow-node":e(m),"onUpdate:modelValue":n,"onFind:parentNode":d},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).PARALLEL_BRANCH_NODE?(l(),c(An,{key:4,"flow-node":e(m),"onUpdate:modelValue":n,"onFind:parentNode":d},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).INCLUSIVE_BRANCH_NODE?(l(),c(Qn,{key:5,"flow-node":e(m),"onUpdate:modelValue":n,"onFind:parentNode":d},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).DELAY_TIMER_NODE?(l(),c(ui,{key:6,"flow-node":e(m),"onUpdate:flowNode":n},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).ROUTER_BRANCH_NODE?(l(),c(ki,{key:7,"flow-node":e(m),"onUpdate:flowNode":n},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).TRIGGER_NODE?(l(),c(dd,{key:8,"flow-node":e(m),"onUpdate:flowNode":n},null,8,["flow-node"])):T("",!0),e(m)&&e(m).type===e(V).CHILD_PROCESS_NODE?(l(),c(Vd,{key:9,"flow-node":e(m),"onUpdate:flowNode":n},null,8,["flow-node"])):T("",!0),e(m)&&e(m).childNode?(l(),c(H,{key:10,"flow-node":e(m).childNode,"onUpdate:flowNode":I[0]||(I[0]=N=>e(m).childNode=N),"parent-node":e(m),"onFind:recursiveFindParentNode":x},null,8,["flow-node","parent-node"])):T("",!0),e(m)&&e(m).type===e(V).END_EVENT_NODE?(l(),c(Fa,{key:11,"flow-node":e(m)},null,8,["flow-node"])):T("",!0)],64)}}}),Cd={class:"simple-process-model-container position-relative"},Rd={class:"position-absolute top-0px right-0px bg-#fff z-index-button-group"},Et=_l(ce({name:"SimpleProcessModel",__name:"SimpleProcessModel",props:{flowNode:{type:Object,required:!0},readonly:{type:Boolean,required:!1,default:!0}},emits:["save"],setup(J,{expose:Z,emit:Y}){const S=J,m=Y,n=Ve(S);Ie("readonly",S.readonly);let d=M(100);const x=M(!1),g=M(0),I=M(0),H=M(0),N=M(0),U=M(0),r=M(0),s=()=>{document.body.style.cursor="grab"},v=F=>{x.value=!0,g.value=F.clientX-H.value,I.value=F.clientY-N.value,s()},O=F=>{x.value&&(F.preventDefault(),requestAnimationFrame(()=>{H.value=F.clientX-g.value,N.value=F.clientY-I.value}))},p=()=>{x.value=!1,document.body.style.cursor="default"},_=()=>{H.value=U.value,N.value=r.value},z=M(!1);let R=[];const P=(F,k)=>{if(F){const{type:E,showText:Q,conditionNodes:f}=F;if(E==V.END_EVENT_NODE)return;E==V.START_USER_NODE&&P(F.childNode,k),E!==V.USER_TASK_NODE&&E!==V.COPY_TASK_NODE&&E!==V.CONDITION_NODE||(Q||k.push(F),P(F.childNode,k)),E!=V.CONDITION_BRANCH_NODE&&E!=V.PARALLEL_BRANCH_NODE&&E!=V.INCLUSIVE_BRANCH_NODE||(f==null||f.forEach(w=>{P(w,k)}),P(F.childNode,k))}};Z({getCurrentFlowData:async()=>{try{return R=[],P(n.value,R),R.length>0?void(z.value=!0):n.value}catch{return}}});const j=()=>{ia.json(new Blob([JSON.stringify(n.value)]),"model.json")},K=M(),D=()=>{K.value.click()},W=()=>{const F=K.value.files[0],k=new FileReader;k.readAsText(F),k.onload=function(){Tt(this.result)&&(n.value=JSON.parse(this.result),m("save",n.value))}};return Ml(()=>{U.value=H.value,r.value=N.value}),(F,k)=>{const E=ve,Q=Oe,f=Kt,w=Tl,X=Hl;return l(),i(G,null,[o("div",Cd,[o("div",Rd,[t(w,{type:"flex",justify:"end"},{default:a(()=>[t(f,{key:"scale-control",size:"default"},{default:a(()=>[J.readonly?T("",!0):(l(),c(Q,{key:0,size:"default",onClick:j},{default:a(()=>[t(E,{icon:"ep:download"}),k[6]||(k[6]=A(" \u5BFC\u51FA "))]),_:1})),J.readonly?T("",!0):(l(),c(Q,{key:1,size:"default",onClick:D},{default:a(()=>[t(E,{icon:"ep:upload"}),k[7]||(k[7]=A("\u5BFC\u5165 "))]),_:1})),J.readonly?T("",!0):(l(),i("input",{key:2,type:"file",id:"files",ref_key:"refFile",ref:K,style:{display:"none"},accept:".json",onChange:W},null,544)),t(Q,{size:"default",icon:e(Yt),onClick:k[0]||(k[0]=q=>{d.value=100})},null,8,["icon"]),t(Q,{size:"default",plain:!0,icon:e(Xt),onClick:k[1]||(k[1]=q=>{d.value!=50&&(d.value-=10)})},null,8,["icon"]),t(Q,{size:"default",class:"w-80px"},{default:a(()=>[A(B(e(d))+"% ",1)]),_:1}),t(Q,{size:"default",plain:!0,icon:e(Wt),onClick:k[2]||(k[2]=q=>{d.value!=200&&(d.value+=10)})},null,8,["icon"]),t(Q,{size:"default",onClick:_},{default:a(()=>k[8]||(k[8]=[A("\u91CD\u7F6E")])),_:1})]),_:1})]),_:1})]),o("div",{class:"simple-process-model",style:St(`transform: translate(${e(H)}px, ${e(N)}px) scale(${e(d)/100});`),onMousedown:v,onMousemove:O,onMouseup:p,onMouseleave:p,onMouseenter:s},[e(n)?(l(),c(Fl,{key:0,"flow-node":e(n),"onUpdate:flowNode":k[3]||(k[3]=q=>de(n)?n.value=q:null)},null,8,["flow-node"])):T("",!0)],36)]),t(X,{modelValue:e(z),"onUpdate:modelValue":k[5]||(k[5]=q=>de(z)?z.value=q:null),title:"\u4FDD\u5B58\u5931\u8D25",width:"400",fullscreen:!1},{footer:a(()=>[t(Q,{type:"primary",onClick:k[4]||(k[4]=q=>z.value=!1)},{default:a(()=>k[9]||(k[9]=[A("\u77E5\u9053\u4E86")])),_:1})]),default:a(()=>[k[10]||(k[10]=o("div",{class:"mb-2"},"\u4EE5\u4E0B\u8282\u70B9\u5185\u5BB9\u4E0D\u5B8C\u5584\uFF0C\u8BF7\u4FEE\u6539\u540E\u4FDD\u5B58",-1)),(l(!0),i(G,null,$(e(R),(q,ee)=>(l(),i("div",{class:"mb-3 b-rounded-1 bg-gray-100 p-2 line-height-normal",key:ee},B(q.name)+" : "+B(e(Ge).get(q.type)),1))),128))]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-0ae6a697"]]),Dd={class:"overflow-auto"},xd=ce({name:"SimpleProcessDesigner",__name:"SimpleProcessDesigner",props:{modelName:{type:String,required:!1},modelFormId:{type:Number,required:!1,default:void 0},modelFormType:{type:Number,required:!1,default:Jl.NORMAL},startUserIds:{type:Array,required:!1},startDeptIds:{type:Array,required:!1}},emits:["success"],setup(J,{expose:Z,emit:Y}){const S=Y,m=J,n=me("processData"),d=M(!1),x=M([]),g=M(m.modelFormType);pl(()=>m.modelFormType,R=>{g.value=R}),pl(()=>m.modelFormId,async R=>{if(R){const P=await gt(R);x.value=P==null?void 0:P.fields}else x.value=[]},{immediate:!0});const I=M([]),H=M([]),N=M([]),U=M([]),r=M(),s=M([]);Ie("formFields",x),Ie("formType",g),Ie("roleList",I),Ie("postList",H),Ie("userList",N),Ie("deptList",U),Ie("userGroupList",s),Ie("deptTree",r),Ie("startUserIds",m.startUserIds),Ie("startDeptIds",m.startDeptIds),Ie("tasks",[]),Ie("processInstance",{}),Rl();const v=M();Ie("processNodeTree",v);const O=M(!1);let p=[];const _=async R=>{if(R)try{n.value=R,S("success",R)}catch{}};Ml(async()=>{try{d.value=!0,I.value=await da(),H.value=await ra(),N.value=await ua(),U.value=await sa(),r.value=Zt(U.value,"id"),s.value=await ca(),n.value?v.value=n==null?void 0:n.value:v.value||(v.value={name:"\u53D1\u8D77\u4EBA",type:V.START_USER_NODE,id:st.START_USER_NODE_ID,childNode:{id:st.END_EVENT_NODE_ID,name:"\u7ED3\u675F",type:V.END_EVENT_NODE}},_(v.value))}finally{d.value=!1}});const z=M();return Z({}),(R,P)=>{const j=Oe,K=Hl,D=Qt;return he((l(),i("div",Dd,[e(v)?(l(),c(Et,{key:0,ref_key:"simpleProcessModelRef",ref:z,"flow-node":e(v),readonly:!1,onSave:_},null,8,["flow-node"])):T("",!0),t(K,{modelValue:e(O),"onUpdate:modelValue":P[1]||(P[1]=W=>de(O)?O.value=W:null),title:"\u4FDD\u5B58\u5931\u8D25",width:"400",fullscreen:!1},{footer:a(()=>[t(j,{type:"primary",onClick:P[0]||(P[0]=W=>O.value=!1)},{default:a(()=>P[2]||(P[2]=[A("\u77E5\u9053\u4E86")])),_:1})]),default:a(()=>[P[3]||(P[3]=o("div",{class:"mb-2"},"\u4EE5\u4E0B\u8282\u70B9\u5185\u5BB9\u4E0D\u5B8C\u5584\uFF0C\u8BF7\u4FEE\u6539\u540E\u4FDD\u5B58",-1)),(l(!0),i(G,null,$(e(p),(W,F)=>(l(),i("div",{class:"mb-3 b-rounded-1 bg-gray-100 p-2 line-height-normal",key:F},B(W.name)+" : "+B(e(Ge).get(W.type)),1))),128))]),_:1},8,["modelValue"])])),[[D,e(d)]])}}});export{Et as _,xd as a};
