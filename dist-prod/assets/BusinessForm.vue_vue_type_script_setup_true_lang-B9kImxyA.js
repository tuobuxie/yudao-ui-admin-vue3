import{a as O,d as W,az as F,b as X,aA as Y}from"./index-B2urM1q-.js";import{_ as Z}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{_ as ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{a as le,c as ae,u as te}from"./index-DjbfgQDC.js";import{g as de}from"./index-BV7SJqTM.js";import{a as ue}from"./index-7u7L_BLd.js";import{g as oe}from"./index-Bix5n4IG.js";import{_ as re}from"./BusinessProductForm.vue_vue_type_script_setup_true_lang-CAWtyS_F.js";import{ak as se,h as ie,i as me,j as ce,aj as ne,k as pe,x as fe,Q as ve,F as _e,a0 as be,$ as Ve,l as Pe,f as Ie}from"./form-designer-DHHJWkD5.js";import{l as we,r as i,j as ye,b as Ue,A as v,q as c,u as t,h as C,B as d,C as ge,J as e,m as y,I as U,$ as g,G as A}from"./form-create-_84fGzaM.js";const ke=we({__name:"BusinessForm",emits:["success"],setup(he,{expose:B,emit:R}){const{t:b}=O(),k=W(),n=i(!1),h=i(""),p=i(!1),f=i(""),u=i({id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1}),S=ye({name:[{required:!0,message:"\u5546\u673A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],statusTypeId:[{required:!0,message:"\u5546\u673A\u72B6\u6001\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i(),T=i([]),x=i([]),q=i([]),V=i("product"),j=i();Ue(()=>u.value,o=>{if(!o)return;const l=o.products.reduce((r,s)=>r+s.totalPrice,0),m=l-(o.discountPercent!=null?Y(l,o.discountPercent/100):0);u.value.totalProductPrice=l,u.value.totalPrice=m},{deep:!0}),B({open:async(o,l,m,r)=>{if(n.value=!0,h.value=b("action."+o),f.value=o,G(),l){p.value=!0;try{u.value=await le(l)}finally{p.value=!1}}else m&&(u.value.customerId=m,u.value.customerDefault=!0),r&&(u.value.contactId=r);q.value=await ue(),x.value=await de(),T.value=await oe(),f.value==="create"&&(u.value.ownerUserId=X().getUser.id)}});const $=R,z=async()=>{if(_&&await _.value.validate()){await j.value.validate(),p.value=!0;try{const o=u.value;f.value==="create"?(await ae(o),k.success(b("common.createSuccess"))):(await te(o),k.success(b("common.updateSuccess"))),n.value=!1,$("success")}finally{p.value=!1}}},G=()=>{var o;u.value={id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1},(o=_.value)==null||o.resetFields()};return(o,l)=>{const m=pe,r=ne,s=ce,P=ve,I=fe,w=me,J=_e,K=Ve,N=be,Q=ee,E=Pe,H=ie,D=Ie,L=Z,M=se;return c(),v(L,{title:t(h),modelValue:t(n),"onUpdate:modelValue":l[11]||(l[11]=a=>C(n)?n.value=a:null),width:"1280"},{footer:d(()=>[e(D,{onClick:z,type:"primary",disabled:t(p)},{default:d(()=>l[12]||(l[12]=[A("\u786E \u5B9A")])),_:1},8,["disabled"]),e(D,{onClick:l[10]||(l[10]=a=>n.value=!1)},{default:d(()=>l[13]||(l[13]=[A("\u53D6 \u6D88")])),_:1})]),default:d(()=>[ge((c(),v(H,{ref_key:"formRef",ref:_,model:t(u),rules:t(S),"label-width":"120px"},{default:d(()=>[e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u5546\u673A\u540D\u79F0",prop:"name"},{default:d(()=>[e(m,{modelValue:t(u).name,"onUpdate:modelValue":l[0]||(l[0]=a=>t(u).name=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:d(()=>[e(I,{modelValue:t(u).ownerUserId,"onUpdate:modelValue":l[1]||(l[1]=a=>t(u).ownerUserId=a),disabled:t(f)!=="create",class:"w-1/1"},{default:d(()=>[(c(!0),y(U,null,g(t(T),a=>(c(),v(P,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:d(()=>[e(I,{disabled:t(u).customerDefault,modelValue:t(u).customerId,"onUpdate:modelValue":l[2]||(l[2]=a=>t(u).customerId=a),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1"},{default:d(()=>[(c(!0),y(U,null,g(t(q),a=>(c(),v(P,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeId"},{default:d(()=>[e(I,{modelValue:t(u).statusTypeId,"onUpdate:modelValue":l[3]||(l[3]=a=>t(u).statusTypeId=a),placeholder:"\u8BF7\u9009\u62E9\u5546\u673A\u72B6\u6001\u7EC4",clearable:"",class:"w-1/1",disabled:t(f)!=="create"},{default:d(()=>[(c(!0),y(U,null,g(t(x),a=>(c(),v(P,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime"},{default:d(()=>[e(J,{modelValue:t(u).dealTime,"onUpdate:modelValue":l[4]||(l[4]=a=>t(u).dealTime=a),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u5907\u6CE8",prop:"remark"},{default:d(()=>[e(m,{type:"textarea",modelValue:t(u).remark,"onUpdate:modelValue":l[5]||(l[5]=a=>t(u).remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Q,null,{default:d(()=>[e(N,{modelValue:t(V),"onUpdate:modelValue":l[6]||(l[6]=a=>C(V)?V.value=a:null),class:"-mt-15px -mb-10px"},{default:d(()=>[e(K,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:d(()=>[e(re,{ref_key:"productFormRef",ref:j,products:t(u).products,disabled:o.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:d(()=>[e(m,{disabled:"",modelValue:t(u).totalProductPrice,"onUpdate:modelValue":l[7]||(l[7]=a=>t(u).totalProductPrice=a),formatter:t(F)},null,8,["modelValue","formatter"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:d(()=>[e(E,{modelValue:t(u).discountPercent,"onUpdate:modelValue":l[8]||(l[8]=a=>t(u).discountPercent=a),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"price"},{default:d(()=>[e(m,{disabled:"",modelValue:t(u).totalPrice,"onUpdate:modelValue":l[9]||(l[9]=a=>t(u).totalPrice=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:t(F)},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[M,t(p)]])]),_:1},8,["title","modelValue"])}}});export{ke as _};
