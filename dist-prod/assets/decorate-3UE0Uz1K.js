import{_ as U,P as j}from"./util-dXIOUGmK.js";import{d as q,u as z,_ as A,M as C,N as p}from"./index-DzK2S43K.js";import{g as E,u as F}from"./template-DMkxpM2P.js";import{u as V}from"./page-BbgZH62H.js";import{u as J}from"./tagsView-CKM4YfGJ.js";import{s as G,o as H,t as L,I as N}from"./form-designer-DHHJWkD5.js";import{l as K,r,j as O,e as Q,u as a,A as k,E as W,q as g,B as d,J as w,m as X,I as Y,$ as Z}from"./form-create-_84fGzaM.js";import"./Dialog.vue_vue_type_style_index_0_lang-D3YOFsHs.js";import"./Qrcode-DD2I8Dz4.js";import"./IFrame.vue_vue_type_script_setup_true_lang-B8_WR1LZ.js";import"./vuedraggable.umd-DPA_Ddu8.js";const y="diy_page_index",ee=K({name:"DiyTemplateDecorate",__name:"decorate",setup(ae){const l=r(0),s=O([{name:"\u57FA\u7840\u8BBE\u7F6E",icon:"ep:iphone"},{name:"\u9996\u9875",icon:"ep:home-filled"},{name:"\u6211\u7684",icon:"ep:user-filled"}]),h=q(),u=r(!1),n=r(),_=r(),i=r({property:""}),m=r(new Map),b=r(""),I=[],c=r(I),$=t=>{m.value.set(s[l.value].name,i.value);const e=m.value.get(s[t].name);if(l.value=t,t===0)return c.value=I,void(i.value=p(e)?n.value:e);c.value=j,i.value=p(e)?n.value.pages.find(o=>o.name===s[t].name):e},D=async()=>{var t;if(_){u.value=!0;try{for(let e=0;e<s.length;e++){const o=m.value.get(s[e].name);e!==0?(t=i.value)!=null&&t.name.includes(s[e].name)?await V(a(i)):p(o)||await V(o):await F(p(o)?a(n):o)}h.success("\u4FDD\u5B58\u6210\u529F")}finally{u.value=!1}}},M=()=>sessionStorage.setItem(y,`${l.value}`),{currentRoute:f}=z(),{delView:x}=J();return Q(async()=>{var t;if(n.value={id:void 0,name:"",used:!1,usedTime:void 0,remark:"",previewPicUrls:[],property:"",pages:[]},(t=_.value)==null||t.resetFields(),!f.value.params.id)return h.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u9875\u9762\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void x(a(f));await(async e=>{u.value=!0;try{n.value=await E(e);const o="http://mall.yudao.iocoder.cn";b.value=`${o}?templateId=${n.value.id}&tenantId=${C()}`}finally{u.value=!1}})(f.value.params.id),(()=>{const e=N(sessionStorage.getItem(y))||0;sessionStorage.removeItem(y),i.value=n.value,m.value=new Map,e!==l.value&&$(e)})()}),(t,e)=>{const o=A,B=L,P=H,R=G,T=U;return a(n)&&!a(u)?(g(),k(T,{key:0,modelValue:a(i).property,"onUpdate:modelValue":e[0]||(e[0]=v=>a(i).property=v),libs:a(c),"preview-url":a(b),"show-navigation-bar":a(l)!==0,"show-page-config":a(l)!==0,"show-tab-bar":a(l)===0,title:a(s)[a(l)].name,onReset:M,onSave:D},{toolBarLeft:d(()=>[w(R,{"model-value":a(l),class:"h-full!",onChange:$},{default:d(()=>[(g(!0),X(Y,null,Z(a(s),(v,S)=>(g(),k(P,{key:S,content:v.name},{default:d(()=>[w(B,{value:S},{default:d(()=>[w(o,{icon:v.icon,size:24},null,8,["icon"])]),_:2},1032,["value"])]),_:2},1032,["content"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","libs","preview-url","show-navigation-bar","show-page-config","show-tab-bar","title"])):W("",!0)}}});export{ee as default};
