import{d as E,_ as H,W as N,c as O}from"./index-D_TWD7wt.js";import{g as R,f as U}from"./file-DDqGaN1G.js";import{f as D,H as J}from"./form-designer-DHHJWkD5.js";import{l as L,r as m,b as W,L as G,m as f,q as n,A as k,E as v,x as o,D as C,u as t,B as F,J as w,H as z,I as K,$ as P}from"./form-create-_84fGzaM.js";const Q={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-10px px-1 rounded-8px min-w-4 h-4 flex items-center justify-center leading-none font-medium"},X=["accept"],Y={class:"max-h-200px overflow-y-auto file-list"},Z={class:"flex items-center flex-1 min-w-0"},ee={class:"font-medium text-gray-900 mr-1 overflow-hidden text-ellipsis whitespace-nowrap flex-1"},le={class:"text-gray-500 flex-shrink-0 text-11px"},ae={class:"flex items-center gap-1 flex-shrink-0 ml-2"},se=O(L({name:"MessageFileUpload",__name:"MessageFileUpload",props:{modelValue:{type:Array,default:()=>[]},limit:{type:Number,default:5},maxSize:{type:Number,default:10},acceptTypes:{type:String,default:".jpg,.jpeg,.png,.gif,.webp,.pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx,.csv,.md"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","upload-success","upload-error"],setup(c,{expose:S,emit:V}){const d=c,x=V,M=m(),a=m([]),u=m([]),y=m(!1),r=m(null),h=E(),{httpRequest:A}=N();W(()=>d.modelValue,e=>{u.value=[...e],e.length===0&&(a.value=[])},{immediate:!0,deep:!0});const _=()=>{var e;(e=M.value)==null||e.click()},I=()=>{r.value&&(clearTimeout(r.value),r.value=null),y.value=!0},T=()=>{r.value=setTimeout(()=>{y.value=!1,r.value=null},300)},B=e=>{const s=e.target,l=Array.from(s.files||[]);if(l.length!==0){if(l.length+a.value.length>d.limit)return h.error(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20 ${d.limit} \u4E2A\u6587\u4EF6`),void(s.value="");l.forEach(i=>{if(i.size>1024*d.maxSize*1024)return void h.error(`\u6587\u4EF6 ${i.name} \u5927\u5C0F\u8D85\u8FC7 ${d.maxSize}MB`);const g={name:i.name,size:i.size,uploading:!0,progress:0,raw:i};a.value.push(g),q(g)}),s.value=""}},q=async e=>{try{const s=setInterval(()=>{e.progress<90&&(e.progress=(e.progress||0)+10*Math.random())},100),l=await A({file:e.raw,filename:e.name});e.uploading=!1,e.progress=100,e.url=l.data,u.value.push(e.url),clearInterval(s),x("upload-success",e),b()}catch(s){e.uploading=!1,h.error(`\u6587\u4EF6 ${e.name} \u4E0A\u4F20\u5931\u8D25`),x("upload-error",s);const l=a.value.indexOf(e);l>-1&&$(l)}},$=e=>{const s=a.value[e];if(a.value.splice(e,1),s.url){const l=u.value.indexOf(s.url);l>-1&&u.value.splice(l,1)}b()},b=()=>{x("update:modelValue",[...u.value])};return S({triggerFileInput:_,clearFiles:()=>{a.value=[],u.value=[],b()}}),G(()=>{r.value&&clearTimeout(r.value)}),(e,s)=>{const l=H,i=D,g=J;return n(),f("div",{class:"relative inline-block",onMouseenter:I,onMouseleave:T},[c.disabled?v("",!0):(n(),k(i,{key:0,circle:"",size:"small",class:C(["upload-btn relative transition-all-200ms",{"has-files":t(a).length>0}]),onClick:_,disabled:t(a).length>=c.limit},{default:F(()=>[w(l,{icon:"ep:paperclip",size:16}),t(a).length>0?(n(),f("span",Q,z(t(a).length),1)):v("",!0)]),_:1},8,["class","disabled"])),o("input",{ref_key:"fileInputRef",ref:M,type:"file",multiple:"",style:{display:"none"},accept:c.acceptTypes,onChange:B},null,40,X),t(a).length>0&&t(y)?(n(),f("div",{key:1,class:"file-tooltip",onMouseenter:I,onMouseleave:T},[s[0]||(s[0]=o("div",{class:"tooltip-arrow"},null,-1)),o("div",Y,[(n(!0),f(K,null,P(t(a),(p,j)=>(n(),f("div",{key:j,class:C(["flex items-center justify-between p-2 mb-1 bg-gray-50 rounded-6px text-12px transition-all-200ms last:mb-0 hover:bg-gray-100",{"opacity-70":p.uploading}])},[o("div",Z,[w(l,{icon:t(R)(p.name),class:"text-blue-500 mr-2 flex-shrink-0"},null,8,["icon"]),o("span",ee,z(p.name),1),o("span",le,"("+z(t(U)(p.size))+")",1)]),o("div",ae,[p.uploading?(n(),k(g,{key:0,percentage:p.progress||0,"show-text":!1,size:"small",class:"w-60px"},null,8,["percentage"])):c.disabled?v("",!0):(n(),k(i,{key:1,link:"",type:"danger",size:"small",onClick:te=>$(j)},{default:F(()=>[w(l,{icon:"ep:close",size:12})]),_:2},1032,["onClick"]))])],2))),128))])],32)):v("",!0)],32)}}}),[["__scopeId","data-v-f5173ed6"]]);export{se as default};
