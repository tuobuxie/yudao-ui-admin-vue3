import{_ as j}from"./Dialog.vue_vue_type_style_index_0_lang-D3YOFsHs.js";import{X as c,d as q}from"./index-DzK2S43K.js";import{a as C}from"./index-Kq3kgCoJ.js";import{h as F,aj as z,k as B,x as G,Q as L,f as Q}from"./form-designer-DHHJWkD5.js";import{l as R,r as m,j as X,A as w,q as y,B as r,J as t,u as d,h as b,m as $,I as D,$ as E,G as k}from"./form-create-_84fGzaM.js";const U={getMessageTemplateList:async u=>await c.get({url:"/mp/message-template/list",params:u}),deleteMessageTemplate:async u=>await c.delete({url:"/mp/message-template/delete?id="+u}),syncMessageTemplate:async u=>await c.post({url:"/mp/message-template/sync?accountId="+u}),sendMessageTemplate:async u=>await c.post({url:"/mp/message-template/send",data:u})},H=R({__name:"MessageTemplateSendForm",setup(u,{expose:A}){const h=q(),i=m(!1),f=m(!1),n=m(""),v=m(),g=m(),o=m({id:void 0,userId:void 0,data:"",url:"",miniProgramAppId:"",miniProgramPagePath:""}),M=X({userId:[{required:!0,message:"\u8BF7\u9009\u62E9\u7528\u6237",trigger:"change"}]}),P=m(!1),V=m([]),I=async l=>{if(v.value){P.value=!0;try{const a=await C({pageNo:1,pageSize:20,accountId:v.value,nickname:l||void 0});V.value=a.list||[]}finally{P.value=!1}}};A({open:async l=>{S(),i.value=!0,o.value.id=l.id,v.value=l.accountId,n.value=l.title,await I("")}});const x=async()=>{if(g.value&&await g.value.validate()){f.value=!0;try{const l={...o.value};if(l.miniProgramAppId&&l.miniProgramPagePath&&(l.miniprogram=JSON.stringify({appid:l.miniProgramAppId,pagepath:l.miniProgramPagePath})),l.data)try{l.data=JSON.parse(l.data)}catch{return void h.error("\u6A21\u677F\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u8F93\u5165\u6709\u6548\u7684 JSON \u683C\u5F0F")}await U.sendMessageTemplate(l),h.success("\u53D1\u9001\u6210\u529F"),i.value=!1}finally{f.value=!1}}},S=()=>{var l;o.value={id:void 0,userId:void 0,data:"",url:"",miniProgramAppId:"",miniProgramPagePath:""},V.value=[],(l=g.value)==null||l.resetFields()};return(l,a)=>{const p=B,s=z,T=L,J=G,N=F,_=Q,O=j;return y(),w(O,{title:"\u53D1\u9001\u6D88\u606F\u6A21\u677F",modelValue:d(i),"onUpdate:modelValue":a[8]||(a[8]=e=>b(i)?i.value=e:null),width:"600px"},{footer:r(()=>[t(_,{type:"primary",onClick:x,loading:d(f)},{default:r(()=>a[9]||(a[9]=[k("\u53D1 \u9001")])),_:1},8,["loading"]),t(_,{onClick:a[7]||(a[7]=e=>i.value=!1)},{default:r(()=>a[10]||(a[10]=[k("\u53D6 \u6D88")])),_:1})]),default:r(()=>[t(N,{ref_key:"formRef",ref:g,model:d(o),rules:d(M),"label-width":"120px"},{default:r(()=>[t(s,{label:"\u6A21\u677F\u7F16\u53F7"},{default:r(()=>[t(p,{modelValue:d(o).id,"onUpdate:modelValue":a[0]||(a[0]=e=>d(o).id=e),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"\u6A21\u677F\u6807\u9898"},{default:r(()=>[t(p,{modelValue:d(n),"onUpdate:modelValue":a[1]||(a[1]=e=>b(n)?n.value=e:null),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"\u7528\u6237",prop:"userId"},{default:r(()=>[t(J,{modelValue:d(o).userId,"onUpdate:modelValue":a[2]||(a[2]=e=>d(o).userId=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6635\u79F0\u641C\u7D22","remote-method":I,loading:d(P),class:"!w-full"},{default:r(()=>[(y(!0),$(D,null,E(d(V),e=>(y(),w(T,{key:e.id,label:e.nickname||e.openid,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(s,{label:"\u6A21\u677F\u6570\u636E",prop:"data"},{default:r(()=>[t(p,{modelValue:d(o).data,"onUpdate:modelValue":a[3]||(a[3]=e=>d(o).data=e),type:"textarea",rows:4,placeholder:'\u8BF7\u8F93\u5165\u6A21\u677F\u6570\u636E\uFF08JSON \u683C\u5F0F\uFF09\uFF0C\u4F8B\u5982\uFF1A{"keyword1": {"value": "\u6D4B\u8BD5\u5185\u5BB9"}}'},null,8,["modelValue"])]),_:1}),t(s,{label:"\u8DF3\u8F6C\u94FE\u63A5",prop:"url"},{default:r(()=>[t(p,{modelValue:d(o).url,"onUpdate:modelValue":a[4]||(a[4]=e=>d(o).url=e),placeholder:"\u8BF7\u8F93\u5165\u8DF3\u8F6C\u94FE\u63A5"},null,8,["modelValue"])]),_:1}),t(s,{label:"\u5C0F\u7A0B\u5E8F appId",prop:"miniProgramAppId"},{default:r(()=>[t(p,{modelValue:d(o).miniProgramAppId,"onUpdate:modelValue":a[5]||(a[5]=e=>d(o).miniProgramAppId=e),placeholder:"\u8BF7\u8F93\u5165\u5C0F\u7A0B\u5E8F appId"},null,8,["modelValue"])]),_:1}),t(s,{label:"\u5C0F\u7A0B\u5E8F\u9875\u9762\u8DEF\u5F84",prop:"miniProgramPagePath"},{default:r(()=>[t(p,{modelValue:d(o).miniProgramPagePath,"onUpdate:modelValue":a[6]||(a[6]=e=>d(o).miniProgramPagePath=e),placeholder:"\u8BF7\u8F93\u5165\u5C0F\u7A0B\u5E8F\u9875\u9762\u8DEF\u5F84"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});export{U as M,H as _};
