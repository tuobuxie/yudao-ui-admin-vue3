import{e as oe,d as ae,_ as te,aK as re,c as se}from"./index-DmQdxAiK.js";import{_ as le}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{b as ie}from"./index-6gTZpT9M.js";import{i as ne}from"./index-gF9XQK0o.js";import{C as ce}from"./index-UrKDy54_.js";import pe from"./ProcessDefinitionDetail-wqDCOv9M.js";import{b1 as fe,k as me,ak as ue,i as de,j as ve,e as ye,o as xe,ad as ge,al as he,a7 as ke,aU as be}from"./form-designer-DHHJWkD5.js";import{l as _e,g as we,r as c,c as R,e as Ce,m,A as g,u as i,q as r,J as u,C as Ie,B as n,h as $e,x as _,I as $,$ as B,D as U,H as D,G as De,n as Te}from"./form-create-_84fGzaM.js";import"./formCreate-BIGK0pmc.js";import"./constants-C3gLHYOK.js";import"./consts-CvaDWb4S.js";import"./ProcessInstanceBpmnViewer-Be865-Nx.js";import"./bpmn-embedded-B03mYb7T.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./XTextButton-CXU1Athx.js";import"./XButton-BH0HlMtk.js";import"./index-DWAKVBMX.js";import"./index-oJNTIjFE.js";import"./node-D3mIdOYQ.js";import"./index-DX-DzHIf.js";import"./index-BCN8BzfC.js";import"./utils-DciZ0SJK.js";import"./index-D29lUHab.js";import"./tree-COGD3qag.js";import"./index-EzkaYqZE.js";import"./index-CuiPf8R-.js";import"./index-hYLD56hJ.js";import"./index-C8HfUSOZ.js";import"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import"./index-DOsjFOOh.js";import"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import"./index-B6R_oMDY.js";import"./formatTime-BGPGB_ys.js";import"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-CJU0J-Mv.js";import"./simple-process-designer-D6s0X7s1.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-CKlTSlHM.js";import"./index-0Ok0c-x7.js";import"./download-oWiM5xVU.js";import"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-D2CEEcsv.js";import"./index-BhHRYVfS.js";import"./tagsView-CQDzb46U.js";const Pe={class:"flex flex-col"},Ve=["onClick"],ze={class:"text-18px font-bold mb-10px mt-5px"},Be={class:"grid grid-cols-3 gap3"},Le={class:"flex"},Se={key:1,class:"flow-icon"},je={style:{"font-size":"12px",color:"#fff"}},qe=se(_e({name:"BpmProcessInstanceCreate",__name:"index",setup(Fe){const{proxy:T}=we(),W=oe(),L=ae(),h=c(""),w=W.query.processInstanceId,P=c(!0),p=c([]),d=c({}),v=c([]),A=async()=>{try{p.value=await ce.getCategorySimpleList()}finally{}},E=async()=>{var e;try{v.value=await ie({suspensionState:1}),y.value=v.value,z.value.length>0&&!((e=d.value)!=null&&e.code)&&(d.value=z.value[0])}finally{}},y=c([]),S=()=>{h.value.trim()?y.value=v.value.filter(e=>e.name.toLowerCase().includes(h.value.toLowerCase())):y.value=v.value},V=R(()=>{var a;if(!((a=v.value)!=null&&a.length))return{};const e=fe(y.value,"category"),o={};return p.value.forEach(t=>{e[t.code]&&(o[t.code]=e[t.code])}),o}),G=e=>{var o,a;return(a=(o=p.value)==null?void 0:o.find(t=>t.code===e))==null?void 0:a.name},C=c(),j=c(),q=async(e,o)=>{var a;C.value=e,await Te(),(a=j.value)==null||a.initProcessInfo(e,o)},H=e=>{const o=e.scrollTop,a=p.value.map(l=>{const f=T.$refs[`category-${l.code}`];return f!=null&&f[0]?{code:l.code,offsetTop:f[0].offsetTop,height:f[0].offsetHeight}:null}).filter(Boolean);let t=a[0];for(const l of a){if(!(o>=l.offsetTop-50))break;t=l}t&&d.value.code!==t.code&&(d.value=p.value.find(l=>l.code===t.code))},z=R(()=>{var o;if(!((o=p.value)!=null&&o.length)||!V.value)return[];const e=Object.keys(V.value);return p.value.filter(a=>e.includes(a.code))});return Ce(()=>{(async()=>{P.value=!0;try{if(await A(),await E(),(w==null?void 0:w.length)>0){const e=await ne(w);if(!e)return void L.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const o=v.value.find(a=>{var t;return a.key==((t=e.processDefinition)==null?void 0:t.key)});if(!o)return void L.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await q(o,e.formVariables)}}finally{P.value=!1}})()}),(e,o)=>{var F;const a=te,t=me,l=ve,f=he,J=ke,K=ge,M=xe,O=ye,N=de,X=be,Y=le,Z=ue;return i(C)?(r(),g(pe,{key:1,ref_key:"processDefinitionDetailRef",ref:j,selectProcessDefinition:i(C),onCancel:o[1]||(o[1]=k=>C.value=void 0)},null,8,["selectProcessDefinition"])):(r(),m($,{key:0},[u(t,{modelValue:i(h),"onUpdate:modelValue":o[0]||(o[0]=k=>$e(h)?h.value=k:null),class:"!w-50% mb-15px",placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onInput:S,onClear:S},{prefix:n(()=>[u(a,{icon:"ep:search"})]),_:1},8,["modelValue"]),Ie((r(),g(Y,{class:U([{"process-definition-container":(F=i(y))==null?void 0:F.length},"position-relative pb-20px h-700px"])},{default:n(()=>{var k;return[(k=i(y))!=null&&k.length?(r(),g(N,{key:0,gutter:20,class:"!flex-nowrap"},{default:n(()=>[u(l,{span:5},{default:n(()=>[_("div",Pe,[(r(!0),m($,null,B(i(z),x=>(r(),m("div",{key:x.code,class:U(["flex items-center p-10px cursor-pointer text-14px rounded-md",i(d).code===x.code?"text-#3e7bff bg-#e8eeff":""]),onClick:I=>(s=>{d.value=s;const b=T.$refs[`category-${s.code}`];if(b!=null&&b.length){const Q=T.$refs.scrollWrapper,ee=b[0].offsetTop;Q.scrollTo({top:ee,behavior:"smooth"})}})(x)},D(x.name),11,Ve))),128))])]),_:1}),u(l,{span:19},{default:n(()=>[u(O,{ref:"scrollWrapper",height:"700",onScroll:H},{default:n(()=>[(r(!0),m($,null,B(i(V),(x,I)=>(r(),m("div",{class:"mb-20px pl-10px",key:I,ref_for:!0,ref:`category-${I}`},[_("h3",ze,D(G(I)),1),_("div",Be,[(r(!0),m($,null,B(x,s=>(r(),g(M,{key:s.id,content:s.description,disabled:!s.description||s.description.trim().length===0,placement:"top"},{default:n(()=>[u(K,{shadow:"hover",class:"cursor-pointer definition-item-card",onClick:b=>q(s)},{default:n(()=>[_("div",Le,[s.icon?(r(),g(f,{key:0,src:s.icon,class:"w-32px h-32px"},null,8,["src"])):(r(),m("div",Se,[_("span",je,D(i(re)(s.name,0,2)),1)])),u(J,{class:"!ml-10px",size:"large"},{default:n(()=>[De(D(s.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1032,["content","disabled"]))),128))])]))),128))]),_:1},512)]),_:1})]),_:1})):(r(),g(X,{key:1,class:"!py-200px","image-size":200,description:"\u6CA1\u6709\u627E\u5230\u641C\u7D22\u7ED3\u679C"}))]}),_:1},8,["class"])),[[Z,i(P)]])],64))}}}),[["__scopeId","data-v-e5f839f6"]]);export{qe as default};
