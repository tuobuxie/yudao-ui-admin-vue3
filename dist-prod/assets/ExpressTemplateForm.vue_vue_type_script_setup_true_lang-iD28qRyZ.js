import{a as Z,d as z,h as K,D as L,_ as N,H as P,aX as y}from"./index-DmQdxAiK.js";import{_ as Q}from"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import{a as W,c as Y,u as ee}from"./index-DDRni0EP.js";import{g as ae}from"./index-Bb5a1IaL.js";import{d as le}from"./tree-COGD3qag.js";import{h as te,aj as re,k as oe,s as ue,u as se,Z as de,_ as ne,m as ie,l as ce,f as me,ak as pe,K as fe}from"./form-designer-DHHJWkD5.js";import{l as ge,r as i,j as Ve,e as Ce,A as U,q as b,B as t,C as he,u as r,J as a,m as ve,I as _e,$ as be,G as p,H as xe,h as we}from"./form-create-_84fGzaM.js";const Pe=ge({__name:"ExpressTemplateForm",emits:["success"],setup(ye,{expose:G,emit:H}){const{t:x}=Z(),k=z(),T={...le,multiple:!0},f=i(!1),E=i(""),g=i(!1),M=i(""),o=i({id:void 0,name:"",chargeMode:1,sort:0,charges:[],frees:[]}),V=new Map,C=i({startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),R=Ve({name:[{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],chargeMode:[{required:!0,message:"\u914D\u9001\u8BA1\u8D39\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sort:[{required:!0,message:"\u5206\u7C7B\u6392\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i();G({open:async(s,l)=>{f.value=!0,E.value=x("action."+s),M.value=s,A();try{l&&(g.value=!0,o.value=await W(l),C.value=V.get(o.value.chargeMode),o.value.charges.forEach(n=>{n.startPrice=P(n.startPrice),n.extraPrice=P(n.extraPrice)}),o.value.frees.forEach(n=>{n.freePrice=P(n.freePrice)}))}finally{g.value=!1}}});const $=H,j=async()=>{if(_&&await _.value.validate()){g.value=!0;try{const s=fe(o.value);s.charges.forEach(l=>{l.startPrice=y(l.startPrice),l.extraPrice=y(l.extraPrice)}),s.frees.forEach(l=>{l.freePrice=y(l.freePrice)}),M.value==="create"?(await Y(s),k.success(x("common.createSuccess"))):(await ee(s),k.success(x("common.updateSuccess"))),f.value=!1,$("success")}finally{g.value=!1}}},A=()=>{var s;o.value={id:void 0,name:"",chargeMode:1,charges:[{areaIds:[1],startCount:2,startPrice:5,extraCount:5,extraPrice:10}],frees:[],sort:0},C.value=V.get(1),(s=_.value)==null||s.resetFields()},D=s=>{C.value=V.get(s)},w=i([]);return Ce(()=>{(async()=>(V.set(1,{startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),V.set(2,{startCountTitle:"\u9996\u4EF6\u91CD\u91CF(kg)",extraCountTitle:"\u7EED\u4EF6\u91CD\u91CF(kg)",freeCountTitle:"\u5305\u90AE\u91CD\u91CF(kg)"}),V.set(3,{startCountTitle:"\u9996\u4EF6\u4F53\u79EF(m\xB3)",extraCountTitle:"\u7EED\u4EF6\u4F53\u79EF(m\xB3)",freeCountTitle:"\u5305\u90AE\u4F53\u79EF(m\xB3)"}),w.value=await ae()))()}),(s,l)=>{const n=oe,c=re,F=se,X=ue,I=ie,d=ne,m=ce,h=me,q=de,S=N,B=te,J=Q,O=pe;return b(),U(J,{title:r(E),modelValue:r(f),"onUpdate:modelValue":l[6]||(l[6]=e=>we(f)?f.value=e:null),width:"1300px"},{footer:t(()=>[a(h,{onClick:j,type:"primary",disabled:r(g)},{default:t(()=>l[11]||(l[11]=[p("\u786E \u5B9A")])),_:1},8,["disabled"]),a(h,{onClick:l[5]||(l[5]=e=>f.value=!1)},{default:t(()=>l[12]||(l[12]=[p("\u53D6 \u6D88")])),_:1})]),default:t(()=>[he((b(),U(B,{ref_key:"formRef",ref:_,model:r(o),rules:r(R),"label-width":"80px"},{default:t(()=>[a(c,{label:"\u6A21\u677F\u540D\u79F0",prop:"name"},{default:t(()=>[a(n,{modelValue:r(o).name,"onUpdate:modelValue":l[0]||(l[0]=e=>r(o).name=e),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(c,{label:"\u8BA1\u8D39\u65B9\u5F0F",prop:"chargeMode"},{default:t(()=>[a(X,{modelValue:r(o).chargeMode,"onUpdate:modelValue":l[1]||(l[1]=e=>r(o).chargeMode=e),onChange:D},{default:t(()=>[(b(!0),ve(_e,null,be(r(K)(r(L).EXPRESS_CHARGE_MODE),e=>(b(),U(F,{key:e.value,value:e.value},{default:t(()=>[p(xe(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"\u8FD0\u8D39",prop:"charges"},{default:t(()=>[a(q,{border:"",style:{width:"100%"},data:r(o).charges},{default:t(()=>[a(d,{align:"center",label:"\u533A\u57DF",width:"360"},{default:t(({row:e})=>[a(I,{modelValue:e.areaIds,"onUpdate:modelValue":u=>e.areaIds=u,options:r(w),props:T,class:"w-1/1",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5730\u533A",filterable:"","collapse-tags":""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(d,{align:"center",label:r(C).startCountTitle,width:"180",prop:"startCount"},{default:t(({row:e})=>[a(m,{modelValue:e.startCount,"onUpdate:modelValue":u=>e.startCount=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{width:"180",align:"center",label:"\u8FD0\u8D39(\u5143)",prop:"startPrice"},{default:t(({row:e})=>[a(m,{modelValue:e.startPrice,"onUpdate:modelValue":u=>e.startPrice=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{width:"180",align:"center",label:r(C).extraCountTitle,prop:"extraCount"},{default:t(({row:e})=>[a(m,{modelValue:e.extraCount,"onUpdate:modelValue":u=>e.extraCount=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{width:"180",align:"center",label:"\u7EED\u8D39(\u5143)",prop:"extraPrice"},{default:t(({row:e})=>[a(m,{modelValue:e.extraPrice,"onUpdate:modelValue":u=>e.extraPrice=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{label:"\u64CD\u4F5C",align:"center"},{default:t(e=>[a(h,{link:"",type:"danger",onClick:u=>{return v=e.$index,void o.value.charges.splice(v,1);var v}},{default:t(()=>l[7]||(l[7]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(c,null,{default:t(()=>[a(h,{type:"primary",plain:"",onClick:l[2]||(l[2]=e=>{o.value.charges.push({areaIds:[],startCount:1,startPrice:1,extraCount:1,extraPrice:1})})},{default:t(()=>[a(S,{icon:"ep:plus",class:"mr-5px"}),l[8]||(l[8]=p(" \u6DFB\u52A0\u533A\u57DF "))]),_:1})]),_:1}),a(c,{label:"\u5305\u90AE\u533A\u57DF",prop:"frees"},{default:t(()=>[a(q,{border:"",style:{width:"100%"},data:r(o).frees},{default:t(()=>[a(d,{align:"center",label:"\u533A\u57DF",width:"360"},{default:t(({row:e})=>[a(I,{modelValue:e.areaIds,"onUpdate:modelValue":u=>e.areaIds=u,options:r(w),props:T,class:"w-1/1",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B",filterable:"","collapse-tags":""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(d,{align:"center",label:r(C).freeCountTitle,prop:"freeCount"},{default:t(({row:e})=>[a(m,{modelValue:e.freeCount,"onUpdate:modelValue":u=>e.freeCount=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(d,{align:"center",label:"\u5305\u90AE\u91D1\u989D\uFF08\u5143\uFF09",prop:"freePrice"},{default:t(({row:e})=>[a(m,{modelValue:e.freePrice,"onUpdate:modelValue":u=>e.freePrice=u,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{label:"\u64CD\u4F5C",align:"center"},{default:t(e=>[a(h,{link:"",type:"danger",onClick:u=>{return v=e.$index,void o.value.frees.splice(v,1);var v}},{default:t(()=>l[9]||(l[9]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(c,null,{default:t(()=>[a(h,{type:"primary",plain:"",onClick:l[3]||(l[3]=e=>{o.value.frees.push({areaIds:[],freeCount:1,freePrice:1})})},{default:t(()=>[a(S,{icon:"ep:plus",class:"mr-5px"}),l[10]||(l[10]=p(" \u6DFB\u52A0\u533A\u57DF "))]),_:1})]),_:1}),a(c,{label:"\u6392\u5E8F",prop:"sort"},{default:t(()=>[a(m,{modelValue:r(o).sort,"onUpdate:modelValue":l[4]||(l[4]=e=>r(o).sort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[O,r(g)]])]),_:1},8,["title","modelValue"])}}});export{Pe as _};
