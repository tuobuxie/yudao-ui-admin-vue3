import{p as M,a as N,d as O}from"./index-B2urM1q-.js";import{l as T,r as p,c as W,b as X,m as z,q as v,I as A,$ as V,A as B,B as r,x as I,J as d,G as f,H as L,C as P,Z as Y,u as y,h as g,K as R}from"./form-create-_84fGzaM.js";import{c as ee,b as ae}from"./property-BIAOrm2P.js";import{j as le,a7 as se,a6 as ue,x as te,Q as ne,f as oe,V as ie}from"./form-designer-DHHJWkD5.js";const re=T({name:"ProductAttributes",__name:"ProductAttributes",props:{propertyList:{type:Array,default:()=>{}},isDetail:M.bool.def(!1)},emits:["success"],setup(b,{emit:$}){const{t:j}=N(),_=O(),s=p(""),c=p(null),D=W(()=>e=>c.value!==null&&(c.value===e||void 0)),C=p([]),q=e=>{e!=null&&(C.value.some(l=>{var o,t;return((o=l.inputRef)==null?void 0:o.attributes.id)===((t=e.inputRef)==null?void 0:t.attributes.id)})||C.value.push(e))},u=p([]),h=p([]),G=b;X(()=>G.propertyList,e=>{e&&(u.value=e)},{deep:!0,immediate:!0});const w=$,x=async(e,l)=>{if(s.value){if(u.value[e].values.find(t=>t.name===s.value))return _.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u5C5E\u6027\u503C\uFF0C\u8BF7\u91CD\u8BD5"),c.value=null,void(s.value="");const o=h.value.find(t=>t.name===s.value);if(o)return c.value=null,s.value="",u.value[e].values.push({id:o.id,name:o.name}),void w("success",u.value);try{const t=await ee({propertyId:l,name:s.value});u.value[e].values.push({id:t,name:s.value}),_.success(j("common.createSuccess")),w("success",u.value)}catch{_.error("\u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}c.value=null,s.value=""},H=async e=>{h.value=await ae(e)};return(e,l)=>{const o=se,t=ue,J=ne,Q=te,S=oe,U=ie,Z=le;return v(!0),z(A,null,V(y(u),(m,n)=>(v(),B(Z,{key:n},{default:r(()=>[I("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[1]||(l[1]=[f("\u5C5E\u6027\u540D\uFF1A")])),_:1}),d(t,{closable:!b.isDetail,class:"mx-1",type:"success",onClose:a=>(i=>{var k;(k=u.value)==null||k.splice(i,1),w("success",u.value)})(n)},{default:r(()=>[f(L(m.name),1)]),_:2},1032,["closable","onClose"])]),I("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[2]||(l[2]=[f("\u5C5E\u6027\u503C\uFF1A")])),_:1}),(v(!0),z(A,null,V(m.values,(a,i)=>(v(),B(t,{key:a.id,closable:!b.isDetail,class:"mx-1",onClose:k=>((E,F)=>{var K;(K=u.value[E].values)==null||K.splice(F,1)})(n,i)},{default:r(()=>[f(L(a.name),1)]),_:2},1032,["closable","onClose"]))),128)),P(d(Q,{id:`input${n}`,ref_for:!0,ref:q,modelValue:y(s),"onUpdate:modelValue":l[0]||(l[0]=a=>g(s)?s.value=a:null),"reserve-keyword":!1,"allow-create":"",class:"!w-30","default-first-option":"",filterable:"",size:"small",onBlur:a=>x(n,m.id),onChange:a=>x(n,m.id),onKeyup:Y(a=>x(n,m.id),["enter"])},{default:r(()=>[(v(!0),z(A,null,V(y(h),a=>(v(),B(J,{key:a.id,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:2},1032,["id","modelValue","onBlur","onChange","onKeyup"]),[[R,y(D)(n)]]),P(d(S,{class:"button-new-tag ml-1",size:"small",onClick:a=>(async i=>{c.value=i,C.value[i].focus(),await H(u.value[i].id)})(n)},{default:r(()=>l[3]||(l[3]=[f(" + \u6DFB\u52A0 ")])),_:2},1032,["onClick"]),[[R,!y(D)(n)]])]),d(U,{class:"my-10px"})]),_:2},1024))),128)}}});export{re as _};
