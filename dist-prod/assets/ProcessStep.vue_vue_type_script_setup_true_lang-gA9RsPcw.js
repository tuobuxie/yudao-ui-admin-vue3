import{_ as k}from"./index-DzK2S43K.js";import{K as _}from"./index-BritCNRd.js";import{H as B,f as C}from"./form-designer-DHHJWkD5.js";import{l as P,i as j,r as q,c as H,e as I,P as K,m,q as p,x as r,I as S,$ as T,J as x,H as y,B as G,G as J,u as V}from"./form-create-_84fGzaM.js";const L={class:"mt-15px grid grid-cols-1 gap-2"},M={class:"flex items-center min-w-[200px] mr-10px"},O={class:"text-[13px] text-[#303133] break-all"},$={class:"flex-1"},z={class:"ml-10px text-[13px] text-[#606266]"},A={class:"flex justify-end mt-20px"},D=P({__name:"ProcessStep",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(f,{emit:b}){const l=f,g=b,n=j("parent"),d=q(null),u=e=>e.progress===100,v=H(()=>l.modelValue.list.every(e=>u(e))),w=()=>{var e;(e=n==null?void 0:n.exposed)!=null&&e.handleBack&&n.exposed.handleBack()},c=async()=>{try{const e=l.modelValue.list.filter(s=>s.id).map(s=>s.id);if(e.length===0)return;const o=await _.getKnowledgeSegmentProcessList(e),i=l.modelValue.list.map(s=>{const a=o.find(t=>t.documentId===s.id);if(a){const t=a.embeddingCount&&a.count?Math.floor(a.embeddingCount/a.count*100):0;return{...s,progress:t,count:a.count||0}}return s});g("update:modelValue",{...l.modelValue,list:i}),i.every(s=>u(s))||(d.value=window.setTimeout(c,3e3))}catch{d.value=window.setTimeout(c,5e3)}};return I(()=>{const e=l.modelValue.list.map(o=>({...o,progress:0}));g("update:modelValue",{...l.modelValue,list:e}),c()}),K(()=>{d.value&&(clearTimeout(d.value),d.value=null)}),(e,o)=>{const i=k,s=B,a=C;return p(),m("div",null,[r("div",L,[(p(!0),m(S,null,T(f.modelValue.list,(t,h)=>(p(),m("div",{key:h,class:"flex items-center py-4px px-12px border-l-4 border-l-[#409eff] rounded-sm shadow-sm hover:bg-[#ecf5ff] transition-all duration-300"},[r("div",M,[x(i,{icon:"ep:document",class:"mr-8px text-[#409eff]"}),r("span",O,y(t.name),1)]),r("div",$,[x(s,{percentage:t.progress||0,"stroke-width":10,status:u(t)?"success":""},null,8,["percentage","status"])]),r("div",z," \u5206\u6BB5\u6570\u91CF\uFF1A"+y(t.count?t.count:"-"),1)]))),128))]),r("div",A,[x(a,{type:V(v)?"success":"primary",disabled:!V(v),onClick:w},{default:G(()=>o[0]||(o[0]=[J(" \u5B8C\u6210 ")])),_:1},8,["type","disabled"])])])}}});export{D as _};
