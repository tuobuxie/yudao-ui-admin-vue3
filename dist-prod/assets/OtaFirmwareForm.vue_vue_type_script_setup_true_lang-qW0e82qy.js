import{a as G,d as J,Y as L,_ as R}from"./index-B2urM1q-.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{I as V}from"./index-h0sm20pm.js";import{P as D}from"./index-CHLLHQ4c.js";import{h as K,aj as Y,k as $,x as H,Q as M,P as N,ak as W,f as X}from"./form-designer-DHHJWkD5.js";import{l as Z,r as u,j as ee,A as c,q as t,B as o,C as le,u as e,J as d,E as _,m as b,I as F,$ as ae,G as g,h as re}from"./form-create-_84fGzaM.js";const oe={key:1},de=Z({name:"IoTOtaFirmwareForm",__name:"OtaFirmwareForm",emits:["success"],setup(ie,{expose:I,emit:x}){const{t:v}=G(),w=J(),m=u(!1),U=u(""),n=u(!1),p=u(""),k=u([]),a=u({id:void 0,name:void 0,description:void 0,version:void 0,productId:void 0,fileUrl:""}),q=ee({name:[{required:!0,message:"\u56FA\u4EF6\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],version:[{required:!0,message:"\u7248\u672C\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],fileUrl:[{required:!0,message:"\u56FA\u4EF6\u6587\u4EF6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),y=u();I({open:async(i,l)=>{if(m.value=!0,U.value=v("action."+i),p.value=i,S(),l){n.value=!0;try{a.value=await V.getOtaFirmware(l)}finally{n.value=!1}}k.value=await D.getSimpleProductList()}});const O=x,C=async()=>{await y.value.validate(),n.value=!0;try{const i=a.value;p.value==="create"?(await V.createOtaFirmware(i),w.success(v("common.createSuccess"))):(await V.updateOtaFirmware({id:i.id,name:i.name,description:i.description}),w.success(v("common.updateSuccess"))),m.value=!1,O("success")}finally{n.value=!1}},S=()=>{var i;a.value={id:void 0,name:void 0,description:void 0,version:void 0,productId:void 0,fileUrl:""},(i=y.value)==null||i.resetFields()};return(i,l)=>{const f=$,s=Y,z=M,P=H,j=R,Q=N,A=K,h=X,B=T,E=W;return t(),c(B,{title:e(U),modelValue:e(m),"onUpdate:modelValue":l[7]||(l[7]=r=>re(m)?m.value=r:null)},{footer:o(()=>[d(h,{onClick:C,type:"primary",disabled:e(n)},{default:o(()=>l[9]||(l[9]=[g("\u786E \u5B9A")])),_:1},8,["disabled"]),d(h,{onClick:l[6]||(l[6]=r=>m.value=!1)},{default:o(()=>l[10]||(l[10]=[g("\u53D6 \u6D88")])),_:1})]),default:o(()=>[le((t(),c(A,{ref_key:"formRef",ref:y,model:e(a),rules:e(q),"label-width":"100px"},{default:o(()=>[d(s,{label:"\u56FA\u4EF6\u540D\u79F0",prop:"name"},{default:o(()=>[d(f,{modelValue:e(a).name,"onUpdate:modelValue":l[0]||(l[0]=r=>e(a).name=r),placeholder:"\u8BF7\u8F93\u5165\u56FA\u4EF6\u540D\u79F0"},null,8,["modelValue"])]),_:1}),d(s,{label:"\u56FA\u4EF6\u63CF\u8FF0",prop:"description"},{default:o(()=>[d(f,{modelValue:e(a).description,"onUpdate:modelValue":l[1]||(l[1]=r=>e(a).description=r),type:"textarea",rows:3,placeholder:"\u8BF7\u8F93\u5165\u56FA\u4EF6\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),d(s,{label:"\u6240\u5C5E\u4EA7\u54C1",prop:"productId"},{default:o(()=>[d(P,{modelValue:e(a).productId,"onUpdate:modelValue":l[2]||(l[2]=r=>e(a).productId=r),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",class:"!w-100%",disabled:e(p)==="update"},{default:o(()=>[(t(!0),b(F,null,ae(e(k),r=>(t(),c(z,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(p)==="create"?(t(),c(s,{key:0,label:"\u7248\u672C\u53F7",prop:"version"},{default:o(()=>[d(f,{modelValue:e(a).version,"onUpdate:modelValue":l[3]||(l[3]=r=>e(a).version=r),placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7"},null,8,["modelValue"])]),_:1})):_("",!0),e(p)==="create"?(t(),c(s,{key:1,label:"\u56FA\u4EF6\u6587\u4EF6",prop:"fileUrl"},{default:o(()=>[d(e(L),{modelValue:e(a).fileUrl,"onUpdate:modelValue":l[4]||(l[4]=r=>e(a).fileUrl=r),"file-type":["bin","zip","pdf"],"file-size":50,limit:1},null,8,["modelValue"])]),_:1})):_("",!0),e(p)==="update"?(t(),b(F,{key:2},[d(s,{label:"\u7248\u672C\u53F7"},{default:o(()=>[d(f,{modelValue:e(a).version,"onUpdate:modelValue":l[5]||(l[5]=r=>e(a).version=r),readonly:""},null,8,["modelValue"])]),_:1}),d(s,{label:"\u56FA\u4EF6\u6587\u4EF6"},{default:o(()=>[e(a).fileUrl?(t(),c(Q,{key:0,type:"primary",href:e(a).fileUrl,target:"_blank",download:""},{default:o(()=>[d(j,{icon:"ep:download",class:"mr-5px"}),l[8]||(l[8]=g(" \u4E0B\u8F7D\u56FA\u4EF6\u6587\u4EF6 "))]),_:1},8,["href"])):(t(),b("span",oe,"\u65E0\u6587\u4EF6"))]),_:1})],64)):_("",!0)]),_:1},8,["model","rules"])),[[E,e(n)]])]),_:1},8,["title","modelValue"])}}});export{de as _};
