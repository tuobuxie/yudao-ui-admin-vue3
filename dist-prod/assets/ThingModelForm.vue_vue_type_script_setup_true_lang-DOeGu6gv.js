import{a as L,d as G,h as H,D as K,N as v}from"./index-DmQdxAiK.js";import{_ as j}from"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import{T as q}from"./ThingModelProperty-B5obN6Qu.js";import A from"./ThingModelService-CV6oShIl.js";import B from"./ThingModelEvent-BzN9ndq5.js";import{a as J,T as E}from"./index-DM2r8AcY.js";import{a as r,b as s,I as $}from"./constants-BFrNJh5I.js";import{ak as z,h as Q,aj as W,s as X,t as Z,k as ee,f as ae,K as le}from"./form-designer-DHHJWkD5.js";import{l as te,i as de,r as m,A as c,q as i,B as o,C as oe,u as l,J as p,E as I,m as pe,I as re,$ as se,G as h,H as ue,h as ie}from"./form-create-_84fGzaM.js";const ne=te({name:"IoTThingModelForm",__name:"ThingModelForm",emits:["success"],setup(me,{expose:k,emit:U}){const N=de($.PRODUCT),{t:T}=L(),R=G(),u=m(!1),S=m(""),n=m(!1),P=m(""),a=m({type:s.PROPERTY,dataType:r.INT,property:{dataType:r.INT,dataSpecs:{dataType:r.INT}},service:{},event:{}}),f=m();k({open:async(e,t)=>{if(u.value=!0,S.value=T("action."+e),P.value=e,C(),t){n.value=!0;try{a.value=await E.getThingModel(t),v(a.value.property)&&(a.value.dataType=r.INT,a.value.property={dataType:r.INT,dataSpecs:{dataType:r.INT}}),v(a.value.service)&&(a.value.service={}),v(a.value.event)&&(a.value.event={})}finally{n.value=!1}}},close:()=>u.value=!1});const g=U,O=async()=>{await f.value.validate(),n.value=!0;try{const e=le(a.value);e.productId=N.value.id,e.productKey=N.value.productKey,w(e),P.value==="create"?(await E.createThingModel(e),R.success(T("common.createSuccess"))):(await E.updateThingModel(e),R.success(T("common.updateSuccess"))),u.value=!1,g("success")}finally{n.value=!1}},w=e=>{e.type===s.PROPERTY&&(V(e.property),e.dataType=e.property.dataType,e.property.identifier=e.identifier,e.property.name=e.name,delete e.service,delete e.event),e.type===s.SERVICE&&(V(e.service),e.dataType=e.service.dataType,e.service.identifier=e.identifier,e.service.name=e.name,delete e.property,delete e.event),e.type===s.EVENT&&(V(e.event),e.dataType=e.event.dataType,e.event.identifier=e.identifier,e.event.name=e.name,delete e.property,delete e.service)},V=e=>{v(e.dataSpecs)&&delete e.dataSpecs,v(e.dataSpecsList)&&delete e.dataSpecsList},C=()=>{var e;a.value={type:s.PROPERTY,dataType:r.INT,property:{dataType:r.INT,dataSpecs:{dataType:r.INT}},service:{},event:{}},(e=f.value)==null||e.resetFields()};return(e,t)=>{const M=Z,x=X,y=W,_=ee,Y=Q,b=ae,D=j,F=z;return i(),c(D,{modelValue:l(u),"onUpdate:modelValue":t[8]||(t[8]=d=>ie(u)?u.value=d:null),title:l(S)},{footer:o(()=>[p(b,{disabled:l(n),type:"primary",onClick:O},{default:o(()=>t[9]||(t[9]=[h("\u786E \u5B9A")])),_:1},8,["disabled"]),p(b,{onClick:t[7]||(t[7]=d=>u.value=!1)},{default:o(()=>t[10]||(t[10]=[h("\u53D6 \u6D88")])),_:1})]),default:o(()=>[oe((i(),c(Y,{ref_key:"formRef",ref:f,model:l(a),rules:l(J),"label-width":"100px"},{default:o(()=>[p(y,{label:"\u529F\u80FD\u7C7B\u578B",prop:"type"},{default:o(()=>[p(x,{modelValue:l(a).type,"onUpdate:modelValue":t[0]||(t[0]=d=>l(a).type=d)},{default:o(()=>[(i(!0),pe(re,null,se(l(H)(l(K).IOT_THING_MODEL_TYPE),d=>(i(),c(M,{key:d.value,value:d.value},{default:o(()=>[h(ue(d.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(y,{label:"\u529F\u80FD\u540D\u79F0",prop:"name"},{default:o(()=>[p(_,{modelValue:l(a).name,"onUpdate:modelValue":t[1]||(t[1]=d=>l(a).name=d),placeholder:"\u8BF7\u8F93\u5165\u529F\u80FD\u540D\u79F0"},null,8,["modelValue"])]),_:1}),p(y,{label:"\u6807\u8BC6\u7B26",prop:"identifier"},{default:o(()=>[p(_,{modelValue:l(a).identifier,"onUpdate:modelValue":t[2]||(t[2]=d=>l(a).identifier=d),placeholder:"\u8BF7\u8F93\u5165\u6807\u8BC6\u7B26"},null,8,["modelValue"])]),_:1}),l(a).type===l(s).PROPERTY?(i(),c(q,{key:0,modelValue:l(a).property,"onUpdate:modelValue":t[3]||(t[3]=d=>l(a).property=d)},null,8,["modelValue"])):I("",!0),l(a).type===l(s).SERVICE?(i(),c(A,{key:1,modelValue:l(a).service,"onUpdate:modelValue":t[4]||(t[4]=d=>l(a).service=d)},null,8,["modelValue"])):I("",!0),l(a).type===l(s).EVENT?(i(),c(B,{key:2,modelValue:l(a).event,"onUpdate:modelValue":t[5]||(t[5]=d=>l(a).event=d)},null,8,["modelValue"])):I("",!0),p(y,{label:"\u63CF\u8FF0",prop:"description"},{default:o(()=>[p(_,{modelValue:l(a).description,"onUpdate:modelValue":t[6]||(t[6]=d=>l(a).description=d),maxlength:200,rows:3,placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027\u63CF\u8FF0",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[F,l(n)]])]),_:1},8,["modelValue","title"])}}});export{ne as _};
