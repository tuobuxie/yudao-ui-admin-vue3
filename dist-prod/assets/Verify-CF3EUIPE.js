import{a5 as Q,g as le,r as t,j as P,c as pe,b as ve,e as re,m as j,q as B,E as q,x as l,u as e,O as z,C as K,J as he,K as Z,B as de,D as ee,H as J,T as ge,n as se,I as fe,$ as ye,a8 as me,h as be,w as xe,G as we,A as Se,F as ke}from"./form-create-_84fGzaM.js";import{ao as A,a as te,ap as ne,aq as oe,c as ze}from"./index-DmQdxAiK.js";function R(i,y="XwKsGlMcdPMEhR1B"){const a=A.enc.Utf8.parse(y),v=A.enc.Utf8.parse(i);return A.AES.encrypt(v,a,{mode:A.mode.ECB,padding:A.pad.Pkcs7}).toString()}function ce(i){let y,a,v,m;const s=window,o=i.$el.parentNode.offsetWidth||s.offsetWidth,p=i.$el.parentNode.offsetHeight||s.offsetHeight;return y=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*o+"px":i.imgSize.width,a=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*p+"px":i.imgSize.height,v=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*o+"px":i.barSize.width,m=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*p+"px":i.barSize.height,{imgWidth:y,imgHeight:a,barWidth:v,barHeight:m}}const We={style:{position:"relative"}},Te=["src"],He=["textContent"],$e=["textContent"],Ie=["src"],Oe={style:{position:"relative"}},Ce={class:"verify-img-out"},Be=["src"],De={class:"verify-msg"},Ne={style:{position:"relative"}},Ve={class:"verify-img-out"},je=["src"],Ee={class:"verify-msg"},Je=["disabled"],Me={key:0,class:"verifybox-top"},Pe=ze({name:"Vue3Verify",components:{VerifySlide:{__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const y=i,{t:a}=te(),{mode:v,captchaType:m,type:s,blockSize:o,explain:p}=Q(y),{proxy:d}=le();let c=t(""),h=t(""),C=t(""),D=t(""),W=t(""),b=t(""),H=t(""),w=t(""),$=t(""),I=t(""),g=P({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),S=t(void 0),n=t(void 0),x=t(void 0),N=t("#ddd"),E=t(void 0),M=t("icon-right"),_=t(!1),k=t(!1),u=t(!0),T=t(""),O=t(""),X=t(0);const L=pe(()=>d.$el.querySelector(".verify-bar-area")),U=()=>{p.value===""?$.value=a("captcha.slide"):$.value=p.value,ue(),se(()=>{let{imgHeight:r,imgWidth:f,barHeight:V,barWidth:ae}=ce(d);g.imgHeight=r,g.imgWidth=f,g.barHeight=V,g.barWidth=ae,d.$parent.$emit("ready",d)}),window.removeEventListener("touchmove",function(r){G(r)}),window.removeEventListener("mousemove",function(r){G(r)}),window.removeEventListener("touchend",function(){Y()}),window.removeEventListener("mouseup",function(){Y()}),window.addEventListener("touchmove",function(r){G(r)}),window.addEventListener("mousemove",function(r){G(r)}),window.addEventListener("touchend",function(){Y()}),window.addEventListener("mouseup",function(){Y()})};ve(s,()=>{U()}),re(()=>{U(),d.$el.onselectstart=function(){return!1}});const F=r=>{if((r=r||window.event).touches)f=r.touches[0].pageX;else var f=r.clientX;X.value=Math.floor(f-L.value.getBoundingClientRect().left),b.value=+new Date,k.value==0&&($.value="",x.value="#337ab7",N.value="#337AB7",E.value="#fff",r.stopPropagation(),_.value=!0)},G=r=>{if(r=r||window.event,_.value&&k.value==0){if(r.touches)f=r.touches[0].pageX;else var f=r.clientX;var V=f-L.value.getBoundingClientRect().left;V>=L.value.offsetWidth-parseInt(parseInt(o.value.width)/2)-2&&(V=L.value.offsetWidth-parseInt(parseInt(o.value.width)/2)-2),V<=0&&(V=parseInt(parseInt(o.value.width)/2)),S.value=V-X.value+"px",n.value=V-X.value+"px"}},Y=()=>{if(H.value=+new Date,_.value&&k.value==0){var r=parseInt((S.value||"0").replace("px",""));r=310*r/parseInt(g.imgWidth);let f={captchaType:m.value,pointJson:c.value?R(JSON.stringify({x:r,y:5}),c.value):JSON.stringify({x:r,y:5}),token:W.value};oe(f).then(V=>{if(V.repCode=="0000"){x.value="#5cb85c",N.value="#5cb85c",E.value="#fff",M.value="icon-check",u.value=!1,k.value=!0,v.value=="pop"&&setTimeout(()=>{d.$parent.clickShow=!1,ie()},1500),h.value=!0,w.value=`${((H.value-b.value)/1e3).toFixed(2)}s
            ${a("captcha.success")}`;var ae=c.value?R(W.value+"---"+JSON.stringify({x:r,y:5}),c.value):W.value+"---"+JSON.stringify({x:r,y:5});setTimeout(()=>{w.value="",d.$parent.closeBox(),d.$parent.$emit("success",{captchaVerification:ae})},1e3)}else x.value="#d9534f",N.value="#d9534f",E.value="#fff",M.value="icon-close",h.value=!1,setTimeout(function(){ie()},1e3),d.$parent.$emit("error",d),w.value=a("captcha.fail"),setTimeout(()=>{w.value=""},1e3)}),_.value=!1}},ie=async()=>{u.value=!0,I.value="",T.value="left .3s",S.value=0,n.value=void 0,O.value="width .3s",N.value="#ddd",x.value="#fff",E.value="#000",M.value="icon-right",k.value=!1,await ue(),setTimeout(()=>{O.value="",T.value="",$.value=p.value},300)},ue=async()=>{let r={captchaType:m.value};const f=await ne(r);f.repCode=="0000"?(C.value=f.repData.originalImageBase64,D.value=f.repData.jigsawImageBase64,W.value=f.repData.token,c.value=f.repData.secretKey):w.value=f.repMsg};return(r,f)=>(B(),j("div",We,[e(s)==="2"?(B(),j("div",{key:0,style:z({height:parseInt(e(g).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[l("div",{style:z({width:e(g).imgWidth,height:e(g).imgHeight}),class:"verify-img-panel"},[l("img",{src:"data:image/png;base64,"+e(C),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,Te),K(l("div",{class:"verify-refresh",onClick:ie},f[0]||(f[0]=[l("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[Z,e(u)]]),he(ge,{name:"tips"},{default:de(()=>[e(w)?(B(),j("span",{key:0,class:ee([e(h)?"suc-bg":"err-bg","verify-tips"])},J(e(w)),3)):q("",!0)]),_:1})],4)],4)):q("",!0),l("div",{style:z({width:e(g).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[l("span",{class:"verify-msg",textContent:J(e($))},null,8,He),l("div",{style:z({width:e(n)!==void 0?e(n):i.barSize.height,height:i.barSize.height,"border-color":e(N),transaction:e(O)}),class:"verify-left-bar"},[l("span",{class:"verify-msg",textContent:J(e(I))},null,8,$e),l("div",{style:z({width:i.barSize.height,height:i.barSize.height,"background-color":e(x),left:e(S),transition:e(T)}),class:"verify-move-block",onMousedown:F,onTouchstart:F},[l("i",{class:ee(["verify-icon iconfont",e(M)]),style:z({color:e(E)})},null,6),e(s)==="2"?(B(),j("div",{key:0,style:z({width:Math.floor(47*parseInt(e(g).imgWidth)/310)+"px",height:e(g).imgHeight,top:"-"+(parseInt(e(g).imgHeight)+i.vSpace)+"px","background-size":e(g).imgWidth+" "+e(g).imgHeight}),class:"verify-sub-block"},[l("img",{src:"data:image/png;base64,"+e(D),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,Ie)],4)):q("",!0)],36)],4)],4)]))}},VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const y=i,{t:a}=te(),{mode:v,captchaType:m}=Q(y),{proxy:s}=le();let o=t(""),p=t(3),d=P([]),c=P([]),h=t(1),C=t(""),D=P([]),W=t(""),b=P({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),H=P([]),w=t(""),$=t(void 0),I=t(void 0),g=t(!0),S=t(!0);re(()=>{d.splice(0,d.length),c.splice(0,c.length),h.value=1,M(),se(()=>{let{imgHeight:k,imgWidth:u,barHeight:T,barWidth:O}=ce(s);b.imgHeight=k,b.imgWidth=u,b.barHeight=T,b.barWidth=O,s.$parent.$emit("ready",s)}),s.$el.onselectstart=function(){return!1}});const n=t(null),x=function(k,u){return{x:u.offsetX,y:u.offsetY}},N=function(k){return H.push(Object.assign({},k)),h.value+1},E=async function(){H.splice(0,H.length),$.value="#000",I.value="#ddd",S.value=!0,d.splice(0,d.length),c.splice(0,c.length),h.value=1,await M(),g.value=!0},M=async()=>{let k={captchaType:m.value};const u=await ne(k);u.repCode=="0000"?(C.value=u.repData.originalImageBase64,W.value=u.repData.token,o.value=u.repData.secretKey,D.value=u.repData.wordList,w.value=a("captcha.point")+"\u3010"+D.value.join(",")+"\u3011"):w.value=u.repMsg},_=function(k,u){return k.map(T=>({x:Math.round(310*T.x/parseInt(u.imgWidth)),y:Math.round(155*T.y/parseInt(u.imgHeight))}))};return(k,u)=>(B(),j("div",Oe,[l("div",Ce,[l("div",{style:z({width:e(b).imgWidth,height:e(b).imgHeight,"background-size":e(b).imgWidth+" "+e(b).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[K(l("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:E},u[1]||(u[1]=[l("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[Z,e(g)]]),l("img",{ref_key:"canvas",ref:n,src:"data:image/png;base64,"+e(C),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:u[0]||(u[0]=T=>e(S)?(O=>{if(c.push(x(n,O)),h.value==p.value){h.value=N(x(n,O));let X=_(c,b);c.length=0,c.push(...X),setTimeout(()=>{var L=o.value?R(W.value+"---"+JSON.stringify(c),o.value):W.value+"---"+JSON.stringify(c);let U={captchaType:m.value,pointJson:o.value?R(JSON.stringify(c),o.value):JSON.stringify(c),token:W.value};oe(U).then(F=>{F.repCode=="0000"?($.value="#4cae4c",I.value="#5cb85c",w.value=a("captcha.success"),S.value=!1,v.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,E()},1500),s.$parent.$emit("success",{captchaVerification:L})):(s.$parent.$emit("error",s),$.value="#d9534f",I.value="#d9534f",w.value=a("captcha.fail"),setTimeout(()=>{E()},700))})},400)}h.value<p.value&&(h.value=N(x(n,O)))})(T):void 0)},null,8,Be),(B(!0),j(fe,null,ye(e(H),(T,O)=>(B(),j("div",{key:O,style:z({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(T.y-10)+"px",left:parseInt(T.x-10)+"px"}),class:"point-area"},J(O+1),5))),128))],4)]),l("div",{style:z({width:e(b).imgWidth,color:e($),"border-color":e(I),"line-height":i.barSize.height}),class:"verify-bar-area"},[l("span",De,J(e(w)),1)],4)]))}},VerifyPictureWord:{__name:"VerifyPictureWord",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const y=i,{t:a}=te(),{mode:v,captchaType:m}=Q(y),{proxy:s}=le();let o=t(""),p=t(""),d=t(""),c=t(""),h=P({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),C=t(""),D=t("#000"),W=t("#ddd"),b=t(!0),H=t(!1);re(()=>{g(),se(()=>{let{imgHeight:S,imgWidth:n,barHeight:x,barWidth:N}=ce(s);h.imgHeight=S,h.imgWidth=n,h.barHeight=x,h.barWidth=N,s.$parent.$emit("ready",s)}),s.$el.onselectstart=function(){return!1}});const w=t(null),$=()=>{H.value=!0;const S=o.value?R(c.value+"---"+p.value,o.value):c.value+"---"+p.value;let n={captchaType:m.value,pointJson:p.value,token:c.value};oe(n).then(x=>{x.repCode==="0000"?(D.value="#4cae4c",W.value="#5cb85c",C.value=a("captcha.success"),v.value==="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,I()},1500),s.$parent.$emit("success",{captchaVerification:S})):(s.$parent.$emit("error",s),D.value="#d9534f",W.value="#d9534f",C.value=a("captcha.fail"),setTimeout(()=>{I()},700)),H.value=!1})},I=async function(){D.value="#000",W.value="#ddd",H.value=!1,p.value="",await g(),b.value=!0},g=async()=>{let S={captchaType:m.value};const n=await ne(S);n.repCode==="0000"?(d.value=n.repData.originalImageBase64,c.value=n.repData.token,o.value=n.repData.secretKey,C.value=a("captcha.code")):C.value=n.repMsg};return(S,n)=>(B(),j("div",Ne,[l("div",Ve,[l("div",{style:z({width:e(h).imgWidth,height:e(h).imgHeight,"background-size":e(h).imgWidth+" "+e(h).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[K(l("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:I},n[1]||(n[1]=[l("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[Z,e(b)]]),l("img",{onClick:I,ref_key:"canvas",ref:w,src:"data:image/png;base64,"+e(d),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,je)],4)]),l("div",{style:z({width:e(h).imgWidth,color:e(D),"border-color":e(W)}),class:"verify-bar-area"},[l("div",Ee,J(e(C)),1),l("div",{style:z({"line-height":i.barSize.height})},[K(l("input",{class:"verify-input",type:"text","onUpdate:modelValue":n[0]||(n[0]=x=>be(p)?p.value=x:p=x)},null,512),[[me,e(p)]])],4),l("button",{type:"button",class:"verify-btn",onClick:$,disabled:e(H)},J(e(a)("captcha.verify")),9,Je)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:y}=te(),{captchaType:a,mode:v}=Q(i),m=t(!1),s=t(void 0),o=t(void 0),p=t({}),d=pe(()=>v.value!="pop"||m.value);return xe(()=>{switch(a.value){case"pictureWord":s.value="3",o.value="VerifyPictureWord";break;case"blockPuzzle":s.value="2",o.value="VerifySlide";break;case"clickWord":s.value="",o.value="VerifyPoints"}}),{t:y,clickShow:m,verifyType:s,componentType:o,instance:p,showBox:d,closeBox:()=>{m.value=!1,p.value.refresh&&p.value.refresh()},show:()=>{v.value=="pop"&&(m.value=!0)}}}},[["render",function(i,y,a,v,m,s){return K((B(),j("div",{class:ee(a.mode=="pop"?"mask":"")},[l("div",{class:ee(a.mode=="pop"?"verifybox":""),style:z({"max-width":parseInt(a.imgSize.width)+20+"px"})},[a.mode=="pop"?(B(),j("div",Me,[we(J(v.t("captcha.verification"))+" ",1),l("span",{class:"verifybox-close",onClick:y[0]||(y[0]=(...o)=>v.closeBox&&v.closeBox(...o))},y[1]||(y[1]=[l("i",{class:"iconfont icon-close"},null,-1)]))])):q("",!0),l("div",{style:z({padding:a.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[v.componentType?(B(),Se(ke(v.componentType),{key:0,ref:"instance",arith:a.arith,barSize:a.barSize,blockSize:a.blockSize,captchaType:a.captchaType,explain:a.explain,figure:a.figure,imgSize:a.imgSize,mode:a.mode,type:v.verifyType,vSpace:a.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):q("",!0)],4)],6)],2)),[[Z,v.showBox]])}]]);export{Pe as _};
