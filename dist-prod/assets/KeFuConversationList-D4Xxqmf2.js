import{d as q,m as z,aF as B,_ as H,c as J}from"./index-DmQdxAiK.js";import{l as $,r as c,c as P,b as Q,e as W,P as Z,ag as ee,A as ae,q as g,B as _,x as s,m as b,C as x,H as h,u as n,$ as se,N as m,D as te,J as r,I as ne,K as y,G as f,O as ie}from"./form-create-_84fGzaM.js";import{u as le,K as o,a as D}from"./kefu-Dp5z9MFR.js";import{u as oe}from"./emoji-CZ9IixHW.js";import{h as ce}from"./formatTime-BGPGB_ys.js";import{T as re,ah as ue,a5 as de}from"./form-designer-DHHJWkD5.js";const me={class:"color-[#999] font-bold my-10px"},pe=["onClick","onContextmenu"],ve={class:"flex justify-center items-center w-100%"},xe={class:"flex justify-center items-center w-50px h-50px"},fe={class:"ml-10px w-100%"},Ce={class:"flex justify-between items-center w-100%"},ge={class:"username"},he={class:"color-[#999]",style:{"font-size":"13px"}},ye={class:"last-message flex items-center color-[#999]"},ke=J($({name:"KeFuConversationList",__name:"KeFuConversationList",emits:["change"],setup(we,{expose:Y,emit:O}){const k=q(),j=z(),u=le(),{replaceEmoji:K}=oe(),C=c(-1),A=P(()=>j.getCollapse),w=c(new Map),M=()=>{var t;(t=u.getConversationList)==null||t.forEach(e=>{w.value.set(e.id,ce(e.lastMessageTime,"YYYY-MM-DD"))})};Y({calculationLastMessageTime:M});const F=O,R=P(()=>(t,e)=>{switch(t){case o.SYSTEM:return"[\u7CFB\u7EDF\u6D88\u606F]";case o.VIDEO:return"[\u89C6\u9891\u6D88\u606F]";case o.IMAGE:return"[\u56FE\u7247\u6D88\u606F]";case o.PRODUCT:return"[\u5546\u54C1\u6D88\u606F]";case o.ORDER:return"[\u8BA2\u5355\u6D88\u606F]";case o.VOICE:return"[\u8BED\u97F3\u6D88\u606F]";case o.TEXT:return K(B(e).text||e);default:return""}}),p=c(!1),E=c({}),i=c({}),d=()=>{p.value=!1},L=async t=>{await D.updateConversationPinned({id:i.value.id,adminPinned:t}),k.notifySuccess(t?"\u7F6E\u9876\u6210\u529F":"\u53D6\u6D88\u7F6E\u9876\u6210\u529F"),d(),await u.updateConversation(i.value.id)},S=async()=>{await k.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u4F1A\u8BDD\u5417\uFF1F"),await D.deleteConversation(i.value.id),d(),u.deleteConversation(i.value.id)};Q(p,t=>{t?document.body.addEventListener("click",d):document.body.removeEventListener("click",d)});const T=c();return W(()=>{T.value=setInterval(M,1e4)}),Z(()=>{clearInterval(T.value)}),(t,e)=>{const U=ue,X=de,v=H,G=re,N=ee("dompurify-html");return g(),ae(G,{class:"kefu pt-5px h-100%",width:"260px"},{default:_(()=>[s("div",me," \u4F1A\u8BDD\u8BB0\u5F55("+h(n(u).getConversationList.length)+") ",1),(g(!0),b(ne,null,se(n(u).getConversationList,a=>(g(),b("div",{key:a.id,class:te([{active:a.id===n(C),pinned:a.adminPinned},"kefu-conversation px-10px flex items-center"]),onClick:I=>(l=>{C.value!==l.id&&(C.value=l.id,F("change",l))})(a),onContextmenu:m(I=>((l,V)=>{i.value=V,p.value=!0,E.value={top:l.clientY-110+"px",left:A.value?l.clientX-80+"px":l.clientX-210+"px"}})(I,a),["prevent"])},[s("div",ve,[s("div",xe,[r(X,{hidden:a.adminUnreadMessageCount===0,max:99,value:a.adminUnreadMessageCount},{default:_(()=>[r(U,{src:a.userAvatar,alt:"avatar"},null,8,["src"])]),_:2},1032,["hidden","value"])]),s("div",fe,[s("div",Ce,[s("span",ge,h(a.userNickname),1),s("span",he,h(n(w).get(a.id)??"\u8BA1\u7B97\u4E2D"),1)]),x(s("div",ye,null,512),[[N,n(R)(a.lastMessageContentType,a.lastMessageContent)]])])])],42,pe))),128)),x(s("ul",{style:ie(n(E)),class:"right-menu-ul"},[x(s("li",{class:"flex items-center",onClick:e[0]||(e[0]=m(a=>L(!0),["stop"]))},[r(v,{class:"mr-5px",icon:"ep:top"}),e[2]||(e[2]=f(" \u7F6E\u9876\u4F1A\u8BDD "))],512),[[y,!n(i).adminPinned]]),x(s("li",{class:"flex items-center",onClick:e[1]||(e[1]=m(a=>L(!1),["stop"]))},[r(v,{class:"mr-5px",icon:"ep:bottom"}),e[3]||(e[3]=f(" \u53D6\u6D88\u7F6E\u9876 "))],512),[[y,n(i).adminPinned]]),s("li",{class:"flex items-center",onClick:m(S,["stop"])},[r(v,{class:"mr-5px",color:"red",icon:"ep:delete"}),e[4]||(e[4]=f(" \u5220\u9664\u4F1A\u8BDD "))]),s("li",{class:"flex items-center",onClick:m(d,["stop"])},[r(v,{class:"mr-5px",color:"red",icon:"ep:close"}),e[5]||(e[5]=f(" \u53D6\u6D88 "))])],4),[[y,n(p)]])]),_:1})}}}),[["__scopeId","data-v-371c5a68"]]);export{ke as default};
