import{X as p,d as b,e as q}from"./index-DmQdxAiK.js";import{_ as I}from"./XTextButton-CXU1Athx.js";import{S as y}from"./constants-C3gLHYOK.js";import{g as R}from"./index-k04NzqSo.js";import{_ as S,Z as x}from"./form-designer-DHHJWkD5.js";import{l as N,r as j,e as A,b as B,A as G,q as m,B as d,J as i,x as f,H,m as h,I as w,G as g,u as J}from"./form-create-_84fGzaM.js";const L=["src"],P={class:"mr-5"},X=N({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup(Z,{emit:v}){const u=b(),r=j([]),n=q(),_=v,k=()=>{const t=(a="type",new URL(decodeURIComponent(location.href)).searchParams.get(a)??"");var a;const e=n.query.code,s=n.query.state;e&&((c,o,l)=>p.post({url:"/system/social-user/bind",data:{type:c,code:o,state:l}}))(t,e,s).then(()=>{u.success("\u7ED1\u5B9A\u6210\u529F"),_("update:activeName","userSocial")})},C=t=>{const a=location.origin+"/user/profile?"+encodeURIComponent(`type=${t.type}`);((e,s)=>p.get({url:"/system/auth/social-auth-redirect?type="+e+"&redirectUri="+s}))(t.type,encodeURIComponent(a)).then(e=>{window.location.href=e})},U=async t=>{var a,e;await(a=t.type,e=t.openid,p.delete({url:"/system/social-user/unbind",data:{type:a,openid:e}}))&&(t.openid=void 0),u.success("\u89E3\u7ED1\u6210\u529F")};return A(async()=>{await(async()=>{r.value=[];const t=await R();for(const a in y){const e={...y[a]};if(r.value.push(e),t&&t.length>0){for(const s of t)if(e.type===s.type){e.openid=s.openid;break}}}})()}),B(()=>n,()=>{k()},{immediate:!0}),(t,a)=>{const e=S,s=I,c=x;return m(),G(c,{data:J(r),"show-header":!1},{default:d(()=>[i(e,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),i(e,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:d(({row:o})=>[f("img",{src:o.img,alt:"",class:"h-5 align-middle"},null,8,L),f("p",P,H(o.title),1)]),_:1}),i(e,{align:"center",label:"\u64CD\u4F5C"},{default:d(({row:o})=>[o.openid?(m(),h(w,{key:0},[a[0]||(a[0]=g(" \u5DF2\u7ED1\u5B9A ")),i(s,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:l=>U(o)},null,8,["onClick"])],64)):(m(),h(w,{key:1},[a[1]||(a[1]=g(" \u672A\u7ED1\u5B9A ")),i(s,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:l=>C(o)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{X as _};
