import{D as p,I as g,N as L,aN as b,aL as C}from"./index-DzK2S43K.js";import{_ as I}from"./DictTag.vue_vue_type_script_lang-D8_eTNf5.js";import{_ as T}from"./Echart.vue_vue_type_script_setup_true_lang-DrazIEIC.js";import{S as W}from"./portrait-D1bAJmLR.js";import{ad as j,i as q,j as A,ag as z,ak as D,_ as N,Z as k}from"./form-designer-DHHJWkD5.js";import{l as B,r as _,j as w,e as J,m as Z,q as v,I as F,J as e,B as o,u as s,C as G,A as H}from"./form-create-_84fGzaM.js";const K=B({name:"PortraitCustomerSource",__name:"PortraitCustomerSource",props:{queryParams:{}},setup(S,{expose:R}){const y=S,i=_(!1),c=_([]),n=w({title:{text:"\u5168\u90E8\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u5168\u90E8\u5BA2\u6237"}}},series:[{name:"\u5168\u90E8\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),u=w({title:{text:"\u6210\u4EA4\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u6210\u4EA4\u5BA2\u6237"}}},series:[{name:"\u6210\u4EA4\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),f=async()=>{i.value=!0;const r=await W.getCustomerSource(y.queryParams);n.series&&n.series[0]&&n.series[0].data&&(n.series[0].data=r.map(t=>({name:g(p.CRM_CUSTOMER_SOURCE,t.source),value:t.customerCount}))),u.series&&u.series[0]&&u.series[0].data&&(u.series[0].data=r.map(t=>({name:g(p.CRM_CUSTOMER_SOURCE,t.source),value:t.dealCount}))),O(r),c.value=r,i.value=!1};R({loadData:f});const O=r=>{if(L(r))return;const t=r,d=b(t.map(a=>a.customerCount)),m=b(t.map(a=>a.dealCount));t.forEach(a=>{a.sourcePortion=a.customerCount===0?0:C(a.customerCount,d),a.dealPortion=a.dealCount===0?0:C(a.dealCount,m)})};return J(()=>{f()}),(r,t)=>{const d=T,m=z,a=A,x=q,h=j,l=N,E=I,P=k,M=D;return v(),Z(F,null,[e(h,{shadow:"never"},{default:o(()=>[e(x,{gutter:20},{default:o(()=>[e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(n)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(u)},null,8,["options"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(h,{class:"mt-16px",shadow:"never"},{default:o(()=>[G((v(),H(P,{data:s(c)},{default:o(()=>[e(l,{align:"center",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(l,{align:"center",label:"\u5BA2\u6237\u6765\u6E90",prop:"source",width:"100"},{default:o(U=>[e(E,{type:s(p).CRM_CUSTOMER_SOURCE,value:U.row.source},null,8,["type","value"])]),_:1}),e(l,{align:"center",label:"\u5BA2\u6237\u4E2A\u6570","min-width":"200",prop:"customerCount"}),e(l,{align:"center",label:"\u6210\u4EA4\u4E2A\u6570","min-width":"200",prop:"dealCount"}),e(l,{align:"center",label:"\u6765\u6E90\u5360\u6BD4(%)","min-width":"200",prop:"sourcePortion"}),e(l,{align:"center",label:"\u6210\u4EA4\u5360\u6BD4(%)","min-width":"200",prop:"dealPortion"})]),_:1},8,["data"])),[[M,s(i)]])]),_:1})],64)}}});export{K as _};
