import{d as D,u as G,_ as H,ay as J}from"./index-DzK2S43K.js";import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BYZVL11n.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import{b as K,g as Q}from"./index-D05eFr8n.js";import{h as V,i as W}from"./index-BFXClQSm.js";import{_ as X}from"./BusinessForm.vue_vue_type_script_setup_true_lang-CvQg7Q6Z.js";import{B as S}from"./index-BrXhj2tq.js";import{_ as Y}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-DRYtBwIu.js";import{i as $,f as ee,ak as ae,_ as te,P as se,Z as oe}from"./form-designer-DHHJWkD5.js";import{l as ie,r as l,j as re,b as ne,ag as ce,m as le,q as u,I as pe,J as a,B as r,C as v,E as k,G as d,u as s,A as m,H as ue}from"./form-create-_84fGzaM.js";const de=ie({name:"CrmBusinessList",__name:"BusinessList",props:{bizType:{},bizId:{},customerId:{},contactId:{}},setup(T){const f=D(),o=T,I=l(!0),C=l(0),w=l([]),t=re({pageNo:1,pageSize:10,customerId:void 0,contactId:void 0}),b=async()=>{I.value=!0;try{t.customerId=void 0,t.contactId=void 0;let i={list:[],total:0};switch(o.bizType){case S.CRM_CUSTOMER:t.customerId=o.bizId,i=await Q(t);break;case S.CRM_CONTACT:t.contactId=o.bizId,i=await K(t);break;default:return}w.value=i.list,C.value=i.total}finally{I.value=!1}},y=()=>{t.pageNo=1,b()},z=l(),x=()=>{z.value.open("create",null,o.customerId,o.contactId)},{push:B}=G(),h=l(),P=()=>{h.value.open()},M=async i=>{const e={contactId:o.bizId,businessIds:i};_.value.getSelectionRows().forEach(p=>{e.businessIds.push(p.id)}),await V(e),f.success("\u5173\u8054\u5546\u673A\u6210\u529F"),y()},_=l(),E=async()=>{const i={contactId:o.bizId,businessIds:_.value.getSelectionRows().map(e=>e.id)};if(i.businessIds.length===0)return f.error("\u672A\u9009\u62E9\u5546\u673A");await W(i),f.success("\u53D6\u5173\u5546\u673A\u6210\u529F"),y()};return ne(()=>[o.bizId,o.bizType],()=>{y()},{immediate:!0,deep:!0}),(i,e)=>{const p=H,g=ee,U=$,n=te,j=se,A=oe,L=F,O=Z,N=ce("hasPermi"),q=ae;return u(),le(pe,null,[a(U,{justify:"end"},{default:r(()=>[a(g,{onClick:x},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:opportunity"}),e[2]||(e[2]=d(" \u521B\u5EFA\u5546\u673A "))]),_:1}),s(t).contactId?v((u(),m(g,{key:0,onClick:P},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=d("\u5173\u8054 "))]),_:1})),[[N,["crm:contact:create-business"]]]):k("",!0),s(t).contactId?v((u(),m(g,{key:1,onClick:E},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=d("\u89E3\u9664\u5173\u8054 "))]),_:1})),[[N,["crm:contact:delete-business"]]]):k("",!0)]),_:1}),a(O,{class:"mt-10px"},{default:r(()=>[v((u(),m(A,{ref_key:"businessRef",ref:_,data:s(w),stripe:!0,"show-overflow-tooltip":!0},{default:r(()=>[s(t).contactId?(u(),m(n,{key:0,type:"selection",width:"55"})):k("",!0),a(n,{label:"\u5546\u673A\u540D\u79F0",fixed:"left",align:"center",prop:"name"},{default:r(c=>[a(j,{type:"primary",underline:!1,onClick:me=>{return R=c.row.id,void B({name:"CrmBusinessDetail",params:{id:R}});var R}},{default:r(()=>[d(ue(c.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(n,{label:"\u5546\u673A\u91D1\u989D",align:"center",prop:"price",formatter:s(J)},null,8,["formatter"]),a(n,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName"}),a(n,{label:"\u5546\u673A\u7EC4",align:"center",prop:"statusTypeName"}),a(n,{label:"\u5546\u673A\u9636\u6BB5",align:"center",prop:"statusName"})]),_:1},8,["data"])),[[q,s(I)]]),a(L,{total:s(C),page:s(t).pageNo,"onUpdate:page":e[0]||(e[0]=c=>s(t).pageNo=c),limit:s(t).pageSize,"onUpdate:limit":e[1]||(e[1]=c=>s(t).pageSize=c),onPagination:b},null,8,["total","page","limit"])]),_:1}),a(X,{ref_key:"formRef",ref:z,onSuccess:b},null,512),a(Y,{ref_key:"businessModalRef",ref:h,"customer-id":o.customerId,onSuccess:M},null,8,["customer-id"])],64)}}});export{de as _};
