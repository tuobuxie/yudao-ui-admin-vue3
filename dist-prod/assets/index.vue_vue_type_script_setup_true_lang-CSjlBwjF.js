import{d as H,a as J,u as W,_ as Y,D as Z}from"./index-D_TWD7wt.js";import{_ as K}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4_WNC8um.js";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang-ZV0RCuCp.js";import{_ as V}from"./DictTag.vue_vue_type_script_lang-BD_Qe0UA.js";import{d as S}from"./formatTime-BGPGB_ys.js";import{_ as X,F as E}from"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-BJRmdZ3t.js";import{B as F}from"./index-VdMMiVod.js";import{i as ee,f as ae,ak as le,_ as te,al as re,P as ie,Z as se}from"./form-designer-DHHJWkD5.js";import{l as oe,r as w,j as ne,b as pe,m as d,q as l,I as y,J as a,B as t,G as _,C as ce,u as s,A as m,E as g,$ as k,H as x}from"./form-create-_84fGzaM.js";const de={key:0,class:"flex"},me={key:0,class:"flex flex-col"},ue=oe({name:"FollowUpRecord",__name:"index",props:{bizType:{},bizId:{}},setup(M){const N=i=>i?i.substring(i.lastIndexOf("/")+1):"",u=M,z=H(),{t:O}=J(),v=w(!0),U=w([]),T=w(0),c=ne({pageNo:1,pageSize:10,bizType:0,bizId:0}),b=async()=>{v.value=!0;try{const i=await E.getFollowUpRecordPage(c);U.value=i.list,T.value=i.total}finally{v.value=!1}},h=w(),P=()=>{var i;(i=h.value)==null||i.open(u.bizType,u.bizId)},{push:I}=W();return pe(()=>u.bizId,()=>{c.bizType=u.bizType,c.bizId=u.bizId,b()}),(i,n)=>{const B=Y,R=ae,D=ee,o=te,$=V,j=re,C=ie,L=se,q=Q,A=K,G=le;return l(),d(y,null,[a(D,{class:"mb-10px",justify:"end"},{default:t(()=>[a(R,{onClick:P},{default:t(()=>[a(B,{class:"mr-5px",icon:"ep:edit"}),n[2]||(n[2]=_(" \u5199\u8DDF\u8FDB "))]),_:1})]),_:1}),a(A,null,{default:t(()=>[ce((l(),m(L,{data:s(U),"show-overflow-tooltip":!0,stripe:!0},{default:t(()=>[a(o,{formatter:s(S),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(o,{align:"center",label:"\u8DDF\u8FDB\u4EBA",prop:"creatorName"}),a(o,{align:"center",label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:t(e=>[a($,{type:s(Z).CRM_FOLLOW_UP_TYPE,value:e.row.type},null,8,["type","value"])]),_:1}),a(o,{align:"center",label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"}),a(o,{label:"\u56FE\u7247",align:"center"},{default:t(e=>[e.row.picUrls&&e.row.picUrls.length>0?(l(),d("div",de,[(l(!0),d(y,null,k(e.row.picUrls,(r,p)=>(l(),m(j,{key:p,src:r,"preview-src-list":e.row.picUrls,class:"w-10 h-10 mr-1","initial-index":p,fit:"cover","preview-teleported":""},null,8,["src","preview-src-list","initial-index"]))),128))])):g("",!0)]),_:1}),a(o,{label:"\u9644\u4EF6",align:"center"},{default:t(e=>[e.row.fileUrls&&e.row.fileUrls.length>0?(l(),d("div",me,[(l(!0),d(y,null,k(e.row.fileUrls,(r,p)=>(l(),m(C,{key:p,href:r,type:"primary",target:"_blank",download:""},{default:t(()=>[_(x(N(r)),1)]),_:2},1032,["href"]))),128))])):g("",!0)]),_:1}),a(o,{formatter:s(S),align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime",width:"180px"},null,8,["formatter"]),i.bizType===s(F).CRM_CUSTOMER?(l(),m(o,{key:0,align:"center",label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:t(e=>[(l(!0),d(y,null,k(e.row.contacts,r=>(l(),m(C,{key:`key-${r.id}`,underline:!1,type:"primary",onClick:p=>{return f=r.id,void I({name:"CrmContactDetail",params:{id:f}});var f},class:"ml-5px"},{default:t(()=>[_(x(r.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):g("",!0),i.bizType===s(F).CRM_CUSTOMER?(l(),m(o,{key:1,align:"center",label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:t(e=>[(l(!0),d(y,null,k(e.row.businesses,r=>(l(),m(C,{key:`key-${r.id}`,underline:!1,type:"primary",onClick:p=>{return f=r.id,void I({name:"CrmBusinessDetail",params:{id:f}});var f},class:"ml-5px"},{default:t(()=>[_(x(r.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):g("",!0),a(o,{align:"center",label:"\u64CD\u4F5C"},{default:t(e=>[a(R,{link:"",type:"danger",onClick:r=>(async p=>{try{await z.delConfirm(),await E.deleteFollowUpRecord(p),z.success(O("common.delSuccess")),await b()}catch{}})(e.row.id)},{default:t(()=>n[3]||(n[3]=[_(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,s(v)]]),a(q,{limit:s(c).pageSize,"onUpdate:limit":n[0]||(n[0]=e=>s(c).pageSize=e),page:s(c).pageNo,"onUpdate:page":n[1]||(n[1]=e=>s(c).pageNo=e),total:s(T),onPagination:b},null,8,["limit","page","total"])]),_:1}),a(X,{ref_key:"formRef",ref:h,onSuccess:b},null,512)],64)}}});export{ue as _};
