import{d as E}from"./index-D_TWD7wt.js";import{I as $}from"./index-D0DErs8g.js";import{n as p}from"./constants-CaEZMpg0.js";import{D as B}from"./index-lvaXv4aK.js";import{v as D,ak as N,h as G,aj as J,k as P,x as Q,Q as R,f as z}from"./form-designer-DHHJWkD5.js";import{l as H,r as t,A as i,q as r,u as l,h as K,B as s,C as M,J as o,E as W,m as y,I as _,$ as g,G as h}from"./form-create-_84fGzaM.js";const X=H({name:"OtaTaskForm",__name:"OtaTaskForm",props:{firmwareId:{},productId:{}},emits:["success"],setup(S,{expose:L,emit:x}){const n=S,U=E(),u=t(!1),c=t(!1),d=t({name:"",deviceScope:p.ALL.value,firmwareId:n.firmwareId,description:"",deviceIds:[]}),v=t(),q={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",trigger:"blur"}],deviceScope:[{required:!0,message:"\u8BF7\u9009\u62E9\u5347\u7EA7\u8303\u56F4",trigger:"change"}],deviceIds:[{required:!0,message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u8BBE\u5907",trigger:"change"}]},b=t([]);L({open:async()=>{u.value=!0,O(),b.value=await B.getDeviceListByProductId(n.productId)||[]}});const C=x,F=async()=>{await v.value.validate(),c.value=!0;try{await $.createOtaTask(d.value),U.success("\u521B\u5EFA\u6210\u529F"),u.value=!1,C("success")}finally{c.value=!1}},O=()=>{var f;d.value={name:"",deviceScope:p.ALL.value,firmwareId:n.firmwareId,description:"",deviceIds:[]},(f=v.value)==null||f.resetFields()};return(f,a)=>{const I=P,m=J,V=R,k=Q,T=G,w=z,j=D,A=N;return r(),i(j,{modelValue:l(u),"onUpdate:modelValue":a[5]||(a[5]=e=>K(u)?u.value=e:null),title:"\u65B0\u589E\u5347\u7EA7\u4EFB\u52A1",width:"800px","append-to-body":""},{footer:s(()=>[o(w,{onClick:F,type:"primary",disabled:l(c)},{default:s(()=>a[6]||(a[6]=[h("\u786E \u5B9A")])),_:1},8,["disabled"]),o(w,{onClick:a[4]||(a[4]=e=>u.value=!1)},{default:s(()=>a[7]||(a[7]=[h("\u53D6 \u6D88")])),_:1})]),default:s(()=>[M((r(),i(T,{ref_key:"formRef",ref:v,model:l(d),rules:q,"label-width":"100px"},{default:s(()=>[o(m,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:s(()=>[o(I,{modelValue:l(d).name,"onUpdate:modelValue":a[0]||(a[0]=e=>l(d).name=e),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u4EFB\u52A1\u63CF\u8FF0",prop:"description"},{default:s(()=>[o(I,{modelValue:l(d).description,"onUpdate:modelValue":a[1]||(a[1]=e=>l(d).description=e),type:"textarea",rows:3,placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u5347\u7EA7\u8303\u56F4",prop:"deviceScope"},{default:s(()=>[o(k,{modelValue:l(d).deviceScope,"onUpdate:modelValue":a[2]||(a[2]=e=>l(d).deviceScope=e),placeholder:"\u8BF7\u9009\u62E9\u5347\u7EA7\u8303\u56F4",class:"w-full"},{default:s(()=>[(r(!0),y(_,null,g(Object.values(l(p)),e=>(r(),i(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d).deviceScope===l(p).SELECT.value?(r(),i(m,{key:0,label:"\u9009\u62E9\u8BBE\u5907",prop:"deviceIds"},{default:s(()=>[o(k,{modelValue:l(d).deviceIds,"onUpdate:modelValue":a[3]||(a[3]=e=>l(d).deviceIds=e),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907",class:"w-full",filterable:"","reserve-keyword":""},{default:s(()=>[(r(!0),y(_,null,g(l(b),e=>(r(),i(V,{key:e.id,label:e.nickname?`${e.deviceName} (${e.nickname})`:e.deviceName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):W("",!0)]),_:1},8,["model"])),[[A,l(c)]])]),_:1},8,["modelValue"])}}});export{X as _};
