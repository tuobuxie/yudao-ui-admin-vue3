import{d as P,u as A}from"./index-DzK2S43K.js";import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import{I as c}from"./index-Dul0EzIE.js";import{_ as U}from"./ImageDetail.vue_vue_type_script_setup_true_lang-BvmrsR_x.js";import{_ as q}from"./ImageCard.vue_vue_type_script_setup_true_lang-B9htFFi9.js";import{a as b}from"./constants-CHvLs4wt.js";import{d as D}from"./download-oWiM5xVU.js";import{ad as H,f as J,d as K}from"./form-designer-DHHJWkD5.js";import{l as W,j as $,r as o,e as F,L as Q,m as S,q as w,I as R,J as p,B as y,x as k,$ as T,u as l,A as V,G as j}from"./form-create-_84fGzaM.js";const X={class:"absolute bottom-[60px] h-[50px] leading-[90px] w-full z-[999] bg-white flex flex-row justify-center items-center"},Y=W({__name:"ImageList",emits:["onRegeneration"],setup(Z,{expose:L,emit:N}){const I=P(),O=A(),n=$({pageNo:1,pageSize:10}),x=o(0),r=o([]),m=o(),h=o(),v=o({}),f=o(),g=o(!1),_=o(0),z=()=>{O.push({name:"AiImageSquare"})},B=async()=>{g.value=!1},u=async()=>{try{m.value=K.service({target:h.value,text:"\u52A0\u8F7D\u4E2D..."});const{list:e,total:a}=await c.getImagePageMy(n);r.value=e,x.value=a;const i={};r.value.forEach(t=>{t.status===b.IN_PROGRESS&&(i[t.id]=t)}),v.value=i}finally{m.value&&(m.value.close(),m.value=null)}},C=async(e,a)=>e==="more"?(_.value=a.id,void await(async()=>{g.value=!0})()):e==="delete"?(await I.confirm("\u662F\u5426\u5220\u9664\u7167\u7247?"),await c.deleteImageMy(a.id),await u(),void I.success("\u5220\u9664\u6210\u529F!")):void(e!=="download"?e!=="regeneration"||M("onRegeneration",a):D.image({url:a.picUrl})),E=async(e,a)=>{const i={id:a.id,customId:e.customId};await c.midjourneyAction(i),await u()};L({getImageList:u});const M=N;return F(async()=>{await u(),f.value=setInterval(async()=>{await(async()=>{const e=Object.keys(v.value).map(Number);if(e.length==0)return;const a=await c.getImageListMyByIds(e),i={};a.forEach(t=>{if(t.status===b.IN_PROGRESS)i[t.id]=t;else{const d=r.value.findIndex(s=>t.id===s.id);d>=0&&(r.value[d]=t)}}),v.value=i})()},3e3)}),Q(async()=>{f.value&&clearInterval(f.value)}),(e,a)=>{const i=J,t=G,d=H;return w(),S(R,null,[p(d,{class:"wh-full","body-style":{margin:0,padding:0,height:"100%",position:"relative"},shadow:"never"},{header:y(()=>[a[3]||(a[3]=j(" \u7ED8\u753B\u4EFB\u52A1 ")),p(i,{onClick:z},{default:y(()=>a[2]||(a[2]=[j("\u7ED8\u753B\u4F5C\u54C1")])),_:1})]),default:y(()=>[k("div",{class:"relative flex flex-row flex-wrap content-start h-full overflow-auto p-5 pb-[140px] box-border [&>div]:mr-5 [&>div]:mb-5",ref_key:"imageListRef",ref:h},[(w(!0),S(R,null,T(l(r),s=>(w(),V(q,{key:s.id,detail:s,onOnBtnClick:C,onOnMjBtnClick:E},null,8,["detail"]))),128))],512),k("div",X,[p(t,{total:l(x),page:l(n).pageNo,"onUpdate:page":a[0]||(a[0]=s=>l(n).pageNo=s),limit:l(n).pageSize,"onUpdate:limit":a[1]||(a[1]=s=>l(n).pageSize=s),onPagination:u},null,8,["total","page","limit"])])]),_:1}),p(U,{show:l(g),id:l(_),onHandleDrawerClose:B},null,8,["show","id"])],64)}}});export{Y as _};
