import{X as O,d as $,h as K,D as V,g as W,_ as ee}from"./index-DzK2S43K.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import{_ as ae}from"./DictTag.vue_vue_type_script_lang-D8_eTNf5.js";import{_ as te}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BYZVL11n.js";import{d as oe}from"./formatTime-BGPGB_ys.js";import{A as re}from"./index-BBeQ9Omv.js";import{P as de}from"./index-xDnKc7mk.js";import{D as ie}from"./index-BrWsOwLz.js";import{h as se,aj as ue,x as pe,Q as ce,F as ne,f as me,Z as fe,_ as ve,n as ge,ak as _e,O as be}from"./form-designer-DHHJWkD5.js";import{l as we,r as n,j as ye,c as Ie,e as Ve,ag as he,m,q as d,J as l,B as o,u as t,I as f,$ as _,A as p,G as v,C as B,H as S,x as ke,E as xe}from"./form-create-_84fGzaM.js";const Le=async b=>await O.get({url:"/iot/alert-record/page",params:b}),Se=async(b,h)=>await O.put({url:"/iot/alert-record/process",data:{id:b,processRemark:h}}),Te={key:1,class:"text-gray-400"},Ne=we({name:"IotAlertRecord",__name:"index",setup(b){const h=$(),k=n(!0),T=n([]),N=n(0),A=n([]),x=n([]),w=n([]),r=ye({pageNo:1,pageSize:10,configId:void 0,configLevel:void 0,productId:void 0,deviceId:void 0,processStatus:void 0,createTime:[]}),R=n(),F=Ie(()=>r.productId?w.value.filter(i=>i.productId===r.productId):w.value),M=i=>{if(!i)return"-";const a=x.value.find(u=>u.id===i);return a?a.name:"\u52A0\u8F7D\u4E2D..."},z=i=>{if(!i)return"-";const a=w.value.find(u=>u.id===i);return a?a.deviceName:"\u52A0\u8F7D\u4E2D..."},y=async()=>{k.value=!0;try{const i=await Le(r);T.value=i.list,N.value=i.total}finally{k.value=!1}},E=()=>{r.pageNo=1,y()},P=()=>{R.value.resetFields(),E()},Y=()=>{r.deviceId=void 0};return Ve(async()=>{await y(),A.value=await re.getSimpleAlertConfigList(),x.value=await de.getSimpleProductList(),w.value=await ie.getSimpleDeviceList()}),(i,a)=>{const u=ce,g=pe,c=ue,q=ne,L=ee,I=me,G=se,U=te,s=ve,C=ae,H=ge,j=fe,Z=le,J=he("hasPermi"),Q=_e;return d(),m(f,null,[l(U,null,{default:o(()=>[l(G,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:R,inline:!0,"label-width":"68px"},{default:o(()=>[l(c,{label:"\u544A\u8B66\u914D\u7F6E",prop:"configId"},{default:o(()=>[l(g,{modelValue:t(r).configId,"onUpdate:modelValue":a[0]||(a[0]=e=>t(r).configId=e),placeholder:"\u8BF7\u9009\u62E9\u544A\u8B66\u914D\u7F6E",clearable:"",filterable:"",class:"!w-240px"},{default:o(()=>[(d(!0),m(f,null,_(t(A),e=>(d(),p(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u544A\u8B66\u7EA7\u522B",prop:"configLevel"},{default:o(()=>[l(g,{modelValue:t(r).configLevel,"onUpdate:modelValue":a[1]||(a[1]=e=>t(r).configLevel=e),placeholder:"\u8BF7\u9009\u62E9\u544A\u8B66\u7EA7\u522B",clearable:"",class:"!w-240px"},{default:o(()=>[(d(!0),m(f,null,_(t(K)(t(V).IOT_ALERT_LEVEL),e=>(d(),p(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u4EA7\u54C1",prop:"productId"},{default:o(()=>[l(g,{modelValue:t(r).productId,"onUpdate:modelValue":a[2]||(a[2]=e=>t(r).productId=e),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",filterable:"",onChange:Y,class:"!w-240px"},{default:o(()=>[(d(!0),m(f,null,_(t(x),e=>(d(),p(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u8BBE\u5907",prop:"deviceId"},{default:o(()=>[l(g,{modelValue:t(r).deviceId,"onUpdate:modelValue":a[3]||(a[3]=e=>t(r).deviceId=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907",clearable:"",filterable:"",class:"!w-240px"},{default:o(()=>[(d(!0),m(f,null,_(t(F),e=>(d(),p(u,{key:e.id,label:e.deviceName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u662F\u5426\u5904\u7406",prop:"processStatus"},{default:o(()=>[l(g,{modelValue:t(r).processStatus,"onUpdate:modelValue":a[4]||(a[4]=e=>t(r).processStatus=e),placeholder:"\u8BF7\u9009\u62E9\u662F\u5426\u5904\u7406",clearable:"",class:"!w-240px"},{default:o(()=>[(d(!0),m(f,null,_(t(W)(t(V).INFRA_BOOLEAN_STRING),e=>(d(),p(u,{key:String(e.value),label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:o(()=>[l(q,{modelValue:t(r).createTime,"onUpdate:modelValue":a[5]||(a[5]=e=>t(r).createTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-220px"},null,8,["modelValue","default-time"])]),_:1}),l(c,null,{default:o(()=>[l(I,{onClick:E},{default:o(()=>[l(L,{icon:"ep:search",class:"mr-5px"}),a[8]||(a[8]=v(" \u641C\u7D22"))]),_:1}),l(I,{onClick:P},{default:o(()=>[l(L,{icon:"ep:refresh",class:"mr-5px"}),a[9]||(a[9]=v(" \u91CD\u7F6E"))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(U,null,{default:o(()=>[B((d(),p(j,{"row-key":"id",data:t(T),stripe:!0,"show-overflow-tooltip":!0},{default:o(()=>[l(s,{label:"\u8BB0\u5F55\u7F16\u53F7",align:"center",prop:"id"}),l(s,{label:"\u544A\u8B66\u540D\u79F0",align:"center",prop:"configName"}),l(s,{label:"\u544A\u8B66\u7EA7\u522B",align:"center",prop:"configLevel"},{default:o(e=>[l(C,{type:t(V).IOT_ALERT_LEVEL,value:e.row.configLevel},null,8,["type","value"])]),_:1}),l(s,{label:"\u4EA7\u54C1\u540D\u79F0",align:"center",prop:"productId"},{default:o(e=>[v(S(M(e.row.productId)),1)]),_:1}),l(s,{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"deviceId"},{default:o(e=>[v(S(z(e.row.deviceId)),1)]),_:1}),l(s,{label:"\u89E6\u53D1\u7684\u8BBE\u5907\u6D88\u606F",align:"center",prop:"deviceMessage"},{default:o(e=>[e.row.deviceMessage?(d(),p(H,{key:0,placement:"top-start",width:600,trigger:"hover"},{reference:o(()=>[l(I,{link:"",type:"primary"},{default:o(()=>[l(L,{icon:"ep:view",class:"mr-5px"}),a[10]||(a[10]=v(" \u67E5\u770B\u6D88\u606F "))]),_:1})]),default:o(()=>[ke("pre",null,S(e.row.deviceMessage),1)]),_:2},1024)):(d(),m("span",Te,"-"))]),_:1}),l(s,{label:"\u662F\u5426\u5904\u7406",align:"center",prop:"processStatus"},{default:o(e=>[l(C,{type:t(V).INFRA_BOOLEAN_STRING,value:e.row.processStatus},null,8,["type","value"])]),_:1}),l(s,{label:"\u5904\u7406\u7ED3\u679C",align:"center",prop:"processRemark"}),l(s,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(oe),width:"180px"},null,8,["formatter"]),l(s,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:o(e=>[e.row.processStatus?xe("",!0):B((d(),p(I,{key:0,link:"",type:"primary",onClick:Ae=>(async X=>{try{const{value:D}=await be.prompt("\u8BF7\u8F93\u5165\u5904\u7406\u539F\u56E0","\u5904\u7406\u544A\u8B66\u8BB0\u5F55",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"});await Se(X.id,D),h.success("\u5904\u7406\u6210\u529F"),await y()}catch{}})(e.row)},{default:o(()=>a[11]||(a[11]=[v(" \u5904\u7406 ")])),_:2},1032,["onClick"])),[[J,["iot:alert-record:process"]]])]),_:1})]),_:1},8,["data"])),[[Q,t(k)]]),l(Z,{total:t(N),page:t(r).pageNo,"onUpdate:page":a[6]||(a[6]=e=>t(r).pageNo=e),limit:t(r).pageSize,"onUpdate:limit":a[7]||(a[7]=e=>t(r).pageSize=e),onPagination:y},null,8,["total","page","limit"])]),_:1})],64)}}});export{Ne as default};
