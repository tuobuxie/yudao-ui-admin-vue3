import{p as j,d as ae,_ as le,F as te,E as v,L as oe}from"./index-D_TWD7wt.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{_ as re}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4_WNC8um.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-ZV0RCuCp.js";import{l as se,r,e as pe,A as x,q as V,B as i,J as a,C as ue,Z as de,u as l,G as g,E as J,H as ce,h as me}from"./form-create-_84fGzaM.js";import{g as fe}from"./index-D9DKyOnS.js";import{d as ve}from"./formatTime-BGPGB_ys.js";import{h as ge,d as we}from"./tree-COGD3qag.js";import{g as he}from"./category-BhERuDqD.js";import{g as ke,d as ye}from"./spu-gjdwZNJW.js";import{i as _e,j as Se,k as be,a1 as xe,F as Ve,f as Ce,Z as Pe,_ as Te,al as Ue,ak as Be}from"./form-designer-DHHJWkD5.js";import{_ as Ie}from"./SkuList.vue_vue_type_style_index_0_lang-C4BhLemM.js";const ze=se({name:"PromotionSpuSelect",__name:"SpuSelect",props:{isSelectSku:j.bool.def(!1),radio:j.bool.def(!1)},emits:["confirm"],setup(B,{expose:K,emit:M}){const C=B,w=ae(),I=r(0),z=r([]),P=r(!1),f=r(!1),D=r(""),s=r({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),T=r([]),U=r(),R=r(),h=r(),k=r(!1),y=r(),d=r(0),m=r([]),Z=t=>{var u;const e=(u=R.value)==null?void 0:u.getSkuTableRef();if(d.value===0)return w.warning("\u8BF7\u5148\u9009\u62E9\u5546\u54C1\u518D\u9009\u62E9\u76F8\u5E94\u7684\u89C4\u683C\uFF01\uFF01\uFF01"),void(e==null?void 0:e.clearSelection());if(t.length!==0)if(C.radio){if(m.value=[t.map(n=>n.id)[0]],t.length>1)return e==null||e.clearSelection(),void(e==null?void 0:e.toggleRowSelection(t.pop(),!0))}else m.value=t.map(n=>n.id);else m.value=[]},q=t=>{var e,u;if(t.length!==0){if(d.value=t.map(n=>n.id)[0],m.value.length>0&&(m.value=[]),t.length>1)return(e=U.value)==null||e.clearSelection(),void((u=U.value)==null?void 0:u.toggleRowSelection(t.pop(),!0));E(t[0],t)}else d.value=0},E=async(t,e)=>{var n,S;if(d.value!==0){if(t.id!==d.value)return w.warning("\u4F60\u5DF2\u9009\u62E9\u5546\u54C1\u8BF7\u5148\u53D6\u6D88"),void(y.value=[d.value]);if(k.value&&((n=h.value)==null?void 0:n.id)===t.id)return}if(h.value={},T.value=[],k.value=!1,(e==null?void 0:e.length)===0)return void(y.value=[]);const u=await ke(t.id);(S=u.skus)==null||S.forEach(p=>{p.price=v(p.price),p.marketPrice=v(p.marketPrice),p.costPrice=v(p.costPrice),p.firstBrokeragePrice=v(p.firstBrokeragePrice),p.secondBrokeragePrice=v(p.secondBrokeragePrice)}),T.value=fe(u),h.value=u,k.value=!0,y.value=[t.id]},L=M,A=()=>{d.value!==0?C.isSelectSku&&m.value.length===0?w.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1\u5C5E\u6027"):(C.isSelectSku?L("confirm",d.value,m.value):L("confirm",d.value),f.value=!1,d.value=0,m.value=[]):w.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1")};K({open:()=>{D.value="\u5546\u54C1\u9009\u62E9",f.value=!0}});const _=async()=>{P.value=!0;try{const t=await ye(s.value);z.value=t.list,I.value=t.total}finally{P.value=!1}},N=()=>{_()},G=()=>{s.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},_()},Y=r();return pe(async()=>{await _();const t=await he({});Y.value=ge(t,"id","parentId")}),(t,e)=>{const u=be,n=Se,S=xe,p=Ve,F=le,b=Ce,O=_e,c=Te,Q=Ue,W=ne,X=re,$=ie,ee=Be;return V(),x($,{modelValue:l(f),"onUpdate:modelValue":e[6]||(e[6]=o=>me(f)?f.value=o:null),appendToBody:!0,title:l(D),width:"70%"},{footer:i(()=>[a(b,{type:"primary",onClick:A},{default:i(()=>e[9]||(e[9]=[g("\u786E \u5B9A")])),_:1}),a(b,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:i(()=>e[10]||(e[10]=[g("\u53D6 \u6D88")])),_:1})]),default:i(()=>[a(X,null,{default:i(()=>[a(O,{gutter:20,class:"mb-10px"},{default:i(()=>[a(n,{span:6},{default:i(()=>[a(u,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=o=>l(s).name=o),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:de(N,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{span:6},{default:i(()=>[a(S,{modelValue:l(s).categoryId,"onUpdate:modelValue":e[1]||(e[1]=o=>l(s).categoryId=o),data:l(Y),props:l(we),"check-strictly":"",class:"w-1/1","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),a(n,{span:6},{default:i(()=>[a(p,{modelValue:l(s).createTime,"onUpdate:modelValue":e[2]||(e[2]=o=>l(s).createTime=o),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(n,{span:6},{default:i(()=>[a(b,{onClick:N},{default:i(()=>[a(F,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=g(" \u641C\u7D22 "))]),_:1}),a(b,{onClick:G},{default:i(()=>[a(F,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=g(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1}),ue((V(),x(l(Pe),{ref_key:"spuListRef",ref:U,data:l(z),"expand-row-keys":l(y),"row-key":"id",onExpandChange:E,onSelectionChange:q},{default:i(()=>[B.isSelectSku?(V(),x(c,{key:0,type:"expand",width:"30"},{default:i(()=>[l(k)?(V(),x(l(Ie),{key:0,ref_key:"skuListRef",ref:R,isComponent:!0,isDetail:!0,"prop-form-data":l(h),"property-list":l(T),onSelectionChange:Z},null,8,["prop-form-data","property-list"])):J("",!0)]),_:1})):J("",!0),a(c,{type:"selection",width:"55"}),a(c,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id"}),a(c,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:i(({row:o})=>[a(Q,{src:o.picUrl,class:"h-30px w-30px",onClick:De=>{return H=o.picUrl,void oe({zIndex:99999999,urlList:[H]});var H}},null,8,["src","onClick"])]),_:1}),a(c,{"show-overflow-tooltip":!0,label:"\u5546\u54C1\u540D\u79F0","min-width":"300",prop:"name"}),a(c,{align:"center",label:"\u5546\u54C1\u552E\u4EF7","min-width":"90",prop:"price"},{default:i(({row:o})=>[g(ce(l(te)(o.price)),1)]),_:1}),a(c,{align:"center",label:"\u9500\u91CF","min-width":"90",prop:"salesCount"}),a(c,{align:"center",label:"\u5E93\u5B58","min-width":"90",prop:"stock"}),a(c,{align:"center",label:"\u6392\u5E8F","min-width":"70",prop:"sort"}),a(c,{formatter:l(ve),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180"},null,8,["formatter"])]),_:1},8,["data","expand-row-keys"])),[[ee,l(P)]]),a(W,{limit:l(s).pageSize,"onUpdate:limit":e[3]||(e[3]=o=>l(s).pageSize=o),page:l(s).pageNo,"onUpdate:page":e[4]||(e[4]=o=>l(s).pageNo=o),total:l(I),onPagination:_},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}}});export{ze as _};
