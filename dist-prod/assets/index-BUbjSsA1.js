import{_ as H}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{u as L,e as M,d as O,_ as T,c as U}from"./index-B2urM1q-.js";import{u as W}from"./tagsView-DIbur9wp.js";import{C as q}from"./constants-C3gLHYOK.js";import{g as z,u as G,c as K}from"./index-BPr8rvT-.js";import{_ as $}from"./BasicInfo.vue_vue_type_script_setup_true_lang-CHh3wku0.js";import F from"./WorkflowDesign-BSczp9f2.js";import{M as P}from"./index-D1CYwmNH.js";import{A as Q}from"./constants-CHvLs4wt.js";import{f as X}from"./form-designer-DHHJWkD5.js";import{l as Y,r as o,e as Z,A,q as u,B as C,x as r,J as v,u as s,H as y,m as E,I as ee,$ as ae,D as j,G as te,E as R,h as D,p as re}from"./form-create-_84fGzaM.js";const se={class:"mx-auto"},le={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},oe={class:"w-200px flex items-center overflow-hidden"},ie=["title"],ne={class:"flex-1 flex items-center justify-center h-full"},ce={class:"w-400px flex items-center justify-between h-full"},ue=["onClick"],fe={class:"text-16px font-bold whitespace-nowrap"},pe={class:"w-200px flex items-center justify-end gap-2"},de={class:"mt-50px"},me={key:0,class:"mx-auto w-560px"},we=Y({__name:"index",setup(ve){const c=L(),{delView:h}=W(),b=M(),f=O(),g=o(),k=o(),p=async()=>{var a;await((a=g.value)==null?void 0:a.validate())},d=async()=>{var a;await((a=k.value)==null?void 0:a.validate())},l=o(-1),I=[{title:"\u57FA\u672C\u4FE1\u606F",validator:p},{title:"\u5DE5\u4F5C\u6D41\u8BBE\u8BA1",validator:d}],t=o({id:void 0,name:"",code:"",remark:"",graph:"",status:q.ENABLE}),_=o([]),m=o({});re("workflowData",m);const V=b.params.type,J=async()=>{try{await(async()=>{try{try{await p()}catch{throw l.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await d()}catch{throw l.value=1,new Error("\u8BF7\u5B8C\u5584\u5DE5\u4F5C\u6D41\u4FE1\u606F")}return!0}catch(e){throw e}})();const a={...t.value,graph:JSON.stringify(m.value)};V==="update"?await G(a):await K(a),f.success("\u4FDD\u5B58\u6210\u529F"),h(s(c.currentRoute)),await c.push({name:"AiWorkflow"})}catch(a){f.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},N=()=>{h(s(c.currentRoute)),c.push({name:"AiWorkflow"})};return Z(async()=>{await(async()=>{if(V==="update"){const e=b.params.id;t.value=await z(e),m.value=JSON.parse(t.value.graph)}const a=await P.getModelSimpleList(Q.CHAT);_.value={llm:()=>a.map(({id:e,name:w})=>({value:e,label:w})),knowledge:()=>[],internal:()=>[]},l.value=0})()}),(a,e)=>{const w=T,S=X,B=H;return u(),A(B,null,{default:C(()=>[r("div",se,[r("div",le,[r("div",oe,[v(w,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:N}),r("span",{class:"ml-10px text-16px truncate",title:s(t).name||"\u521B\u5EFA\u6D41\u7A0B"},y(s(t).name||"\u521B\u5EFA\u6D41\u7A0B"),9,ie)]),r("div",ne,[r("div",ce,[(u(),E(ee,null,ae(I,(i,n)=>r("div",{key:n,class:j(["flex items-center cursor-pointer mx-15px relative h-full",[s(l)===n?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:ye=>(async x=>{try{x!==0&&await p(),x!==1&&await d(),l.value=x}catch{f.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(n)},[r("div",{class:j(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[s(l)===n?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},y(n+1),3),r("span",fe,y(i.title),1)],10,ue)),64))])]),r("div",pe,[v(S,{type:"primary",onClick:J},{default:C(()=>e[2]||(e[2]=[te(" \u4FDD \u5B58 ")])),_:1})])]),r("div",de,[s(l)===0?(u(),E("div",me,[v($,{modelValue:s(t),"onUpdate:modelValue":e[0]||(e[0]=i=>D(t)?t.value=i:null),ref_key:"basicInfoRef",ref:g},null,8,["modelValue"])])):R("",!0),s(l)===1?(u(),A(F,{key:1,modelValue:s(t),"onUpdate:modelValue":e[1]||(e[1]=i=>D(t)?t.value=i:null),provider:s(_),ref_key:"workflowDesignRef",ref:k},null,8,["modelValue","provider"])):R("",!0)])])]),_:1})}}}),xe=U(we,[["__scopeId","data-v-0f3fd8af"]]);export{xe as default};
