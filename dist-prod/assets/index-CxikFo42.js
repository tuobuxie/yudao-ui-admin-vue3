import{d as ue,_ as ce,D as fe,B as ve,c as xe}from"./index-D_TWD7wt.js";import{_ as ye}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4_WNC8um.js";import{_ as _e}from"./DictTag.vue_vue_type_script_lang-BD_Qe0UA.js";import{l as be,r as n,e as ge,aa as ke,m as R,q as f,J as a,B as i,x as t,u as e,H as k,A as C,E as T,G as $,h as ee,C as A,K as ae,I as Te,n as he}from"./form-create-_84fGzaM.js";import{f as Ie}from"./formatTime-BGPGB_ys.js";import{B as O,a as S}from"./constants-C3gLHYOK.js";import{b as Ne}from"./formCreate-BIGK0pmc.js";import{g as Ce,a as we}from"./index-BjYtO2bM.js";import{g as Ee}from"./index-tmtszvF2.js";import Be from"./ProcessInstanceBpmnViewer-BNWI6Tur.js";import{_ as Pe}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-DC7FPlT-.js";import{_ as Ue}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-BpzakL6S.js";import Ve from"./ProcessInstanceOperationButton-k6ceXzuG.js";import{_ as Re}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-CloJBl5V.js";import{F as D}from"./consts-CvaDWb4S.js";import{T as w}from"./index-BqzMtKKc.js";import{_ as Ae}from"./PrintDialog.vue_vue_type_style_index_0_lang-D_FQ9OxU.js";import{e as Oe,V as Se,ah as De,a0 as Me,$ as je,i as Fe,j as Le,ak as Ke}from"./form-designer-DHHJWkD5.js";import"./bpmn-embedded-DmfAvFEq.js";import"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import"./XTextButton-DLsQA9Na.js";import"./XButton-D2DbA0bE.js";import"./index-DWAKVBMX.js";import"./node-DGa8QpOR.js";import"./index-BCN8BzfC.js";import"./utils-DciZ0SJK.js";import"./index-DtDcjRGr.js";import"./tree-COGD3qag.js";import"./index-D0Shdg27.js";import"./index-2u6l8ymH.js";import"./index-bRiUJ-Wq.js";import"./index-Dr_KpYqc.js";import"./index.vue_vue_type_script_setup_true_lang-ZV0RCuCp.js";import"./index-E0v7Hq2g.js";import"./index-BNl68Exi.js";import"./simple-process-designer-0Rw0PNOz.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-BaqkTJqn.js";import"./index-BLgxU3BI.js";import"./download-oWiM5xVU.js";import"./SignDialog.vue_vue_type_script_setup_true_lang-C11JZzoM.js";import"./index-CZA7FiKL.js";const ze={class:"processInstance-wrap-main"},Ge=["src"],Je={class:"flex"},Ye={class:"text-#878c93 h-15px"},qe={class:"flex items-center gap-5 mb-10px h-40px"},He={class:"text-26px font-bold mb-5px"},Qe={class:"flex items-center gap-5 mb-10px text-13px h-35px"},We={class:"bg-gray-100 h-35px rounded-3xl flex items-center p-8px gap-2 dark:color-gray-600"},Xe={class:"text-#878c93"},Ze={class:"form-scroll-area"},$e={class:"form-box flex flex-col mb-30px flex-1"},ea={key:1},aa={class:"form-scroll-area"},sa={class:"form-scroll-area"},oa={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},la=xe(be({name:"BpmProcessInstanceDetail",__name:"index",props:{id:{},taskId:{},activityId:{}},setup(se){const _=se,M=ue(),v=n(!1),o=n({}),m=n({}),h=n({}),j=n(),oe={[w.RUNNING]:"/assets/running-Cm4KjmYZ.svg",[w.APPROVE]:"/assets/approve-BQD8ihNj.svg",[w.REJECT]:"/assets/reject-C_en7x-2.svg",[w.CANCEL]:"/assets/cancel-Cn_ivYkt.svg"},p=n(),d=n({rule:[],option:{},value:{}}),E=[],F=()=>{le(),re()},L=n(null),K=n([]),le=async()=>{var r,s;v.value=!0;try{const x={processInstanceId:_.id,activityId:_.activityId,taskId:_.taskId},l=await Ce(x);if(!l)return void M.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(!l.processDefinition||!l.processInstance)return void M.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");if(o.value=l.processInstance,m.value=l.processDefinition,m.value.formType===O.NORMAL){const u=l.formFieldsPermission;E.splice(0),((r=d.value.rule)==null?void 0:r.length)>0?d.value.value=o.value.formVariables:Ne(d,m.value.formConf,m.value.formFields,o.value.formVariables),he().then(()=>{var b,I,y;(b=p.value)==null||b.btn.show(!1),(I=p.value)==null||I.resetBtn.show(!1),(y=p.value)==null||y.disabled(!0),u&&Object.keys(l.formFieldsPermission).forEach(N=>{ie(N,u[N])})})}else L.value=ve(l.processDefinition.formCustomViewPath);K.value=l.activityNodes,(s=j.value)==null||s.loadTodoTask(l.todoTask)}finally{v.value=!1}},re=async()=>{var s;S.BPMN===((s=m.value)==null?void 0:s.modelType)&&(h.value={bpmnXml:""});const r=await we(_.id);r&&(h.value=r)},ie=(r,s)=>{var x,l,u;s===D.READ&&((x=p.value)==null||x.disabled(!0,r)),s===D.WRITE&&((l=p.value)==null||l.disabled(!1,r),E.push(r)),s===D.NONE&&((u=p.value)==null||u.hidden(!0,r))},te=()=>{F()},z=n(),me=async()=>{z.value.open(_.id)},B=n("form"),G=n([]);return ge(async()=>{F(),G.value=await Ee()}),(r,s)=>{const x=ce,l=Se,u=_e,b=De,I=ke("form-create"),y=Le,N=Fe,P=Oe,U=je,ne=Me,pe=ye,de=Ke;return f(),R(Te,null,[a(pe,{bodyStyle:{padding:"10px 20px 0"},class:"position-relative"},{default:i(()=>[t("div",ze,[a(P,null,{default:i(()=>{var J,Y,q,H,Q,W,X,Z;return[t("img",{class:"position-absolute right-20px",width:"150",src:oe[e(o).status],alt:""},null,8,Ge),t("div",Je,[t("div",Ye,"\u7F16\u53F7\uFF1A"+k(r.id),1),a(x,{icon:"ep:printer",class:"ml-15px cursor-pointer",onClick:me})]),a(l,{class:"!my-8px"}),t("div",qe,[t("div",He,k(e(o).name),1),e(o).status?(f(),C(u,{key:0,type:e(fe).BPM_PROCESS_INSTANCE_STATUS,value:e(o).status},null,8,["type","value"])):T("",!0)]),t("div",Qe,[t("div",We,[(Y=(J=e(o))==null?void 0:J.startUser)!=null&&Y.avatar?(f(),C(b,{key:0,size:28,src:(H=(q=e(o))==null?void 0:q.startUser)==null?void 0:H.avatar},null,8,["src"])):(W=(Q=e(o))==null?void 0:Q.startUser)!=null&&W.nickname?(f(),C(b,{key:1,size:28},{default:i(()=>{var c,g;return[$(k((g=(c=e(o))==null?void 0:c.startUser)==null?void 0:g.nickname.substring(0,1)),1)]}),_:1})):T("",!0),$(" "+k((Z=(X=e(o))==null?void 0:X.startUser)==null?void 0:Z.nickname),1)]),t("div",Xe,k(e(Ie)(e(o).startTime))+" \u63D0\u4EA4 ",1)]),a(ne,{modelValue:e(B),"onUpdate:modelValue":s[2]||(s[2]=c=>ee(B)?B.value=c:null)},{default:i(()=>[a(U,{label:"\u5BA1\u6279\u8BE6\u60C5",name:"form"},{default:i(()=>[t("div",Ze,[a(P,null,{default:i(()=>[a(N,null,{default:i(()=>[a(y,{span:17,class:"!flex !flex-col formCol"},{default:i(()=>{var c,g;return[A((f(),R("div",$e,[((c=e(m))==null?void 0:c.formType)===e(O).NORMAL?(f(),C(y,{key:0},{default:i(()=>[a(I,{modelValue:e(d).value,"onUpdate:modelValue":s[0]||(s[0]=V=>e(d).value=V),api:e(p),"onUpdate:api":s[1]||(s[1]=V=>ee(p)?p.value=V:null),option:e(d).option,rule:e(d).rule},null,8,["modelValue","api","option","rule"])]),_:1})):T("",!0),((g=e(m))==null?void 0:g.formType)===e(O).CUSTOM?(f(),R("div",ea,[a(e(L),{id:e(o).businessKey},null,8,["id"])])):T("",!0)])),[[de,e(v)]])]}),_:1}),a(y,{span:7},{default:i(()=>[a(Re,{"activity-nodes":e(K)},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(U,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:i(()=>[t("div",aa,[A(a(Pe,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[ae,e(m).modelType&&e(m).modelType===e(S).SIMPLE]]),A(a(Be,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[ae,e(m).modelType&&e(m).modelType===e(S).BPMN]])])]),_:1}),a(U,{label:"\u6D41\u8F6C\u8BB0\u5F55",name:"record"},{default:i(()=>[t("div",sa,[a(P,null,{default:i(()=>[a(Ue,{loading:e(v),id:r.id},null,8,["loading","id"])]),_:1})])]),_:1}),T("",!0)]),_:1},8,["modelValue"]),t("div",oa,[a(Ve,{ref_key:"operationButtonRef",ref:j,"process-instance":e(o),"process-definition":e(m),userOptions:e(G),"normal-form":e(d),"normal-form-api":e(p),"writable-fields":E,onSuccess:te},null,8,["process-instance","process-definition","userOptions","normal-form","normal-form-api"])])]}),_:1})])]),_:1}),a(Ae,{ref_key:"printRef",ref:z},null,512)],64)}}}),[["__scopeId","data-v-be84bcf8"]]);export{la as default};
