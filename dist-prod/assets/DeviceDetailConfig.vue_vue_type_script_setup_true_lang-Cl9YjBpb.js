import{d as F,aF as y,N as G}from"./index-B2urM1q-.js";import{_ as I}from"./JsonEditor-ptu02USn.js";import{D as g}from"./index-DM-qCYCO.js";import{k as M}from"./constants-D46CCSyK.js";import{R as U,f as j}from"./form-designer-DHHJWkD5.js";import{l as q,r as t,w as A,m as B,q as n,J as k,x as H,u as i,h as P,A as d,E as _,B as v,G as m}from"./form-create-_84fGzaM.js";const R={class:"mt-5 text-center"},z=q({name:"DeviceDetailConfig",__name:"DeviceDetailConfig",props:{device:{}},emits:["success"],setup(h,{emit:w}){const u=h,C=w,o=F(),p=t(!1),f=t(!1),a=t({}),l=t(!1);A(()=>{a.value=y(u.device.config)});const s=t(!1),D=()=>{s.value=!0,l.value=!1},N=()=>{a.value=y(u.device.config),s.value=!1,l.value=!1},x=async()=>{l.value?o.error("JSON\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u4FEE\u6B63\u540E\u518D\u63D0\u4EA4\uFF01"):(await O(),s.value=!1)},J=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u63A8\u9001\u914D\u7F6E\u5230\u8BBE\u5907\u5417\uFF1F\u6B64\u64CD\u4F5C\u5C06\u8FDC\u7A0B\u66F4\u65B0\u8BBE\u5907\u914D\u7F6E\u3002","\u914D\u7F6E\u63A8\u9001\u786E\u8BA4"),f.value=!0,await g.sendDeviceMessage({deviceId:u.device.id,method:M.CONFIG_PUSH.method,params:a.value}),o.success("\u914D\u7F6E\u63A8\u9001\u6210\u529F\uFF01")}catch(c){c!=="cancel"&&o.error("\u914D\u7F6E\u63A8\u9001\u5931\u8D25\uFF01")}finally{f.value=!1}},O=async()=>{try{p.value=!0,await g.updateDevice({id:u.device.id,config:JSON.stringify(a.value)}),o.success("\u66F4\u65B0\u6210\u529F\uFF01"),C("success")}catch{}finally{p.value=!1}},S=c=>{G(c)?l.value=!1:l.value=!0};return(c,e)=>{const V=U,b=I,r=j;return n(),B("div",null,[k(V,{title:"\u652F\u6301\u8FDC\u7A0B\u66F4\u65B0\u8BBE\u5907\u7684\u914D\u7F6E\u6587\u4EF6(JSON \u683C\u5F0F)\uFF0C\u53EF\u4EE5\u5728\u4E0B\u65B9\u7F16\u8F91\u914D\u7F6E\u6A21\u677F\uFF0C\u5BF9\u8BBE\u5907\u7684\u7CFB\u7EDF\u53C2\u6570\u3001\u7F51\u7EDC\u53C2\u6570\u7B49\u8FDB\u884C\u8FDC\u7A0B\u914D\u7F6E\u3002\u914D\u7F6E\u5B8C\u6210\u540E\uFF0C\u9700\u70B9\u51FB\u300C\u4E0B\u53D1\u300D\u6309\u94AE\uFF0C\u8BBE\u5907\u5373\u53EF\u8FDB\u884C\u8FDC\u7A0B\u914D\u7F6E\u3002",type:"info","show-icon":"",class:"my-4",description:"\u5982\u9700\u7F16\u8F91\u6587\u4EF6\uFF0C\u8BF7\u70B9\u51FB\u4E0B\u65B9\u7F16\u8F91\u6309\u94AE"}),k(b,{modelValue:i(a),"onUpdate:modelValue":e[0]||(e[0]=E=>P(a)?a.value=E:null),mode:i(s)?"code":"view",height:"600px",onError:S},null,8,["modelValue","mode"]),H("div",R,[i(s)?(n(),d(r,{key:0,onClick:N},{default:v(()=>e[1]||(e[1]=[m("\u53D6\u6D88")])),_:1})):_("",!0),i(s)?(n(),d(r,{key:1,type:"primary",onClick:x,disabled:i(l)},{default:v(()=>e[2]||(e[2]=[m(" \u4FDD\u5B58 ")])),_:1},8,["disabled"])):(n(),d(r,{key:2,onClick:D},{default:v(()=>e[3]||(e[3]=[m("\u7F16\u8F91")])),_:1})),i(s)?_("",!0):(n(),d(r,{key:3,type:"success",onClick:J,loading:i(f)},{default:v(()=>e[4]||(e[4]=[m(" \u914D\u7F6E\u63A8\u9001 ")])),_:1},8,["loading"]))])])}}});export{z as _};
