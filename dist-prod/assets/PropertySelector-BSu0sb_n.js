import{aE as G,_ as H,c as J}from"./index-D_TWD7wt.js";import{x as K,aw as Q,Q as U,a6 as F,n as W,f as X,b4 as Z}from"./form-designer-DHHJWkD5.js";import{p as g,T as h,b as o,B as S,C as ee,E as te,d as ae,c as se}from"./constants-CaEZMpg0.js";import{T as re}from"./index-DxCMWBFB.js";import{l as le,r as P,c as b,b as I,m as c,q as i,J as v,A as V,E as d,u as a,h as ie,B as u,I as _,$ as w,x as r,H as p,G as R}from"./form-create-_84fGzaM.js";const pe={class:"flex items-center gap-8px"},ne={class:"flex items-center justify-between w-full py-2px"},oe={class:"text-14px font-500 text-[var(--el-text-color-primary)] flex-1 truncate"},ce={class:"property-detail-content"},xe={class:"flex items-center gap-8px mb-12px"},de={class:"text-14px font-500 text-[var(--el-text-color-primary)]"},ue={class:"space-y-8px ml-24px"},fe={class:"flex items-start gap-8px"},ye={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},me={key:0,class:"flex items-start gap-8px"},ve={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},Ee={key:1,class:"flex items-start gap-8px"},Te={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},ge={key:2,class:"flex items-start gap-8px"},he={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},Pe={key:3,class:"flex items-start gap-8px"},Ve={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},ke={key:4,class:"flex items-start gap-8px"},Se={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},be={key:5,class:"flex items-start gap-8px"},Ie={class:"text-12px text-[var(--el-text-color-primary)] flex-1"},_e=J(le({name:"PropertySelector",__name:"PropertySelector",props:{modelValue:{},triggerType:{},productId:{},deviceId:{}},emits:["update:modelValue","change"],setup(C,{emit:A}){const x=C,k=A,y=G(x,"modelValue",k),E=P(!1),n=P([]),T=P(null),O=b(()=>{const t=[];return x.triggerType===g.DEVICE_PROPERTY_POST&&t.push({label:h.PROPERTY,options:n.value.filter(e=>e.type===o.PROPERTY)}),x.triggerType===g.DEVICE_EVENT_POST&&t.push({label:h.EVENT,options:n.value.filter(e=>e.type===o.EVENT)}),x.triggerType===g.DEVICE_SERVICE_INVOKE&&t.push({label:h.SERVICE,options:n.value.filter(e=>e.type===o.SERVICE)}),t.filter(e=>e.options.length>0)}),l=b(()=>n.value.find(t=>t.identifier===y.value)),q=t=>{const e=n.value.find(s=>s.identifier===t);e&&k("change",{type:e.dataType,config:e})},N=()=>{const t=T.value,e=[];t&&(t.properties&&Array.isArray(t.properties)&&t.properties.forEach(s=>{e.push({identifier:s.identifier,name:s.name,description:s.description,dataType:s.dataType,type:o.PROPERTY,accessMode:s.accessMode,required:s.required,unit:M(s),range:Y(s),property:s})}),t.events&&Array.isArray(t.events)&&t.events.forEach(s=>{e.push({identifier:s.identifier,name:s.name,description:s.description,dataType:"struct",type:o.EVENT,eventType:s.type,required:s.required,outputParams:s.outputParams,event:s})}),t.services&&Array.isArray(t.services)&&t.services.forEach(s=>{e.push({identifier:s.identifier,name:s.name,description:s.description,dataType:"struct",type:o.SERVICE,callType:s.callType,required:s.required,inputParams:s.inputParams,outputParams:s.outputParams,service:s})})),n.value=e},M=t=>{if(t)return t.dataSpecs&&t.dataSpecs.unit?t.dataSpecs.unit:void 0},Y=t=>{if(t){if(t.dataSpecs){const e=t.dataSpecs;if(e.min!==void 0&&e.max!==void 0)return`${e.min}~${e.max}`}return t.dataSpecsList&&Array.isArray(t.dataSpecsList)?t.dataSpecsList.map(e=>`${e.name}(${e.value})`).join(", "):void 0}};return I(()=>x.productId,()=>{(async()=>{if(!x.productId)return T.value=null,void(n.value=[]);E.value=!0;try{const t=await re.getThingModelTSLByProductId(x.productId);t?(T.value=t,N()):n.value=[]}catch{n.value=[]}finally{E.value=!1}})()},{immediate:!0}),I(()=>x.triggerType,()=>{y.value=""}),(t,e)=>{const s=F,$=U,L=Q,z=K,B=X,D=H,j=W;return i(),c("div",pe,[v(z,{modelValue:a(y),"onUpdate:modelValue":e[0]||(e[0]=m=>ie(y)?y.value=m:null),placeholder:"\u8BF7\u9009\u62E9\u76D1\u63A7\u9879",filterable:"",clearable:"",onChange:q,class:"!w-150px",loading:a(E)},{default:u(()=>[(i(!0),c(_,null,w(a(O),m=>(i(),V(L,{key:m.label,label:m.label},{default:u(()=>[(i(!0),c(_,null,w(m.options,f=>(i(),V($,{key:f.identifier,label:f.name,value:f.identifier},{default:u(()=>[r("div",ne,[r("span",oe,p(f.name),1),v(s,{type:a(S)(f.dataType),size:"small",class:"ml-8px flex-shrink-0"},{default:u(()=>[R(p(f.identifier),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","loading"]),a(l)?(i(),V(j,{key:0,placement:"right-start",width:350,trigger:"click","show-arrow":!0,offset:8,"popper-class":"property-detail-popover"},{reference:u(()=>[v(B,{type:"info",icon:a(Z),circle:"",size:"small",class:"flex-shrink-0",title:"\u67E5\u770B\u5C5E\u6027\u8BE6\u60C5"},null,8,["icon"])]),default:u(()=>[r("div",ce,[r("div",xe,[v(D,{icon:"ep:info-filled",class:"text-[var(--el-color-info)] text-16px"}),r("span",de,p(a(l).name),1),v(s,{type:a(S)(a(l).dataType),size:"small"},{default:u(()=>[R(p(a(ee)(a(l).dataType)),1)]),_:1},8,["type"])]),r("div",ue,[r("div",fe,[e[1]||(e[1]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u6807\u8BC6\u7B26\uFF1A ",-1)),r("span",ye,p(a(l).identifier),1)]),a(l).description?(i(),c("div",me,[e[2]||(e[2]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u63CF\u8FF0\uFF1A ",-1)),r("span",ve,p(a(l).description),1)])):d("",!0),a(l).unit?(i(),c("div",Ee,[e[3]||(e[3]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u5355\u4F4D\uFF1A ",-1)),r("span",Te,p(a(l).unit),1)])):d("",!0),a(l).range?(i(),c("div",ge,[e[4]||(e[4]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u53D6\u503C\u8303\u56F4\uFF1A ",-1)),r("span",he,p(a(l).range),1)])):d("",!0),a(l).type===a(o).PROPERTY&&a(l).accessMode?(i(),c("div",Pe,[e[5]||(e[5]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u8BBF\u95EE\u6A21\u5F0F\uFF1A ",-1)),r("span",Ve,p(a(te)(a(l).accessMode)),1)])):d("",!0),a(l).type===a(o).EVENT&&a(l).eventType?(i(),c("div",ke,[e[6]||(e[6]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u4E8B\u4EF6\u7C7B\u578B\uFF1A ",-1)),r("span",Se,p(a(ae)(a(l).eventType)),1)])):d("",!0),a(l).type===a(o).SERVICE&&a(l).callType?(i(),c("div",be,[e[7]||(e[7]=r("span",{class:"text-12px text-[var(--el-text-color-secondary)] min-w-60px flex-shrink-0"}," \u8C03\u7528\u7C7B\u578B\uFF1A ",-1)),r("span",Ie,p(a(se)(a(l).callType)),1)])):d("",!0)])])]),_:1})):d("",!0)])}}}),[["__scopeId","data-v-cfa62b02"]]);export{_e as default};
