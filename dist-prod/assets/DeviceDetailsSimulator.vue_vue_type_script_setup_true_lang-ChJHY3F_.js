import{d as W}from"./index-DmQdxAiK.js";import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{a as N,D as E}from"./index-m3HcIj_K.js";import{_ as ee}from"./DeviceDetailsMessage.vue_vue_type_script_setup_true_lang-BQimBrW0.js";import{_ as R}from"./DataDefinition.vue_vue_type_script_setup_true_lang-fr0wvk2b.js";import{b as D,k as s}from"./constants-BFrNJh5I.js";import{i as ae,j as te,a0 as le,$ as ie,Z as de,_ as re,k as ne,f as oe}from"./form-designer-DHHJWkD5.js";import{l as se,r as b,c as J,A as M,q as $,B as a,J as e,u as r,h as Y,E as F,x as S,G as u,H as z}from"./form-create-_84fGzaM.js";const fe={class:"flex justify-between items-center mt-4"},ue={class:"flex gap-4"},me={class:"flex justify-between items-center mt-4"},T=2e3,ce=se({__name:"DeviceDetailsSimulator",props:{product:{},device:{},thingModelList:{}},setup(K){const h=K,o=W(),v=b("upstream"),k=b(s.PROPERTY_POST.method),I=b(s.PROPERTY_SET.method),w=b(),L=b({}),U=d=>h.thingModelList.filter(t=>t.type===d),O=J(()=>U(D.PROPERTY)),q=J(()=>U(D.EVENT)),B=J(()=>U(D.SERVICE)),m=d=>d&&L.value[String(d)]||"",V=(d,t)=>{d&&(L.value[String(d)]=t)},G=async()=>{const d={};if(O.value.forEach(t=>{const i=m(t.identifier);i&&t.identifier&&(d[String(t.identifier)]=i)}),Object.keys(d).length!==0)try{await E.sendDeviceMessage({deviceId:h.device.id,method:s.PROPERTY_POST.method,params:d}),o.success("\u5C5E\u6027\u4E0A\u62A5\u6210\u529F"),w.value.refresh(T)}catch{o.error("\u5C5E\u6027\u4E0A\u62A5\u5931\u8D25")}else o.warning("\u8BF7\u81F3\u5C11\u8BBE\u7F6E\u4E00\u4E2A\u5C5E\u6027\u503C")},j=async d=>{try{await E.sendDeviceMessage({deviceId:h.device.id,method:s.STATE_UPDATE.method,params:{state:d}}),o.success(`\u8BBE\u5907${d===N.ONLINE?"\u4E0A\u7EBF":"\u4E0B\u7EBF"}\u6210\u529F`),w.value.refresh(T)}catch{o.error(`\u8BBE\u5907${d===N.ONLINE?"\u4E0A\u7EBF":"\u4E0B\u7EBF"}\u5931\u8D25`)}},H=async()=>{const d={};if(O.value.forEach(t=>{const i=m(t.identifier);i&&t.identifier&&(d[String(t.identifier)]=i)}),Object.keys(d).length!==0)try{await E.sendDeviceMessage({deviceId:h.device.id,method:s.PROPERTY_SET.method,params:d}),o.success("\u5C5E\u6027\u8BBE\u7F6E\u6210\u529F"),w.value.refresh(T)}catch{o.error("\u5C5E\u6027\u8BBE\u7F6E\u5931\u8D25")}else o.warning("\u8BF7\u81F3\u5C11\u8BBE\u7F6E\u4E00\u4E2A\u5C5E\u6027\u503C")};return(d,t)=>{const i=re,x=ne,P=de,_=oe,c=X,p=ie,C=le,A=te,Z=ae;return $(),M(c,null,{default:a(()=>[e(Z,{gutter:20},{default:a(()=>[e(A,{span:12},{default:a(()=>[e(C,{modelValue:r(v),"onUpdate:modelValue":t[4]||(t[4]=l=>Y(v)?v.value=l:null),type:"border-card"},{default:a(()=>[e(p,{label:"\u4E0A\u884C\u6307\u4EE4\u8C03\u8BD5",name:"upstream"},{default:a(()=>[r(v)==="upstream"?($(),M(C,{key:0,modelValue:r(k),"onUpdate:modelValue":t[2]||(t[2]=l=>Y(k)?k.value=l:null)},{default:a(()=>[e(p,{label:"\u5C5E\u6027\u4E0A\u62A5",name:r(s).PROPERTY_POST.method},{default:a(()=>[e(c,null,{default:a(()=>[e(P,{data:r(O),"show-overflow-tooltip":!0,stripe:!0},{default:a(()=>[e(i,{fixed:"left",align:"center",label:"\u529F\u80FD\u540D\u79F0",prop:"name",width:"120"}),e(i,{fixed:"left",align:"center",label:"\u6807\u8BC6\u7B26",prop:"identifier",width:"120"}),e(i,{align:"center",label:"\u6570\u636E\u7C7B\u578B",width:"100"},{default:a(({row:l})=>{var n;return[u(z(((n=l.property)==null?void 0:n.dataType)??"-"),1)]}),_:1}),e(i,{align:"left",label:"\u6570\u636E\u5B9A\u4E49","min-width":"200"},{default:a(({row:l})=>[e(r(R),{data:l},null,8,["data"])]),_:1}),e(i,{fixed:"right",align:"center",label:"\u503C",width:"150"},{default:a(l=>[e(x,{"model-value":m(l.row.identifier),"onUpdate:modelValue":n=>V(l.row.identifier,n),placeholder:"\u8F93\u5165\u503C",size:"small"},null,8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),S("div",fe,[t[6]||(t[6]=S("span",{class:"text-sm text-gray-600"}," \u8BBE\u7F6E\u5C5E\u6027\u503C\u540E\uFF0C\u70B9\u51FB\u300C\u53D1\u9001\u5C5E\u6027\u4E0A\u62A5\u300D\u6309\u94AE ",-1)),e(_,{type:"primary",onClick:G},{default:a(()=>t[5]||(t[5]=[u("\u53D1\u9001\u5C5E\u6027\u4E0A\u62A5")])),_:1})])]),_:1})]),_:1},8,["name"]),e(p,{label:"\u4E8B\u4EF6\u4E0A\u62A5",name:r(s).EVENT_POST.method},{default:a(()=>[e(c,null,{default:a(()=>[e(P,{data:r(q),"show-overflow-tooltip":!0,stripe:!0},{default:a(()=>[e(i,{fixed:"left",align:"center",label:"\u529F\u80FD\u540D\u79F0",prop:"name",width:"120"}),e(i,{fixed:"left",align:"center",label:"\u6807\u8BC6\u7B26",prop:"identifier",width:"120"}),e(i,{align:"center",label:"\u6570\u636E\u7C7B\u578B",width:"100"},{default:a(({row:l})=>{var n;return[u(z(((n=l.event)==null?void 0:n.dataType)??"-"),1)]}),_:1}),e(i,{align:"left",label:"\u6570\u636E\u5B9A\u4E49","min-width":"200"},{default:a(({row:l})=>[e(r(R),{data:l},null,8,["data"])]),_:1}),e(i,{align:"center",label:"\u503C",width:"200"},{default:a(l=>[e(x,{"model-value":m(l.row.identifier),"onUpdate:modelValue":n=>V(l.row.identifier,n),type:"textarea",rows:3,placeholder:"\u8F93\u5165\u4E8B\u4EF6\u53C2\u6570\uFF08JSON\u683C\u5F0F\uFF09",size:"small"},null,8,["model-value","onUpdate:modelValue"])]),_:1}),e(i,{fixed:"right",align:"center",label:"\u64CD\u4F5C",width:"100"},{default:a(l=>[e(_,{type:"primary",size:"small",onClick:n=>(async f=>{const g=m(f.identifier);if(!g)return void o.warning("\u8BF7\u8F93\u5165\u4E8B\u4EF6\u53C2\u6570");let y;try{y=JSON.parse(g)}catch{return void o.error("\u4E8B\u4EF6\u53C2\u6570\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u8F93\u5165\u6709\u6548\u7684JSON\u683C\u5F0F")}try{await E.sendDeviceMessage({deviceId:h.device.id,method:s.EVENT_POST.method,params:{identifier:String(f.identifier),value:y,time:Date.now()}}),o.success(`\u4E8B\u4EF6\u3010${String(f.name)}\u3011\u4E0A\u62A5\u6210\u529F`),w.value.refresh(T)}catch{o.error(`\u4E8B\u4EF6\u3010${String(f.name)}\u3011\u4E0A\u62A5\u5931\u8D25`)}})(l.row)},{default:a(()=>t[7]||(t[7]=[u(" \u4E0A\u62A5\u4E8B\u4EF6 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["name"]),e(p,{label:"\u72B6\u6001\u53D8\u66F4",name:r(s).STATE_UPDATE.method},{default:a(()=>[e(c,null,{default:a(()=>[S("div",ue,[e(_,{type:"primary",onClick:t[0]||(t[0]=l=>j(r(N).ONLINE))},{default:a(()=>t[8]||(t[8]=[u(" \u8BBE\u5907\u4E0A\u7EBF ")])),_:1}),e(_,{type:"danger",onClick:t[1]||(t[1]=l=>j(r(N).OFFLINE))},{default:a(()=>t[9]||(t[9]=[u(" \u8BBE\u5907\u4E0B\u7EBF ")])),_:1})])]),_:1})]),_:1},8,["name"])]),_:1},8,["modelValue"])):F("",!0)]),_:1}),e(p,{label:"\u4E0B\u884C\u6307\u4EE4\u8C03\u8BD5",name:"downstream"},{default:a(()=>[r(v)==="downstream"?($(),M(C,{key:0,modelValue:r(I),"onUpdate:modelValue":t[3]||(t[3]=l=>Y(I)?I.value=l:null)},{default:a(()=>[e(p,{label:"\u5C5E\u6027\u8BBE\u7F6E",name:r(s).PROPERTY_SET.method},{default:a(()=>[e(c,null,{default:a(()=>[e(P,{data:r(O),"show-overflow-tooltip":!0,stripe:!0},{default:a(()=>[e(i,{fixed:"left",align:"center",label:"\u529F\u80FD\u540D\u79F0",prop:"name",width:"120"}),e(i,{fixed:"left",align:"center",label:"\u6807\u8BC6\u7B26",prop:"identifier",width:"120"}),e(i,{align:"center",label:"\u6570\u636E\u7C7B\u578B",width:"100"},{default:a(({row:l})=>{var n;return[u(z(((n=l.property)==null?void 0:n.dataType)??"-"),1)]}),_:1}),e(i,{align:"left",label:"\u6570\u636E\u5B9A\u4E49","min-width":"200"},{default:a(({row:l})=>[e(r(R),{data:l},null,8,["data"])]),_:1}),e(i,{fixed:"right",align:"center",label:"\u503C",width:"150"},{default:a(l=>[e(x,{"model-value":m(l.row.identifier),"onUpdate:modelValue":n=>V(l.row.identifier,n),placeholder:"\u8F93\u5165\u503C",size:"small"},null,8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),S("div",me,[t[11]||(t[11]=S("span",{class:"text-sm text-gray-600"}," \u8BBE\u7F6E\u5C5E\u6027\u503C\u540E\uFF0C\u70B9\u51FB\u300C\u53D1\u9001\u5C5E\u6027\u8BBE\u7F6E\u300D\u6309\u94AE ",-1)),e(_,{type:"primary",onClick:H},{default:a(()=>t[10]||(t[10]=[u("\u53D1\u9001\u5C5E\u6027\u8BBE\u7F6E")])),_:1})])]),_:1})]),_:1},8,["name"]),e(p,{label:"\u8BBE\u5907\u670D\u52A1\u8C03\u7528",name:r(s).SERVICE_INVOKE.method},{default:a(()=>[e(c,null,{default:a(()=>[e(P,{data:r(B),"show-overflow-tooltip":!0,stripe:!0},{default:a(()=>[e(i,{fixed:"left",align:"center",label:"\u670D\u52A1\u540D\u79F0",prop:"name",width:"120"}),e(i,{fixed:"left",align:"center",label:"\u6807\u8BC6\u7B26",prop:"identifier",width:"120"}),e(i,{align:"left",label:"\u8F93\u5165\u53C2\u6570","min-width":"200"},{default:a(({row:l})=>[e(r(R),{data:l},null,8,["data"])]),_:1}),e(i,{align:"center",label:"\u53C2\u6570\u503C",width:"200"},{default:a(l=>[e(x,{"model-value":m(l.row.identifier),"onUpdate:modelValue":n=>V(l.row.identifier,n),type:"textarea",rows:3,placeholder:"\u8F93\u5165\u670D\u52A1\u53C2\u6570\uFF08JSON\u683C\u5F0F\uFF09",size:"small"},null,8,["model-value","onUpdate:modelValue"])]),_:1}),e(i,{fixed:"right",align:"center",label:"\u64CD\u4F5C",width:"100"},{default:a(l=>[e(_,{type:"primary",size:"small",onClick:n=>(async f=>{const g=m(f.identifier);if(!g)return void o.warning("\u8BF7\u8F93\u5165\u670D\u52A1\u53C2\u6570");let y;try{y=JSON.parse(g)}catch{return void o.error("\u670D\u52A1\u53C2\u6570\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u8F93\u5165\u6709\u6548\u7684JSON\u683C\u5F0F")}try{await E.sendDeviceMessage({deviceId:h.device.id,method:s.SERVICE_INVOKE.method,params:{identifier:String(f.identifier),inputParams:y}}),o.success(`\u670D\u52A1\u3010${String(f.name)}\u3011\u8C03\u7528\u6210\u529F`),w.value.refresh(T)}catch{o.error(`\u670D\u52A1\u3010${String(f.name)}\u3011\u8C03\u7528\u5931\u8D25`)}})(l.row)},{default:a(()=>t[12]||(t[12]=[u(" \u670D\u52A1\u8C03\u7528 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["name"])]),_:1},8,["modelValue"])):F("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(A,{span:12},{default:a(()=>[e(c,{title:"\u8BBE\u5907\u6D88\u606F"},{default:a(()=>[e(ee,{ref_key:"deviceMessageRef",ref:w,"device-id":d.device.id},null,8,["device-id"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{ce as _};
