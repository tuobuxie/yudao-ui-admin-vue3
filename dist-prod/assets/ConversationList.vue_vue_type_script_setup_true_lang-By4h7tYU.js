import{d as ae,_ as le}from"./index-D_TWD7wt.js";import{l as te,r as m,a5 as se,b as oe,e as ie,A as z,q as v,B as l,x as u,J as a,G as T,h as L,u as n,E as I,m as M,$ as O,H as P,I as G,O as ne,C as re,K as ce,N as E}from"./form-create-_84fGzaM.js";import{C as h}from"./index-yBeRpogp.js";import{_ as ue}from"./RoleRepository.vue_vue_type_style_index_0_lang-Ci1PCZR5.js";import{T as de,f as ve,k as pe,aU as fe,a7 as me,b as ye,aV as Ce,aW as we,aH as xe,O as he,M as ge}from"./form-designer-DHHJWkD5.js";import{r as ke}from"./gpt-WhTktY3S.js";const _e={class:"h-100%"},be={class:"overflow-auto h-full"},Me={key:0,class:"mt-1.25 pt-2.5"},Ve=["onClick","onMouseover"],je={class:"flex flex-row items-center"},ze=["src"],Te={class:"py-0.5 px-2.5",style:{"max-width":"220px","font-size":"14px","font-weight":"400",color:"var(--el-text-color-regular)",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Ie={class:"right-0.5 flex flex-row justify-center",style:{color:"var(--el-text-color-regular)"}},Se={class:"absolute bottom-0 left-0 right-0 px-5 leading-8.75 flex justify-between items-center",style:{"background-color":"var(--el-fill-color-extra-light)","box-shadow":"0 0 1px 1px var(--el-border-color-lighter)",color:"var(--el-text-color)"}},Ue=te({__name:"ConversationList",props:{activeId:{type:String||null,required:!0}},emits:["onConversationCreate","onConversationClick","onConversationClear","onConversationDelete"],setup(J,{expose:N,emit:W}){const V=ae(),g=m(""),p=m(null),S=m(null),r=m([]),y=m({}),j=m(!1),U=m(),$=J,C=W,F=async s=>{if(g.value.trim().length){const e=r.value.filter(o=>o.title.includes(g.value.trim()));y.value=await D(e)}else y.value=await D(r.value)},H=async s=>{const e=r.value.filter(o=>o.id===s);C("onConversationClick",e[0])&&(p.value=s)},w=async()=>{try{if(U.value=setTimeout(()=>{j.value=!0},50),r.value=await h.getChatConversationMyList(),r.value.sort((s,e)=>e.createTime-s.createTime),r.value.length===0)return p.value=null,void(y.value={});y.value=await D(r.value)}finally{U.value&&clearTimeout(U.value),j.value=!1}},D=async s=>{const e={\u7F6E\u9876:[],\u4ECA\u5929:[],\u4E00\u5929\u524D:[],\u4E09\u5929\u524D:[],\u4E03\u5929\u524D:[],\u4E09\u5341\u5929\u524D:[]},o=Date.now(),d=864e5,q=3*d,A=7*d,_=30*d;for(const t of s){if(t.pinned){e.\u7F6E\u9876.push(t);continue}const x=o-t.createTime;x<d?e.\u4ECA\u5929.push(t):x<q?e.\u4E00\u5929\u524D.push(t):x<A?e.\u4E09\u5929\u524D.push(t):x<_?e.\u4E03\u5929\u524D.push(t):e.\u4E09\u5341\u5929\u524D.push(t)}return e},K=async()=>{const s=await h.createChatConversationMy({});await w(),await H(s),C("onConversationCreate")},Q=async()=>{try{await V.confirm("\u786E\u8BA4\u540E\u5BF9\u8BDD\u4F1A\u5168\u90E8\u6E05\u7A7A\uFF0C\u7F6E\u9876\u7684\u5BF9\u8BDD\u9664\u5916\u3002"),await h.deleteChatConversationMyByUnpinned(),ge({message:"\u64CD\u4F5C\u6210\u529F!",type:"success"}),p.value=null,await w(),C("onConversationClear")}catch{}},k=m(!1),R=async()=>{k.value=!k.value},{activeId:X}=se($);return oe(X,async(s,e)=>{p.value=s}),N({createConversation:K}),ie(async()=>{await w(),$.activeId?p.value=$.activeId:r.value.length&&(p.value=r.value[0].id,await C("onConversationClick",r.value[0]))}),(s,e)=>{const o=le,d=ve,q=pe,A=fe,_=me,t=ye,x=xe,Y=de;return v(),z(Y,{width:"260px",class:"h-100% relative flex flex-col justify-between px-2.5 pt-2.5 pb-0 overflow-hidden"},{default:l(()=>[u("div",_e,[a(d,{class:"w-1/1 py-4.5",type:"primary",onClick:K},{default:l(()=>[a(o,{icon:"ep:plus",class:"mr-5px"}),e[3]||(e[3]=T(" \u65B0\u5EFA\u5BF9\u8BDD "))]),_:1}),a(q,{modelValue:n(g),"onUpdate:modelValue":e[0]||(e[0]=f=>L(g)?g.value=f:null),size:"large",class:"mt-5",placeholder:"\u641C\u7D22\u5386\u53F2\u8BB0\u5F55",onKeyup:F},{prefix:l(()=>[a(o,{icon:"ep:search"})]),_:1},8,["modelValue"]),u("div",be,[n(j)?(v(),z(A,{key:0,description:".","v-loading":n(j)},null,8,["v-loading"])):I("",!0),(v(!0),M(G,null,O(Object.keys(n(y)),f=>(v(),M("div",{key:f},[n(y)[f].length?(v(),M("div",Me,[a(_,{class:"mx-1",size:"small",tag:"b"},{default:l(()=>[T(P(f),1)]),_:2},1024)])):I("",!0),(v(!0),M(G,null,O(n(y)[f],i=>(v(),M("div",{class:"mt-1.25",key:i.id,onClick:b=>H(i.id),onMouseover:b=>S.value=i.id,onMouseout:e[1]||(e[1]=b=>S.value="")},[u("div",{class:"flex flex-row justify-between flex-1 px-1.25 cursor-pointer rounded-1.25 items-center leading-7.5",style:ne(i.id===n(p)?"background-color: var(--el-color-primary-light-9); border: 1px solid var(--el-color-primary-light-7);":"")},[u("div",je,[u("img",{class:"w-6.25 h-6.25 rounded-1.25 flex flex-row justify-center",src:i.roleAvatar||n(ke)},null,8,ze),u("span",Te,P(i.title),1)]),re(u("div",Ie,[a(d,{class:"m-0",link:"",onClick:E(b=>(async c=>{c.pinned=!c.pinned,await h.updateChatConversationMy(c),await w()})(i),["stop"])},{default:l(()=>[i.pinned?I("",!0):(v(),z(t,{key:0,title:"\u7F6E\u9876"},{default:l(()=>[a(n(Ce))]),_:1})),i.pinned?(v(),z(t,{key:1,title:"\u7F6E\u9876"},{default:l(()=>[a(n(we))]),_:1})):I("",!0)]),_:2},1032,["onClick"]),a(d,{class:"m-0",link:"",onClick:E(b=>(async c=>{const{value:Z}=await he.prompt("\u4FEE\u6539\u6807\u9898",{inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",inputValue:c.title});await h.updateChatConversationMy({id:c.id,title:Z}),V.success("\u91CD\u547D\u540D\u6210\u529F"),await w();const B=r.value.filter(ee=>ee.id===c.id);B.length>0&&p.value===B[0].id&&C("onConversationClick",B[0])})(i),["stop"])},{default:l(()=>[a(t,{title:"\u7F16\u8F91"},{default:l(()=>[a(o,{icon:"ep:edit"})]),_:1})]),_:2},1032,["onClick"]),a(d,{class:"m-0",link:"",onClick:E(b=>(async c=>{try{await V.delConfirm(`\u662F\u5426\u786E\u8BA4\u5220\u9664\u5BF9\u8BDD - ${c.title}?`),await h.deleteChatConversationMy(c.id),V.success("\u5BF9\u8BDD\u5DF2\u5220\u9664"),await w(),C("onConversationDelete",c)}catch{}})(i),["stop"])},{default:l(()=>[a(t,{title:"\u5220\u9664\u5BF9\u8BDD"},{default:l(()=>[a(o,{icon:"ep:delete"})]),_:1})]),_:2},1032,["onClick"])],512),[[ce,n(S)===i.id]])],4)],40,Ve))),128))]))),128)),e[4]||(e[4]=u("div",{class:"h-160px w-100%"},null,-1))])]),u("div",Se,[u("div",{class:"flex items-center p-0 m-0 cursor-pointer",style:{color:"var(--el-text-color-regular)"},onClick:R},[a(o,{icon:"ep:user"}),a(_,{class:"ml-1.25",size:"small"},{default:l(()=>e[5]||(e[5]=[T("\u89D2\u8272\u4ED3\u5E93")])),_:1})]),u("div",{class:"flex items-center p-0 m-0 cursor-pointer",style:{color:"var(--el-text-color-regular)"},onClick:Q},[a(o,{icon:"ep:delete"}),a(_,{class:"ml-1.25",size:"small"},{default:l(()=>e[6]||(e[6]=[T("\u6E05\u7A7A\u672A\u7F6E\u9876\u5BF9\u8BDD")])),_:1})])]),a(x,{modelValue:n(k),"onUpdate:modelValue":e[2]||(e[2]=f=>L(k)?k.value=f:null),title:"\u89D2\u8272\u4ED3\u5E93",size:"754px"},{default:l(()=>[a(ue)]),_:1},8,["modelValue"])]),_:1})}}});export{Ue as _};
