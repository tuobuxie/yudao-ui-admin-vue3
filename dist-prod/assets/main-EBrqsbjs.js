import{X as j,d as J,c as M}from"./index-B2urM1q-.js";import{_ as W}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{R as x}from"./TabNews-BJTup0AO.js";import A from"./main-C-KGxakD.js";import D from"./MsgList-CQYy0dCp.js";import{g as G}from"./index-Dgz_ZBu-.js";import{ak as K,f as P}from"./form-designer-DHHJWkD5.js";import{l as X,r as c,j as H,e as F,A as L,q as p,B as C,x as f,C as T,m as _,E as b,J as h,u as s,h as Q,G as Y,n as O}from"./form-create-_84fGzaM.js";const R=y=>j.get({url:"/mp/message/page",params:y}),Z={key:0},$={key:1,class:"el-table__empty-block"},ee={class:"msg-send"},U=M(X({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(y){const V=J(),I=y,m=c(-1),d=c(!1),k=c(!0),o=c([]),r=H({pageNo:1,pageSize:14,accountId:m}),i=H({nickname:"\u7528\u6237",avatar:"/assets/profile-BiJdjH9E.jpg",accountId:m}),S=c(!1),l=c({type:x.Text,accountId:-1,articles:[]}),N=c(null),t=c(null);F(async()=>{var e,u;const a=await G(I.userId);i.nickname=((e=a.nickname)==null?void 0:e.length)>0?a.nickname:i.nickname,i.avatar=((u=a.headImageUrl)==null?void 0:u.length)>0?a.headImageUrl:i.avatar,m.value=a.accountId,l.value.accountId=a.accountId,E()});const q=async()=>{var e;if(!s(l))return;l.value.type===x.News&&l.value.articles&&l.value.articles.length>1&&(l.value.articles=[l.value.articles[0]],V.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(u=>j.post({url:"/mp/message/send",data:u}))({userId:I.userId,...l.value});S.value=!1,o.value=[...o.value,a],await z(),(e=N.value)==null||e.clear()},B=()=>{r.pageNo++,w(r,null)},w=async(a,e=null)=>{var g;d.value=!0;const u=await R(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:I.userId,accountId:a.accountId},e)),v=((g=t.value)==null?void 0:g.scrollHeight)??0,n=u.list.reverse();o.value=[...n,...o.value],d.value=!1,(n.length<r.pageSize||n.length===0)&&(k.value=!1),r.pageNo=a.pageNo,r.pageSize=a.pageSize,r.pageNo===1?await z():n.length!==0&&(await O(),v!==0&&t.value&&(t.value.scrollTop=t.value.scrollHeight-v-100))},E=()=>{w(r)},z=async()=>{await O(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return(a,e)=>{const u=P,v=W,n=K;return p(),L(v,null,{default:C(()=>[f("div",{class:"msg-div",ref_key:"msgDivRef",ref:t},[T(f("div",null,null,512),[[n,s(d)]]),s(d)?b("",!0):(p(),_("div",Z,[s(k)?(p(),_("div",{key:0,class:"el-table__empty-block",onClick:B},e[1]||(e[1]=[f("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1)]))):b("",!0),s(k)?b("",!0):(p(),_("div",$,e[2]||(e[2]=[f("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1)])))])),h(D,{list:s(o),"account-id":s(m),user:s(i)},null,8,["list","account-id","user"])],512),T((p(),_("div",ee,[h(s(A),{ref_key:"replySelectRef",ref:N,modelValue:s(l),"onUpdate:modelValue":e[0]||(e[0]=g=>Q(l)?l.value=g:null)},null,8,["modelValue"]),h(u,{type:"success",class:"send-but",onClick:q},{default:C(()=>e[3]||(e[3]=[Y("\u53D1\u9001(S)")])),_:1})])),[[n,s(S)]])]),_:1})}}}),[["__scopeId","data-v-f580aeeb"]]),ae=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{U as W,R as g,ae as m};
