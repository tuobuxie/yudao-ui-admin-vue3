import{a as J,d as M,a4 as L,D as W,_ as j}from"./index-B2urM1q-.js";import{_ as G}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{C as H}from"./constants-C3gLHYOK.js";import{g as $,c as Q,u as X}from"./index-DW48ffhY.js";import{h as Y,aj as Z,k as ee,s as le,u as ae,z as te,f as ie,ak as oe}from"./form-designer-DHHJWkD5.js";import{l as re,r as f,m as b,q as s,J as l,u as i,h as pe,B as t,C as ne,A as k,E as q,G as d,x as h,I as de,$ as ue,H as ce}from"./form-create-_84fGzaM.js";const se={key:0},me={key:1},fe=re({name:"WeixinChannelForm",__name:"WeixinChannelForm",emits:["success"],setup(ge,{expose:R,emit:U}){const{t:w}=J(),g=M(),u=f(!1),x=f(""),c=f(!1),a=f({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",certSerialNo:"",apiV3Key:"",publicKeyContent:"",publicKeyId:""}}),A={feeRate:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387",trigger:"blur"}],status:[{required:!0,message:"\u6E20\u9053\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.mchId":[{required:!0,message:"\u8BF7\u4F20\u5165\u5546\u6237\u53F7",trigger:"blur"}],"config.appId":[{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u4F17\u53F7APPID",trigger:"blur"}],"config.apiVersion":[{required:!0,message:"API\u7248\u672C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.mchKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u6237\u5BC6\u94A5",trigger:"blur"}],"config.keyContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20 apiclient_cert.p12 \u8BC1\u4E66",trigger:"blur"}],"config.privateKeyContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20 apiclient_key.pem \u8BC1\u4E66",trigger:"blur"}],"config.certSerialNo":[{required:!0,message:"\u8BF7\u8F93\u5165\u8BC1\u4E66\u5E8F\u5217\u53F7",trigger:"blur"}],"config.publicKeyId":[{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u94A5 ID",trigger:"blur"}],"config.apiV3Key":[{required:!0,message:"\u8BF7\u4E0A\u4F20 api V3 \u5BC6\u94A5\u503C",trigger:"blur"}]},y=f();R({open:async(p,e)=>{u.value=!0,c.value=!0,F(p,e);try{const r=await $(p,e);r&&r.id&&(a.value=r,a.value.config=JSON.parse(r.config)),x.value=a.value.id?"\u7F16\u8F91\u652F\u4ED8\u6E20\u9053":"\u521B\u5EFA\u652F\u4ED8\u6E20\u9053"}finally{c.value=!1}}});const P=U,S=async()=>{if(y&&await y.value.validate()){c.value=!0;try{const p={...a.value};p.config=JSON.stringify(a.value.config),p.id?(await X(p),g.success(w("common.updateSuccess"))):(await Q(p),g.success(w("common.createSuccess"))),u.value=!1,P("success")}finally{c.value=!1}}},F=(p,e)=>{var r;a.value={appId:p,code:e,status:H.ENABLE,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",certSerialNo:"",apiV3Key:"",publicKeyContent:"",publicKeyId:""}},(r=y.value)==null||r.resetFields()},K=(p,e)=>{if("."+p.name.split(".")[1]!==e)return g.error('\u8BF7\u4E0A\u4F20\u6307\u5B9A\u683C\u5F0F"'+e+'"\u6587\u4EF6'),!1;let r=p.size/1024/1024<2;return r||g.error("\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7 2MB"),r},N=p=>{K(p,".p12")},I=p=>{K(p,".pem")},D=async p=>{const e=new FileReader;e.onload=r=>{a.value.config.privateKeyContent=r.target.result},e.readAsText(p.file)},z=async p=>{const e=new FileReader;e.onload=r=>{a.value.config.keyContent=r.target.result.split(",")[1]},e.readAsDataURL(p.file)},O=async p=>{const e=new FileReader;e.onload=r=>{a.value.config.publicKeyContent=r.target.result},e.readAsText(p.file)};return(p,e)=>{const r=ee,n=Z,_=ae,C=le,V=j,m=ie,v=te,T=Y,B=G,E=oe;return s(),b("div",null,[l(B,{modelValue:i(u),"onUpdate:modelValue":e[14]||(e[14]=o=>pe(u)?u.value=o:null),title:i(x),width:"800px"},{footer:t(()=>[l(m,{disabled:i(c),type:"primary",onClick:S},{default:t(()=>e[25]||(e[25]=[d("\u786E \u5B9A")])),_:1},8,["disabled"]),l(m,{onClick:e[13]||(e[13]=o=>u.value=!1)},{default:t(()=>e[26]||(e[26]=[d("\u53D6 \u6D88")])),_:1})]),default:t(()=>[ne((s(),k(T,{ref_key:"formRef",ref:y,model:i(a),rules:A,"label-width":"120px"},{default:t(()=>[l(n,{label:"\u6E20\u9053\u8D39\u7387","label-width":"180px",prop:"feeRate"},{default:t(()=>[l(r,{modelValue:i(a).feeRate,"onUpdate:modelValue":e[0]||(e[0]=o=>i(a).feeRate=o),style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387"},{append:t(()=>e[15]||(e[15]=[d("%")])),_:1},8,["modelValue"])]),_:1}),l(n,{label:"\u5FAE\u4FE1 APPID","label-width":"180px",prop:"config.appId"},{default:t(()=>[l(r,{modelValue:i(a).config.appId,"onUpdate:modelValue":e[1]||(e[1]=o=>i(a).config.appId=o),style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5FAE\u4FE1 APPID"},null,8,["modelValue"])]),_:1}),l(n,{"label-width":"180px"},{default:t(()=>e[16]||(e[16]=[h("a",{href:"https://pay.weixin.qq.com/index.php/extend/merchant_appid/mapay_platform/account_manage",target:"_blank"}," \u524D\u5F80\u5FAE\u4FE1\u5546\u6237\u5E73\u53F0\u67E5\u770B APPID ",-1)])),_:1}),l(n,{label:"\u5546\u6237\u53F7","label-width":"180px",prop:"config.mchId"},{default:t(()=>[l(r,{modelValue:i(a).config.mchId,"onUpdate:modelValue":e[2]||(e[2]=o=>i(a).config.mchId=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{"label-width":"180px"},{default:t(()=>e[17]||(e[17]=[h("a",{href:"https://pay.weixin.qq.com/index.php/extend/pay_setting",target:"_blank"}," \u524D\u5F80\u5FAE\u4FE1\u5546\u6237\u5E73\u53F0\u67E5\u770B\u5546\u6237\u53F7 ",-1)])),_:1}),l(n,{label:"\u6E20\u9053\u72B6\u6001","label-width":"180px",prop:"status"},{default:t(()=>[l(C,{modelValue:i(a).status,"onUpdate:modelValue":e[3]||(e[3]=o=>i(a).status=o)},{default:t(()=>[(s(!0),b(de,null,ue(i(L)(i(W).COMMON_STATUS),o=>(s(),k(_,{key:parseInt(o.value),value:parseInt(o.value)},{default:t(()=>[d(ce(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"API \u7248\u672C","label-width":"180px",prop:"config.apiVersion"},{default:t(()=>[l(C,{modelValue:i(a).config.apiVersion,"onUpdate:modelValue":e[4]||(e[4]=o=>i(a).config.apiVersion=o)},{default:t(()=>[l(_,{value:"v2"},{default:t(()=>e[18]||(e[18]=[d("v2")])),_:1}),l(_,{value:"v3"},{default:t(()=>e[19]||(e[19]=[d("v3")])),_:1})]),_:1},8,["modelValue"])]),_:1}),i(a).config.apiVersion==="v2"?(s(),b("div",se,[l(n,{label:"\u5546\u6237\u5BC6\u94A5","label-width":"180px",prop:"config.mchKey"},{default:t(()=>[l(r,{modelValue:i(a).config.mchKey,"onUpdate:modelValue":e[5]||(e[5]=o=>i(a).config.mchKey=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u6237\u5BC6\u94A5"},null,8,["modelValue"])]),_:1}),l(n,{label:"apiclient_cert.p12 \u8BC1\u4E66","label-width":"180px",prop:"config.keyContent"},{default:t(()=>[l(r,{modelValue:i(a).config.keyContent,"onUpdate:modelValue":e[6]||(e[6]=o=>i(a).config.keyContent=o),autosize:{minRows:2,maxRows:4},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20 apiclient_cert.p12 \u8BC1\u4E66",readonly:"",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(n,{label:"","label-width":"180px"},{default:t(()=>[l(v,{"before-upload":N,"http-request":z,limit:1,accept:".p12",action:""},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[l(V,{class:"mr-5px",icon:"ep:upload"}),e[20]||(e[20]=d(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1})]),_:1})])):q("",!0),i(a).config.apiVersion==="v3"?(s(),b("div",me,[l(n,{label:"API V3 \u5BC6\u94A5","label-width":"180px",prop:"config.apiV3Key"},{default:t(()=>[l(r,{modelValue:i(a).config.apiV3Key,"onUpdate:modelValue":e[7]||(e[7]=o=>i(a).config.apiV3Key=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165 API V3 \u5BC6\u94A5"},null,8,["modelValue"])]),_:1}),l(n,{label:"apiclient_key.pem \u8BC1\u4E66","label-width":"180px",prop:"config.privateKeyContent"},{default:t(()=>[l(r,{modelValue:i(a).config.privateKeyContent,"onUpdate:modelValue":e[8]||(e[8]=o=>i(a).config.privateKeyContent=o),autosize:{minRows:2,maxRows:4},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20 apiclient_key.pem \u8BC1\u4E66",readonly:"",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(n,{label:"","label-width":"180px",prop:"privateKeyContentFile"},{default:t(()=>[l(v,{ref:"privateKeyContentFile","before-upload":I,"http-request":D,limit:1,accept:".pem",action:""},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[l(V,{class:"mr-5px",icon:"ep:upload"}),e[21]||(e[21]=d(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1},512)]),_:1}),l(n,{label:"\u8BC1\u4E66\u5E8F\u5217\u53F7","label-width":"180px",prop:"config.certSerialNo"},{default:t(()=>[l(r,{modelValue:i(a).config.certSerialNo,"onUpdate:modelValue":e[9]||(e[9]=o=>i(a).config.certSerialNo=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8BC1\u4E66\u5E8F\u5217\u53F7"},null,8,["modelValue"])]),_:1}),l(n,{"label-width":"180px"},{default:t(()=>e[22]||(e[22]=[h("a",{href:"https://pay.weixin.qq.com/index.php/core/cert/api_cert#/api-cert-manage",target:"_blank"}," \u524D\u5F80\u5FAE\u4FE1\u5546\u6237\u5E73\u53F0\u67E5\u770B\u8BC1\u4E66\u5E8F\u5217\u53F7 ",-1)])),_:1}),l(n,{label:"public_key.pem \u8BC1\u4E66","label-width":"180px",prop:"config.publicKeyContent"},{default:t(()=>[l(r,{modelValue:i(a).config.publicKeyContent,"onUpdate:modelValue":e[10]||(e[10]=o=>i(a).config.publicKeyContent=o),autosize:{minRows:2,maxRows:4},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20 public_key.pem \u8BC1\u4E66",readonly:"",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(n,{label:"","label-width":"180px",prop:"publicKeyContentFile"},{default:t(()=>[l(v,{ref:"publicKeyContentFile","before-upload":I,"http-request":O,limit:1,accept:".pem",action:""},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[l(V,{class:"mr-5px",icon:"ep:upload"}),e[23]||(e[23]=d(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1},512)]),_:1}),l(n,{label:"\u516C\u94A5 ID","label-width":"180px",prop:"config.publicKeyId"},{default:t(()=>[l(r,{modelValue:i(a).config.publicKeyId,"onUpdate:modelValue":e[11]||(e[11]=o=>i(a).config.publicKeyId=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u516C\u94A5 ID"},null,8,["modelValue"])]),_:1}),l(n,{"label-width":"180px"},{default:t(()=>e[24]||(e[24]=[h("a",{href:"https://pay.weixin.qq.com/doc/v3/merchant/4012153196",target:"_blank"}," \u5FAE\u4FE1\u652F\u4ED8\u516C\u94A5\u4EA7\u54C1\u7B80\u4ECB\u53CA\u4F7F\u7528\u8BF4\u660E ",-1)])),_:1})])):q("",!0),l(n,{label:"\u5907\u6CE8","label-width":"180px",prop:"remark"},{default:t(()=>[l(r,{modelValue:i(a).remark,"onUpdate:modelValue":e[12]||(e[12]=o=>i(a).remark=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[E,i(c)]])]),_:1},8,["modelValue","title"])])}}});export{fe as _};
