import{a as O,d as B,a4 as J,D as M,_ as $}from"./index-B2urM1q-.js";import{_ as j}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{C as G}from"./constants-C3gLHYOK.js";import{g as H,c as L,u as Q}from"./index-DW48ffhY.js";import{h as W,aj as X,k as Y,s as Z,u as ee,z as ae,f as le,ak as te}from"./form-designer-DHHJWkD5.js";import{l as oe,r as y,m as b,q as s,J as a,u as o,h as re,B as t,C as ie,A as K,E as x,G as p,I as ne,$ as de,H as pe}from"./form-create-_84fGzaM.js";const ue={key:0},se={key:1},ce={key:2},v=".crt",fe=oe({name:"AlipayChannelForm",__name:"AlipayChannelForm",emits:["success"],setup(me,{expose:k,emit:A}){const{t:R}=O(),C=B(),c=y(!1),U=y(""),f=y(!1),l=y({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",serverUrl:null,signType:"",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:"",encryptType:"",encryptKey:""}}),P={feeRate:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387",trigger:"blur"}],status:[{required:!0,message:"\u6E20\u9053\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.appId":[{required:!0,message:"\u8BF7\u8F93\u5165\u5F00\u653E\u5E73\u53F0\u4E0A\u521B\u5EFA\u7684\u5E94\u7528\u7684 ID",trigger:"blur"}],"config.serverUrl":[{required:!0,message:"\u8BF7\u4F20\u5165\u7F51\u5173\u5730\u5740",trigger:"blur"}],"config.signType":[{required:!0,message:"\u8BF7\u4F20\u5165\u7B7E\u540D\u7B97\u6CD5\u7C7B\u578B",trigger:"blur"}],"config.mode":[{required:!0,message:"\u516C\u94A5\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.privateKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u6237\u79C1\u94A5",trigger:"blur"}],"config.alipayPublicKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u652F\u4ED8\u5B9D\u516C\u94A5\u5B57\u7B26\u4E32",trigger:"blur"}],"config.appCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66",trigger:"blur"}],"config.alipayPublicCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66",trigger:"blur"}],"config.rootCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u6307\u5B9A\u6839\u8BC1\u4E66",trigger:"blur"}],"config.encryptKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5",trigger:"blur"}]},_=y();k({open:async(n,e)=>{c.value=!0,f.value=!0,I(n,e);try{const i=await H(n,e);i&&i.id&&(l.value=i,l.value.config=JSON.parse(i.config)),U.value=l.value.id?"\u7F16\u8F91\u652F\u4ED8\u6E20\u9053":"\u521B\u5EFA\u652F\u4ED8\u6E20\u9053"}finally{f.value=!1}}});const T=A,q=async()=>{if(_&&await _.value.validate()){f.value=!0;try{const n={...l.value};n.config=JSON.stringify(l.value.config),n.id?(await Q(n),C.success(R("common.updateSuccess"))):(await L(n),C.success(R("common.createSuccess"))),c.value=!1,T("success")}finally{f.value=!1}}},I=(n,e)=>{var i;l.value={appId:n,code:e,status:G.ENABLE,remark:"",feeRate:null,config:{appId:"",serverUrl:null,signType:"RSA2",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:"",encryptType:"",encryptKey:""}},(i=_.value)==null||i.resetFields()},w=n=>{if("."+n.name.split(".")[1]!==v)return C.error(`\u8BF7\u4E0A\u4F20\u6307\u5B9A\u683C\u5F0F"${v}"\u6587\u4EF6`),!1;let e=n.size/1024/1024<2;return e||C.error("\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7 2MB"),e},S=n=>{const e=new FileReader;e.onload=i=>{l.value.config.appCertContent=i.target.result},e.readAsText(n.file)},E=n=>{const e=new FileReader;e.onload=i=>{l.value.config.alipayPublicCertContent=i.target.result},e.readAsText(n.file)},F=n=>{const e=new FileReader;e.onload=i=>{l.value.config.rootCertContent=i.target.result},e.readAsText(n.file)};return(n,e)=>{const i=Y,d=X,u=ee,m=Z,V=$,g=le,h=ae,z=W,N=j,D=te;return s(),b("div",null,[a(N,{modelValue:o(c),"onUpdate:modelValue":e[16]||(e[16]=r=>re(c)?c.value=r:null),title:o(U),width:"830px",onClosed:n.close},{footer:t(()=>[a(g,{disabled:o(f),type:"primary",onClick:q},{default:t(()=>e[28]||(e[28]=[p("\u786E \u5B9A")])),_:1},8,["disabled"]),a(g,{onClick:e[15]||(e[15]=r=>c.value=!1)},{default:t(()=>e[29]||(e[29]=[p("\u53D6 \u6D88")])),_:1})]),default:t(()=>[ie((s(),K(z,{ref_key:"formRef",ref:_,model:o(l),rules:P,"label-width":"100px"},{default:t(()=>[a(d,{label:"\u6E20\u9053\u8D39\u7387","label-width":"180px",prop:"feeRate"},{default:t(()=>[a(i,{modelValue:o(l).feeRate,"onUpdate:modelValue":e[0]||(e[0]=r=>o(l).feeRate=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387"},{append:t(()=>e[17]||(e[17]=[p("%")])),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u5F00\u653E\u5E73\u53F0 APPID","label-width":"180px",prop:"config.appId"},{default:t(()=>[a(i,{modelValue:o(l).config.appId,"onUpdate:modelValue":e[1]||(e[1]=r=>o(l).config.appId=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5F00\u653E\u5E73\u53F0 APPID"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u6E20\u9053\u72B6\u6001","label-width":"180px",prop:"status"},{default:t(()=>[a(m,{modelValue:o(l).status,"onUpdate:modelValue":e[2]||(e[2]=r=>o(l).status=r)},{default:t(()=>[(s(!0),b(ne,null,de(o(J)(o(M).COMMON_STATUS),r=>(s(),K(u,{key:parseInt(r.value),value:parseInt(r.value)},{default:t(()=>[p(pe(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u7F51\u5173\u5730\u5740","label-width":"180px",prop:"config.serverUrl"},{default:t(()=>[a(m,{modelValue:o(l).config.serverUrl,"onUpdate:modelValue":e[3]||(e[3]=r=>o(l).config.serverUrl=r)},{default:t(()=>[a(u,{value:"https://openapi.alipay.com/gateway.do"},{default:t(()=>e[18]||(e[18]=[p("\u7EBF\u4E0A\u73AF\u5883")])),_:1}),a(u,{value:"https://openapi-sandbox.dl.alipaydev.com/gateway.do"},{default:t(()=>e[19]||(e[19]=[p(" \u6C99\u7BB1\u73AF\u5883 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u7B97\u6CD5\u7C7B\u578B","label-width":"180px",prop:"config.signType"},{default:t(()=>[a(m,{modelValue:o(l).config.signType,"onUpdate:modelValue":e[4]||(e[4]=r=>o(l).config.signType=r)},{default:t(()=>[a(u,{key:"RSA2",value:"RSA2"},{default:t(()=>e[20]||(e[20]=[p("RSA2")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u516C\u94A5\u7C7B\u578B","label-width":"180px",prop:"config.mode"},{default:t(()=>[a(m,{modelValue:o(l).config.mode,"onUpdate:modelValue":e[5]||(e[5]=r=>o(l).config.mode=r)},{default:t(()=>[a(u,{key:"\u516C\u94A5\u6A21\u5F0F",value:1},{default:t(()=>e[21]||(e[21]=[p("\u516C\u94A5\u6A21\u5F0F")])),_:1}),a(u,{key:"\u8BC1\u4E66\u6A21\u5F0F",value:2},{default:t(()=>e[22]||(e[22]=[p("\u8BC1\u4E66\u6A21\u5F0F")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(l).config.mode===1?(s(),b("div",ue,[a(d,{label:"\u5E94\u7528\u79C1\u94A5","label-width":"180px",prop:"config.privateKey"},{default:t(()=>[a(i,{modelValue:o(l).config.privateKey,"onUpdate:modelValue":e[6]||(e[6]=r=>o(l).config.privateKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u79C1\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u652F\u4ED8\u5B9D\u516C\u94A5","label-width":"180px",prop:"config.alipayPublicKey"},{default:t(()=>[a(i,{modelValue:o(l).config.alipayPublicKey,"onUpdate:modelValue":e[7]||(e[7]=r=>o(l).config.alipayPublicKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u652F\u4ED8\u5B9D\u516C\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1})])):x("",!0),o(l).config.mode===2?(s(),b("div",se,[a(d,{label:"\u5E94\u7528\u79C1\u94A5","label-width":"180px",prop:"config.privateKey"},{default:t(()=>[a(i,{modelValue:o(l).config.privateKey,"onUpdate:modelValue":e[8]||(e[8]=r=>o(l).config.privateKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u79C1\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66","label-width":"180px",prop:"config.appCertContent"},{default:t(()=>[a(i,{modelValue:o(l).config.appCertContent,"onUpdate:modelValue":e[9]||(e[9]=r=>o(l).config.appCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"","label-width":"180px"},{default:t(()=>[a(h,{ref:"privateKeyContentFile",accept:v,"before-upload":w,"http-request":S,limit:1,action:""},{default:t(()=>[a(g,{type:"primary"},{default:t(()=>[a(V,{class:"mr-5px",icon:"ep:upload"}),e[23]||(e[23]=p(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1},512)]),_:1}),a(d,{label:"\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66","label-width":"180px",prop:"config.alipayPublicCertContent"},{default:t(()=>[a(i,{modelValue:o(l).config.alipayPublicCertContent,"onUpdate:modelValue":e[10]||(e[10]=r=>o(l).config.alipayPublicCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"","label-width":"180px"},{default:t(()=>[a(h,{ref:"privateCertContentFile",accept:v,"before-upload":w,"http-request":E,limit:1,action:""},{default:t(()=>[a(g,{type:"primary"},{default:t(()=>[a(V,{class:"mr-5px",icon:"ep:upload"}),e[24]||(e[24]=p(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1},512)]),_:1}),a(d,{label:"\u6839\u8BC1\u4E66","label-width":"180px",prop:"config.rootCertContent"},{default:t(()=>[a(i,{modelValue:o(l).config.rootCertContent,"onUpdate:modelValue":e[11]||(e[11]=r=>o(l).config.rootCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u6839\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"","label-width":"180px"},{default:t(()=>[a(h,{ref:"privateCertContentFile",accept:v,"before-upload":w,"http-request":F,limit:1,action:""},{default:t(()=>[a(g,{type:"primary"},{default:t(()=>[a(V,{class:"mr-5px",icon:"ep:upload"}),e[25]||(e[25]=p(" \u70B9\u51FB\u4E0A\u4F20 "))]),_:1})]),_:1},512)]),_:1})])):x("",!0),a(d,{label:"\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u65B9\u5F0F","label-width":"180px",prop:"config.encryptType"},{default:t(()=>[a(m,{modelValue:o(l).config.encryptType,"onUpdate:modelValue":e[12]||(e[12]=r=>o(l).config.encryptType=r)},{default:t(()=>[a(u,{key:"NONE",label:""},{default:t(()=>e[26]||(e[26]=[p("\u65E0\u52A0\u5BC6")])),_:1}),a(u,{key:"AES",label:"AES"},{default:t(()=>e[27]||(e[27]=[p("AES")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(l).config.encryptType==="AES"?(s(),b("div",ce,[a(d,{label:"\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5","label-width":"180px",prop:"config.encryptKey"},{default:t(()=>[a(i,{modelValue:o(l).config.encryptKey,"onUpdate:modelValue":e[13]||(e[13]=r=>o(l).config.encryptKey=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5"},null,8,["modelValue"])]),_:1})])):x("",!0),a(d,{label:"\u5907\u6CE8","label-width":"180px",prop:"remark"},{default:t(()=>[a(i,{modelValue:o(l).remark,"onUpdate:modelValue":e[14]||(e[14]=r=>o(l).remark=r),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[D,o(f)]])]),_:1},8,["modelValue","title","onClosed"])])}}});export{fe as _};
