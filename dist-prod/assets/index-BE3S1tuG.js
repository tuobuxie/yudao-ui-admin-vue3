import{X as T,d as z,c as K}from"./index-DmQdxAiK.js";import{_ as W}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as Y}from"./index-C2x7yuaO.js";import{_ as Z}from"./main.vue_vue_type_script_setup_true_lang-DijmNsTR.js";import ee from"./MenuEditor-C-T9ANYs.js";import le from"./MenuPreviewer-CKS5_5P3.js";import{h as ae}from"./tree-COGD3qag.js";import{h as re,aj as ie,f as te,ak as ue}from"./form-designer-DHHJWkD5.js";import{l as ne,r as i,ag as se,m as x,q as v,J as u,B as y,u as t,C,x as f,H as ce,h as N,A as $,G as F,I as pe}from"./form-create-_84fGzaM.js";import"./index-W8edep2c.js";import"./tagsView-CQDzb46U.js";import"./main-BWoc3Odi.js";import"./TabNews-B7LkNpZh.js";import"./main-CJVSjYz7.js";import"./main-I-_7yN8H.js";import"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import"./main-Ddqx4-1N.js";import"./main.vue_vue_type_script_setup_true_lang-DeOxeHzY.js";import"./index-CHHBmOkg.js";import"./index-CebrFt1o.js";import"./formatTime-BGPGB_ys.js";import"./TabText.vue_vue_type_script_setup_true_lang-CjSjCXTv.js";import"./TabImage-DasBtZ73.js";import"./useUpload-CW5EVrRd.js";import"./TabVoice-Cfw_efun.js";import"./TabVideo-CkUeWTPH.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-CrK_E0Z2.js";import"./vuedraggable.umd-D1BZfJwI.js";const oe={class:"clearfix public-account-management"},de={class:"left"},me={class:"weixin-hd"},ve={class:"weixin-title"},ye={class:"clearfix weixin-menu"},fe={class:"save_div"},he={key:0,class:"right"},Me={key:1,class:"right"},k="__MENU_NOT_SELECTED__",_e=K(ne({name:"MpMenu",__name:"index",setup(xe){const o=z(),n=i(!1),d=i(-1),E=i(""),s=i([]),h=i(k),U=i(-1),M=i(!1),b=i(!0),c=i({}),r=i({grand:"0",x:0,y:0}),P=i(!1),j=(l,e)=>{d.value=l,E.value=e,g()},g=async()=>{n.value=!1;try{const l=await(a=>T.get({url:"/mp/menu/list?accountId="+a}))(d.value),e=B(l);s.value=ae(e,"id")}finally{n.value=!1}},B=l=>{if(!l)return[];const e=[];return l.forEach(a=>{const m={...a};m.reply={type:a.replyMessageType,accountId:a.accountId,content:a.replyContent,mediaId:a.replyMediaId,url:a.replyMediaUrl,title:a.replyTitle,description:a.replyDescription,thumbMediaId:a.replyThumbMediaId,thumbMediaUrl:a.replyThumbMediaUrl,articles:a.replyArticles,musicUrl:a.replyMusicUrl,hqMusicUrl:a.replyHqMusicUrl},e.push(m)}),e},G=()=>{h.value=k,U.value=-1,M.value=!1,c.value={},r.value={grand:"0",x:0,y:0},P.value=!1},J=async()=>{var l;try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),r.value.grand==="1"?s.value.splice(r.value.x,1):r.value.grand==="2"&&((l=s.value[r.value.x].children)==null||l.splice(r.value.y,1)),o.notifySuccess("\u5220\u9664\u6210\u529F"),c.value={},M.value=!1,h.value=k}catch{}},L=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417?"),n.value=!0,await((l,e)=>T.post({url:"/mp/menu/save",data:{accountId:l,menus:e}}))(d.value,Q()),g(),o.notifySuccess("\u53D1\u5E03\u6210\u529F")}finally{n.value=!1}},O=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),n.value=!0,await(l=>T.delete({url:"/mp/menu/delete?accountId="+l}))(d.value),G(),g(),o.notifySuccess("\u6E05\u7A7A\u6210\u529F")}finally{n.value=!1}},Q=()=>{const l=[];return s.value.forEach(e=>{const a=q(e);l.push(a),!e.children||e.children.length<=0||(a.children=[],e.children.forEach(m=>{a.children.push(q(m))}))}),l},q=l=>{const e={...l,children:void 0,reply:void 0};return e.replyMessageType=l.reply.type,e.replyContent=l.reply.content,e.replyMediaId=l.reply.mediaId,e.replyMediaUrl=l.reply.url,e.replyTitle=l.reply.title,e.replyDescription=l.reply.description,e.replyThumbMediaId=l.reply.thumbMediaId,e.replyThumbMediaUrl=l.reply.thumbMediaUrl,e.replyArticles=l.reply.articles,e.replyMusicUrl=l.reply.musicUrl,e.replyHqMusicUrl=l.reply.hqMusicUrl,e};return(l,e)=>{const a=Y,m=ie,R=re,V=W,S=te,D=se("hasPermi"),X=ue;return v(),x(pe,null,[u(a,{title:"\u516C\u4F17\u53F7\u83DC\u5355",url:"https://doc.iocoder.cn/mp/menu/"}),u(V,null,{default:y(()=>[u(R,{class:"-mb-15px",ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:y(()=>[u(m,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:y(()=>[u(t(Z),{onChange:j})]),_:1})]),_:1},512)]),_:1}),u(V,null,{default:y(()=>[C((v(),x("div",oe,[f("div",de,[f("div",me,[f("div",ve,ce(t(E)),1)]),f("div",ye,[u(le,{modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=p=>N(s)?s.value=p:null),"account-id":t(d),"active-index":t(h),"parent-index":t(U),onMenuClicked:e[1]||(e[1]=(p,I)=>((w,_)=>{M.value=!0,c.value=w,r.value.grand="1",r.value.x=_,b.value=!0,h.value=`${_}`,U.value=_})(p,I)),onSubmenuClicked:e[2]||(e[2]=(p,I,w)=>((_,A,H)=>{M.value=!0,c.value=_,r.value.grand="2",r.value.x=A,r.value.y=H,b.value=!1,h.value=`${A}-${H}`})(p,I,w))},null,8,["modelValue","account-id","active-index","parent-index"])]),f("div",fe,[C((v(),$(S,{class:"save_btn",type:"success",onClick:L},{default:y(()=>e[4]||(e[4]=[F("\u4FDD\u5B58\u5E76\u53D1\u5E03\u83DC\u5355")])),_:1})),[[D,["mp:menu:save"]]]),C((v(),$(S,{class:"save_btn",type:"danger",onClick:O},{default:y(()=>e[5]||(e[5]=[F("\u6E05\u7A7A\u83DC\u5355")])),_:1})),[[D,["mp:menu:delete"]]])])]),t(M)?(v(),x("div",he,[u(ee,{"account-id":t(d),"is-parent":t(b),modelValue:t(c),"onUpdate:modelValue":e[3]||(e[3]=p=>N(c)?c.value=p:null),onDelete:J},null,8,["account-id","is-parent","modelValue"])])):(v(),x("div",Me,e[6]||(e[6]=[f("p",null,"\u8BF7\u9009\u62E9\u83DC\u5355\u914D\u7F6E",-1)])))])),[[X,t(n)]])]),_:1})],64)}}}),[["__scopeId","data-v-dff385b3"]]);export{_e as default};
