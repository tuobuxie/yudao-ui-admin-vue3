import{d as N,u as X,e as Y}from"./index-DzK2S43K.js";import{_ as Z,g as ee}from"./index-CXjPJq5M.js";import{u as ae}from"./tagsView-CKM4YfGJ.js";import{g as ie,u as re,l as h,r as te,p as le}from"./index-CPW4F6LX.js";import{_ as oe}from"./CustomerForm.vue_vue_type_script_setup_true_lang-DflugMVw.js";import{_ as se}from"./CustomerDetailsInfo.vue_vue_type_script_setup_true_lang-CgZlaVLk.js";import{_ as me}from"./CustomerDetailsHeader.vue_vue_type_script_setup_true_lang-CIhBxi-Y.js";import{_ as ue}from"./ContactList.vue_vue_type_script_setup_true_lang-vNXSgxAy.js";import{_ as ne}from"./ContractList.vue_vue_type_script_setup_true_lang-BM3YPB8O.js";import{_ as pe}from"./BusinessList.vue_vue_type_script_setup_true_lang-rzG8JHYX.js";import{_ as ce}from"./ReceivableList.vue_vue_type_script_setup_true_lang-DTnwWESv.js";import{_ as de}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-YH_pcBOI.js";import{_ as fe}from"./PermissionList.vue_vue_type_script_setup_true_lang-Dz4HjHJF.js";import{_ as ye}from"./TransferForm.vue_vue_type_script_setup_true_lang-D3i2o06y.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-DkZMBJo8.js";import{B as v}from"./index-BrXhj2tq.js";import{_ as ve}from"./CustomerDistributeForm.vue_vue_type_script_setup_true_lang-BHhU_KvL.js";import{f as be,a0 as we,$ as ze,j as Ce}from"./form-designer-DHHJWkD5.js";import{l as ke,r as m,e as Re,ag as Ue,m as Me,q as u,J as i,B as t,C as Se,E as d,A as f,u as e,G as y,I as Oe}from"./form-create-_84fGzaM.js";import"./formatTime-BGPGB_ys.js";import"./Dialog.vue_vue_type_style_index_0_lang-D3YOFsHs.js";import"./index-CJ_UF08e.js";import"./tree-COGD3qag.js";import"./index-xS-5DhXp.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BYZVL11n.js";import"./DictTag.vue_vue_type_script_lang-D8_eTNf5.js";import"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import"./index-BFXClQSm.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-DvXPCHj_.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-HGjAZefL.js";import"./index-ViSh8DuD.js";import"./ContractForm.vue_vue_type_script_setup_true_lang-E47b6048.js";import"./index-D05eFr8n.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-BRcCT8be.js";import"./index-Cw8Ai6YR.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-CvQg7Q6Z.js";import"./index-D16nAiDL.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-Z7NIdiRv.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-DRYtBwIu.js";import"./index-BDPuDy7M.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-Bx1GzzDy.js";import"./index-B3YA61De.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-Cx6ojFJ7.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-C2QyFUrq.js";import"./index-CmWkCErn.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-B1WUohYA.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-Ct925nmX.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-BNHyAL8L.js";const $e=ke({name:"CrmCustomerDetail",__name:"index",setup(Te){const o=m(0),z=m(!0),s=N(),{delView:I}=ae(),{push:W,currentRoute:x}=X(),n=m(),a=m({}),_=async()=>{z.value=!0;try{a.value=await ie(o.value),await G()}finally{z.value=!1}},C=m(),B=()=>{var l;(l=C.value)==null||l.open("update",o.value)},F=async()=>{const l=!a.value.dealStatus;try{await s.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${l?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await re(o.value,l),s.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await _()}catch{}},k=m(),L=()=>{var l;(l=k.value)==null||l.open(o.value)},P=async()=>{await s.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!0),s.success(`\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},j=async()=>{await s.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!1),s.success(`\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},q=async()=>{await s.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await te([e(o.value)]),s.success(`\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},R=m(),A=async()=>{var l;(l=R.value)==null||l.open(o.value)},D=async()=>{await s.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await le(e(o.value)),s.success(`\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),w()},U=m([]),G=async()=>{if(!o.value)return;const l=await ee({bizType:v.CRM_CUSTOMER,bizId:o.value});U.value=l.list},M=m(),J=l=>{var r;(r=M.value)==null||r.createReceivable(l)},w=()=>{I(e(x)),W({name:"CrmCustomer"})},{params:S}=Y();return Re(()=>{if(!S.id)return s.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void w();o.value=S.id,_()}),(l,r)=>{const p=be,c=ze,Q=Z,V=we,H=Ce,K=Ue("hasPermi");return u(),Me(Oe,null,[i(me,{customer:e(a),loading:e(z)},{default:t(()=>{var b,O,$,T,g,E;return[(b=e(n))!=null&&b.validateWrite?Se((u(),f(p,{key:0,type:"primary",onClick:B},{default:t(()=>r[0]||(r[0]=[y(" \u7F16\u8F91 ")])),_:1})),[[K,["crm:customer:update"]]]):d("",!0),(O=e(n))!=null&&O.validateOwnerUser?(u(),f(p,{key:1,type:"primary",onClick:L},{default:t(()=>r[1]||(r[1]=[y(" \u8F6C\u79FB ")])),_:1})):d("",!0),($=e(n))!=null&&$.validateWrite?(u(),f(p,{key:2,onClick:F},{default:t(()=>r[2]||(r[2]=[y(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")])),_:1})):d("",!0),e(a).lockStatus&&((T=e(n))!=null&&T.validateOwnerUser)?(u(),f(p,{key:3,onClick:j},{default:t(()=>r[3]||(r[3]=[y(" \u89E3\u9501 ")])),_:1})):d("",!0),!e(a).lockStatus&&((g=e(n))!=null&&g.validateOwnerUser)?(u(),f(p,{key:4,onClick:P},{default:t(()=>r[4]||(r[4]=[y(" \u9501\u5B9A ")])),_:1})):d("",!0),e(a).ownerUserId?d("",!0):(u(),f(p,{key:5,type:"primary",onClick:q},{default:t(()=>r[5]||(r[5]=[y(" \u9886\u53D6")])),_:1})),e(a).ownerUserId?d("",!0):(u(),f(p,{key:6,type:"primary",onClick:A},{default:t(()=>r[6]||(r[6]=[y(" \u5206\u914D ")])),_:1})),e(a).ownerUserId&&((E=e(n))!=null&&E.validateOwnerUser)?(u(),f(p,{key:7,onClick:D},{default:t(()=>r[7]||(r[7]=[y(" \u653E\u5165\u516C\u6D77 ")])),_:1})):d("",!0)]}),_:1},8,["customer","loading"]),i(H,null,{default:t(()=>[i(V,null,{default:t(()=>[i(c,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(_e,{"biz-id":e(o),"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(se,{customer:e(a)},null,8,["customer"])]),_:1}),i(c,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(ue,{"biz-id":e(a).id,"customer-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","customer-id","biz-type"])]),_:1}),i(c,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var b;return[i(fe,{ref_key:"permissionListRef",ref:n,"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER,"show-action":!((b=e(n))!=null&&b.isPool)||!1,onQuitTeam:w},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(c,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(pe,{"biz-id":e(a).id,"customer-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","customer-id","biz-type"])]),_:1}),i(c,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(ne,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(de,{"customer-id":e(a).id,onCreateReceivable:J},null,8,["customer-id"]),i(ce,{ref_key:"receivableListRef",ref:M,"customer-id":e(a).id},null,8,["customer-id"])]),_:1}),i(c,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(Q,{"log-list":e(U)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(oe,{ref_key:"formRef",ref:C,onSuccess:_},null,512),i(ve,{ref_key:"distributeForm",ref:R,onSuccess:_},null,512),i(ye,{ref_key:"transferFormRef",ref:k,"biz-type":e(v).CRM_CUSTOMER,onSuccess:w},null,8,["biz-type"])],64)}}});export{$e as default};
