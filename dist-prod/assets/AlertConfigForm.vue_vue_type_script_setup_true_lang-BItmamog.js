import{a as G,d as J,h as y,D as I}from"./index-D_TWD7wt.js";import{_ as P}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{A as U}from"./index-Ott2_lbG.js";import{C}from"./constants-C3gLHYOK.js";import{R as Q}from"./index-CvsZTKd4.js";import{g as K}from"./index-tmtszvF2.js";import{h as Y,aj as $,k as z,x as H,Q as W,ak as X,f as Z}from"./form-designer-DHHJWkD5.js";import{l as ee,r as o,j as le,A as m,q as t,B as s,C as ae,u as l,J as r,m as f,I as b,$ as _,G as q,h as ue}from"./form-create-_84fGzaM.js";const se=ee({name:"AlertConfigForm",__name:"AlertConfigForm",emits:["success"],setup(re,{expose:L,emit:S}){const{t:g}=G(),T=J(),n=o(!1),w=o(""),c=o(!1),A=o(""),u=o({id:void 0,name:void 0,description:void 0,level:void 0,status:C.ENABLE,sceneRuleIds:[],receiveUserIds:[],receiveTypes:[]}),x=le({name:[{required:!0,message:"\u914D\u7F6E\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],level:[{required:!0,message:"\u544A\u8B66\u7EA7\u522B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],status:[{required:!0,message:"\u914D\u7F6E\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sceneRuleIds:[{required:!0,message:"\u5173\u8054\u573A\u666F\u8054\u52A8\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],receiveUserIds:[{required:!0,message:"\u63A5\u6536\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],receiveTypes:[{required:!0,message:"\u63A5\u6536\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),V=o(),E=o([]),R=o([]);L({open:async(d,a)=>{if(n.value=!0,w.value=g("action."+d),A.value=d,N(),a){c.value=!0;try{u.value=await U.getAlertConfig(a)}finally{c.value=!1}}await O()}});const O=async()=>{try{E.value=await Q.getSimpleRuleSceneList(),R.value=await K()}catch{}},B=S,F=async()=>{await V.value.validate(),c.value=!0;try{const d=u.value;A.value==="create"?(await U.createAlertConfig(d),T.success(g("common.createSuccess"))):(await U.updateAlertConfig(d),T.success(g("common.updateSuccess"))),n.value=!1,B("success")}finally{c.value=!1}},N=()=>{var d;u.value={id:void 0,name:void 0,description:void 0,level:void 0,status:C.ENABLE,sceneRuleIds:[],receiveUserIds:[],receiveTypes:[]},(d=V.value)==null||d.resetFields()};return(d,a)=>{const h=z,i=$,v=W,p=H,j=Y,k=Z,M=P,D=X;return t(),m(M,{title:l(w),modelValue:l(n),"onUpdate:modelValue":a[8]||(a[8]=e=>ue(n)?n.value=e:null)},{footer:s(()=>[r(k,{onClick:F,type:"primary",disabled:l(c)},{default:s(()=>a[9]||(a[9]=[q("\u786E \u5B9A")])),_:1},8,["disabled"]),r(k,{onClick:a[7]||(a[7]=e=>n.value=!1)},{default:s(()=>a[10]||(a[10]=[q("\u53D6 \u6D88")])),_:1})]),default:s(()=>[ae((t(),m(j,{ref_key:"formRef",ref:V,model:l(u),rules:l(x),"label-width":"140px"},{default:s(()=>[r(i,{label:"\u914D\u7F6E\u540D\u79F0",prop:"name"},{default:s(()=>[r(h,{modelValue:l(u).name,"onUpdate:modelValue":a[0]||(a[0]=e=>l(u).name=e),placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u540D\u79F0"},null,8,["modelValue"])]),_:1}),r(i,{label:"\u914D\u7F6E\u63CF\u8FF0",prop:"description"},{default:s(()=>[r(h,{modelValue:l(u).description,"onUpdate:modelValue":a[1]||(a[1]=e=>l(u).description=e),placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),r(i,{label:"\u544A\u8B66\u7EA7\u522B",prop:"level"},{default:s(()=>[r(p,{modelValue:l(u).level,"onUpdate:modelValue":a[2]||(a[2]=e=>l(u).level=e),placeholder:"\u8BF7\u9009\u62E9\u544A\u8B66\u7EA7\u522B"},{default:s(()=>[(t(!0),f(b,null,_(l(y)(l(I).IOT_ALERT_LEVEL),e=>(t(),m(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u914D\u7F6E\u72B6\u6001",prop:"status"},{default:s(()=>[r(p,{modelValue:l(u).status,"onUpdate:modelValue":a[3]||(a[3]=e=>l(u).status=e)},{default:s(()=>[(t(!0),f(b,null,_(l(y)(l(I).COMMON_STATUS),e=>(t(),m(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u5173\u8054\u573A\u666F\u8054\u52A8\u89C4\u5219",prop:"sceneRuleIds"},{default:s(()=>[r(p,{modelValue:l(u).sceneRuleIds,"onUpdate:modelValue":a[4]||(a[4]=e=>l(u).sceneRuleIds=e),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5173\u8054\u7684\u573A\u666F\u8054\u52A8\u89C4\u5219",class:"w-full"},{default:s(()=>[(t(!0),f(b,null,_(l(E),e=>(t(),m(v,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u63A5\u6536\u7684\u7528\u6237",prop:"receiveUserIds"},{default:s(()=>[r(p,{modelValue:l(u).receiveUserIds,"onUpdate:modelValue":a[5]||(a[5]=e=>l(u).receiveUserIds=e),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u7684\u7528\u6237",class:"w-full"},{default:s(()=>[(t(!0),f(b,null,_(l(R),e=>(t(),m(v,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u63A5\u6536\u7C7B\u578B",prop:"receiveTypes"},{default:s(()=>[r(p,{modelValue:l(u).receiveTypes,"onUpdate:modelValue":a[6]||(a[6]=e=>l(u).receiveTypes=e),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u7C7B\u578B",class:"w-full"},{default:s(()=>[(t(!0),f(b,null,_(l(y)(l(I).IOT_ALERT_RECEIVE_TYPE),e=>(t(),m(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[D,l(c)]])]),_:1},8,["title","modelValue"])}}});export{se as _};
