import{aE as Y}from"./index-DmQdxAiK.js";import{_ as z}from"./ProductSelector.vue_vue_type_script_setup_true_lang-uQUGU1td.js";import{_ as F}from"./DeviceSelector.vue_vue_type_script_setup_true_lang-DfitL0X7.js";import C from"./JsonParamsInput-JuXXJFLb.js";import{q as L,f as N,a as p}from"./constants-BFrNJh5I.js";import{T as G}from"./index-DM2r8AcY.js";import{i as H,j as K,aj as Q,x as X,Q as $,a6 as Z}from"./form-designer-DHHJWkD5.js";import{l as ee,r as v,c as b,e as ae,b as le,m as V,q as f,J as s,E as w,B as r,u,I as te,$ as ue,A as ie,x as q,H as U,G as se,h as D}from"./form-create-_84fGzaM.js";const re={class:"flex flex-col gap-16px"},de={key:0,class:"space-y-16px"},ne={class:"flex items-center justify-between"},oe={key:0,class:"space-y-16px"},ce={key:1,class:"space-y-16px"},pe=ee({name:"DeviceControlConfig",__name:"DeviceControlConfig",props:{modelValue:{}},emits:["update:modelValue"],setup(P,{emit:R}){const l=Y(P,"modelValue",R),m=v([]),O=v(!1),y=v(null),n=v([]),g=v(!1),o=b({get:()=>l.value.params&&typeof l.value.params=="object"?JSON.stringify(l.value.params,null,2):l.value.params||"",set:e=>{l.value.params=e.trim()||""}}),_=b(()=>l.value.type===L.DEVICE_PROPERTY_SET),I=b(()=>l.value.type===L.DEVICE_SERVICE_INVOKE),J=e=>{l.value.productId!==e&&(l.value.deviceId=void 0,l.value.identifier=void 0,l.value.params="",y.value=null,n.value=[]),e&&(_.value?E(e):I.value&&h(e))},M=e=>{l.value.deviceId!==e&&(l.value.params="")},j=e=>{const a=n.value.find(t=>t.identifier===e)||null;if(y.value=a,l.value.params="",a&&a.inputParams&&a.inputParams.length>0){const t={};a.inputParams.forEach(d=>{t[d.identifier]=k(d)}),l.value.params=JSON.stringify(t,null,2)}},x=async e=>{if(!e)return null;try{return await G.getThingModelTSLByProductId(e)}catch{return null}},E=async e=>{if(e)try{O.value=!0;const a=await x(e);if(!(a!=null&&a.properties))return void(m.value=[]);m.value=a.properties.filter(t=>t.accessMode&&(t.accessMode===N.READ_WRITE.value||t.accessMode===N.WRITE_ONLY.value))}catch{m.value=[]}finally{O.value=!1}else m.value=[]},h=async e=>{if(e)try{g.value=!0;const a=await x(e);if(!(a!=null&&a.services))return void(n.value=[]);n.value=a.services}catch{n.value=[]}finally{g.value=!1}else n.value=[]},k=e=>{var a;switch(e.dataType){case p.INT:case p.FLOAT:case p.DOUBLE:return 0;case p.BOOL:return!1;case p.TEXT:return"";case p.ENUM:return(a=e.dataSpecs)!=null&&a.dataSpecsList&&e.dataSpecs.dataSpecsList.length>0?e.dataSpecs.dataSpecsList[0].value:"";default:return""}},T=v(!1),B=async()=>{if(T.value)return;const e=l.value;e&&(e.productId&&_.value&&await E(e.productId),e.productId&&I.value&&e.identifier&&await(async(a,t)=>{await h(a);const d=n.value.find(c=>c.identifier===t);d&&(y.value=d)})(e.productId,e.identifier),T.value=!0)};return ae(()=>{B()}),le(()=>[l.value.productId,l.value.type,l.value.identifier],async([e,,a],[t,,d])=>{if(T.value&&(e!==t&&(e&&_.value?await E(e):e&&I.value&&await h(e)),a!==d&&e&&I.value&&a)){const c=n.value.find(S=>S.identifier===a);c&&(y.value=c)}}),(e,a)=>{const t=Q,d=K,c=H,S=Z,A=$,W=X;return f(),V("div",re,[s(c,{gutter:16},{default:r(()=>[s(d,{span:12},{default:r(()=>[s(t,{label:"\u4EA7\u54C1",required:""},{default:r(()=>[s(z,{modelValue:u(l).productId,"onUpdate:modelValue":a[0]||(a[0]=i=>u(l).productId=i),onChange:J},null,8,["modelValue"])]),_:1})]),_:1}),s(d,{span:12},{default:r(()=>[s(t,{label:"\u8BBE\u5907",required:""},{default:r(()=>[s(F,{modelValue:u(l).deviceId,"onUpdate:modelValue":a[1]||(a[1]=i=>u(l).deviceId=i),"product-id":u(l).productId,onChange:M},null,8,["modelValue","product-id"])]),_:1})]),_:1})]),_:1}),u(l).productId&&u(I)?(f(),V("div",de,[s(t,{label:"\u670D\u52A1",required:""},{default:r(()=>[s(W,{modelValue:u(l).identifier,"onUpdate:modelValue":a[2]||(a[2]=i=>u(l).identifier=i),placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1",filterable:"",clearable:"",class:"w-full",loading:u(g),onChange:j},{default:r(()=>[(f(!0),V(te,null,ue(u(n),i=>(f(),ie(A,{key:i.identifier,label:i.name,value:i.identifier},{default:r(()=>[q("div",ne,[q("span",null,U(i.name),1),s(S,{type:i.callType==="sync"?"primary":"success",size:"small"},{default:r(()=>[se(U(i.callType==="sync"?"\u540C\u6B65":"\u5F02\u6B65"),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),u(l).identifier?(f(),V("div",oe,[s(t,{label:"\u670D\u52A1\u53C2\u6570",required:""},{default:r(()=>[s(C,{modelValue:u(o),"onUpdate:modelValue":a[3]||(a[3]=i=>D(o)?o.value=i:null),type:"service",config:{service:u(y)},placeholder:"\u8BF7\u8F93\u5165 JSON \u683C\u5F0F\u7684\u670D\u52A1\u53C2\u6570"},null,8,["modelValue","config"])]),_:1})])):w("",!0)])):w("",!0),u(l).productId&&u(_)?(f(),V("div",ce,[s(t,{label:"\u53C2\u6570",required:""},{default:r(()=>[s(C,{modelValue:u(o),"onUpdate:modelValue":a[4]||(a[4]=i=>D(o)?o.value=i:null),type:"property",config:{properties:u(m)},placeholder:"\u8BF7\u8F93\u5165 JSON \u683C\u5F0F\u7684\u63A7\u5236\u53C2\u6570"},null,8,["modelValue","config"])]),_:1})])):w("",!0)])}}});export{pe as _};
