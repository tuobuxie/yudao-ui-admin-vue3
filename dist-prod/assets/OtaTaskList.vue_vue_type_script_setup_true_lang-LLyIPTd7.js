import{d as H,_ as J,D as x}from"./index-B2urM1q-.js";import{_ as M}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang-Cj0jlW8o.js";import{_ as W}from"./DictTag.vue_vue_type_script_lang-wg8pUI-B.js";import{l as X,r as n,j as Y,e as $,ag as aa,A as m,q as u,B as r,J as a,C as g,N as ea,u as l,G as d,Z as ta,H as A,E as la}from"./form-create-_84fGzaM.js";import{d as ra}from"./formatTime-BGPGB_ys.js";import{I as E}from"./index-Da1-ONCj.js";import{m as sa}from"./constants-D46CCSyK.js";import{_ as ia}from"./OtaTaskForm.vue_vue_type_script_setup_true_lang-DtO2V10J.js";import{_ as oa}from"./OtaTaskDetail.vue_vue_type_script_setup_true_lang-BJmzVm8e.js";import{h as na,aj as pa,f as ca,k as ma,Z as ua,_ as da,ak as fa}from"./form-designer-DHHJWkD5.js";const _a=X({name:"OtaTaskList",__name:"OtaTaskList",props:{firmwareId:{},productId:{}},emits:["success"],setup(N,{emit:P}){const R=N,k=H(),f=n(!1),y=n([]),v=n(0),s=Y({pageNo:1,pageSize:10,name:"",firmwareId:R.firmwareId}),D=n(),S=n(),T=n(),p=async()=>{f.value=!0;try{const i=await E.getOtaTaskPage(s);y.value=i.list,v.value=i.total}finally{f.value=!1}},U=()=>{s.pageNo=1,p()},V=()=>{var i;(i=S.value)==null||i.open()},b=P,z=()=>{p(),b("success")},I=async()=>{await p(),b("success")};return $(()=>{p()}),(i,t)=>{const K=J,_=ca,h=pa,j=ma,q=na,o=da,C=W,B=ua,F=Q,G=M,O=aa("hasPermi"),L=fa;return u(),m(G,{title:"\u5347\u7EA7\u4EFB\u52A1\u7BA1\u7406",class:"mb-20px"},{default:r(()=>[a(q,{class:"-mb-15px",model:l(s),ref_key:"queryFormRef",ref:D,inline:!0,"label-width":"68px",onSubmit:t[1]||(t[1]=ea(()=>{},["prevent"]))},{default:r(()=>[a(h,null,{default:r(()=>[g((u(),m(_,{type:"primary",onClick:V},{default:r(()=>[a(K,{icon:"ep:plus",class:"mr-5px"}),t[4]||(t[4]=d(" \u65B0\u589E "))]),_:1})),[[O,["iot:ota-task:create"]]])]),_:1}),a(h,{class:"float-right"},{default:r(()=>[a(j,{modelValue:l(s).name,"onUpdate:modelValue":t[0]||(t[0]=e=>l(s).name=e),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:ta(U,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),g((u(),m(B,{data:l(y),stripe:!0,"show-overflow-tooltip":!0,class:"mt-15px"},{default:r(()=>[a(o,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id",width:"80"}),a(o,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(o,{label:"\u5347\u7EA7\u8303\u56F4",align:"center",prop:"deviceScope"},{default:r(e=>[a(C,{type:l(x).IOT_OTA_TASK_DEVICE_SCOPE,value:e.row.deviceScope},null,8,["type","value"])]),_:1}),a(o,{label:"\u5347\u7EA7\u8FDB\u5EA6",align:"center"},{default:r(e=>[d(A(e.row.deviceSuccessCount)+"/"+A(e.row.deviceTotalCount),1)]),_:1}),a(o,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:l(ra)},null,8,["formatter"]),a(o,{label:"\u4EFB\u52A1\u63CF\u8FF0",align:"center",prop:"description","show-overflow-tooltip":""}),a(o,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:r(e=>[a(C,{type:l(x).IOT_OTA_TASK_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(o,{label:"\u64CD\u4F5C",align:"center",width:"120"},{default:r(e=>[a(_,{link:"",type:"primary",onClick:Z=>{var w;return c=e.row.id,void((w=T.value)==null?void 0:w.open(c));var c}},{default:r(()=>t[5]||(t[5]=[d(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"]),e.row.status===l(sa).IN_PROGRESS.value?g((u(),m(_,{key:0,link:"",type:"danger",onClick:Z=>(async c=>{try{await k.confirm("\u786E\u8BA4\u8981\u53D6\u6D88\u8BE5\u5347\u7EA7\u4EFB\u52A1\u5417\uFF1F"),await E.cancelOtaTask(c),k.success("\u53D6\u6D88\u6210\u529F"),await I()}catch{}})(e.row.id)},{default:r(()=>t[6]||(t[6]=[d(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[O,["iot:ota-task:cancel"]]]):la("",!0)]),_:1})]),_:1},8,["data"])),[[L,l(f)]]),a(F,{total:l(v),page:l(s).pageNo,"onUpdate:page":t[2]||(t[2]=e=>l(s).pageNo=e),limit:l(s).pageSize,"onUpdate:limit":t[3]||(t[3]=e=>l(s).pageSize=e),onPagination:p},null,8,["total","page","limit"]),a(ia,{ref_key:"taskFormRef",ref:S,"firmware-id":i.firmwareId,"product-id":i.productId,onSuccess:z},null,8,["firmware-id","product-id"]),a(oa,{ref_key:"taskDetailRef",ref:T,onSuccess:I},null,512)]),_:1})}}});export{_a as _};
