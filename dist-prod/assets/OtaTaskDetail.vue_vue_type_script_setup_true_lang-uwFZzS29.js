import{X as R,d as le,D as h}from"./index-DzK2S43K.js";import{_ as se}from"./DictTag.vue_vue_type_script_lang-D8_eTNf5.js";import{l as re,r as p,j as oe,c as de,ag as ue,A as T,q as c,u as s,B as t,J as a,C as S,G as y,H as o,x as l,m as V,I as $,$ as q,K as ie,E as pe}from"./form-create-_84fGzaM.js";import{_ as ne}from"./Dialog.vue_vue_type_style_index_0_lang-D3YOFsHs.js";import{_ as G}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BYZVL11n.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-Cvlg2yMl.js";import{I as ve}from"./index-Bow3mXHT.js";import{l as n}from"./constants-DGDXM-Iq.js";import{f as B}from"./formatTime-BGPGB_ys.js";import{ak as be,am as xe,an as ge,i as me,j as fe,a0 as ye,$ as _e,Z as ke,_ as Te,f as we}from"./form-designer-DHHJWkD5.js";const E={getOtaTaskRecordStatusStatistics:async(x,O)=>{const w={};return x&&(w.firmwareId=x),O&&(w.taskId=O),await R.get({url:"/iot/ota/task/record/get-status-statistics",params:w})},getOtaTaskRecordPage:async x=>await R.get({url:"/iot/ota/task/record/page",params:x}),cancelOtaTaskRecord:async x=>await R.put({url:"/iot/ota/task/record/cancel?id="+x})},Se={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Oe={class:"text-32px font-bold mb-8px text-blue-500"},Ie={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Ee={class:"text-32px font-bold mb-8px text-gray-400"},Ne={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Ae={class:"text-32px font-bold mb-8px text-blue-400"},De={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Ue={class:"text-32px font-bold mb-8px text-yellow-500"},Ce={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Pe={class:"text-32px font-bold mb-8px text-green-500"},Re={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},he={class:"text-32px font-bold mb-8px text-red-500"},Ve={class:"text-center p-20px border border-solid border-gray-200 rounded bg-gray-50"},Ge={class:"text-32px font-bold mb-8px text-gray-400"},je=re({name:"OtaTaskDetail",__name:"OtaTaskDetail",emits:["success"],setup(x,{expose:O,emit:w}){const j=le(),N=p(!1),g=p(),A=p(!1),v=p({}),D=p(!1),b=p({}),U=p(!1),K=p([]),z=p(0),u=oe({pageNo:1,pageSize:10,taskId:void 0,status:void 0}),_=p(""),H=de(()=>{const i=[{key:"",label:"\u5168\u90E8\u8BBE\u5907"}];return Object.values(n).forEach(e=>{i.push({key:e.value.toString(),label:e.label})}),i}),F=async()=>{if(g.value){A.value=!0;try{v.value=await ve.getOtaTask(g.value)}finally{A.value=!1}}},L=async()=>{if(g.value){D.value=!0;try{b.value=await E.getOtaTaskRecordStatusStatistics(void 0,g.value)}finally{D.value=!1}}},I=async()=>{if(g.value){U.value=!0;try{u.taskId=g.value;const i=await E.getOtaTaskRecordPage(u);K.value=i.list||[],z.value=i.total||0}finally{U.value=!1}}},J=i=>{const e=i.paneName;_.value=e,u.pageNo=1,u.status=_.value===""?void 0:parseInt(e),I()},X=w;return O({open:i=>{g.value=i,N.value=!0,_.value="",u.pageNo=1,u.status=void 0,F(),L(),I()}}),(i,e)=>{const k=ge,C=se,Z=xe,m=fe,M=me,Q=_e,W=ye,f=Te,Y=we,ee=ke,P=be,ae=ue("hasPermi");return c(),T(s(ne),{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=d=>N.value=d),title:"\u5347\u7EA7\u4EFB\u52A1\u8BE6\u60C5",width:"1200px","append-to-body":""},{default:t(()=>[a(s(G),{title:"\u4EFB\u52A1\u4FE1\u606F",class:"mb-20px"},{default:t(()=>[S((c(),T(Z,{column:3,border:""},{default:t(()=>[a(k,{label:"\u4EFB\u52A1\u7F16\u53F7"},{default:t(()=>[y(o(v.value.id),1)]),_:1}),a(k,{label:"\u4EFB\u52A1\u540D\u79F0"},{default:t(()=>[y(o(v.value.name),1)]),_:1}),a(k,{label:"\u5347\u7EA7\u8303\u56F4"},{default:t(()=>[a(C,{type:s(h).IOT_OTA_TASK_DEVICE_SCOPE,value:v.value.deviceScope},null,8,["type","value"])]),_:1}),a(k,{label:"\u4EFB\u52A1\u72B6\u6001"},{default:t(()=>[a(C,{type:s(h).IOT_OTA_TASK_STATUS,value:v.value.status},null,8,["type","value"])]),_:1}),a(k,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(()=>[y(o(v.value.createTime?s(B)(v.value.createTime):"-"),1)]),_:1}),a(k,{label:"\u4EFB\u52A1\u63CF\u8FF0",span:3},{default:t(()=>[y(o(v.value.description),1)]),_:1})]),_:1})),[[P,A.value]])]),_:1}),a(s(G),{title:"\u5347\u7EA7\u8BBE\u5907\u7EDF\u8BA1",class:"mb-20px"},{default:t(()=>[S((c(),T(M,{gutter:20,class:"py-20px"},{default:t(()=>[a(m,{span:6},{default:t(()=>[l("div",Se,[l("div",Oe,o(Object.values(b.value).reduce((d,r)=>d+(r||0),0)||0),1),e[4]||(e[4]=l("div",{class:"text-14px text-gray-600"},"\u5347\u7EA7\u8BBE\u5907\u603B\u6570",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",Ie,[l("div",Ee,o(b.value[s(n).PENDING.value]||0),1),e[5]||(e[5]=l("div",{class:"text-14px text-gray-600"},"\u5F85\u63A8\u9001",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",Ne,[l("div",Ae,o(b.value[s(n).PUSHED.value]||0),1),e[6]||(e[6]=l("div",{class:"text-14px text-gray-600"},"\u5DF2\u63A8\u9001",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",De,[l("div",Ue,o(b.value[s(n).UPGRADING.value]||0),1),e[7]||(e[7]=l("div",{class:"text-14px text-gray-600"},"\u6B63\u5728\u5347\u7EA7",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",Ce,[l("div",Pe,o(b.value[s(n).SUCCESS.value]||0),1),e[8]||(e[8]=l("div",{class:"text-14px text-gray-600"},"\u5347\u7EA7\u6210\u529F",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",Re,[l("div",he,o(b.value[s(n).FAILURE.value]||0),1),e[9]||(e[9]=l("div",{class:"text-14px text-gray-600"},"\u5347\u7EA7\u5931\u8D25",-1))])]),_:1}),a(m,{span:3},{default:t(()=>[l("div",Ve,[l("div",Ge,o(b.value[s(n).CANCELED.value]||0),1),e[10]||(e[10]=l("div",{class:"text-14px text-gray-600"},"\u5347\u7EA7\u53D6\u6D88",-1))])]),_:1})]),_:1})),[[P,D.value]])]),_:1}),a(s(G),{title:"\u5347\u7EA7\u8BBE\u5907\u8BB0\u5F55"},{default:t(()=>[a(W,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=d=>_.value=d),onTabClick:J,class:"mb-15px"},{default:t(()=>[(c(!0),V($,null,q(H.value,d=>(c(),T(Q,{key:d.key,label:d.label,name:d.key},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),(c(!0),V($,null,q(H.value,d=>S((c(),V("div",{key:d.key},[S((c(),T(ee,{data:K.value,stripe:!0,"show-overflow-tooltip":!0},{default:t(()=>[a(f,{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"deviceName"}),a(f,{label:"\u5F53\u524D\u7248\u672C",align:"center",prop:"fromFirmwareVersion"}),a(f,{label:"\u5347\u7EA7\u72B6\u6001",align:"center",prop:"status",width:"120"},{default:t(r=>[a(C,{type:s(h).IOT_OTA_TASK_RECORD_STATUS,value:r.row.status},null,8,["type","value"])]),_:1}),a(f,{label:"\u5347\u7EA7\u8FDB\u5EA6",align:"center",prop:"progress",width:"120"},{default:t(r=>[y(o(r.row.progress)+"% ",1)]),_:1}),a(f,{label:"\u72B6\u6001\u63CF\u8FF0",align:"center",prop:"description"}),a(f,{label:"\u66F4\u65B0\u65F6\u95F4",align:"center",prop:"updateTime",width:"180"},{default:t(r=>[y(o(s(B)(r.row.updateTime)),1)]),_:1}),a(f,{label:"\u64CD\u4F5C",align:"center",width:"80"},{default:t(r=>[[s(n).PENDING.value,s(n).PUSHED.value,s(n).UPGRADING.value].includes(r.row.status)?S((c(),T(Y,{key:0,link:"",type:"danger",onClick:Ke=>(async te=>{try{await j.confirm("\u786E\u8BA4\u8981\u53D6\u6D88\u8BE5\u8BBE\u5907\u7684\u5347\u7EA7\u4EFB\u52A1\u5417\uFF1F"),await E.cancelOtaTaskRecord(te.id),j.success("\u53D6\u6D88\u6210\u529F"),await I(),await L(),await F(),X("success")}catch{}})(r.row)},{default:t(()=>e[11]||(e[11]=[y(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[ae,["iot:ota-task-record:cancel"]]]):pe("",!0)]),_:1})]),_:1},8,["data"])),[[P,U.value]]),a(ce,{total:z.value,page:u.pageNo,"onUpdate:page":e[1]||(e[1]=r=>u.pageNo=r),limit:u.pageSize,"onUpdate:limit":e[2]||(e[2]=r=>u.pageSize=r),onPagination:I},null,8,["total","page","limit"])])),[[ie,_.value===d.key]])),128))]),_:1})]),_:1},8,["modelValue"])}}});export{E as I,je as _};
