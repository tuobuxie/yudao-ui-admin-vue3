import{d as U,e as q,u as C,_ as D}from"./index-D_TWD7wt.js";import{_ as I}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4_WNC8um.js";import{K as z}from"./index-CuTrVG0d.js";import{K as A}from"./index-Bd51vpJI.js";import{k as B,l as F,f as G,aU as H}from"./form-designer-DHHJWkD5.js";import{l as J,r as K,j as L,e as N,m as c,q as d,J as n,B as m,x as a,u as s,H as o,G as k,A as T,I as R,$ as S,D as E}from"./form-create-_84fGzaM.js";const $={class:"flex gap-20px w-full"},M={class:"relative mb-10px"},O={class:"absolute bottom-10px right-10px text-gray-400 text-12px"},P={class:"flex items-center mb-10px"},Q={class:"flex items-center mb-15px"},W={class:"flex justify-end"},X={key:1,class:"font-bold mb-15px"},Y={class:"flex justify-between text-12px text-gray-500 mb-5px"},Z={class:"px-8px py-4px bg-blue-50 text-blue-500 rounded-full text-12px font-bold"},ee={class:"flex justify-between items-center"},ae={class:"flex items-center text-gray-500 text-13px"},le=J({name:"KnowledgeDocumentRetrieval",__name:"index",setup(te){const u=U(),y=q(),V=C(),x=K(!1),r=K([]),l=L({id:void 0,content:"",topK:10,similarityThreshold:.5}),_=async()=>{if(l.content){x.value=!0,r.value=[];try{const p=await z.searchKnowledgeSegment({knowledgeId:l.id,content:l.content,topK:l.topK,similarityThreshold:l.similarityThreshold});r.value=p||[]}catch{}finally{x.value=!1}}else u.warning("\u8BF7\u8F93\u5165\u67E5\u8BE2\u6587\u672C")};return N(()=>{if(!y.query.id)return u.error("\u77E5\u8BC6\u5E93 ID \u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u8FDB\u884C\u53EC\u56DE\u6D4B\u8BD5"),void V.back();l.id=y.query.id,(async p=>{try{const e=await A.getKnowledge(p);e&&(l.topK=e.topK||l.topK,l.similarityThreshold=e.similarityThreshold||l.similarityThreshold)}catch{}})(l.id)}),(p,e)=>{const j=B,f=F,h=G,g=I,v=H,b=D;return d(),c("div",$,[n(g,{class:"flex-1 min-w-300px"},{default:m(()=>{var t;return[e[6]||(e[6]=a("div",{class:"mb-15px"},[a("h3",{class:"m-0 mb-5px"},"\u53EC\u56DE\u6D4B\u8BD5"),a("div",{class:"text-gray-500 text-14px"},"\u6839\u636E\u7ED9\u5B9A\u7684\u67E5\u8BE2\u6587\u672C\u6D4B\u8BD5\u53EC\u56DE\u6548\u679C\u3002")],-1)),a("div",null,[a("div",M,[n(j,{modelValue:s(l).content,"onUpdate:modelValue":e[0]||(e[0]=i=>s(l).content=i),type:"textarea",rows:8,placeholder:"\u8BF7\u8F93\u5165\u6587\u672C"},null,8,["modelValue"]),a("div",O,o((t=s(l).content)==null?void 0:t.length)+" / 200 ",1)]),a("div",P,[e[3]||(e[3]=a("span",{class:"w-60px text-gray-500"},"topK:",-1)),n(f,{modelValue:s(l).topK,"onUpdate:modelValue":e[1]||(e[1]=i=>s(l).topK=i),min:1,max:20},null,8,["modelValue"])]),a("div",Q,[e[4]||(e[4]=a("span",{class:"w-60px text-gray-500"},"\u76F8\u4F3C\u5EA6:",-1)),n(f,{modelValue:s(l).similarityThreshold,"onUpdate:modelValue":e[2]||(e[2]=i=>s(l).similarityThreshold=i),min:0,max:1,precision:2,step:.01},null,8,["modelValue"])]),a("div",W,[n(h,{type:"primary",onClick:_,loading:s(x)},{default:m(()=>e[5]||(e[5]=[k("\u6D4B\u8BD5")])),_:1},8,["loading"])])])]}),_:1}),n(g,{class:"flex-1 min-w-300px"},{default:m(()=>[s(x)?(d(),T(v,{key:0,description:"\u6B63\u5728\u68C0\u7D22\u4E2D..."})):s(r).length>0?(d(),c("div",X,o(s(r).length)+" \u4E2A\u53EC\u56DE\u6BB5\u843D ",1)):(d(),T(v,{key:2,description:"\u6682\u65E0\u53EC\u56DE\u7ED3\u679C"})),a("div",null,[(d(!0),c(R,null,S(s(r),(t,i)=>(d(),c("div",{key:i,class:"mb-20px border border-solid border-gray-200 rounded p-15px"},[a("div",Y,[a("span",null," \u5206\u6BB5("+o(t.id)+") \xB7 "+o(t.contentLength)+" \u5B57\u7B26\u6570 \xB7 "+o(t.tokens)+" Token ",1),a("span",Z," score: "+o(t.score),1)]),a("div",{class:E(["bg-gray-50 p-10px rounded mb-10px whitespace-pre-wrap overflow-hidden transition-all duration-100 text-13px",{"line-clamp-2 max-h-50px":!t.expanded,"max-h-500px":t.expanded}])},o(t.content),3),a("div",ee,[a("div",ae,[n(b,{icon:"ep:document",class:"mr-5px"}),a("span",null,o(t.documentName||"\u672A\u77E5\u6587\u6863"),1)]),n(h,{size:"small",onClick:se=>(w=>{w.expanded=!w.expanded})(t)},{default:m(()=>[k(o(t.expanded?"\u6536\u8D77":"\u5C55\u5F00")+" ",1),n(b,{icon:t.expanded?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])]),_:1})])}}});export{le as default};
