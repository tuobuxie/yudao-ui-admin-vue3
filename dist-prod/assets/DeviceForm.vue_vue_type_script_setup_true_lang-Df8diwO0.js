import{a as Q,d as K,$ as X,h as ee,D as ae}from"./index-D_TWD7wt.js";import{_ as le}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{D as V}from"./index-lvaXv4aK.js";import{D as ue}from"./index-ClubPft2.js";import{D as E,L as S,P as de}from"./index-BpRFJkOM.js";import{M as oe}from"./index-DkUHLAoM.js";import{h as te,aj as ie,x as ve,Q as re,k as ne,ab as ce,ac as se,s as pe,u as me,ak as fe,f as ge}from"./form-designer-DHHJWkD5.js";import{l as be,r as v,b as ye,j as _e,A as c,q as t,B as o,C as Ve,u as p,J as u,E as N,m,I as y,$ as I,G as U,H as Ie}from"./form-create-_84fGzaM.js";const ke={key:0,class:"pl-0 h-[400px] w-full ml-[-18px]"},Te=be({name:"IoTDeviceForm",__name:"DeviceForm",emits:["success"],setup(he,{expose:q,emit:B}){const{t:k}=Q(),w=K(),f=v(!1),D=v(""),s=v(!1),_=v(""),g=v(!1),A=v(null),e=v({id:void 0,productId:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,locationType:void 0,longitude:void 0,latitude:void 0,location:"",groupIds:[]});ye([()=>e.value.longitude,()=>e.value.latitude],([d,a])=>{d&&a&&(e.value.location=`${d},${a}`,g.value=!0)});const F=_e({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],deviceName:[{required:!0,message:"DeviceName \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{pattern:/^[a-zA-Z0-9_.\-:@]{4,32}$/,message:"\u652F\u6301\u82F1\u6587\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\uFF08_\uFF09\u3001\u4E2D\u5212\u7EBF\uFF08-\uFF09\u3001\u70B9\u53F7\uFF08.\uFF09\u3001\u534A\u89D2\u5192\u53F7\uFF08:\uFF09\u548C\u7279\u6B8A\u5B57\u7B26@\uFF0C\u957F\u5EA6\u9650\u5236\u4E3A 4~32 \u4E2A\u5B57\u7B26",trigger:"blur"}],nickname:[{validator:(d,a,i)=>{if(a==null)return void i();const n=a.replace(/[\u4e00-\u9fa5\u3040-\u30ff]/g,"aa").length;n<4||n>64?i(new Error("\u5907\u6CE8\u540D\u79F0\u957F\u5EA6\u9650\u5236\u4E3A 4~64 \u4E2A\u5B57\u7B26\uFF0C\u4E2D\u6587\u53CA\u65E5\u6587\u7B97 2 \u4E2A\u5B57\u7B26")):/^[\u4e00-\u9fa5\u3040-\u30ff_a-zA-Z0-9]+$/.test(a)?i():i(new Error("\u5907\u6CE8\u540D\u79F0\u53EA\u80FD\u5305\u542B\u4E2D\u6587\u3001\u82F1\u6587\u5B57\u6BCD\u3001\u65E5\u6587\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\uFF08_\uFF09"))},trigger:"blur"}],serialNumber:[{pattern:/^[a-zA-Z0-9-_]+$/,message:"\u5E8F\u5217\u53F7\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E2D\u5212\u7EBF\u548C\u4E0B\u5212\u7EBF",trigger:"blur"}]}),T=v(),h=v([]),$=v([]),x=v([]);q({open:async(d,a)=>{if(f.value=!0,D.value=k("action."+d),_.value=d,O(),g.value=!1,a){s.value=!0;try{e.value=await V.getDevice(a),e.value.longitude&&e.value.latitude&&(e.value.location=`${e.value.longitude},${e.value.latitude}`)}finally{s.value=!1}}g.value=!0,$.value=await V.getSimpleDeviceList(E.GATEWAY),h.value=await de.getSimpleProductList(),x.value=await ue.getSimpleDeviceGroupList()}});const G=B,M=async()=>{await T.value.validate(),s.value=!0;try{const d=e.value;d.locationType!==S.MANUAL&&(d.longitude=void 0,d.latitude=void 0),_.value==="create"?(await V.createDevice(d),w.success(k("common.createSuccess"))):(await V.updateDevice(d),w.success(k("common.updateSuccess"))),f.value=!1,G("success")}finally{s.value=!1}},O=()=>{var d;e.value={id:void 0,productId:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,locationType:void 0,longitude:void 0,latitude:void 0,location:"",groupIds:[]},(d=T.value)==null||d.resetFields(),g.value=!1},z=d=>{var i;if(!d)return void(e.value.deviceType=void 0);const a=(i=h.value)==null?void 0:i.find(n=>n.id===d);e.value.deviceType=a==null?void 0:a.deviceType,e.value.locationType=a==null?void 0:a.locationType},P=d=>{e.value.longitude=d[0],e.value.latitude=d[1]},L=()=>{e.value.longitude&&e.value.latitude&&(e.value.location=`${e.value.longitude},${e.value.latitude}`,A.value.regeoCode(e.value.location))};return(d,a)=>{const i=re,n=ve,r=ie,b=ne,W=me,Y=pe,Z=se,j=ce,R=te,C=ge,H=le,J=fe;return t(),c(H,{title:D.value,modelValue:f.value,"onUpdate:modelValue":a[11]||(a[11]=l=>f.value=l)},{footer:o(()=>[u(C,{onClick:M,type:"primary",disabled:s.value},{default:o(()=>a[12]||(a[12]=[U("\u786E \u5B9A")])),_:1},8,["disabled"]),u(C,{onClick:a[10]||(a[10]=l=>f.value=!1)},{default:o(()=>a[13]||(a[13]=[U("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Ve((t(),c(R,{ref_key:"formRef",ref:T,model:e.value,rules:p(F),"label-width":"100px"},{default:o(()=>[u(r,{label:"\u4EA7\u54C1",prop:"productId"},{default:o(()=>[u(n,{modelValue:e.value.productId,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.productId=l),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",disabled:_.value==="update",clearable:"",onChange:z},{default:o(()=>[(t(!0),m(y,null,I(h.value,l=>(t(),c(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u(r,{label:"DeviceName",prop:"deviceName"},{default:o(()=>[u(b,{modelValue:e.value.deviceName,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.deviceName=l),placeholder:"\u8BF7\u8F93\u5165 DeviceName",disabled:_.value==="update"},null,8,["modelValue","disabled"])]),_:1}),e.value.deviceType===p(E).GATEWAY_SUB?(t(),c(r,{key:0,label:"\u7F51\u5173\u8BBE\u5907",prop:"gatewayId"},{default:o(()=>[u(n,{modelValue:e.value.gatewayId,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.gatewayId=l),placeholder:"\u5B50\u8BBE\u5907\u53EF\u9009\u62E9\u7236\u8BBE\u5907",clearable:""},{default:o(()=>[(t(!0),m(y,null,I($.value,l=>(t(),c(i,{key:l.id,label:l.nickname||l.deviceName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):N("",!0),u(j,null,{default:o(()=>[u(Z,{title:"\u66F4\u591A\u914D\u7F6E"},{default:o(()=>[u(r,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:o(()=>[u(b,{modelValue:e.value.nickname,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.nickname=l),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(r,{label:"\u8BBE\u5907\u56FE\u7247",prop:"picUrl"},{default:o(()=>[u(p(X),{modelValue:e.value.picUrl,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.picUrl=l),height:"120px",width:"120px"},null,8,["modelValue"])]),_:1}),u(r,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupIds"},{default:o(()=>[u(n,{modelValue:e.value.groupIds,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.groupIds=l),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",multiple:"",clearable:""},{default:o(()=>[(t(!0),m(y,null,I(x.value,l=>(t(),c(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(r,{label:"\u8BBE\u5907\u5E8F\u5217\u53F7",prop:"serialNumber"},{default:o(()=>[u(b,{modelValue:e.value.serialNumber,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.serialNumber=l),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907\u5E8F\u5217\u53F7"},null,8,["modelValue"])]),_:1}),u(r,{label:"\u5B9A\u4F4D\u7C7B\u578B",prop:"locationType"},{default:o(()=>[u(Y,{modelValue:e.value.locationType,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.locationType=l)},{default:o(()=>[(t(!0),m(y,null,I(p(ee)(p(ae).IOT_LOCATION_TYPE),l=>(t(),c(W,{key:l.value,label:l.value},{default:o(()=>[U(Ie(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(S).MANUAL===e.value.locationType?(t(),m(y,{key:0},[u(r,{label:"\u8BBE\u5907\u7ECF\u5EA6",prop:"longitude",type:"number"},{default:o(()=>[u(b,{modelValue:e.value.longitude,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.longitude=l),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907\u7ECF\u5EA6",onBlur:L},null,8,["modelValue"])]),_:1}),u(r,{label:"\u8BBE\u5907\u7EF4\u5EA6",prop:"latitude",type:"number"},{default:o(()=>[u(b,{modelValue:e.value.latitude,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.latitude=l),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907\u7EF4\u5EA6",onBlur:L},null,8,["modelValue"])]),_:1}),g.value?(t(),m("div",ke,[u(oe,{isWrite:!0,clickMap:!0,center:e.value.location,onLocateChange:P,ref_key:"mapRef",ref:A,class:"h-full w-full"},null,8,["center"])])):N("",!0)],64)):N("",!0)]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[J,s.value]])]),_:1},8,["title","modelValue"])}}});export{Te as _};
