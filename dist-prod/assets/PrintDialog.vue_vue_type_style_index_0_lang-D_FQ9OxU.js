import{b as Y,I as k,D as S}from"./index-D_TWD7wt.js";import{f as B}from"./index-BjYtO2bM.js";import{f as T}from"./formatTime-BGPGB_ys.js";import{d as R}from"./formCreate-BIGK0pmc.js";import{ak as j,f as F,v as J}from"./form-designer-DHHJWkD5.js";import{l as z,r as v,c as G,ag as $,C as U,u as r,A as C,q as u,B as w,x as e,m as x,H as p,I as L,$ as _,G as g,E as K,J as Q,h as W}from"./form-create-_84fGzaM.js";const X={id:"printDivTag",style:{"word-break":"break-all"}},Z=["innerHTML"],ee={key:1},te={class:"text-center"},se={class:"text-right text-15px"},ae={class:"flex justify-between"},le={class:"text-15px"},re={class:"text-15px"},ne={class:"mt-20px w-100%",border:"1",style:{"border-collapse":"collapse"}},ce={class:"p-5px w-25%"},oe={class:"p-5px w-25%"},pe={class:"p-5px w-25%"},ie={class:"p-5px w-25%"},de={class:"p-5px w-20%"},ue={class:"p-5px w-80%",colspan:"3"},me=["innerHTML"],ve={class:"p-5px w-20%"},xe={class:"p-5px w-80%",colspan:"3"},fe={key:0},be=["src"],he={class:"dialog-footer"},Te=z({__name:"PrintDialog",setup(we,{expose:D}){const N=Y(),b=v(!1),y=v(!1),a=v(),E=G(()=>N.user.nickname??""),H=v(T(new Date,"YYYY-MM-DD HH:mm")),M=v(),n=v({});D({open:async i=>{y.value=!0;try{a.value=await B(i),q(),P()}finally{y.value=!1}b.value=!0}});const P=()=>{const i=R(a.value.processInstance.processDefinition.formFields),t=a.value.processInstance.formVariables;let c=[];for(const l of i){const o=l.field,f=l.title,s=t[l.field];let m=s;switch(l.type){case"UploadImg":{let d=document.createElement("img");d.setAttribute("src",s),d.setAttribute("style","max-width: 600px;"),m=d.outerHTML;break}case"radio":case"checkbox":case"select":{const d=l.options||[],I=[];if(Array.isArray(s)){const A=d.filter(h=>s.includes(h.value)).map(h=>h.label);I.push(...A)}else{const A=d.find(h=>h.value===s);I.push(A.label)}m=I.join(",")}}n.value[l.field]=m,c.push({id:o,name:f,html:m})}M.value=c},q=()=>{n.value.startUser=a.value.processInstance.startUser.nickname,n.value.startUserDept=a.value.processInstance.startUser.deptName,n.value.processName=a.value.processInstance.name,n.value.processNum=a.value.processInstance.id,n.value.startTime=T(a.value.processInstance.startTime),n.value.endTime=T(a.value.processInstance.endTime),n.value.processStatus=k(S.BPM_PROCESS_INSTANCE_STATUS,a.value.processInstance.status),n.value.printUser=E.value,n.value.printTime=H.value},O=()=>{let i=new DOMParser().parseFromString(a.value.printTemplateHtml,"text/html");i.querySelectorAll("table").forEach(l=>{l.setAttribute("border","1"),l.setAttribute("style",(l.getAttribute("style")||"")+"border-collapse:collapse;")}),i.querySelectorAll('[data-w-e-type="mention"]').forEach(l=>{const o=JSON.parse(decodeURIComponent(l.getAttribute("data-info")??"")).id;l.innerHTML=n.value[o]??""});let t=i.querySelectorAll('[data-w-e-type="process-record"]'),c=document.createElement("table");if(t.length>0){c.setAttribute("border","1"),c.setAttribute("style","width:100%;border-collapse:collapse;");const l=document.createElement("tr"),o=document.createElement("td");o.setAttribute("colspan","2"),o.setAttribute("width","auto"),o.setAttribute("style","text-align: center;"),o.innerHTML="\u6D41\u7A0B\u8282\u70B9",l.appendChild(o),c.appendChild(l),a.value.tasks.forEach(f=>{const s=document.createElement("tr"),m=document.createElement("td");m.innerHTML=f.name;const d=document.createElement("td");d.innerHTML=f.description,s.appendChild(m),s.appendChild(d),c.appendChild(s)})}return t.forEach(l=>{l.innerHTML=c.outerHTML}),i.body.innerHTML},V=v({id:"printDivTag",popTitle:"&nbsp",extraCss:"/print.css",extraHead:"",zIndex:20003});return(i,t)=>{const c=F,l=J,o=$("print"),f=j;return U((u(),C(l,{modelValue:r(b),"onUpdate:modelValue":t[1]||(t[1]=s=>W(b)?b.value=s:null),"show-close":!1},{footer:w(()=>[e("div",he,[Q(c,{onClick:t[0]||(t[0]=s=>b.value=!1)},{default:w(()=>t[8]||(t[8]=[g("\u53D6 \u6D88")])),_:1}),U((u(),C(c,{type:"primary"},{default:w(()=>t[9]||(t[9]=[g(" \u6253 \u5370")])),_:1})),[[o,r(V)]])])]),default:w(()=>[e("div",X,[r(a).printTemplateEnable?(u(),x("div",{key:0,innerHTML:O()},null,8,Z)):(u(),x("div",ee,[e("h2",te,p(r(a).processInstance.name),1),e("div",se,p("\u6253\u5370\u4EBA\u5458: "+r(E)),1),e("div",ae,[e("div",le,p("\u6D41\u7A0B\u7F16\u53F7: "+r(a).processInstance.id),1),e("div",re,p("\u6253\u5370\u65F6\u95F4: "+r(H)),1)]),e("table",ne,[e("tbody",null,[e("tr",null,[t[2]||(t[2]=e("td",{class:"p-5px w-25%"},"\u53D1\u8D77\u4EBA",-1)),e("td",ce,p(r(a).processInstance.startUser.nickname),1),t[3]||(t[3]=e("td",{class:"p-5px w-25%"},"\u53D1\u8D77\u65F6\u95F4",-1)),e("td",oe,p(r(T)(r(a).processInstance.startTime)),1)]),e("tr",null,[t[4]||(t[4]=e("td",{class:"p-5px w-25%"},"\u6240\u5C5E\u90E8\u95E8",-1)),e("td",pe,p(r(a).processInstance.startUser.deptName),1),t[5]||(t[5]=e("td",{class:"p-5px w-25%"},"\u6D41\u7A0B\u72B6\u6001",-1)),e("td",ie,p(r(k)(r(S).BPM_PROCESS_INSTANCE_STATUS,r(a).processInstance.status)),1)]),t[6]||(t[6]=e("tr",null,[e("td",{class:"p-5px w-100% text-center",colspan:"4"},[e("h4",null,"\u8868\u5355\u5185\u5BB9")])],-1)),(u(!0),x(L,null,_(r(M),s=>(u(),x("tr",{key:s.id},[e("td",de,p(s.name),1),e("td",ue,[e("div",{innerHTML:s.html},null,8,me)])]))),128)),t[7]||(t[7]=e("tr",null,[e("td",{class:"p-5px w-100% text-center",colspan:"4"},[e("h4",null,"\u6D41\u7A0B\u8282\u70B9")])],-1)),(u(!0),x(L,null,_(r(a).tasks,s=>(u(),x("tr",{key:s.id},[e("td",ve,p(s.name),1),e("td",xe,[g(p(s.description)+" ",1),s.signPicUrl&&s.signPicUrl.length>0?(u(),x("div",fe,[e("img",{class:"w-90px h-40px",src:s.signPicUrl,alt:""},null,8,be)])):K("",!0)])]))),128))])])]))])]),_:1},8,["modelValue"])),[[f,r(y)]])}}});export{Te as _};
