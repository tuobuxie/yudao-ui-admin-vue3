import{_ as A}from"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import{d as B,_ as T,M as j,aH as q}from"./index-DmQdxAiK.js";import{D as G}from"./index-m3HcIj_K.js";import{d as H}from"./download-oWiM5xVU.js";import{z as M,w as J,P as L,f as O}from"./form-designer-DHHJWkD5.js";import{l as P,r as n,A as R,q as S,B as o,J as c,u as i,h as x,x as v,G as f,n as E}from"./form-create-_84fGzaM.js";const K={class:"el-upload__tip text-center"},Q={class:"el-upload__tip"},W=P({name:"IoTDeviceImportForm",__name:"DeviceImportForm",emits:["success"],setup(X,{expose:b,emit:g}){const d=B(),r=n(!1),s=n(!1),_=n(),h=n(),m=n([]),p=n(0);b({open:()=>{r.value=!0,p.value=0,m.value=[],D()}});const N=async()=>{m.value.length!=0?(h.value={Authorization:"Bearer "+q(),"tenant-id":j()},s.value=!0,_.value.submit()):d.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},k=g,V=a=>{if(a.code!==0)return d.error(a.msg),void(s.value=!1);const e=a.data;let l="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createDeviceNames.length+";";for(let t of e.createDeviceNames)l+="< "+t+" >";l+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateDeviceNames.length+";";for(const t of e.updateDeviceNames)l+="< "+t+" >";l+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureDeviceNames).length+";";for(const t in e.failureDeviceNames)l+="< "+t+": "+e.failureDeviceNames[t]+" >";d.alert(l),s.value=!1,r.value=!1,k("success")},w=()=>{d.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),D()},D=async()=>{var a;s.value=!1,await E(),(a=_.value)==null||a.clearFiles()},z=()=>{d.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},C=async()=>{const a=await G.importDeviceTemplate();H.excel(a,"\u8BBE\u5907\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const l=T,t=J,F=L,I=M,y=O,U=A;return S(),R(U,{modelValue:i(r),"onUpdate:modelValue":e[3]||(e[3]=u=>x(r)?r.value=u:null),title:"\u8BBE\u5907\u5BFC\u5165",width:"400"},{footer:o(()=>[c(y,{disabled:i(s),type:"primary",onClick:N},{default:o(()=>e[8]||(e[8]=[f("\u786E \u5B9A")])),_:1},8,["disabled"]),c(y,{onClick:e[2]||(e[2]=u=>r.value=!1)},{default:o(()=>e[9]||(e[9]=[f("\u53D6 \u6D88")])),_:1})]),default:o(()=>[c(I,{ref_key:"uploadRef",ref:_,"file-list":i(m),"onUpdate:fileList":e[1]||(e[1]=u=>x(m)?m.value=u:null),action:"http://47.105.43.107:48080/admin-api/iot/device/import?updateSupport="+i(p),"auto-upload":!1,disabled:i(s),headers:i(h),limit:1,"on-error":w,"on-exceed":z,"on-success":V,accept:".xlsx, .xls",drag:""},{tip:o(()=>[v("div",K,[v("div",Q,[c(t,{modelValue:i(p),"onUpdate:modelValue":e[0]||(e[0]=u=>x(p)?p.value=u:null)},null,8,["modelValue"]),e[4]||(e[4]=f(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u8BBE\u5907\u6570\u636E "))]),e[6]||(e[6]=v("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),c(F,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:C},{default:o(()=>e[5]||(e[5]=[f(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:o(()=>[c(l,{icon:"ep:upload"}),e[7]||(e[7]=v("div",{class:"el-upload__text"},[f("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),v("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","action","disabled","headers"])]),_:1},8,["modelValue"])}}});export{W as _};
