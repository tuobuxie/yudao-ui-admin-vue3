import{X as w,a as X,d as Z,h as $,D as H,Z as N,Y as ee,_ as ae}from"./index-B2urM1q-.js";import{_ as le}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{B as g}from"./index-B0eIRY_y.js";import{_ as se}from"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-BEwpenxH.js";import{_ as oe}from"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-BhMje63r.js";import{_ as te}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-Du3cpciC.js";import{_ as ue}from"./ContactListModal.vue_vue_type_script_setup_true_lang-C_6HWrGc.js";import{ak as re,i as de,j as ne,aj as ce,x as ie,Q as pe,F as me,k as fe,f as _e,h as be}from"./form-designer-DHHJWkD5.js";import{l as ve,r as c,j as ye,m as x,q as m,I as F,J as a,u as s,h as Ue,B as o,C as we,A as v,E as h,$ as Ve,G as y}from"./form-create-_84fGzaM.js";const k={getFollowUpRecordPage:async i=>await w.get({url:"/crm/follow-up-record/page",params:i}),createFollowUpRecord:async i=>await w.post({url:"/crm/follow-up-record/create",data:i}),deleteFollowUpRecord:async i=>await w.delete({url:"/crm/follow-up-record/delete?id="+i})},Re=ve({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(i,{expose:z,emit:C}){const{t:I}=X(),S=Z(),p=c(!1);c("");const _=c(!1),l=c({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),E=ye({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),U=c();z({open:async(u,e)=>{p.value=!0,D(),l.value.bizType=u,l.value.bizId=e}});const M=C,O=async()=>{await U.value.validate(),_.value=!0;try{const u={...l.value,contactIds:l.value.contacts.map(e=>e.id),businessIds:l.value.businesses.map(e=>e.id)};await k.createFollowUpRecord(u),S.success(I("common.createSuccess")),p.value=!1,M("success")}finally{_.value=!1}},V=c(),q=()=>{var u;(u=V.value)==null||u.open()},P=(u,e)=>{e.forEach(r=>{l.value.contacts.some(f=>f.id===r.id)||l.value.contacts.push(r)})},R=c(),j=()=>{var u;(u=R.value)==null||u.open()},B=(u,e)=>{e.forEach(r=>{l.value.businesses.some(f=>f.id===r.id)||l.value.businesses.push(r)})},D=()=>{var u;(u=U.value)==null||u.resetFields(),l.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}};return(u,e)=>{const r=pe,f=ie,d=ce,n=ne,J=me,L=fe,Y=N,A=ee,T=ae,b=_e,G=de,K=be,Q=le,W=re;return m(),x(F,null,[a(Q,{modelValue:s(p),"onUpdate:modelValue":e[6]||(e[6]=t=>Ue(p)?p.value=t:null),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[a(b,{disabled:s(_),type:"primary",onClick:O},{default:o(()=>e[9]||(e[9]=[y("\u786E \u5B9A")])),_:1},8,["disabled"]),a(b,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:o(()=>e[10]||(e[10]=[y("\u53D6 \u6D88")])),_:1})]),default:o(()=>[we((m(),v(K,{ref_key:"formRef",ref:U,model:s(l),rules:s(E),"label-width":"120px"},{default:o(()=>[a(G,null,{default:o(()=>[a(n,{span:12},{default:o(()=>[a(d,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[a(f,{modelValue:s(l).type,"onUpdate:modelValue":e[0]||(e[0]=t=>s(l).type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(m(!0),x(F,null,Ve(s($)(s(H).CRM_FOLLOW_UP_TYPE),t=>(m(),v(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[a(J,{modelValue:s(l).nextTime,"onUpdate:modelValue":e[1]||(e[1]=t=>s(l).nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:24},{default:o(()=>[a(d,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[a(L,{modelValue:s(l).content,"onUpdate:modelValue":e[2]||(e[2]=t=>s(l).content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[a(Y,{modelValue:s(l).picUrls,"onUpdate:modelValue":e[3]||(e[3]=t=>s(l).picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[a(A,{modelValue:s(l).fileUrls,"onUpdate:modelValue":e[4]||(e[4]=t=>s(l).fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),s(l).bizType==s(g).CRM_CUSTOMER?(m(),v(n,{key:0,span:24},{default:o(()=>[a(d,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[a(b,{onClick:q},{default:o(()=>[a(T,{class:"mr-5px",icon:"ep:plus"}),e[7]||(e[7]=y(" \u6DFB\u52A0\u8054\u7CFB\u4EBA "))]),_:1}),a(oe,{contacts:s(l).contacts},null,8,["contacts"])]),_:1})]),_:1})):h("",!0),s(l).bizType==s(g).CRM_CUSTOMER?(m(),v(n,{key:1,span:24},{default:o(()=>[a(d,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[a(b,{onClick:j},{default:o(()=>[a(T,{class:"mr-5px",icon:"ep:plus"}),e[8]||(e[8]=y(" \u6DFB\u52A0\u5546\u673A "))]),_:1}),a(se,{businesses:s(l).businesses},null,8,["businesses"])]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1},8,["model","rules"])),[[W,s(_)]])]),_:1},8,["modelValue"]),a(ue,{ref_key:"contactTableSelectRef",ref:V,"customer-id":s(l).bizId,onSuccess:P},null,8,["customer-id"]),a(te,{ref_key:"businessTableSelectRef",ref:R,"customer-id":s(l).bizId,onSuccess:B},null,8,["customer-id"])],64)}}});export{k as F,Re as _};
