import{u as Q,d as Y,_ as Z,c as ee}from"./index-DmQdxAiK.js";import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{d as te,b as ie}from"./formCreate-BIGK0pmc.js";import{a as A,B as oe}from"./constants-C3gLHYOK.js";import{N as le,C as se,F as g}from"./consts-CvaDWb4S.js";import re from"./ProcessInstanceBpmnViewer-Be865-Nx.js";import{_ as ne}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-CJU0J-Mv.js";import{_ as me}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-D2CEEcsv.js";import{u as ce}from"./tagsView-CQDzb46U.js";import{g as ue,h as pe}from"./index-gF9XQK0o.js";import{a as de}from"./index-6gTZpT9M.js";import{l as fe,r as c,b as ve,A as x,q as y,B as n,x as h,J as i,H as ye,h as j,u as o,C as be,m as O,al as U,E as w,G as M,n as _e}from"./form-create-_84fGzaM.js";import{e as he,V as Se,a0 as De,$ as Pe,i as ge,j as xe,ak as we,f as Ve}from"./form-designer-DHHJWkD5.js";import"./bpmn-embedded-B03mYb7T.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./XTextButton-CXU1Athx.js";import"./XButton-BH0HlMtk.js";import"./index-DWAKVBMX.js";import"./index-oJNTIjFE.js";import"./node-D3mIdOYQ.js";import"./index-DX-DzHIf.js";import"./index-BCN8BzfC.js";import"./utils-DciZ0SJK.js";import"./index-D29lUHab.js";import"./tree-COGD3qag.js";import"./index-EzkaYqZE.js";import"./index-CuiPf8R-.js";import"./index-hYLD56hJ.js";import"./index-C8HfUSOZ.js";import"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import"./index-DOsjFOOh.js";import"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import"./index-B6R_oMDY.js";import"./formatTime-BGPGB_ys.js";import"./simple-process-designer-D6s0X7s1.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-CKlTSlHM.js";import"./index-0Ok0c-x7.js";import"./download-oWiM5xVU.js";import"./index-BhHRYVfS.js";const Ce={class:"processInstance-wrap-main"},Ee={class:"text-#878c93 h-15px"},Ie={class:"form-scroll-area"},Ne={class:"form-scroll-area"},Re={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},ke={key:0,class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},Te=ee(fe({name:"ProcessDefinitionDetail",__name:"ProcessDefinitionDetail",props:{selectProcessDefinition:{}},emits:["cancel"],setup(B,{expose:F,emit:J}){const S=B,L=J,D=c(!1),{push:V,currentRoute:$}=Q(),P=Y(),{delView:q}=ce(),d=c({rule:[],option:{},value:{}}),m=c(),f=c([]),u=c({}),b=c({}),C=c(null),E=c(),_=c("form"),I=c([]);ve(d.value,a=>{a&&Object.keys(a.value).length>0&&(b.value=u.value,u.value={},N({id:S.selectProcessDefinition.id,processVariablesStr:JSON.stringify(a.value)}))},{immediate:!0});const N=async a=>{var e,l;try{const s=await ue({processDefinitionId:a.id,activityId:le.START_USER_NODE_ID,processVariablesStr:a.processVariablesStr});if(!s)return void P.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(I.value=s.activityNodes,f.value=(e=s.activityNodes)==null?void 0:e.filter(t=>se.START_USER_SELECT===t.candidateStrategy),((l=f.value)==null?void 0:l.length)>0)for(const t of f.value)b.value[t.id]&&b.value[t.id].length>0?u.value[t.id]=b.value[t.id]:u.value[t.id]=[];const r=s.formFieldsPermission;r&&Object.keys(r).forEach(t=>{G(t,r[t])})}finally{}},G=(a,e)=>{var l,s,r,t;if(e===g.READ){(l=m.value)==null||l.disabled(!0,a);try{const p=(s=m.value)==null?void 0:s.getRule(a);p&&(p.$required=!1,p.validate&&(p.validate=[]))}catch{}}e===g.WRITE&&((r=m.value)==null||r.disabled(!1,a)),e===g.NONE&&((t=m.value)==null||t.hidden(!0,a))},R=async()=>{var a;if(m.value&&S.selectProcessDefinition){try{await m.value.validate()}catch{return}if(((a=f.value)==null?void 0:a.length)>0){for(const e of f.value)if(Array.isArray(u.value[e.id])&&u.value[e.id].length===0)return P.warning(`\u8BF7\u9009\u62E9${e.name}\u7684\u5019\u9009\u4EBA`)}D.value=!0;try{await pe({processDefinitionId:S.selectProcessDefinition.id,variables:d.value.value,startUserSelectAssignees:u.value}),P.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),q(o($)),await V({name:"BpmProcessInstanceMy"})}finally{D.value=!1}}},H=()=>{L("cancel")},W=(a,e)=>{u.value[a]=e==null?void 0:e.map(l=>l.id)};return F({initProcessInfo:async(a,e)=>{var l;if(f.value=[],u.value={},a.formType==oe.NORMAL){const s=U.create(te(a.formFields)).fields();for(const t in e)s.includes(t)||delete e[t];ie(d,a.formConf,a.formFields,e),await _e(),(l=m.value)==null||l.btn.show(!1),await N({id:a.id,processVariablesStr:JSON.stringify(e)});const r=await de(a.id);r&&(C.value=r.bpmnXml,E.value=r.simpleModel)}else a.formCustomCreatePath&&await V({path:a.formCustomCreatePath})}}),(a,e)=>{const l=Se,s=xe,r=ge,t=he,p=Pe,X=De,k=Z,T=Ve,z=ae,K=we;return y(),x(z,{bodyStyle:{padding:"10px 20px 0"}},{default:n(()=>[h("div",Ce,[i(t,null,{default:n(()=>[h("div",Ee,"\u6D41\u7A0B\uFF1A"+ye(a.selectProcessDefinition.name),1),i(l,{class:"!my-8px"}),i(X,{modelValue:o(_),"onUpdate:modelValue":e[2]||(e[2]=v=>j(_)?_.value=v:null)},{default:n(()=>[i(p,{label:"\u8868\u5355\u586B\u5199",name:"form"},{default:n(()=>[be((y(),O("div",Ie,[i(t,null,{default:n(()=>[i(r,null,{default:n(()=>[i(s,{span:17},{default:n(()=>[i(o(U),{rule:o(d).rule,api:o(m),"onUpdate:api":e[0]||(e[0]=v=>j(m)?m.value=v:null),modelValue:o(d).value,"onUpdate:modelValue":e[1]||(e[1]=v=>o(d).value=v),option:o(d).option,onSubmit:R},null,8,["rule","api","modelValue","option"])]),_:1}),i(s,{span:6,offset:1},{default:n(()=>[i(me,{ref:"timelineRef","activity-nodes":o(I),"show-status-icon":!1,onSelectUserConfirm:W},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])),[[K,o(D)]])]),_:1}),i(p,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:n(()=>[h("div",Ne,[o(A).BPMN===a.selectProcessDefinition.modelType?(y(),x(re,{key:0,"bpmn-xml":o(C)},null,8,["bpmn-xml"])):w("",!0),o(A).SIMPLE===a.selectProcessDefinition.modelType?(y(),x(ne,{key:1,"simple-json":o(E)},null,8,["simple-json"])):w("",!0)])]),_:1})]),_:1},8,["modelValue"]),h("div",Re,[o(_)==="form"?(y(),O("div",ke,[i(T,{plain:"",type:"success",onClick:R},{default:n(()=>[i(k,{icon:"ep:select"}),e[3]||(e[3]=M("\xA0 \u53D1\u8D77 "))]),_:1}),i(T,{plain:"",type:"danger",onClick:H},{default:n(()=>[i(k,{icon:"ep:close"}),e[4]||(e[4]=M("\xA0 \u53D6\u6D88 "))]),_:1})])):w("",!0)])]),_:1})])]),_:1})}}}),[["__scopeId","data-v-f6e351af"]]);export{Te as default};
