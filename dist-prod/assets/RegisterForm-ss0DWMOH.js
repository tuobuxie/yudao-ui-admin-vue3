import{a as A,u as G,q as J,M as K,am as M,y as O,t as $,z as D,A as V,ai as H,c as Q}from"./index-DzK2S43K.js";import{_ as W}from"./Verify-DRWi7Y-t.js";import{_ as X}from"./XButton-c3Z73tBC.js";import{l as Y,r as m,c as Z,u as e,j as ee,b as ae,e as re,C as se,K as le,A as g,q as f,B as l,J as s,E as v}from"./form-create-_84fGzaM.js";import{u as te,L as oe,_ as ie,a as ne}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-TLnzM6Xx.js";import{u as w}from"./useIcon-DdzKJstU.js";import{i as pe,j as me,aj as ue,k as ce,h as de,d as ge}from"./form-designer-DHHJWkD5.js";const fe=Q(Y({name:"RegisterForm",__name:"RegisterForm",setup(we){const{t:p}=A(),E=w({icon:"ep:house"}),h=w({icon:"ep:avatar"}),x=w({icon:"ep:lock"}),b=m(),{validForm:z}=ne(b),{handleBackLogin:q,getLoginState:P}=te(),{currentRoute:N,push:R}=G(),U=J(),u=m(""),_=m(!1),y=m(),S=m("blockPuzzle"),I=Z(()=>e(P)===oe.REGISTER),L={tenantName:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u6240\u5C5E\u7684\u79DF\u6237"},{min:2,max:20,message:"\u79DF\u6237\u8D26\u53F7\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],username:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u8D26\u53F7"},{min:4,max:30,message:"\u7528\u6237\u8D26\u53F7\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 4 \u548C 30 \u4E4B\u95F4",trigger:"blur"}],nickname:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u6635\u79F0"},{min:0,max:30,message:"\u6635\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 0 \u548C 30 \u4E4B\u95F4",trigger:"blur"}],password:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u5BC6\u7801"},{min:5,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`\u4E0D\u80FD\u5305\u542B\u975E\u6CD5\u5B57\u7B26\uFF1A< > " ' \\ |`,trigger:"blur"}],confirmPassword:[{required:!0,trigger:"blur",message:"\u8BF7\u518D\u6B21\u8F93\u5165\u60A8\u7684\u5BC6\u7801"},{required:!0,validator:(t,a,i)=>{r.registerForm.password!==a?i(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4")):i()},trigger:"blur"}]},r=ee({isShowPassword:!1,captchaEnable:"false",tenantEnable:"true",registerForm:{tenantName:"saas",nickname:"",tenantId:0,username:"",password:"",confirmPassword:"",captchaVerification:""}}),d=m(),F=async t=>{d.value=!0;try{if(r.tenantEnable&&(await j(),r.registerForm.tenantId=K()),r.captchaEnable&&(r.registerForm.captchaVerification=t.captchaVerification),!await z())return;const a=await M(r.registerForm);if(!a)return;d.value=ge.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),O(),$(a),u.value||(u.value="/"),u.value.indexOf("sso")!==-1?window.location.href=window.location.href.replace("/login?redirect=",""):R({path:u.value||U.addRouters[0].path})}finally{_.value=!1,d.value.close()}},j=async()=>{if(r.tenantEnable==="true"){const t=await D(r.registerForm.tenantName);V(t)}};return ae(()=>N.value,t=>{var a;u.value=(a=t==null?void 0:t.query)==null?void 0:a.redirect},{immediate:!0}),re(()=>{(async()=>{if(r.tenantEnable==="true"){const t=location.host,a=await H(t);a&&(r.registerForm.tenantName=a.name,V(a.id))}})()}),(t,a)=>{const i=ue,n=me,c=ce,k=X,B=W,C=pe,T=de;return se((f(),g(T,{ref_key:"formLogin",ref:b,model:e(r).registerForm,rules:L,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:l(()=>[s(C,{class:"mx-[-10px]"},{default:l(()=>[s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,null,{default:l(()=>[s(ie,{class:"w-full"})]),_:1})]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[e(r).tenantEnable==="true"?(f(),g(i,{key:0,prop:"tenantName"},{default:l(()=>[s(c,{modelValue:e(r).registerForm.tenantName,"onUpdate:modelValue":a[0]||(a[0]=o=>e(r).registerForm.tenantName=o),placeholder:e(p)("login.tenantname"),"prefix-icon":e(E),link:"",type:"primary",size:"large"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):v("",!0)]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,{prop:"username"},{default:l(()=>[s(c,{modelValue:e(r).registerForm.username,"onUpdate:modelValue":a[1]||(a[1]=o=>e(r).registerForm.username=o),placeholder:e(p)("login.username"),size:"large","prefix-icon":e(h)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,{prop:"nickname"},{default:l(()=>[s(c,{modelValue:e(r).registerForm.nickname,"onUpdate:modelValue":a[2]||(a[2]=o=>e(r).registerForm.nickname=o),placeholder:"\u6635\u79F0",size:"large","prefix-icon":e(h)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,{prop:"password"},{default:l(()=>[s(c,{modelValue:e(r).registerForm.password,"onUpdate:modelValue":a[3]||(a[3]=o=>e(r).registerForm.password=o),type:"password","auto-complete":"off",placeholder:e(p)("login.password"),size:"large","prefix-icon":e(x),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,{prop:"confirmPassword"},{default:l(()=>[s(c,{modelValue:e(r).registerForm.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=o=>e(r).registerForm.confirmPassword=o),type:"password",size:"large","auto-complete":"off",placeholder:e(p)("login.checkPassword"),"prefix-icon":e(x),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),s(n,{span:24,class:"px-10px"},{default:l(()=>[s(i,null,{default:l(()=>[s(k,{loading:e(_),title:e(p)("login.register"),class:"w-full",type:"primary",onClick:a[5]||(a[5]=o=>(async()=>{r.captchaEnable==="false"?await F({}):y.value.show()})())},null,8,["loading","title"])]),_:1})]),_:1}),e(r).captchaEnable==="true"?(f(),g(B,{key:0,ref_key:"verify",ref:y,captchaType:e(S),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:F},null,8,["captchaType"])):v("",!0)]),_:1}),s(k,{title:e(p)("login.hasUser"),class:"w-full",onClick:a[6]||(a[6]=o=>e(q)())},null,8,["title"])]),_:1},8,["model"])),[[le,e(I)]])}}}),[["__scopeId","data-v-6a2ac2d6"]]);export{fe as default};
