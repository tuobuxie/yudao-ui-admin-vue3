import{a as N,d as R,c as z}from"./index-D_TWD7wt.js";import{_ as D}from"./Dialog.vue_vue_type_style_index_0_lang-CJT4CHEp.js";import{_ as K}from"./ContentWrap.vue_vue_type_script_setup_true_lang-4_WNC8um.js";import{d as W,h as H}from"./tree-COGD3qag.js";import{g as L}from"./index-2u6l8ymH.js";import{g as M}from"./index-tmtszvF2.js";import{ak as O,i as P,j as Q,y as T,S as X,f as Y}from"./form-designer-DHHJWkD5.js";import{l as Z,r as u,c as $,A as g,q as V,B as o,C as ee,u as d,J as r,h as x,G as b}from"./form-create-_84fGzaM.js";const ae=z(Z({name:"UserSelectForm",__name:"index",emits:["confirm"],setup(le,{expose:w,emit:C}){const I=C,{t:S}=N(),U=R(),p=u([]),v=u([]),i=u([]),f=u([]),l=u([]),n=u(!1),m=u(!1),_=u(),j=$(()=>[...i.value.filter(a=>l.value.includes(a.id)),...f.value.filter(a=>!l.value.includes(a.id))]),y=(a,e)=>{const t=[a];return e.filter(s=>s.parentId===a).forEach(s=>{t.push(...y(s.id,e))}),t},q=async()=>{try{U.success(S("common.updateSuccess")),n.value=!1;const a=i.value.filter(e=>l.value.includes(e.id));I("confirm",_.value,a)}finally{}},A=()=>{p.value=[],v.value=[],i.value=[],f.value=[],l.value=[]},B=a=>{(async e=>{m.value=!0;try{if(!e)return void(f.value=[...i.value]);const t=y(e,v.value);f.value=i.value.filter(s=>t.includes(s.deptId))}finally{m.value=!1}})(a.id)};return w({open:async(a,e)=>{_.value=a,A();const t=await L();v.value=t,p.value=H(t),i.value=await M(),f.value=[...i.value],l.value=(e==null?void 0:e.map(s=>s.id))||[],n.value=!0}}),(a,e)=>{const t=T,s=K,h=Q,E=X,F=P,k=Y,G=D,J=O;return V(),g(G,{modelValue:d(n),"onUpdate:modelValue":e[2]||(e[2]=c=>x(n)?n.value=c:null),title:"\u4EBA\u5458\u9009\u62E9",width:"800"},{footer:o(()=>{var c;return[r(k,{disabled:d(m)||!((c=d(l))!=null&&c.length),type:"primary",onClick:q},{default:o(()=>e[3]||(e[3]=[b(" \u786E \u5B9A ")])),_:1},8,["disabled"]),r(k,{onClick:e[1]||(e[1]=te=>n.value=!1)},{default:o(()=>e[4]||(e[4]=[b("\u53D6 \u6D88")])),_:1})]}),default:o(()=>[ee((V(),g(F,{class:"gap2"},{default:o(()=>[r(h,{span:6},{default:o(()=>[r(s,{class:"h-1/1"},{default:o(()=>[r(t,{ref:"treeRef",data:d(p),"expand-on-click-node":!1,props:d(W),"default-expand-all":"","highlight-current":"","node-key":"id",onNodeClick:B},null,8,["data","props"])]),_:1})]),_:1}),r(h,{span:17},{default:o(()=>[r(E,{modelValue:d(l),"onUpdate:modelValue":e[0]||(e[0]=c=>x(l)?l.value=c:null),titles:["\u672A\u9009","\u5DF2\u9009"],filterable:"","filter-placeholder":"\u641C\u7D22\u6210\u5458",data:d(j),props:{label:"nickname",key:"id"}},null,8,["modelValue","data"])]),_:1})]),_:1})),[[J,d(m)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-07642267"]]);export{ae as _};
