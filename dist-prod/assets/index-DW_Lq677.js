import{d as F,_ as G,c as M}from"./index-DmQdxAiK.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as H}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as K}from"./index-C2x7yuaO.js";import{_ as L}from"./main.vue_vue_type_script_setup_true_lang-DijmNsTR.js";import{g as Q,c as T,u as W,d as X}from"./main-I-_7yN8H.js";import{s as Y}from"./index-CebrFt1o.js";import{N as Z,c as $}from"./NewsForm-k9opkok9.js";import aa from"./DraftTable-Dp5TC95k.js";import{h as ea,aj as la,f as ta,ak as oa,v as ia}from"./form-designer-DHHJWkD5.js";import{l as sa,r as i,j as ra,ag as na,m as ua,q as N,J as t,B as o,u as e,C as U,A as ma,G as _,h as V,I as ca,p as pa}from"./form-create-_84fGzaM.js";import"./index-W8edep2c.js";import"./tagsView-CQDzb46U.js";import"./main-CJVSjYz7.js";import"./main-Ddqx4-1N.js";import"./main.vue_vue_type_script_setup_true_lang-DeOxeHzY.js";import"./index-CHHBmOkg.js";import"./formatTime-BGPGB_ys.js";import"./CoverSelect-Da-b3AHk.js";import"./useUpload-CW5EVrRd.js";const da=M(sa({name:"MpDraft",__name:"index",setup(fa){const n=F(),s=i(-1);pa("accountId",s);const v=i(!0),w=i([]),h=i(0),u=ra({pageNo:1,pageSize:10,accountId:s}),m=i(!1),c=i([]),I=i(""),p=i(!0),y=i(!1),k=l=>{s.value=l,u.pageNo=1,d()},x=async l=>{try{await n.confirm("\u4FEE\u6539\u5185\u5BB9\u53EF\u80FD\u8FD8\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u5173\u95ED\u5417?"),l()}catch{}},d=async()=>{v.value=!0;try{const l=await Q(u);l.list.forEach(a=>{a.content.newsItem.forEach(f=>{f.picUrl=f.thumbUrl})}),w.value=l.list,h.value=l.total}finally{v.value=!1}},z=()=>{p.value=!0,c.value=[$()],m.value=!0},C=l=>{I.value=l.mediaId,c.value=JSON.parse(JSON.stringify(l.content.newsItem)),p.value=!1,m.value=!0},J=async()=>{y.value=!0;try{p.value?(await T(s.value,c.value),n.notifySuccess("\u65B0\u589E\u6210\u529F")):(await W(s.value,I.value,c.value),n.notifySuccess("\u66F4\u65B0\u6210\u529F"))}finally{m.value=!1,y.value=!1,await d()}},O=async l=>{const a=l.mediaId;try{await n.confirm("\u4F60\u6B63\u5728\u901A\u8FC7\u53D1\u5E03\u7684\u65B9\u5F0F\u53D1\u8868\u5185\u5BB9\u3002 \u53D1\u5E03\u4E0D\u5360\u7528\u7FA4\u53D1\u6B21\u6570\uFF0C\u4E00\u5929\u53EF\u591A\u6B21\u53D1\u5E03\u3002\u5DF2\u53D1\u5E03\u5185\u5BB9\u4E0D\u4F1A\u63A8\u9001\u7ED9\u7528\u6237\uFF0C\u4E5F\u4E0D\u4F1A\u5C55\u793A\u5728\u516C\u4F17\u53F7\u4E3B\u9875\u4E2D\u3002 \u53D1\u5E03\u540E\uFF0C\u4F60\u53EF\u4EE5\u524D\u5F80\u53D1\u8868\u8BB0\u5F55\u83B7\u53D6\u94FE\u63A5\uFF0C\u4E5F\u53EF\u4EE5\u5C06\u53D1\u5E03\u5185\u5BB9\u6DFB\u52A0\u5230\u81EA\u5B9A\u4E49\u83DC\u5355\u3001\u81EA\u52A8\u56DE\u590D\u3001\u8BDD\u9898\u548C\u9875\u9762\u6A21\u677F\u4E2D\u3002"),await Y(s.value,a),n.notifySuccess("\u53D1\u5E03\u6210\u529F"),await d()}catch{}},P=async l=>{const a=l.mediaId;try{await n.confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u8BE5\u8349\u7A3F, \u662F\u5426\u7EE7\u7EED?"),await X(s.value,a),n.notifySuccess("\u5220\u9664\u6210\u529F"),await d()}catch{}};return(l,a)=>{const f=K,b=la,j=G,g=ta,q=ea,S=H,D=R,E=ia,A=na("hasPermi"),B=oa;return N(),ua(ca,null,[t(f,{title:"\u516C\u4F17\u53F7\u56FE\u6587",url:"https://doc.iocoder.cn/mp/article/"}),t(S,null,{default:o(()=>[t(q,{class:"-mb-15px",model:e(u),ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:o(()=>[t(b,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:o(()=>[t(e(L),{onChange:k})]),_:1}),t(b,null,{default:o(()=>[U((N(),ma(g,{type:"primary",plain:"",onClick:z,disabled:e(s)===0},{default:o(()=>[t(j,{icon:"ep:plus"}),a[5]||(a[5]=_("\u65B0\u589E "))]),_:1},8,["disabled"])),[[A,["mp:draft:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),t(S,null,{default:o(()=>[t(e(aa),{loading:e(v),list:e(w),onUpdate:C,onDelete:P,onPublish:O},null,8,["loading","list"]),t(D,{total:e(h),page:e(u).pageNo,"onUpdate:page":a[0]||(a[0]=r=>e(u).pageNo=r),limit:e(u).pageSize,"onUpdate:limit":a[1]||(a[1]=r=>e(u).pageSize=r),onPagination:d},null,8,["total","page","limit"])]),_:1}),t(E,{title:e(p)?"\u65B0\u5EFA\u56FE\u6587":"\u4FEE\u6539\u56FE\u6587",width:"80%",modelValue:e(m),"onUpdate:modelValue":a[4]||(a[4]=r=>V(m)?m.value=r:null),"before-close":x,"destroy-on-close":""},{footer:o(()=>[t(g,{onClick:a[3]||(a[3]=r=>m.value=!1)},{default:o(()=>a[6]||(a[6]=[_("\u53D6 \u6D88")])),_:1}),t(g,{type:"primary",onClick:J},{default:o(()=>a[7]||(a[7]=[_("\u63D0 \u4EA4")])),_:1})]),default:o(()=>[U(t(e(Z),{modelValue:e(c),"onUpdate:modelValue":a[2]||(a[2]=r=>V(c)?c.value=r:null),"is-creating":e(p)},null,8,["modelValue","is-creating"]),[[B,e(y)]])]),_:1},8,["title","modelValue"])],64)}}}),[["__scopeId","data-v-541cdc15"]]);export{da as default};
