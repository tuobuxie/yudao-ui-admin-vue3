import{d as E,aU as S,aV as k}from"./index-DmQdxAiK.js";import g from"./KeFuConversationList-D4Xxqmf2.js";import C from"./KeFuMessageList-Dbh8yP06.js";import M from"./MemberInfo-SBY1AIyF.js";import{u as A,W as l}from"./kefu-Dp5z9MFR.js";import{U as F}from"./form-designer-DHHJWkD5.js";import{l as I,r as a,b as N,e as R,P as b,A as x,q as J,B as L,J as m,u as p}from"./form-create-_84fGzaM.js";import"./emoji-CZ9IixHW.js";import"./formatTime-BGPGB_ys.js";import"./EmojiSelectPopover.vue_vue_type_script_setup_true_lang-C_E-YhOJ.js";import"./PictureSelectUpload.vue_vue_type_script_setup_true_lang-CcWUPOwo.js";import"./picture-CTjip5lJ.js";import"./ProductItem-B2VZbH4S.js";import"./OrderItem-BrOoiEbF.js";import"./constants-C3gLHYOK.js";import"./ProductBrowsingHistory.vue_vue_type_script_setup_true_lang-BfoS1saL.js";import"./OrderBrowsingHistory.vue_vue_type_script_setup_true_lang-DtSdXkdm.js";import"./index-DJfeCMK3.js";import"./CardTitle-BaQRDVCp.js";import"./UserBasicInfo-Bkw-OiEX.js";import"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import"./DescriptionsItemLabel-C4KEC3uC.js";import"./el-collapse-transition-l0sNRNKZ.js";import"./UserAccountInfo-D1wdQKIs.js";import"./index-CKzwGPO3.js";import"./index-B1idgCex.js";const U=I({name:"KeFu",__name:"index",setup(w){const c=E(),s=A(),v=a("http://47.105.43.107:48080/infra/ws".replace("http","ws")+"?token="+S()),{data:d,close:_,open:h}=k(v.value,{autoReconnect:!0,heartbeat:!0});N(()=>d.value,t=>{var r;if(t)try{if(t==="pong")return;const e=JSON.parse(t),n=e.type;if(!n)return void c.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+t);if(n===l.KEFU_MESSAGE_TYPE){const o=JSON.parse(e.content);return s.updateConversation(o.conversationId),void((r=i.value)==null?void 0:r.refreshMessageList(o))}if(n===l.KEFU_MESSAGE_ADMIN_READ){const o=JSON.parse(e.content);s.updateConversationStatus(o.conversationId)}}catch{}},{immediate:!1});const i=a(),u=a(),y=t=>{var r,e;(r=i.value)==null||r.getNewMessageList(t),(e=u.value)==null||e.initHistory(t)},f=a();return R(()=>{s.setConversationList().then(()=>{var t;(t=f.value)==null||t.calculationLastMessageTime()}),h()}),b(()=>{_()}),(t,r)=>{const e=F;return J(),x(e,{class:"kefu-layout"},{default:L(()=>[m(p(g),{ref_key:"keFuConversationRef",ref:f,onChange:y},null,512),m(p(C),{ref_key:"keFuChatBoxRef",ref:i},null,512),m(p(M),{ref_key:"memberInfoRef",ref:u},null,512)]),_:1})}}});export{U as default};
