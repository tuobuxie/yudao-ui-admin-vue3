import{X as c,a as Y,d as q}from"./index-DmQdxAiK.js";import{_ as j}from"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import{g as F}from"./index-CuiPf8R-.js";import{d as B,h as D}from"./tree-COGD3qag.js";import{g as G}from"./index-oJNTIjFE.js";import{ak as J,h as X,aj as $,x as z,Q as H,a1 as P,l as W,D as Z,f as ee}from"./form-designer-DHHJWkD5.js";import{l as ae,r,j as le,A as _,q as p,B as u,C as te,u as a,J as d,E as se,m as ue,I as oe,$ as de,G as E,h as re}from"./form-create-_84fGzaM.js";var n=(s=>(s[s.CUSTOMER_QUANTITY_LIMIT=1]="CUSTOMER_QUANTITY_LIMIT",s[s.CUSTOMER_LOCK_LIMIT=2]="CUSTOMER_LOCK_LIMIT",s))(n||{});const ie=async s=>await c.get({url:"/crm/customer-limit-config/page",params:s}),me=async s=>await c.delete({url:"/crm/customer-limit-config/delete?id="+s}),ne=ae({__name:"CustomerLimitConfigForm",emits:["success"],setup(s,{expose:L,emit:w}){const{t:C}=Y(),T=q(),i=r(!1),g=r(""),m=r(!1),b=r(""),l=r({id:void 0,type:n.CUSTOMER_LOCK_LIMIT,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1}),O=le({type:[{required:!0,message:"\u89C4\u5219\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],maxCount:[{required:!0,message:"\u6570\u91CF\u4E0A\u9650\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),f=r(),U=r(),M=r([]);L({open:async(o,e,I)=>{if(i.value=!0,g.value=C("action."+o),b.value=o,x(),I){m.value=!0;try{l.value=await(async y=>await c.get({url:"/crm/customer-limit-config/get?id="+y}))(I)}finally{m.value=!1}}else l.value.type=e;U.value=D(await F()),M.value=await G()}});const h=w,k=async()=>{if(f&&await f.value.validate()){m.value=!0;try{const o=l.value;b.value==="create"?(await(async e=>await c.post({url:"/crm/customer-limit-config/create",data:e}))(o),T.success(C("common.createSuccess"))):(await(async e=>await c.put({url:"/crm/customer-limit-config/update",data:e}))(o),T.success(C("common.updateSuccess"))),i.value=!1,h("success")}finally{m.value=!1}}},x=()=>{var o;l.value={id:void 0,type:n.CUSTOMER_LOCK_LIMIT,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1},(o=f.value)==null||o.resetFields()};return(o,e)=>{const I=H,y=z,v=$,R=P,S=W,A=Z,Q=X,V=ee,K=j,N=J;return p(),_(K,{title:a(g),modelValue:a(i),"onUpdate:modelValue":e[5]||(e[5]=t=>re(i)?i.value=t:null)},{footer:u(()=>[d(V,{onClick:k,type:"primary",disabled:a(m)},{default:u(()=>e[6]||(e[6]=[E("\u786E \u5B9A")])),_:1},8,["disabled"]),d(V,{onClick:e[4]||(e[4]=t=>i.value=!1)},{default:u(()=>e[7]||(e[7]=[E("\u53D6 \u6D88")])),_:1})]),default:u(()=>[te((p(),_(Q,{ref_key:"formRef",ref:f,model:a(l),rules:a(O),"label-width":"200px"},{default:u(()=>[d(v,{label:"\u89C4\u5219\u9002\u7528\u4EBA\u7FA4",prop:"userIds"},{default:u(()=>[d(y,{multiple:"",filterable:"",modelValue:a(l).userIds,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).userIds=t)},{default:u(()=>[(p(!0),ue(oe,null,de(a(M),t=>(p(),_(I,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(v,{label:"\u89C4\u5219\u9002\u7528\u90E8\u95E8",prop:"deptIds"},{default:u(()=>[d(R,{modelValue:a(l).deptIds,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).deptIds=t),data:a(U),props:a(B),multiple:"",filterable:"","check-strictly":"","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u89C4\u5219\u9002\u7528\u90E8\u95E8"},null,8,["modelValue","data","props"])]),_:1}),d(v,{label:a(l).type===a(n).CUSTOMER_QUANTITY_LIMIT?"\u62E5\u6709\u5BA2\u6237\u6570\u4E0A\u9650":"\u9501\u5B9A\u5BA2\u6237\u6570\u4E0A\u9650",prop:"maxCount"},{default:u(()=>[d(S,{modelValue:a(l).maxCount,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).maxCount=t),placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF\u4E0A\u9650"},null,8,["modelValue"])]),_:1},8,["label"]),a(l).type===a(n).CUSTOMER_QUANTITY_LIMIT?(p(),_(v,{key:0,label:"\u6210\u4EA4\u5BA2\u6237\u662F\u5426\u5360\u7528\u62E5\u6709\u5BA2\u6237\u6570",prop:"dealCountEnabled"},{default:u(()=>[d(A,{modelValue:a(l).dealCountEnabled,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).dealCountEnabled=t)},null,8,["modelValue"])]),_:1})):se("",!0)]),_:1},8,["model","rules"])),[[N,a(m)]])]),_:1},8,["title","modelValue"])}}});export{n as L,ne as _,me as d,ie as g};
