import{u as W,e as X,d as ee,a as ae,h as le,D as q,_ as te}from"./index-DmQdxAiK.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as se}from"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as ie}from"./index-C2x7yuaO.js";import{l as ne,r as u,j as de,e as me,ag as pe,m as f,q as o,J as a,B as s,u as l,I as _,$ as g,A as p,Z as A,G as b,C as S,H as ue,E as ce}from"./form-create-_84fGzaM.js";import{d as H}from"./formatTime-BGPGB_ys.js";import{b as fe,c as _e}from"./index-gF9XQK0o.js";import{g as be}from"./index-oJNTIjFE.js";import{a as we}from"./index-6gTZpT9M.js";import{p as ye}from"./index-BCN8BzfC.js";import{h as he,aj as ge,x as ve,Q as Ve,k as ke,F as Se,f as Te,Z as xe,_ as Ue,ak as Pe,O as De}from"./form-designer-DHHJWkD5.js";const Ce=ne({name:"BpmProcessInstanceReport",__name:"index",setup(Fe){const O=W(),{query:T}=X(),z=ee(),{t:x}=ae(),v=u(!0),U=u(0),P=u([]),V=u(),K=T.processDefinitionId,r=de({pageNo:1,pageSize:10,startUserId:void 0,name:"",processDefinitionKey:T.processDefinitionKey,status:void 0,createTime:[],endTime:[],formFieldsParams:{}}),D=u(),C=u([]),w=async()=>{v.value=!0;try{const i=await fe({...r,formFieldsParams:JSON.stringify(r.formFieldsParams)});P.value=i.list,U.value=i.total}finally{v.value=!1}},R=i=>{const t=[];return i&&i.forEach(k=>{ye(JSON.parse(k),t)}),t},y=()=>{r.pageNo=1,w()},$=()=>{D.value.resetFields(),r.formFieldsParams={},y()};return me(async()=>{await(async()=>{const i=await we(K);V.value=R(i.formFields)})(),await w(),C.value=await be()}),(i,t)=>{const k=ie,F=Ve,I=ve,d=ge,N=ke,Y=Se,B=te,h=Te,J=he,E=oe,m=Ue,j=se,Z=xe,G=re,M=pe("hasPermi"),Q=Pe;return o(),f(_,null,[a(k,{title:"\u5DE5\u4F5C\u6D41\u624B\u518C",url:"https://doc.iocoder.cn/bpm/"}),a(E,null,{default:s(()=>[a(J,{class:"-mb-15px",model:l(r),ref_key:"queryFormRef",ref:D,inline:!0,"label-width":"68px"},{default:s(()=>[a(d,{label:"\u53D1\u8D77\u4EBA",prop:"startUserId"},{default:s(()=>[a(I,{modelValue:l(r).startUserId,"onUpdate:modelValue":t[0]||(t[0]=e=>l(r).startUserId=e),placeholder:"\u8BF7\u9009\u62E9\u53D1\u8D77\u4EBA",class:"!w-240px"},{default:s(()=>[(o(!0),f(_,null,g(l(C),e=>(o(),p(F,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name"},{default:s(()=>[a(N,{modelValue:l(r).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(r).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:A(y,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status"},{default:s(()=>[a(I,{modelValue:l(r).status,"onUpdate:modelValue":t[2]||(t[2]=e=>l(r).status=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u72B6\u6001",clearable:"",class:"!w-240px"},{default:s(()=>[(o(!0),f(_,null,g(l(le)(l(q).BPM_PROCESS_INSTANCE_STATUS),e=>(o(),p(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u53D1\u8D77\u65F6\u95F4",prop:"createTime"},{default:s(()=>[a(Y,{modelValue:l(r).createTime,"onUpdate:modelValue":t[3]||(t[3]=e=>l(r).createTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),a(d,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:s(()=>[a(Y,{modelValue:l(r).endTime,"onUpdate:modelValue":t[4]||(t[4]=e=>l(r).endTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),(o(!0),f(_,null,g(l(V),(e,c)=>(o(),p(d,{key:c,label:e.title,prop:e.field},{default:s(()=>[a(N,{disabled:e.type!=="input",modelValue:l(r).formFieldsParams[e.field],"onUpdate:modelValue":n=>l(r).formFieldsParams[e.field]=n,placeholder:`\u8BF7\u8F93\u5165${e.title}`,clearable:"",onKeyup:A(y,["enter"]),class:"!w-240px"},null,8,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),a(d,null,{default:s(()=>[a(h,{onClick:y},{default:s(()=>[a(B,{icon:"ep:search",class:"mr-5px"}),t[7]||(t[7]=b(" \u641C\u7D22"))]),_:1}),a(h,{onClick:$},{default:s(()=>[a(B,{icon:"ep:refresh",class:"mr-5px"}),t[8]||(t[8]=b(" \u91CD\u7F6E"))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(E,null,{default:s(()=>[S((o(),p(Z,{border:"",data:l(P)},{default:s(()=>[a(m,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name",fixed:"left",width:"200"}),a(m,{label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA",align:"center",prop:"startUser.nickname",width:"120"}),a(m,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status",width:"120"},{default:s(e=>[a(j,{type:l(q).BPM_PROCESS_INSTANCE_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(m,{label:"\u53D1\u8D77\u65F6\u95F4",align:"center",prop:"startTime",width:"180",formatter:l(H)},null,8,["formatter"]),a(m,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"endTime",width:"180",formatter:l(H)},null,8,["formatter"]),(o(!0),f(_,null,g(l(V),(e,c)=>(o(),p(m,{key:c,label:e.title,prop:e.field,width:"120"},{default:s(n=>[b(ue(n.row.formVariables[e.field]??""),1)]),_:2},1032,["label","prop"]))),128)),a(m,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"180"},{default:s(e=>[S((o(),p(h,{link:"",type:"primary",onClick:c=>{return n=e.row,void O.push({name:"BpmProcessInstanceDetail",query:{id:n.id}});var n}},{default:s(()=>t[9]||(t[9]=[b(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[M,["bpm:process-instance:cancel"]]]),e.row.status===1?S((o(),p(h,{key:0,link:"",type:"primary",onClick:c=>(async n=>{const{value:L}=await De.prompt("\u8BF7\u8F93\u5165\u53D6\u6D88\u539F\u56E0","\u53D6\u6D88\u6D41\u7A0B",{confirmButtonText:x("common.ok"),cancelButtonText:x("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u53D6\u6D88\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});await _e(n.id,L),z.success("\u53D6\u6D88\u6210\u529F"),await w()})(e.row)},{default:s(()=>t[10]||(t[10]=[b(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[M,["bpm:process-instance:query"]]]):ce("",!0)]),_:1})]),_:1},8,["data"])),[[Q,l(v)]]),a(G,{total:l(U),page:l(r).pageNo,"onUpdate:page":t[5]||(t[5]=e=>l(r).pageNo=e),limit:l(r).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>l(r).pageSize=e),onPagination:w},null,8,["total","page","limit"])]),_:1})],64)}}});export{Ce as default};
