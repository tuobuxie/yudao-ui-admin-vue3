import{d as x,a0 as j}from"./index-B2urM1q-.js";import{_ as q}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{g as F,s as S}from"./index-B3hvL-HI.js";import{h as T,aj as A,ba as B,k as G,ak as I,f as J}from"./form-designer-DHHJWkD5.js";import{l as R,r as n,j as $,A as M,q as i,B as m,C as z,u as s,J as o,m as D,I as E,$ as H,G as V,h as K}from"./form-create-_84fGzaM.js";const L=R({name:"SystemMailTemplateSendForm",__name:"MailTemplateSendForm",setup(N,{expose:_}){const y=x(),d=n(!1),p=n(!1),e=n({content:"",params:{},toMails:[],ccMails:[],bccMails:[],templateCode:"",templateParams:new Map}),f=$({templateCode:[{required:!0,message:"\u6A21\u7248\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],templateParams:{}}),c=n();_({open:async r=>{d.value=!0,w(),p.value=!0;try{const a=await F(r);e.value.content=a.content,e.value.params=a.params,e.value.templateCode=a.code,e.value.templateParams=a.params.reduce((u,t)=>(u[t]="",u),{}),f.templateParams=a.params.reduce((u,t)=>(u[t]={required:!0,message:"\u53C2\u6570 "+t+" \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},u),{})}finally{p.value=!1}}});const h=async()=>{if(c&&await c.value.validate()){p.value=!0;try{const r=e.value,a=await S(r);a&&y.success("\u63D0\u4EA4\u53D1\u9001\u6210\u529F\uFF01\u53D1\u9001\u7ED3\u679C\uFF0C\u89C1\u53D1\u9001\u65E5\u5FD7\u7F16\u53F7\uFF1A"+a),d.value=!1}finally{p.value=!1}}},w=()=>{var r;e.value={content:"",params:{},toMails:[],ccMails:[],bccMails:[],templateCode:"",templateParams:new Map},f.templateParams={},(r=c.value)==null||r.resetFields()};return(r,a)=>{const u=j,t=A,v=B,P=G,g=T,b=J,C=q,k=I;return i(),M(C,{modelValue:s(d),"onUpdate:modelValue":a[4]||(a[4]=l=>K(d)?d.value=l:null),title:"\u6D4B\u8BD5"},{footer:m(()=>[o(b,{disabled:s(p),type:"primary",onClick:h},{default:m(()=>a[5]||(a[5]=[V("\u786E \u5B9A")])),_:1},8,["disabled"]),o(b,{onClick:a[3]||(a[3]=l=>d.value=!1)},{default:m(()=>a[6]||(a[6]=[V("\u53D6 \u6D88")])),_:1})]),default:m(()=>[z((i(),M(g,{ref_key:"formRef",ref:c,model:s(e),rules:s(f),"label-width":"140px"},{default:m(()=>[o(t,{label:"\u6A21\u677F\u5185\u5BB9",prop:"content"},{default:m(()=>[o(u,{"model-value":s(e).content,height:"150px",readonly:""},null,8,["model-value"])]),_:1}),o(t,{label:"\u6536\u4EF6\u90AE\u7BB1",prop:"toMails"},{default:m(()=>[o(v,{modelValue:s(e).toMails,"onUpdate:modelValue":a[0]||(a[0]=l=>s(e).toMails=l),placeholder:"\u8BF7\u8F93\u5165\u6536\u4EF6\u90AE\u7BB1\uFF0C\u591A\u4E2A\u90AE\u7BB1\u7528\u56DE\u8F66\u5206\u9694",class:"!w-full"},null,8,["modelValue"])]),_:1}),o(t,{label:"\u6284\u9001\u90AE\u7BB1",prop:"ccMails"},{default:m(()=>[o(v,{modelValue:s(e).ccMails,"onUpdate:modelValue":a[1]||(a[1]=l=>s(e).ccMails=l),placeholder:"\u8BF7\u8F93\u5165\u6284\u9001\u90AE\u7BB1\uFF0C\u591A\u4E2A\u90AE\u7BB1\u7528\u56DE\u8F66\u5206\u9694",class:"!w-full"},null,8,["modelValue"])]),_:1}),o(t,{label:"\u5BC6\u9001\u90AE\u7BB1",prop:"bccMails"},{default:m(()=>[o(v,{modelValue:s(e).bccMails,"onUpdate:modelValue":a[2]||(a[2]=l=>s(e).bccMails=l),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u9001\u90AE\u7BB1\uFF0C\u591A\u4E2A\u90AE\u7BB1\u7528\u56DE\u8F66\u5206\u9694",class:"!w-full"},null,8,["modelValue"])]),_:1}),(i(!0),D(E,null,H(s(e).params,l=>(i(),M(t,{key:l,label:"\u53C2\u6570 {"+l+"}",prop:"templateParams."+l},{default:m(()=>[o(P,{modelValue:s(e).templateParams[l],"onUpdate:modelValue":U=>s(e).templateParams[l]=U,placeholder:"\u8BF7\u8F93\u5165 "+l+" \u53C2\u6570"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])),[[k,s(p)]])]),_:1},8,["modelValue"])}}});export{L as _};
