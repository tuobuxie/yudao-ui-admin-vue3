import{a as K,d as W,u as Q,ak as X,z as Y,A as Z,an as $,c as ee}from"./index-DzK2S43K.js";import{_ as ae}from"./XButton-c3Z73tBC.js";import{I as le}from"./InputPassword-CSlhvdqP.js";import{_ as se}from"./Verify-DRWi7Y-t.js";import{l as oe,r as d,c as te,u as e,j as S,b as re,C as ne,K as ie,A as E,q as m,B as s,J as a,E as w,m as C,H as q}from"./form-create-_84fGzaM.js";import{u as _}from"./useIcon-DdzKJstU.js";import{u as ce,L,_ as pe,a as de}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-TLnzM6Xx.js";import{r as ue}from"./formRules-CLH8W1j7.js";import{i as me,j as fe,aj as ge,k as he,h as we,d as _e}from"./form-designer-DHHJWkD5.js";const xe={key:1,class:"getMobileCode",style:{cursor:"pointer"}},be=ee(oe({name:"ForgetPasswordForm",__name:"ForgetPasswordForm",setup(ye){const x=d(),{t}=K(),f=W(),{currentRoute:T}=Q(),b=d(),u=d(!1),z=_({icon:"ep:house"}),F=_({icon:"ep:cellphone"}),I=_({icon:"ep:circle-check"}),{validForm:U}=de(b),{handleBackLogin:j,getLoginState:A,setLoginState:R}=ce(),M=te(()=>e(A)===L.RESET_PASSWORD),B=d("blockPuzzle"),y=(i,l,r)=>{l===""?r(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):l!==o.password?r(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):r()},O={tenantName:[{required:!0,min:2,max:20,trigger:"blur",message:"\u957F\u5EA6\u4E3A4\u523016\u4F4D"}],mobile:[{required:!0,min:11,max:11,trigger:"blur",message:"\u624B\u673A\u53F7\u957F\u5EA6\u4E3A11\u4F4D"}],password:[{required:!0,min:4,max:16,validator:y,trigger:"blur",message:"\u5BC6\u7801\u957F\u5EA6\u4E3A4\u523016\u4F4D"}],check_password:[{required:!0,validator:y,trigger:"blur"}],code:[ue]},o=S({captchaEnable:"false",tenantEnable:"true",tenantName:"",username:"",password:"",check_password:"",mobile:"",code:""}),g=S({tenantName:"",mobile:"",captchaVerification:"",scene:23}),p=d(0),D=d(""),G=async()=>{o.captchaEnable==="false"?await k({}):x.value.show()},k=async i=>{o.tenantEnable==="true"&&await v(),g.captchaVerification=i.captchaVerification,g.mobile=o.mobile,await X(g).then(async()=>{f.success(t("login.SmsSendMsg")),p.value=60;let l=setInterval(()=>{p.value=p.value-1,p.value<=0&&clearInterval(l)},1e3)})};re(()=>T.value,i=>{var l;D.value=(l=i==null?void 0:i.query)==null?void 0:l.redirect},{immediate:!0});const v=async()=>{if(o.tenantEnable==="true"){const i=await Y(o.tenantName);if(i==null)throw f.error(t("login.invalidTenantName")),t("login.invalidTenantName");Z(i)}};return(i,l)=>{const r=ge,c=fe,h=he,H=se,V=me,N=le,P=ae,J=we;return ne((m(),E(J,{ref_key:"formSmsResetPassword",ref:b,model:e(o),rules:O,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:s(()=>[a(V,{class:"mx-[-10px]"},{default:s(()=>[a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,null,{default:s(()=>[a(pe,{class:"w-full"})]),_:1})]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[e(o).tenantEnable==="true"?(m(),E(r,{key:0,prop:"tenantName"},{default:s(()=>[a(h,{modelValue:e(o).tenantName,"onUpdate:modelValue":l[0]||(l[0]=n=>e(o).tenantName=n),placeholder:e(t)("login.tenantNamePlaceholder"),"prefix-icon":e(z),type:"primary",link:""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):w("",!0)]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,{prop:"mobile"},{default:s(()=>[a(h,{modelValue:e(o).mobile,"onUpdate:modelValue":l[1]||(l[1]=n=>e(o).mobile=n),placeholder:e(t)("login.mobileNumberPlaceholder"),"prefix-icon":e(F)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),a(H,{ref_key:"verify",ref:x,captchaType:e(B),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:k},null,8,["captchaType"]),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,{prop:"code"},{default:s(()=>[a(V,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:s(()=>[a(c,{span:24},{default:s(()=>[a(h,{modelValue:e(o).code,"onUpdate:modelValue":l[2]||(l[2]=n=>e(o).code=n),placeholder:e(t)("login.codePlaceholder"),"prefix-icon":e(I)},{append:s(()=>[e(p)<=0?(m(),C("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:G},q(e(t)("login.getSmsCode")),1)):w("",!0),e(p)>0?(m(),C("span",xe,q(e(p))+"\u79D2\u540E\u53EF\u91CD\u65B0\u83B7\u53D6 ",1)):w("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,{prop:"password"},{default:s(()=>[a(N,{modelValue:e(o).password,"onUpdate:modelValue":l[3]||(l[3]=n=>e(o).password=n),placeholder:e(t)("login.passwordPlaceholder"),class:"w-full",strength:!0},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,{prop:"check_password"},{default:s(()=>[a(N,{modelValue:e(o).check_password,"onUpdate:modelValue":l[4]||(l[4]=n=>e(o).check_password=n),placeholder:e(t)("login.checkPassword"),class:"w-full",strength:!0},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,null,{default:s(()=>[a(P,{loading:e(u),title:e(t)("login.resetPassword"),class:"w-full",type:"primary",onClick:l[5]||(l[5]=n=>(async()=>{await U()&&(await v(),u.value=!0,await $(o).then(async()=>{f.success(t("login.resetPasswordSuccess")),R(L.LOGIN)}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{_e.service().close()},400)}))})())},null,8,["loading","title"])]),_:1})]),_:1}),a(c,{span:24,class:"px-10px"},{default:s(()=>[a(r,null,{default:s(()=>[a(P,{loading:e(u),title:e(t)("login.backLogin"),class:"w-full",onClick:l[6]||(l[6]=n=>e(j)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[ie,e(M)]])}}}),[["__scopeId","data-v-16dac24d"]]);export{be as default};
