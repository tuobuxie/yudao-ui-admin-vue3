import{p as c,c as A}from"./index-D_TWD7wt.js";import{h as x,aj as P,x as O,Q as Z,am as S,an as H}from"./form-designer-DHHJWkD5.js";import{l as I,j as V,e as j,m as u,q as m,J as d,B as r,I as z,$ as D,A as E,x as g,G as W,H as q}from"./form-create-_84fGzaM.js";const J={key:0},K={key:1},N=A(I({__name:"index",props:{clickMap:c.bool.def(!1),isWrite:c.bool.def(!1),center:c.string.def("")},emits:["locateChange","update:center"],setup(M,{expose:f,emit:b}){const w=b,a=V({lonLat:"",address:"",loading:!1,latitude:"",longitude:"",map:null,mapAddrOptions:[],mapMarker:null,geocoder:null,autoComplete:null,tips:[]}),p=M,L=()=>{a.map=new window.BMapGL.Map("bdMap"),a.map.centerAndZoom(new window.BMapGL.Point(116.404,39.915),11),a.map.enableScrollWheelZoom(),a.map.disableDoubleClickZoom(),a.map.addControl(new window.BMapGL.NavigationControl),a.map.addControl(new window.BMapGL.ScaleControl),a.map.addControl(new window.BMapGL.ZoomControl)},h=()=>{a.geocoder=new window.BMapGL.Geocoder},k=()=>{a.autoComplete=new window.BMapGL.Autocomplete({input:"searchInput",location:a.map})},v=o=>{if(!o)return void(a.mapAddrOptions=[]);a.loading=!0,new window.BMapGL.LocalSearch(a.map,{onSearchComplete:e=>{a.loading=!1;const n=[];e&&e.getPoi&&e.getPoi().forEach(t=>{const l=t.point;l&&l.lng&&l.lat&&n.push({name:t.title,value:l.lng+","+l.lat})}),a.mapAddrOptions=n}}).search(o)},C=o=>{o&&s(o)},s=o=>{if(!o)return;const e=o.split(",");if(e.length!==2)return;a.longitude=e[0],a.latitude=e[1],w("locateChange",e),w("update:center",o);const n=new window.BMapGL.Point(e[0],e[1]);a.map.centerAndZoom(n,16),(t=>{if(!t)return;a.mapMarker!==null&&(a.map.removeOverlay(a.mapMarker),a.lonLat="");const l=new window.BMapGL.Point(t[0],t[1]);a.mapMarker=new window.BMapGL.Marker(l),a.map.addOverlay(a.mapMarker),a.map.centerAndZoom(l,16)})(e),B(e)},B=o=>{const e=new window.BMapGL.Point(o[0],o[1]);a.geocoder.getLocation(e,n=>{n&&n.address&&(a.address=n.address)})};return f({regeoCode:s}),j(()=>{(()=>{a.address="",a.latitude="",a.longitude="";const o=document.createElement("script");o.src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=efHIw2qmH8RzHPxK0z0rbCgzDVLup9LD&callback=initBaiduMap",document.body.appendChild(o),window.initBaiduMap=()=>{L(),h(),k(),p.clickMap&&a.map.addEventListener("click",e=>{const n=e.latlng;a.lonLat=n.lng+","+n.lat,s(a.lonLat)}),p.center&&s(p.center)}})()}),(o,e)=>{const n=Z,t=O,l=P,G=x,_=H,y=S;return p.isWrite?(m(),u("div",J,[d(G,{ref:"form","label-width":"120px"},{default:r(()=>[d(l,{label:"\u5B9A\u4F4D\u4F4D\u7F6E:"},{default:r(()=>[d(t,{class:"w-full",modelValue:a.address,"onUpdate:modelValue":e[0]||(e[0]=i=>a.address=i),clearable:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"\u53EF\u8F93\u5165\u5730\u5740\u67E5\u8BE2\u7ECF\u7EAC\u5EA6","remote-method":v,onChange:C,loading:a.loading},{default:r(()=>[(m(!0),u(z,null,D(a.mapAddrOptions,i=>(m(),E(n,{key:i.value,label:i.name,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),d(l,{label:"\u8BBE\u5907\u5730\u56FE:"},{default:r(()=>e[1]||(e[1]=[g("div",{id:"bdMap",class:"mapContainer"},null,-1)])),_:1})]),_:1},512)])):(m(),u("div",K,[d(y,{column:2,border:"",labelStyle:{"font-weight":"bold"}},{default:r(()=>[d(_,{label:"\u8BBE\u5907\u4F4D\u7F6E:"},{default:r(()=>[W(q(a.address),1)]),_:1})]),_:1}),e[2]||(e[2]=g("div",{id:"bdMap",class:"mapContainer"},null,-1))]))}}}),[["__scopeId","data-v-a7fa1588"]]);export{N as M};
