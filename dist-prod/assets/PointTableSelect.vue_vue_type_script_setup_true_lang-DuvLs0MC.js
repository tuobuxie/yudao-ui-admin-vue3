import{p as ee,h as ae,D as E,_ as le}from"./index-B2urM1q-.js";import{_ as te}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-Cj0jlW8o.js";import{_ as ie}from"./DictTag.vue_vue_type_script_lang-wg8pUI-B.js";import{P as re}from"./index-DDDBLsoH.js";import{f as ne}from"./formatter-pZca4aFw.js";import{d as se}from"./formatTime-BGPGB_ys.js";import{f as pe,h as de,aj as me,x as ve,Q as ce,Z as fe,_ as he,w as _e,u as we,al as ge,ak as be,b5 as B}from"./form-designer-DHHJWkD5.js";import{l as Ve,r as s,c as ye,A as _,q as f,_ as ke,B as u,J as l,G as h,C as Ce,u as o,m as Se,I as Ue,$ as Ne,h as S,H as Pe}from"./form-create-_84fGzaM.js";const Te=Ve({name:"PointTableSelect",__name:"PointTableSelect",props:{multiple:ee.bool.def(!1)},setup(U,{expose:I,emit:Q}){const N=s(0),m=s([]),y=s(!1),d=s(!1),r=s({pageNo:1,pageSize:10,name:null,status:void 0}),D=ye(()=>t=>(t.totalStock||0)-(t.stock||0));I({open:t=>{v.value=[],n.value={},p.value=!1,w.value=!1,t&&t.length>0&&(v.value=[...t],n.value=Object.fromEntries(t.map(e=>[e.id,!0]))),d.value=!0,P()}});const k=async()=>{y.value=!0;try{const t=await re.getPointActivityPage(r.value);m.value=t.list,N.value=t.total,m.value.forEach(e=>n.value[e.id]=n.value[e.id]||!1),z()}finally{y.value=!1}},F=()=>{r.value.pageNo=1,k()},P=()=>{r.value={pageNo:1,pageSize:10,name:null,status:void 0},k()},p=s(!1),w=s(!1),v=s([]),n=s({}),g=s(),G=()=>{d.value=!1,T(B,[...v.value])},T=Q,H=t=>{p.value=t,w.value=!1,m.value.forEach(e=>O(t,e,!1))},O=(t,e,C)=>{if(t)v.value.push(e),n.value[e.id]=!0;else{const b=J(e);b>-1&&(v.value.splice(b,1),n.value[e.id]=!1,p.value=!1)}C&&z()},J=t=>v.value.findIndex(e=>e.id===t.id),z=()=>{p.value=m.value.every(t=>n.value[t.id]),w.value=!p.value&&m.value.some(t=>n.value[t.id])};return(t,e)=>{const C=ce,b=ve,A=me,M=le,V=pe,L=de,j=_e,i=he,R=we,Z=ge,$=ie,K=fe,W=ue,X=oe,Y=te,x=be;return f(),_(Y,{modelValue:o(d),"onUpdate:modelValue":e[6]||(e[6]=a=>S(d)?d.value=a:null),appendToBody:!0,title:"\u9009\u62E9\u6D3B\u52A8",width:"70%"},ke({default:u(()=>[l(X,null,{default:u(()=>[l(L,{ref:"queryFormRef",inline:!0,model:o(r),class:"-mb-15px","label-width":"68px"},{default:u(()=>[l(A,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:u(()=>[l(b,{modelValue:o(r).status,"onUpdate:modelValue":e[0]||(e[0]=a=>o(r).status=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001"},{default:u(()=>[(f(!0),Se(Ue,null,Ne(o(ae)(o(E).COMMON_STATUS),a=>(f(),_(C,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(A,null,{default:u(()=>[l(V,{onClick:F},{default:u(()=>[l(M,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=h(" \u641C\u7D22 "))]),_:1}),l(V,{onClick:P},{default:u(()=>[l(M,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=h(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),Ce((f(),_(K,{data:o(m),"show-overflow-tooltip":""},{default:u(()=>[U.multiple?(f(),_(i,{key:0,width:"55"},{header:u(()=>[l(j,{modelValue:o(p),"onUpdate:modelValue":e[1]||(e[1]=a=>S(p)?p.value=a:null),indeterminate:o(w),onChange:H},null,8,["modelValue","indeterminate"])]),default:u(({row:a})=>[l(j,{modelValue:o(n)[a.id],"onUpdate:modelValue":c=>o(n)[a.id]=c,onChange:c=>O(c,a,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(f(),_(i,{key:1,label:"#",width:"55"},{default:u(({row:a})=>[l(R,{modelValue:o(g),"onUpdate:modelValue":e[2]||(e[2]=c=>S(g)?g.value=c:null),value:a.id,onChange:c=>{return T(B,q=a),d.value=!1,void(g.value=q.id);var q}},{default:u(()=>e[9]||(e[9]=[h(" \xA0 ")])),_:2},1032,["modelValue","value","onChange"])]),_:1})),l(i,{label:"\u6D3B\u52A8\u7F16\u53F7","min-width":"80",prop:"id"}),l(i,{label:"\u5546\u54C1\u56FE\u7247","min-width":"80",prop:"spuName"},{default:u(a=>[l(Z,{"preview-src-list":[a.row.picUrl],src:a.row.picUrl,class:"h-40px w-40px","preview-teleported":""},null,8,["preview-src-list","src"])]),_:1}),l(i,{label:"\u5546\u54C1\u6807\u9898","min-width":"300",prop:"spuName"}),l(i,{formatter:o(ne),label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"},null,8,["formatter"]),l(i,{label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"}),l(i,{align:"center",label:"\u6D3B\u52A8\u72B6\u6001","min-width":"100",prop:"status"},{default:u(a=>[l($,{type:o(E).COMMON_STATUS,value:a.row.status},null,8,["type","value"])]),_:1}),l(i,{align:"center",label:"\u5E93\u5B58","min-width":"80",prop:"stock"}),l(i,{align:"center",label:"\u603B\u5E93\u5B58","min-width":"80",prop:"totalStock"}),l(i,{align:"center",label:"\u5DF2\u5151\u6362\u6570\u91CF","min-width":"100",prop:"redeemedQuantity"},{default:u(({row:a})=>[h(Pe(o(D)(a)),1)]),_:1}),l(i,{formatter:o(se),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"])]),_:1},8,["data"])),[[x,o(y)]]),l(W,{limit:o(r).pageSize,"onUpdate:limit":e[3]||(e[3]=a=>o(r).pageSize=a),page:o(r).pageNo,"onUpdate:page":e[4]||(e[4]=a=>o(r).pageNo=a),total:o(N),onPagination:k},null,8,["limit","page","total"])]),_:1})]),_:2},[U.multiple?{name:"footer",fn:u(()=>[l(V,{type:"primary",onClick:G},{default:u(()=>e[10]||(e[10]=[h("\u786E \u5B9A")])),_:1}),l(V,{onClick:e[5]||(e[5]=a=>d.value=!1)},{default:u(()=>e[11]||(e[11]=[h("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Te as _};
