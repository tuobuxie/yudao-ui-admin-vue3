import{a as ie,d as de,u as ce,h as pe,D as B,_ as ue}from"./index-DmQdxAiK.js";import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-OyXbUoED.js";import{_ as fe}from"./DictTag.vue_vue_type_script_lang-DiMRMEpR.js";import{_ as ye}from"./ContentWrap.vue_vue_type_script_setup_true_lang-OPDE9cVe.js";import{_ as be}from"./index-C2x7yuaO.js";import{l as _e,r as g,j as ge,e as he,ag as we,m as L,q as r,J as a,B as l,u as t,Z as E,I as K,$ as ke,A as i,C as u,G as d,H as ve,E as V}from"./form-create-_84fGzaM.js";import{c as P}from"./permission-Dj0aJnJY.js";import{_ as Ce}from"./JobForm.vue_vue_type_script_setup_true_lang-YGTljudi.js";import{_ as je}from"./JobDetail.vue_vue_type_script_setup_true_lang-DNpGyCB1.js";import{d as xe}from"./download-oWiM5xVU.js";import{b as Se,e as Ne,d as Oe,f as Re,h as Ve,r as Pe}from"./index-CAFT8MAt.js";import{f as w}from"./constants-C3gLHYOK.js";import{h as Te,aj as qe,k as Ae,x as Je,Q as Ue,f as ze,Z as De,_ as Fe,a2 as Ie,a3 as Be,a4 as Le,ak as Ee}from"./form-designer-DHHJWkD5.js";import"./Dialog.vue_vue_type_style_index_0_lang-C4PMlRRW.js";import"./Crontab-xeBZIF_4.js";import"./formatTime-BGPGB_ys.js";const Ke=_e({name:"InfraJob",__name:"index",setup(Ze){const{t:k}=ie(),p=de(),{push:Z}=ce(),S=g(!0),T=g(0),q=g([]),s=ge({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),A=g(),N=g(!1),m=async()=>{S.value=!0;try{const n=await Se(s);q.value=n.list,T.value=n.total}finally{S.value=!1}},v=()=>{s.pageNo=1,m()},$=()=>{A.value.resetFields(),v()},G=async()=>{try{await p.exportConfirm(),N.value=!0;const n=await Ne(s);xe.excel(n,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},J=g(),U=(n,e)=>{J.value.open(n,e)},C=g([]),H=n=>{C.value=n.map(e=>e.id)},M=async()=>{try{await p.delConfirm(),await Ve(C.value),C.value=[],p.success(k("common.delSuccess")),await m()}catch{}},Q=async n=>{try{await p.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+n.name+"?",k("common.reminder")),await Pe(n.id),p.success("\u6267\u884C\u6210\u529F"),await m()}catch{}},z=g(),Y=n=>{z.value.open(n)},D=n=>{Z(n&&n>0?"/job/job-log?id="+n:"/job/job-log")};return he(()=>{m()}),(n,e)=>{const O=be,F=Ae,j=qe,W=Ue,X=Je,h=ue,c=ze,ee=Te,I=ye,f=Fe,ae=fe,R=Le,le=Be,oe=Ie,te=De,ne=me,y=we("hasPermi"),re=Ee;return r(),L(K,null,[a(O,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),a(O,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),a(O,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),a(I,null,{default:l(()=>[a(ee,{class:"-mb-15px",model:t(s),ref_key:"queryFormRef",ref:A,inline:!0,"label-width":"100px"},{default:l(()=>[a(j,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:l(()=>[a(F,{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=o=>t(s).name=o),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:E(v,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(j,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:l(()=>[a(X,{modelValue:t(s).status,"onUpdate:modelValue":e[1]||(e[1]=o=>t(s).status=o),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(r(!0),L(K,null,ke(t(pe)(t(B).INFRA_JOB_STATUS),o=>(r(),i(W,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(j,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:l(()=>[a(F,{modelValue:t(s).handlerName,"onUpdate:modelValue":e[2]||(e[2]=o=>t(s).handlerName=o),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:E(v,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(j,null,{default:l(()=>[a(c,{onClick:v},{default:l(()=>[a(h,{icon:"ep:search",class:"mr-5px"}),e[7]||(e[7]=d(" \u641C\u7D22"))]),_:1}),a(c,{onClick:$},{default:l(()=>[a(h,{icon:"ep:refresh",class:"mr-5px"}),e[8]||(e[8]=d(" \u91CD\u7F6E"))]),_:1}),u((r(),i(c,{type:"primary",plain:"",onClick:e[3]||(e[3]=o=>U("create"))},{default:l(()=>[a(h,{icon:"ep:plus",class:"mr-5px"}),e[9]||(e[9]=d(" \u65B0\u589E "))]),_:1})),[[y,["infra:job:create"]]]),u((r(),i(c,{type:"danger",plain:"",disabled:t(C).length===0,onClick:M},{default:l(()=>[a(h,{icon:"ep:delete",class:"mr-5px"}),e[10]||(e[10]=d(" \u6279\u91CF\u5220\u9664 "))]),_:1},8,["disabled"])),[[y,["infra:job:delete"]]]),u((r(),i(c,{type:"success",plain:"",onClick:G,loading:t(N)},{default:l(()=>[a(h,{icon:"ep:download",class:"mr-5px"}),e[11]||(e[11]=d(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[y,["infra:job:export"]]]),u((r(),i(c,{type:"info",plain:"",onClick:e[4]||(e[4]=o=>D())},{default:l(()=>[a(h,{icon:"ep:zoom-in",class:"mr-5px"}),e[12]||(e[12]=d(" \u6267\u884C\u65E5\u5FD7 "))]),_:1})),[[y,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(I,null,{default:l(()=>[u((r(),i(te,{data:t(q),onSelectionChange:H},{default:l(()=>[a(f,{type:"selection",width:"55"}),a(f,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),a(f,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(f,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:l(o=>[a(ae,{type:t(B).INFRA_JOB_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),a(f,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),a(f,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),a(f,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),a(f,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:l(o=>[u((r(),i(c,{type:"primary",link:"",onClick:x=>U("update",o.row.id)},{default:l(()=>e[13]||(e[13]=[d(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),u((r(),i(c,{type:"primary",link:"",onClick:x=>(async b=>{try{const _=b.status===w.STOP?"\u5F00\u542F":"\u5173\u95ED";await p.confirm("\u786E\u8BA4\u8981"+_+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+b.id+'"\u7684\u6570\u636E\u9879?',k("common.reminder"));const se=b.status===w.STOP?w.NORMAL:w.STOP;await Oe(b.id,se),p.success(_+"\u6210\u529F"),await m()}catch{}})(o.row)},{default:l(()=>[d(ve(o.row.status===t(w).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),u((r(),i(c,{type:"danger",link:"",onClick:x=>(async b=>{try{await p.delConfirm(),await Re(b),p.success(k("common.delSuccess")),await m()}catch{}})(o.row.id)},{default:l(()=>e[14]||(e[14]=[d(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[y,["infra:job:delete"]]]),u((r(),i(oe,{onCommand:x=>((b,_)=>{switch(b){case"handleRun":Q(_);break;case"openDetail":Y(_.id);break;case"handleJobLog":D(_==null?void 0:_.id)}})(x,o.row)},{dropdown:l(()=>[a(le,null,{default:l(()=>[t(P)(["infra:job:trigger"])?(r(),i(R,{key:0,command:"handleRun"},{default:l(()=>e[16]||(e[16]=[d(" \u6267\u884C\u4E00\u6B21 ")])),_:1})):V("",!0),t(P)(["infra:job:query"])?(r(),i(R,{key:1,command:"openDetail"},{default:l(()=>e[17]||(e[17]=[d(" \u4EFB\u52A1\u8BE6\u7EC6 ")])),_:1})):V("",!0),t(P)(["infra:job:query"])?(r(),i(R,{key:2,command:"handleJobLog"},{default:l(()=>e[18]||(e[18]=[d(" \u8C03\u5EA6\u65E5\u5FD7 ")])),_:1})):V("",!0)]),_:1})]),default:l(()=>[a(c,{type:"primary",link:""},{default:l(()=>[a(h,{icon:"ep:d-arrow-right"}),e[15]||(e[15]=d(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[y,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[re,t(S)]]),a(ne,{total:t(T),page:t(s).pageNo,"onUpdate:page":e[5]||(e[5]=o=>t(s).pageNo=o),limit:t(s).pageSize,"onUpdate:limit":e[6]||(e[6]=o=>t(s).pageSize=o),onPagination:m},null,8,["total","page","limit"])]),_:1}),a(Ce,{ref_key:"formRef",ref:J,onSuccess:m},null,512),a(je,{ref_key:"detailRef",ref:z},null,512)],64)}}});export{Ke as default};
