import{a as ee,d as le,_ as ae,$ as se,h as te,D as G,g as re,c as ue}from"./index-B2urM1q-.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{d as de,h as ne}from"./tree-COGD3qag.js";import{g as pe}from"./index-CRqoysqb.js";import{ak as ce,i as me,j as ve,y as fe,f as P,aj as ye,k as ge,o as ke,x as be,Q as xe,s as _e,u as he,ah as Ve,h as Ue}from"./form-designer-DHHJWkD5.js";import{l as Z,r as c,A as _,q as u,u as n,h as Ie,B as t,C as Ce,J as a,G as m,n as we,ar as qe,as as De,b as Le,m as v,x as H,I as V,$ as L,H as U,E as J}from"./form-create-_84fGzaM.js";import{_ as Ae}from"./index-hV7105lN.js";import"./index-Bix5n4IG.js";const Se=Z({name:"DeptSelectForm",__name:"index",props:{checkStrictly:{type:Boolean,default:!1},multiple:{type:Boolean,default:!0}},emits:["confirm"],setup(I,{expose:E,emit:A}){const T=A,{t:C}=ee(),w=le(),q=I,f=c(),D=c([]),p=c([]),h=c(!1),e=c(!1),R=(k,o)=>{if(p.value=f.value.getCheckedKeys(),!q.multiple&&p.value.length>1){const y=p.value[p.value.length-1];p.value=[y],f.value.setCheckedKeys([y])}},F=async()=>{try{const k=f.value.getCheckedNodes();w.success(C("common.updateSuccess")),h.value=!1,T("confirm",k)}finally{}},K=()=>{D.value=[],p.value=[],f.value&&f.value.setCheckedKeys([])};return E({open:async k=>{var o;K(),e.value=!0;try{const y=await pe();D.value=ne(y)}finally{e.value=!1}if(h.value=!0,k==null?void 0:k.length){await we();const y=k.map(r=>r.id).filter(r=>r!==void 0);p.value=y,(o=f.value)==null||o.setCheckedKeys(y)}}}),(k,o)=>{const y=fe,r=oe,s=ve,i=me,d=P,b=ie,g=ce;return u(),_(b,{modelValue:n(h),"onUpdate:modelValue":o[1]||(o[1]=x=>Ie(h)?h.value=x:null),title:"\u90E8\u95E8\u9009\u62E9",width:"600"},{footer:t(()=>{var x;return[a(d,{disabled:n(e)||!((x=n(p))!=null&&x.length),type:"primary",onClick:F},{default:t(()=>o[2]||(o[2]=[m(" \u786E \u5B9A ")])),_:1},8,["disabled"]),a(d,{onClick:o[0]||(o[0]=N=>h.value=!1)},{default:t(()=>o[3]||(o[3]=[m("\u53D6 \u6D88")])),_:1})]}),default:t(()=>[Ce((u(),_(i,null,{default:t(()=>[a(s,{span:24},{default:t(()=>[a(r,{class:"h-1/1"},{default:t(()=>[a(y,{ref_key:"treeRef",ref:f,data:n(D),props:n(de),"show-checkbox":"","check-strictly":I.checkStrictly,"check-on-click-node":"","default-expand-all":"","highlight-current":"","node-key":"id",onCheck:R},null,8,["data","props","check-strictly"])]),_:1})]),_:1})]),_:1})),[[g,n(e)]])]),_:1},8,["modelValue"])}}}),Be={class:"flex items-center"},Te={key:0,class:"mt-2 flex flex-wrap gap-2"},ze={key:1,class:"mt-2 flex flex-wrap gap-2"},Ee={class:"flex flex-wrap gap-2"},Re=ue(Z({__name:"BasicInfo",props:qe({categoryList:{type:Array,required:!0},userList:{type:Array,required:!0},deptList:{type:Array,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(I,{expose:E}){const A=I,T=c(),C=c([]),w=c([]),q=c([]),f=c(),D=c(),p=c("start"),h={name:[{required:!0,message:"\u6D41\u7A0B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],key:[{required:!0,message:"\u6D41\u7A0B\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:(r,s,i)=>{s?/^[a-zA-Z_][\-_.0-9_a-zA-Z$]*$/.test(s)?i():i(new Error("\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u8FDE\u5B57\u7B26\u548C\u70B9\u53F7\uFF0C\u4E14\u5FC5\u987B\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934")):i()},trigger:"blur"}],category:[{required:!0,message:"\u6D41\u7A0B\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],type:[{required:!0,message:"\u662F\u5426\u53EF\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],visible:[{required:!0,message:"\u662F\u5426\u53EF\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],managerUserIds:[{required:!0,message:"\u6D41\u7A0B\u7BA1\u7406\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},e=De(I,"modelValue");Le(()=>e.value,r=>{var s,i,d;(s=r.startUserIds)!=null&&s.length?C.value=A.userList.filter(b=>r.startUserIds.includes(b.id)):C.value=[],(i=r.startDeptIds)!=null&&i.length?w.value=A.deptList.filter(b=>r.startDeptIds.includes(b.id)):w.value=[],(d=r.managerUserIds)!=null&&d.length?q.value=A.userList.filter(b=>r.managerUserIds.includes(b.id)):q.value=[]},{immediate:!0});const R=()=>{p.value="start",f.value.open(0,C.value)},F=()=>{D.value.open(w.value)},K=()=>{p.value="manager",f.value.open(0,q.value)},k=(r,s)=>{p.value==="start"?e.value={...e.value,startUserIds:s.map(i=>i.id)}:e.value={...e.value,managerUserIds:s.map(i=>i.id)}},o=r=>{e.value={...e.value,startDeptIds:r.map(s=>s.id)}},y=r=>{r===0?e.value={...e.value,startUserIds:[],startDeptIds:[]}:r===1?e.value={...e.value,startDeptIds:[]}:r===2&&(e.value={...e.value,startUserIds:[]})};return E({validate:async()=>{var r;await((r=T.value)==null?void 0:r.validate())}}),(r,s)=>{const i=ge,d=ae,b=ke,g=ye,x=xe,N=be,Q=se,j=he,M=_e,z=Ve,$=P,X=Ue,Y=Ae,W=Se;return u(),v(V,null,[a(X,{ref_key:"formRef",ref:T,model:e.value,rules:h,"label-width":"120px",class:"mt-20px"},{default:t(()=>[a(g,{label:"\u6D41\u7A0B\u6807\u8BC6",prop:"key",class:"mb-20px"},{default:t(()=>[H("div",Be,[a(i,{class:"!w-440px",modelValue:e.value.key,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.key=l),disabled:!!e.value.id,placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u6807\u8BC6\uFF0C\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934"},null,8,["modelValue","disabled"]),a(b,{class:"item",content:e.value.id?"\u6D41\u7A0B\u6807\u8BC6\u4E0D\u53EF\u4FEE\u6539\uFF01":"\u65B0\u5EFA\u540E\uFF0C\u6D41\u7A0B\u6807\u8BC6\u4E0D\u53EF\u4FEE\u6539\uFF01",effect:"light",placement:"top"},{default:t(()=>[a(d,{icon:"ep:question-filled",class:"ml-5px"})]),_:1},8,["content"])])]),_:1}),a(g,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name",class:"mb-20px"},{default:t(()=>[a(i,{modelValue:e.value.name,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value.name=l),disabled:!!e.value.id,clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0"},null,8,["modelValue","disabled"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u5206\u7C7B",prop:"category",class:"mb-20px"},{default:t(()=>[a(N,{class:"!w-full",modelValue:e.value.category,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.category=l),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u5206\u7C7B"},{default:t(()=>[(u(!0),v(V,null,L(I.categoryList,l=>(u(),_(x,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u56FE\u6807",class:"mb-20px"},{default:t(()=>[a(Q,{modelValue:e.value.icon,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.icon=l),limit:1,height:"64px",width:"64px"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u63CF\u8FF0",prop:"description",class:"mb-20px"},{default:t(()=>[a(i,{modelValue:e.value.description,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.description=l),clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u7C7B\u578B",prop:"type",class:"mb-20px"},{default:t(()=>[a(M,{modelValue:e.value.type,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.type=l)},{default:t(()=>[(u(!0),v(V,null,L(n(te)(n(G).BPM_MODEL_TYPE),l=>(u(),_(j,{key:l.value,value:l.value},{default:t(()=>[m(U(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u662F\u5426\u53EF\u89C1",prop:"visible",class:"mb-20px"},{default:t(()=>[a(M,{modelValue:e.value.visible,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.visible=l)},{default:t(()=>[(u(!0),v(V,null,L(n(re)(n(G).INFRA_BOOLEAN_STRING),l=>(u(),_(j,{key:l.value,value:l.value},{default:t(()=>[m(U(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u8C01\u53EF\u4EE5\u53D1\u8D77",prop:"startUserType",class:"mb-20px"},{default:t(()=>[a(N,{modelValue:e.value.startUserType,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.startUserType=l),placeholder:"\u8BF7\u9009\u62E9\u8C01\u53EF\u4EE5\u53D1\u8D77",onChange:y},{default:t(()=>[a(x,{label:"\u5168\u5458",value:0}),a(x,{label:"\u6307\u5B9A\u4EBA\u5458",value:1}),a(x,{label:"\u6307\u5B9A\u90E8\u95E8",value:2})]),_:1},8,["modelValue"]),e.value.startUserType===1?(u(),v("div",Te,[(u(!0),v(V,null,L(n(C),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[l.avatar?(u(),_(z,{key:0,class:"!m-5px",size:28,src:l.avatar},null,8,["src"])):(u(),_(z,{key:1,class:"!m-5px",size:28},{default:t(()=>[m(U(l.nickname.substring(0,1)),1)]),_:2},1024)),m(" "+U(l.nickname)+" ",1),a(d,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:O=>(S=>{e.value={...e.value,startUserIds:e.value.startUserIds.filter(B=>B!==S.id)}})(l)},null,8,["onClick"])]))),128)),a($,{type:"primary",link:"",onClick:R},{default:t(()=>[a(d,{icon:"ep:plus"}),s[8]||(s[8]=m(" \u9009\u62E9\u4EBA\u5458 "))]),_:1})])):J("",!0),e.value.startUserType===2?(u(),v("div",ze,[(u(!0),v(V,null,L(n(w),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[a(d,{icon:"ep:office-building",class:"!m-5px text-20px"}),m(" "+U(l.name)+" ",1),a(d,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:O=>(S=>{e.value={...e.value,startDeptIds:e.value.startDeptIds.filter(B=>B!==S.id)}})(l)},null,8,["onClick"])]))),128)),a($,{type:"primary",link:"",onClick:F},{default:t(()=>[a(d,{icon:"ep:plus"}),s[9]||(s[9]=m(" \u9009\u62E9\u90E8\u95E8 "))]),_:1})])):J("",!0)]),_:1}),a(g,{label:"\u6D41\u7A0B\u7BA1\u7406\u5458",prop:"managerUserIds",class:"mb-20px"},{default:t(()=>[H("div",Ee,[(u(!0),v(V,null,L(n(q),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[l.avatar?(u(),_(z,{key:0,class:"!m-5px",size:28,src:l.avatar},null,8,["src"])):(u(),_(z,{key:1,class:"!m-5px",size:28},{default:t(()=>[m(U(l.nickname.substring(0,1)),1)]),_:2},1024)),m(" "+U(l.nickname)+" ",1),a(d,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:O=>(S=>{e.value={...e.value,managerUserIds:e.value.managerUserIds.filter(B=>B!==S.id)}})(l)},null,8,["onClick"])]))),128)),a($,{type:"primary",link:"",onClick:K},{default:t(()=>[a(d,{icon:"ep:plus"}),s[10]||(s[10]=m("\u9009\u62E9\u4EBA\u5458 "))]),_:1})])]),_:1})]),_:1},8,["model"]),a(Y,{ref_key:"userSelectFormRef",ref:f,onConfirm:k},null,512),a(W,{ref_key:"deptSelectFormRef",ref:D,multiple:!0,"check-strictly":!0,onConfirm:o},null,512)],64)}}}),[["__scopeId","data-v-8c316930"]]);export{Re as default};
