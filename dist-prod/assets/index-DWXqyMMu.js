import{d as de,_ as me,H as X,E as ve,D as J,b as fe,c as ye}from"./index-B2urM1q-.js";import{_ as ge}from"./index.vue_vue_type_script_setup_true_lang-Cj0jlW8o.js";import{_ as be}from"./DictTag.vue_vue_type_script_lang-wg8pUI-B.js";import{_ as _e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BRGqERh7.js";import{_ as we}from"./index-Cb5mbozM.js";import{l as xe,r as s,j as he,e as ke,ag as Ue,m as _,q as u,J as e,B as r,I as N,$ as R,A as m,C as f,u as i,K as Se,G as y,x as O,H as w}from"./form-create-_84fGzaM.js";import{f as Pe,e as Ie}from"./index-BhCMOSLE.js";import{a as Ne}from"./index-DXQ1o6-R.js";import{f as Ve}from"./formatter-pZca4aFw.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-PuuYa4VK.js";import{d as Te}from"./formatTime-BGPGB_ys.js";import{D as Ce}from"./constants-C3gLHYOK.js";import{_ as qe}from"./OrderPickUpForm.vue_vue_type_script_setup_true_lang-Brs_4_D7.js";import{h as De,aj as Re,F as Fe,x as je,Q as Ae,k as Ee,f as Oe,j as Be,ak as He,i as Ye,Z as ze,_ as Me,al as $e,a6 as Ge}from"./form-designer-DHHJWkD5.js";import"./CountTo.vue_vue_type_script_setup_true_lang-BpjX4GIa.js";import"./Dialog.vue_vue_type_style_index_0_lang-bMayE4GC.js";import"./index-4g9dnD_P.js";import"./OrderUpdateRemarkForm.vue_vue_type_script_setup_true_lang-DESxVIHb.js";import"./OrderDeliveryForm.vue_vue_type_script_setup_true_lang-Be9V5N9B.js";import"./index-dGs5GZA3.js";import"./OrderUpdateAddressForm.vue_vue_type_script_setup_true_lang-DTxUuek5.js";import"./index-jyjhpj6h.js";import"./tree-COGD3qag.js";import"./OrderUpdatePriceForm.vue_vue_type_script_setup_true_lang-BbXrqHop.js";import"./tagsView-DIbur9wp.js";const Ke={class:"mr-10px"},Le={class:"flex flex-col flex-wrap gap-1"},Xe=ye(xe({name:"PickUpOrder",__name:"index",setup(Je){const x=de(),g=s(""),Q=s([]),V=s(""),v=s(!0),B=s(2),H=s([]),Y=s(),z={pageNo:1,pageSize:10,createTime:void 0,deliveryType:Ce.PICK_UP.type,pickUpStoreIds:-1},t=s({...z}),h=he({queryParam:"no"}),k=s(),T=s(!1),U=s(!0),M=s([{value:"no",label:"\u8BA2\u5355\u53F7"},{value:"userId",label:"\u7528\u6237 UID"},{value:"userNickname",label:"\u7528\u6237\u6635\u79F0"},{value:"userMobile",label:"\u7528\u6237\u7535\u8BDD"}]),Z=o=>{var l;(l=M.value.filter(n=>n.value!==o))==null||l.forEach(n=>{t.value.hasOwnProperty(n.value)&&delete t.value[n.value]})},C=async()=>{v.value=!0;try{k.value=await Pe(i(t));const o=await Ie(i(t));H.value=o.list,B.value=o.total}finally{v.value=!1}},j=async()=>{t.value.pageNo=1,await C()},W=()=>{var o;(o=Y.value)==null||o.resetFields(),t.value={...z},d.value.length>0&&(t.value.pickUpStoreIds=d.value[0].id),j()},d=s([]),A=s(),ee=()=>{A.value.open()},ae=async()=>{try{if(!("serial"in navigator)||navigator.serial==null||typeof navigator.serial!="object"||!("requestPort"in navigator.serial))return void x.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u626B\u7801\u67AA\u8FDE\u63A5\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668\u91CD\u8BD5");g.value=await navigator.serial.requestPort(),Q.value=await navigator.serial.getPorts(),await g.value.open({baudRate:9600,dataBits:8,stopBits:2}),x.success("\u6210\u529F\u8FDE\u63A5\u626B\u7801\u67AA"),T.value=!0,le()}catch{}},le=async()=>{V.value=g.value.readable.getReader();let o="";for(;;){const{value:l,done:n}=await V.value.read();if(n){V.value.releaseLock();break}const q=new TextDecoder().decode(l);if(o=`${o}${q}`,q.includes("\r")){let b=o.replace("\r","");o="",A.value.open(b)}}},re=async()=>{g.value!==""?(await V.value.cancel(),await g.value.close(),g.value="",x.success("\u5DF2\u6210\u529F\u65AD\u5F00\u626B\u7801\u67AA\u8FDE\u63A5"),T.value=!1):x.warning("\u8BF7\u5148\u8FDE\u63A5\u6216\u6253\u5F00\u626B\u7801\u67AA")};return ke(async()=>{if(await(async()=>{d.value=await Ne();const o=fe().getUser.id;d.value=d.value.filter(l=>{var n;return(n=l.verifyUserIds)==null?void 0:n.includes(o)})})(),d.value.length===0)return x.error("\u5F53\u524D\u767B\u5F55\u4EBA\u6CA1\u7ED1\u5B9A\u4EFB\u4F55\u81EA\u63D0\u70B9"),v.value=!1,void(U.value=!0);t.value.pickUpStoreIds=d.value[0].id,U.value=!1,await C()}),(o,l)=>{const n=we,q=Fe,b=Re,$=Ae,G=je,te=Ee,E=me,S=Oe,oe=De,K=_e,D=Be,ue=Ye,p=Me,se=$e,ie=Ge,L=be,ne=ze,pe=ge,ce=Ue("hasPermi"),P=He;return u(),_(N,null,[e(n,{title:"\u3010\u4EA4\u6613\u3011\u4EA4\u6613\u8BA2\u5355",url:"https://doc.iocoder.cn/mall/trade-order/"}),e(n,{title:"\u3010\u4EA4\u6613\u3011\u8D2D\u7269\u8F66",url:"https://doc.iocoder.cn/mall/trade-cart/"}),e(K,null,{default:r(()=>[e(oe,{ref_key:"queryFormRef",ref:Y,inline:!0,model:t.value,class:"-mb-15px","label-width":"68px"},{default:r(()=>[e(b,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:r(()=>[e(q,{modelValue:t.value.createTime,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-280px","end-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4","start-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(b,{label:"\u81EA\u63D0\u95E8\u5E97",prop:"pickUpStoreIds"},{default:r(()=>[e(G,{modelValue:t.value.pickUpStoreIds,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.pickUpStoreIds=a),class:"!w-280px",placeholder:"\u5168\u90E8",onChange:j},{default:r(()=>[(u(!0),_(N,null,R(d.value,a=>(u(),m($,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"\u805A\u5408\u641C\u7D22"},{default:r(()=>[f(e(te,{modelValue:t.value[i(h).queryParam],"onUpdate:modelValue":l[3]||(l[3]=a=>t.value[i(h).queryParam]=a),class:"!w-280px",clearable:"",placeholder:"\u8BF7\u8F93\u5165",type:i(h).queryParam==="userId"?"number":"text"},{prepend:r(()=>[e(G,{modelValue:i(h).queryParam,"onUpdate:modelValue":l[2]||(l[2]=a=>i(h).queryParam=a),class:"!w-110px",placeholder:"\u5168\u90E8",onChange:Z},{default:r(()=>[(u(!0),_(N,null,R(M.value,a=>(u(),m($,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","type"]),[[Se,!0]])]),_:1}),e(b,null,{default:r(()=>[e(S,{onClick:j},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:search"}),l[6]||(l[6]=y(" \u641C\u7D22 "))]),_:1}),e(S,{onClick:W},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:refresh"}),l[7]||(l[7]=y(" \u91CD\u7F6E "))]),_:1}),f((u(),m(S,{onClick:ee,type:"success",plain:"",disabled:U.value},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:check"}),l[8]||(l[8]=y(" \u6838\u9500 "))]),_:1},8,["disabled"])),[[ce,["trade:order:pick-up"]]]),e(S,{type:"primary",onClick:ae,disabled:T.value||U.value},{default:r(()=>l[9]||(l[9]=[y(" \u8FDE\u63A5\u626B\u63CF\u67AA ")])),_:1},8,["disabled"]),e(S,{type:"danger",onClick:re,disabled:!T.value||U.value},{default:r(()=>l[10]||(l[10]=[y(" \u65AD\u5F00\u626B\u63CF\u67AA ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ue,{gutter:16,class:"summary"},{default:r(()=>[f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u8BA2\u5355\u6570\u91CF",icon:"icon-park-outline:transaction-order","icon-color":"bg-blue-100","icon-bg-color":"text-blue-500",value:((a=k.value)==null?void 0:a.orderCount)||0},null,8,["value"])]}),_:1})),[[P,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u8BA2\u5355\u91D1\u989D",icon:"streamline:money-cash-file-dollar-common-money-currency-cash-file","icon-color":"bg-purple-100","icon-bg-color":"text-purple-500",prefix:"\uFFE5",decimals:2,value:i(X)(((a=k.value)==null?void 0:a.orderPayPrice)||0)},null,8,["value"])]}),_:1})),[[P,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u9000\u6B3E\u5355\u6570",icon:"heroicons:receipt-refund","icon-color":"bg-yellow-100","icon-bg-color":"text-yellow-500",value:((a=k.value)==null?void 0:a.afterSaleCount)||0},null,8,["value"])]}),_:1})),[[P,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u9000\u6B3E\u91D1\u989D",icon:"ri:refund-2-line","icon-color":"bg-green-100","icon-bg-color":"text-green-500",prefix:"\uFFE5",decimals:2,value:i(X)(((a=k.value)==null?void 0:a.afterSalePrice)||0)},null,8,["value"])]}),_:1})),[[P,v.value]])]),_:1}),e(K,null,{default:r(()=>[f((u(),m(ne,{data:H.value},{default:r(()=>[e(p,{label:"\u8BA2\u5355\u53F7",align:"center",prop:"no","min-width":"180"}),e(p,{label:"\u7528\u6237\u4FE1\u606F",align:"center",prop:"user.nickname","min-width":"80"}),e(p,{label:"\u63A8\u8350\u4EBA\u4FE1\u606F",align:"center",prop:"brokerageUser.nickname","min-width":"100"}),e(p,{label:"\u5546\u54C1\u4FE1\u606F",align:"center",prop:"spuName","min-width":"300"},{default:r(({row:a})=>[(u(!0),_(N,null,R(a.items,c=>(u(),_("div",{class:"flex items-center",key:c.id},[e(se,{src:c.picUrl,class:"mr-10px h-30px w-30px flex-shrink-0","preview-src-list":[c.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"]),O("span",Ke,w(c.spuName),1),O("div",Le,[(u(!0),_(N,null,R(c.properties,I=>(u(),m(ie,{key:I.propertyId,class:"mr-10px"},{default:r(()=>[y(w(I.propertyName)+": "+w(I.valueName),1)]),_:2},1024))),128)),O("span",null,w(i(ve)(c.price))+" \u5143 x "+w(c.count),1)])]))),128))]),_:1}),e(p,{label:"\u5B9E\u4ED8\u91D1\u989D(\u5143)",align:"center",prop:"payPrice","min-width":"110",formatter:i(Ve)},null,8,["formatter"]),e(p,{label:"\u6838\u9500\u5458",align:"center",prop:"storeStaffName","min-width":"70"}),e(p,{label:"\u6838\u9500\u95E8\u5E97",align:"center",prop:"pickUpStoreId","min-width":"80"},{default:r(({row:a})=>{var c;return[y(w((c=d.value.find(I=>I.id===a.pickUpStoreId))==null?void 0:c.name),1)]}),_:1}),e(p,{label:"\u652F\u4ED8\u72B6\u6001",align:"center",prop:"payStatus","min-width":"80"},{default:r(({row:a})=>[e(L,{type:i(J).INFRA_BOOLEAN_STRING,value:a.payStatus||!1},null,8,["type","value"])]),_:1}),e(p,{align:"center",label:"\u8BA2\u5355\u72B6\u6001",prop:"status",width:"120"},{default:r(({row:a})=>[e(L,{type:i(J).TRADE_ORDER_STATUS,value:a.status},null,8,["type","value"])]),_:1}),e(p,{label:"\u4E0B\u5355\u65F6\u95F4",align:"center",prop:"createTime","min-width":"170",formatter:i(Te)},null,8,["formatter"])]),_:1},8,["data"])),[[P,v.value]]),e(pe,{limit:t.value.pageSize,"onUpdate:limit":l[4]||(l[4]=a=>t.value.pageSize=a),page:t.value.pageNo,"onUpdate:page":l[5]||(l[5]=a=>t.value.pageNo=a),total:B.value,onPagination:C},null,8,["limit","page","total"])]),_:1}),e(qe,{ref_key:"pickUpForm",ref:A,onSuccess:C},null,512)],64)}}}),[["__scopeId","data-v-7496f02f"]]);export{Xe as default};
